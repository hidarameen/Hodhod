{"file_contents":{"main.py":{"content":"def main():\n    print(\"Hello from repl-nix-workspace!\")\n\n\nif __name__ == \"__main__\":\n    main()\n","path":null,"size_bytes":96,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"server/github-sync.ts":{"content":"/**\n * GitHub Sync Service - SIMPLIFIED & ROBUST\n * Push ALL files from Replit workspace to GitHub with force overwrite\n */\n\nimport { Octokit } from \"@octokit/rest\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\n\nconst execAsync = promisify(exec);\n\n// Increase buffer size for large git operations (10MB instead of default 1MB)\nconst EXEC_OPTIONS = { \n  maxBuffer: 10 * 1024 * 1024,\n  shell: '/bin/bash',\n  timeout: 120000 // 2 minutes timeout\n};\n\nlet connectionSettings: any;\n\nasync function getAccessToken(): Promise<string> {\n  if (\n    connectionSettings &&\n    connectionSettings.settings.expires_at &&\n    new Date(connectionSettings.settings.expires_at).getTime() > Date.now()\n  ) {\n    return connectionSettings.settings.access_token;\n  }\n\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? \"repl \" + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n      ? \"depl \" + process.env.WEB_REPL_RENEWAL\n      : null;\n\n  if (!xReplitToken) {\n    console.error(\"X_REPLIT_TOKEN not found\");\n    return \"\";\n  }\n\n  try {\n    const response = await fetch(\n      \"https://\" +\n        hostname +\n        \"/api/v2/connection?include_secrets=true&connector_names=github\",\n      {\n        headers: {\n          Accept: \"application/json\",\n          X_REPLIT_TOKEN: xReplitToken,\n        },\n      }\n    );\n\n    const data = (await response.json()) as any;\n    connectionSettings = data.items?.[0];\n\n    const accessToken =\n      connectionSettings?.settings?.access_token ||\n      connectionSettings?.settings?.oauth?.credentials?.access_token;\n\n    if (!connectionSettings || !accessToken) {\n      console.error(\"GitHub not connected\");\n      return \"\";\n    }\n\n    return accessToken;\n  } catch (error) {\n    console.error(\"Failed to get access token:\", error);\n    return \"\";\n  }\n}\n\nasync function getGitHubClient(): Promise<Octokit | null> {\n  const accessToken = await getAccessToken();\n  if (!accessToken) {\n    return null;\n  }\n  return new Octokit({ auth: accessToken });\n}\n\nexport async function getGitHubInfo(): Promise<{\n  owner: string;\n  repo: string;\n} | null> {\n  try {\n    const client = await getGitHubClient();\n    if (!client) return null;\n\n    const user = await client.users.getAuthenticated();\n    const repos = await client.repos.listForAuthenticatedUser({ per_page: 100 });\n\n    const matchingRepo = repos.data.find(\n      (r) =>\n        r.name.toLowerCase().includes(\"telegram\") ||\n        r.name.toLowerCase().includes(\"bot\")\n    );\n\n    if (matchingRepo) {\n      return {\n        owner: matchingRepo.owner.login,\n        repo: matchingRepo.name,\n      };\n    }\n\n    console.log(\"Found repositories:\", repos.data.map((r) => r.name).join(\", \"));\n    return null;\n  } catch (error) {\n    console.error(\"Error getting GitHub info:\", error);\n    return null;\n  }\n}\n\nexport async function listGitHubRepos(): Promise<\n  Array<{ name: string; owner: string; url: string; private: boolean }>\n> {\n  try {\n    const client = await getGitHubClient();\n    if (!client) return [];\n\n    const user = await client.users.getAuthenticated();\n    const repos = await client.repos.listForAuthenticatedUser({ per_page: 100 });\n\n    console.log(\"[GitHub] Authenticated user:\", user.data.login);\n\n    const result = repos.data.map((r: any) => {\n      const ownerLogin = r.owner?.login || user.data.login || \"unknown\";\n      return {\n        name: r.name,\n        owner: ownerLogin,\n        url: r.html_url,\n        private: r.private || false,\n      };\n    });\n\n    return result;\n  } catch (error) {\n    console.error(\"Error listing repos:\", error);\n    return [];\n  }\n}\n\nexport async function getBranches(): Promise<string[]> {\n  try {\n    const result = await execAsync(\"git branch -a --format='%(refname:short)'\", EXEC_OPTIONS);\n    const branches = result.stdout\n      ?.split(\"\\n\")\n      .filter((b) => b.trim() && !b.includes(\"HEAD\"))\n      .map((b) => b.trim())\n      .filter((b, i, arr) => arr.indexOf(b) === i) || [];\n\n    const currentBranch = await execAsync(\"git rev-parse --abbrev-ref HEAD\", EXEC_OPTIONS);\n    const current = currentBranch.stdout?.trim() || \"main\";\n\n    const filtered = branches.filter((b) => !b.includes(\"origin/\") || b === `origin/${current}`);\n    const clean = filtered.map((b) => b.replace(\"origin/\", \"\"));\n\n    return [current, ...clean.filter((b) => b !== current)];\n  } catch (error) {\n    console.error(\"Error getting branches:\", error);\n    return [\"main\"];\n  }\n}\n\nexport async function getFileChanges(): Promise<{\n  modified: string[];\n  created: string[];\n  deleted: string[];\n}> {\n  try {\n    const result = await execAsync(\"git diff --name-status HEAD~1..HEAD 2>/dev/null || git diff --name-status 2>/dev/null || echo ''\", EXEC_OPTIONS);\n    const output = result.stdout?.trim() || \"\";\n\n    const modified: string[] = [];\n    const created: string[] = [];\n    const deleted: string[] = [];\n\n    output.split(\"\\n\").forEach((line) => {\n      if (!line) return;\n      const [status, file] = line.split(\"\\t\");\n      if (status === \"M\") modified.push(file);\n      else if (status === \"A\") created.push(file);\n      else if (status === \"D\") deleted.push(file);\n    });\n\n    return { modified, created, deleted };\n  } catch (error) {\n    console.error(\"[GitHub] Error getting file changes:\", error);\n    return { modified: [], created: [], deleted: [] };\n  }\n}\n\n/**\n * PUSH ALL FILES FROM REPLIT TO GITHUB\n * - Adds ALL files (including ignored ones with --force)\n * - Commits with provided message\n * - Force pushes to replace everything in GitHub\n * - GitHub becomes identical to Replit after this operation\n */\nexport async function pushToGitHubRepo(\n  owner: string,\n  repo: string,\n  message: string,\n  targetBranch: string = \"main\"\n): Promise<{ success: boolean }> {\n  const startTime = Date.now();\n  try {\n    console.log(\"\\n[GitHub] ========================================\");\n    console.log(\"[GitHub] üöÄ Starting Complete Workspace Push\");\n    console.log(\"[GitHub] ========================================\");\n    console.log(`[GitHub] Owner: ${owner}`);\n    console.log(`[GitHub] Repository: ${repo}`);\n    console.log(`[GitHub] Target Branch: ${targetBranch}`);\n    console.log(`[GitHub] Commit Message: ${message}`);\n    console.log(\"[GitHub] ========================================\\n\");\n\n    // Step 1: Clean up\n    console.log(\"[GitHub] ‚öôÔ∏è Step 1: Cleanup...\");\n    try {\n      await execAsync('rm -f /home/runner/workspace/.git/index.lock 2>/dev/null || true', EXEC_OPTIONS);\n    } catch (e) {\n      // ignore\n    }\n    console.log(\"[GitHub] ‚úì Cleanup done\\n\");\n\n    // Step 2: Configure Git\n    console.log(\"[GitHub] ‚öôÔ∏è Step 2: Configure Git...\");\n    await execAsync('git config user.email \"replit-bot@replit.com\"', EXEC_OPTIONS);\n    await execAsync('git config user.name \"Replit Auto-Sync\"', EXEC_OPTIONS);\n    console.log(\"[GitHub] ‚úì Git configured\\n\");\n\n    // Step 3: Get token\n    console.log(\"[GitHub] üîë Step 3: Retrieve GitHub token...\");\n    const accessToken = await getAccessToken();\n    if (!accessToken) {\n      console.error(\"[GitHub] ‚úó No GitHub token available\");\n      return { success: false };\n    }\n    console.log(\"[GitHub] ‚úì Token retrieved\\n\");\n\n    // Step 4: Configure remote\n    console.log(\"[GitHub] üîó Step 4: Configure remote...\");\n    try {\n      await execAsync(`git remote remove origin 2>/dev/null || true`, EXEC_OPTIONS);\n    } catch (e) {\n      // ignore\n    }\n    const remoteUrl = `https://oauth2:${accessToken}@github.com/${owner}/${repo}.git`;\n    await execAsync(`git remote add origin \"${remoteUrl}\"`, EXEC_OPTIONS);\n    console.log(\"[GitHub] ‚úì Remote configured\\n\");\n\n    // Step 5: Add all tracked project files (respecting .gitignore)\n    console.log(\"[GitHub] üì¶ Step 5: Adding all project files...\");\n    await execAsync(\"git add .\", EXEC_OPTIONS);\n    console.log(\"[GitHub] ‚úì Project files added\\n\");\n\n    // Step 6: Get file count summary\n    console.log(\"[GitHub] üìä Step 6: Analyzing changes...\");\n    let fileCount = 0;\n    try {\n      const lsResult = await execAsync(\"git ls-files | wc -l\", EXEC_OPTIONS);\n      fileCount = parseInt(lsResult.stdout?.trim() || \"0\") || 0;\n      console.log(`[GitHub] ‚úì Total files in staging: ${fileCount}\\n`);\n    } catch (e) {\n      console.log(\"[GitHub] ‚ÑπÔ∏è Could not count files\\n\");\n    }\n\n    // Step 7: Check if there are changes\n    console.log(\"[GitHub] ‚úì Step 7: Check for changes...\");\n    const statusResult = await execAsync(\"git status --porcelain 2>/dev/null | wc -l\", EXEC_OPTIONS);\n    const changesCount = parseInt(statusResult.stdout?.trim() || \"0\") || 0;\n    if (changesCount > 0) {\n      console.log(`[GitHub] ‚úì Found ${changesCount} changes to commit\\n`);\n    } else {\n      console.log(\"[GitHub] ‚ÑπÔ∏è No new changes detected (will force push anyway)\\n\");\n    }\n\n    // Step 8: Commit\n    console.log(\"[GitHub] üíæ Step 8: Creating commit...\");\n    try {\n      // Use single quotes with proper escaping for Arabic characters\n      const escapedMsg = message.replace(/'/g, \"'\\\\''\");\n      const commitResult = await execAsync(`git commit -m '${escapedMsg}'`, EXEC_OPTIONS);\n      const hashMatch = commitResult.stdout?.match(/\\[.*? ([a-f0-9]+)\\]/);\n      const commitHash = hashMatch ? hashMatch[1].substring(0, 7) : \"unknown\";\n      console.log(`[GitHub] ‚úì Commit created: ${commitHash}\\n`);\n    } catch (e: any) {\n      // Might fail if nothing to commit, but we'll push anyway\n      console.log(\"[GitHub] ‚ÑπÔ∏è No new commits needed (might already be up to date)\\n\");\n    }\n\n    // Step 9: Push with force (this will OVERWRITE GitHub with Replit content)\n    console.log(\"[GitHub] üöÄ Step 9: Force pushing to GitHub...\");\n    console.log(`[GitHub] This will replace all GitHub content with Replit workspace content\\n`);\n    \n    const pushResult = await execAsync(\n      `git push --force --set-upstream origin ${targetBranch}`,\n      EXEC_OPTIONS\n    );\n    \n    console.log(\"[GitHub] Push output:\", pushResult.stdout);\n    console.log(\"[GitHub] ‚úì Force push completed\\n\");\n\n    // Final summary\n    const duration = ((Date.now() - startTime) / 1000).toFixed(1);\n    console.log(\"\\n[GitHub] ========================================\");\n    console.log(\"[GitHub] ‚úÖ PUSH SUCCESSFUL!\");\n    console.log(\"[GitHub] ========================================\");\n    console.log(`[GitHub] Files synced: ${fileCount}`);\n    console.log(`[GitHub] Branch: ${targetBranch}`);\n    console.log(`[GitHub] Duration: ${duration}s`);\n    console.log(\"[GitHub] Status: GitHub now equals Replit workspace\");\n    console.log(\"[GitHub] ========================================\\n\");\n\n    return { success: true };\n  } catch (error: any) {\n    const duration = ((Date.now() - startTime) / 1000).toFixed(1);\n    console.error(\"\\n[GitHub] ‚úó PUSH FAILED!\");\n    console.error(\"[GitHub] Error details:\", error.message || error);\n    if (error.stderr) {\n      console.error(\"[GitHub] Git stderr:\", error.stderr);\n    }\n    console.error(`[GitHub] Duration: ${duration}s`);\n    console.log(\"[GitHub] ========================================\\n\");\n    return { success: false };\n  }\n}\n\nexport async function pushToGitHub(message: string): Promise<boolean> {\n  try {\n    console.log(\"[GitHub] Starting push with message:\", message);\n\n    await execAsync('git config user.email \"replit-bot@replit.com\"', EXEC_OPTIONS);\n    await execAsync('git config user.name \"Replit Auto-Sync\"', EXEC_OPTIONS);\n\n    const accessToken = await getAccessToken();\n    if (!accessToken) {\n      console.error(\"[GitHub] No access token available\");\n      return false;\n    }\n\n    const githubInfo = await getGitHubInfo();\n    if (!githubInfo) {\n      console.error(\"[GitHub] Could not get GitHub repository info\");\n      return false;\n    }\n\n    await execAsync(\"git add .\", EXEC_OPTIONS);\n    console.log(\"[GitHub] Staged changes\");\n\n    const statusResult = await execAsync(\"git status --porcelain\", EXEC_OPTIONS);\n    if (!statusResult.stdout) {\n      console.log(\"[GitHub] No changes to commit\");\n      return true;\n    }\n\n    const escapedMessage = message.replace(/'/g, \"'\\\\''\");\n    await execAsync(`git commit -m '${escapedMessage}'`, EXEC_OPTIONS);\n    console.log(\"[GitHub] Commit created\");\n\n    const remoteUrl = `https://oauth2:${accessToken}@github.com/${githubInfo.owner}/${githubInfo.repo}.git`;\n    await execAsync(`git push --force -u origin HEAD:main`, EXEC_OPTIONS);\n    console.log(\"[GitHub] Push successful\");\n\n    return true;\n  } catch (error) {\n    console.error(\"[GitHub] Push failed:\", error);\n    return false;\n  }\n}\n","path":null,"size_bytes":12661,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background text-foreground p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3851,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-all duration-300 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 bg-gray-300 dark:bg-slate-400 data-[state=checked]:bg-green-500 dark:data-[state=checked]:bg-green-600 data-[state=unchecked]:bg-gray-300 dark:data-[state=unchecked]:bg-slate-400\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none absolute h-4 w-4 rounded-full bg-white dark:bg-white shadow-lg ring-0 transition-all duration-300 ease-in-out data-[state=checked]:right-0.5 data-[state=checked]:left-auto data-[state=unchecked]:left-0.5 data-[state=unchecked]:right-auto\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1381,"size_tokens":null},"telegram_bot/services/video_processor.py":{"content":"\"\"\"\nVideo Processing Service\nConvert video to audio, transcribe with Whisper, and summarize with AI\nEnhanced with file size validation, timeout handling, and retry mechanisms\n\"\"\"\nimport os\nimport asyncio\nfrom typing import Dict, Any, Optional, Tuple\nfrom utils.error_handler import handle_errors, ErrorLogger, TaskLogger\nfrom utils.database import db\nfrom services.ai_providers import ai_manager\nfrom services.ai_pipeline import ai_pipeline\nfrom services.telegraph_service import telegraph_manager\n\nerror_logger = ErrorLogger(\"video_processor\")\n\nMAX_VIDEO_SIZE_MB = 100\nMAX_AUDIO_SIZE_MB = 25\nEXTRACTION_TIMEOUT = 180\nTRANSCRIPTION_TIMEOUT = 300\nSUPPORTED_VIDEO_EXTENSIONS = {'.mp4', '.avi', '.mkv', '.mov', '.webm', '.flv', '.wmv', '.m4v'}\n\nclass VideoProcessor:\n    \"\"\"Process video messages with enhanced validation and error handling\"\"\"\n    \n    def __init__(self, temp_dir: str = \"telegram_bot/temp\"):\n        self.temp_dir = temp_dir\n        os.makedirs(temp_dir, exist_ok=True)\n        error_logger.log_info(\"VideoProcessor initialized\")\n    \n    def _get_file_size_mb(self, file_path: str) -> float:\n        \"\"\"Get file size in megabytes\"\"\"\n        if os.path.exists(file_path):\n            return os.path.getsize(file_path) / (1024 * 1024)\n        return 0\n    \n    def _validate_video_file(self, video_path: str) -> Tuple[bool, str]:\n        \"\"\"Validate video file before processing\"\"\"\n        if not video_path:\n            return False, \"Video path is empty\"\n        \n        if not os.path.exists(video_path):\n            return False, f\"Video file not found: {video_path}\"\n        \n        file_size_mb = self._get_file_size_mb(video_path)\n        if file_size_mb > MAX_VIDEO_SIZE_MB:\n            return False, f\"Video too large: {file_size_mb:.1f}MB (max: {MAX_VIDEO_SIZE_MB}MB)\"\n        \n        if file_size_mb < 0.001:\n            return False, \"Video file is empty or corrupted\"\n        \n        ext = os.path.splitext(video_path)[1].lower()\n        if ext not in SUPPORTED_VIDEO_EXTENSIONS:\n            error_logger.log_warning(f\"Unsupported video extension: {ext}, attempting anyway\")\n        \n        return True, \"Valid\"\n    \n    @handle_errors(\"video_processor\", \"extract_audio\")\n    async def extract_audio(self, video_path: str, timeout: int = EXTRACTION_TIMEOUT) -> Optional[str]:\n        \"\"\"Extract audio from video file with timeout and validation\"\"\"\n        try:\n            is_valid, validation_msg = self._validate_video_file(video_path)\n            if not is_valid:\n                error_logger.log_warning(f\"Video validation failed: {validation_msg}\")\n                return None\n            \n            import ffmpeg\n            \n            audio_path = video_path.rsplit(\".\", 1)[0] + \".mp3\"\n            \n            error_logger.log_info(f\"Extracting audio from video: {video_path} -> {audio_path}\")\n            \n            def run_ffmpeg():\n                stream = ffmpeg.input(video_path)\n                stream = ffmpeg.output(\n                    stream, \n                    audio_path, \n                    acodec='libmp3lame', \n                    ar='16000',\n                    ac=1,\n                    ab='64k'\n                )\n                ffmpeg.run(stream, overwrite_output=True, quiet=True)\n            \n            loop = asyncio.get_event_loop()\n            await asyncio.wait_for(\n                loop.run_in_executor(None, run_ffmpeg),\n                timeout=timeout\n            )\n            \n            if os.path.exists(audio_path):\n                audio_size_mb = self._get_file_size_mb(audio_path)\n                \n                if audio_size_mb > MAX_AUDIO_SIZE_MB:\n                    error_logger.log_warning(f\"Audio file too large for transcription: {audio_size_mb:.1f}MB (max: {MAX_AUDIO_SIZE_MB}MB)\")\n                    return None\n                \n                if audio_size_mb < 0.001:\n                    error_logger.log_warning(\"Audio extraction produced empty file\")\n                    if os.path.exists(audio_path):\n                        os.remove(audio_path)\n                    return None\n                \n                error_logger.log_info(f\"Audio extracted successfully: {audio_path} ({audio_size_mb:.2f}MB)\")\n                return audio_path\n            \n            return None\n            \n        except asyncio.TimeoutError:\n            error_logger.log_warning(f\"Audio extraction timeout after {timeout}s\")\n            return None\n        except Exception as e:\n            error_logger.log_info(f\"Audio extraction error: {str(e)}\")\n            return None\n    \n    @handle_errors(\"video_processor\", \"process_video\")\n    async def process_video(\n        self,\n        client,\n        message_id: int,\n        chat_id: int,\n        task_id: int,\n        task_config: Dict[str, Any]\n    ) -> Optional[Tuple[str, str, Optional[str]]]:\n        \"\"\"\n        Process video: download -> extract audio -> transcribe -> summarize -> create Telegraph page\n        Returns tuple of (summary, transcript, telegraph_url)\n        \n        Enhanced with:\n        - File size validation\n        - Timeout handling for all operations\n        - Better error recovery\n        - Comprehensive logging\n        \"\"\"\n        task_logger = TaskLogger(task_id)\n        video_path = None\n        audio_path = None\n        \n        try:\n            await task_logger.log_info(\"Starting video processing...\")\n            \n            try:\n                message = await asyncio.wait_for(\n                    client.get_messages(chat_id, message_id),\n                    timeout=30\n                )\n            except asyncio.TimeoutError:\n                await task_logger.log_error(\"Timeout fetching message\")\n                return None\n            \n            if not message or not message.video:\n                await task_logger.log_warning(\"Video not found in message\")\n                return None\n            \n            video_size_mb = (message.video.file_size or 0) / (1024 * 1024)\n            if video_size_mb > MAX_VIDEO_SIZE_MB:\n                await task_logger.log_warning(f\"Video too large: {video_size_mb:.1f}MB (max: {MAX_VIDEO_SIZE_MB}MB)\")\n                return None\n            \n            await task_logger.log_info(f\"Video info: {video_size_mb:.1f}MB, duration: {message.video.duration or 0}s\")\n            \n            video_path = os.path.join(\n                self.temp_dir,\n                f\"video_{message_id}_{int(asyncio.get_event_loop().time())}.mp4\"\n            )\n            \n            await task_logger.log_info(\"Downloading video...\")\n            download_timeout = max(60, int(video_size_mb * 10))\n            try:\n                await asyncio.wait_for(\n                    message.download(file_name=video_path),\n                    timeout=download_timeout\n                )\n            except asyncio.TimeoutError:\n                await task_logger.log_error(f\"Video download timeout after {download_timeout}s\")\n                return None\n            \n            is_valid, validation_msg = self._validate_video_file(video_path)\n            if not is_valid:\n                await task_logger.log_warning(f\"Downloaded video validation failed: {validation_msg}\")\n                return None\n            \n            file_size_mb = self._get_file_size_mb(video_path)\n            await task_logger.log_info(f\"Video downloaded: {file_size_mb:.2f}MB\")\n            \n            await task_logger.log_info(\"Extracting audio from video...\")\n            audio_path = await self.extract_audio(video_path)\n            \n            if not audio_path:\n                await task_logger.log_warning(\"Failed to extract audio from video\")\n                return None\n            \n            await task_logger.log_info(\"Transcribing audio with Whisper...\")\n            try:\n                transcript = await asyncio.wait_for(\n                    ai_manager.transcribe_audio(audio_path),\n                    timeout=TRANSCRIPTION_TIMEOUT\n                )\n            except asyncio.TimeoutError:\n                await task_logger.log_error(f\"Transcription timeout after {TRANSCRIPTION_TIMEOUT}s\")\n                return None\n            \n            if not transcript or not transcript.strip():\n                await task_logger.log_warning(\"Transcription failed or returned empty result\")\n                return None\n            \n            transcript = transcript.strip()\n            await task_logger.log_info(f\"Transcription completed: {len(transcript)} characters\")\n            \n            provider_id = task_config.get(\"video_ai_provider_id\") or task_config.get(\"summarization_provider_id\")\n            model_id = task_config.get(\"video_ai_model_id\") or task_config.get(\"summarization_model_id\")\n            \n            # Get video rules specifically (not text summarization rules)\n            rules = await db.get_task_rules(task_id)\n            video_rule = next((r for r in rules if r[\"type\"] == \"video\" and r[\"is_active\"]), None)\n            await task_logger.log_info(f\"Found video rules: {len([r for r in rules if r['type'] == 'video'])}, active: {video_rule is not None}\")\n            \n            provider_name = \"groq\"\n            model_name = \"llama-3.3-70b-versatile\"\n            \n            if provider_id:\n                provider_info = await db.get_ai_provider(provider_id)\n                if provider_info:\n                    provider_name = provider_info[\"name\"]\n            \n            if model_id:\n                model_info = await db.get_ai_model(model_id)\n                if model_info:\n                    model_name = model_info[\"model_name\"]\n            \n            custom_rule = video_rule[\"prompt\"] if video_rule else None\n            if video_rule:\n                await task_logger.log_info(f\"Using video rule: {video_rule.get('name', 'unnamed')}\")\n            \n            await task_logger.log_info(f\"Summarizing transcript with AI Pipeline ({provider_name}/{model_name})...\")\n            # Apply BOTH video rules AND summarize rules\n            video_rules = [r for r in rules if r[\"type\"] == \"video\" and r[\"is_active\"]]\n            summarize_rules = [r for r in rules if r[\"type\"] == \"summarize\" and r[\"is_active\"]]\n            all_applicable_rules = video_rules + summarize_rules\n            \n            # Video source info not available for direct video uploads\n            # Only available when processing links via link_processor\n            video_source_info = None\n            \n            pipeline_result = await ai_pipeline.process(\n                text=transcript,\n                task_id=task_id,\n                provider=provider_name,\n                model=model_name,\n                system_prompt=custom_rule,\n                custom_rules=all_applicable_rules,\n                video_source_info=video_source_info\n            )\n            summary = pipeline_result.final_text\n            await task_logger.log_info(f\"Pipeline processing complete: {len(summary)} chars (quality: {pipeline_result.quality_score:.2f})\")\n            \n            await task_logger.log_info(\"Creating Telegraph page for original transcript...\")\n            telegraph_url = None\n            try:\n                telegraph_url = await telegraph_manager.create_text_page(\n                    title=\"ŸÜÿµ ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑÿ£ÿµŸÑŸä\",\n                    content=transcript,\n                    description=\"ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÖŸÜ ÿßŸÑŸÅŸäÿØŸäŸà ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Whisper\"\n                )\n                if telegraph_url:\n                    await task_logger.log_success(f\"Telegraph page created: {telegraph_url}\")\n                else:\n                    await task_logger.log_warning(\"Telegraph page creation returned empty URL\")\n            except Exception as telegraph_err:\n                await task_logger.log_warning(f\"Failed to create Telegraph page: {str(telegraph_err)}\")\n            \n            summary_len = len(summary) if summary else 0\n            await task_logger.log_success(f\"Video processing completed. Summary: {summary_len} chars, Telegraph: {telegraph_url or 'N/A'}\")\n            await db.update_task_stats(task_id, \"video\")\n            \n            return (summary, transcript, telegraph_url)\n            \n        except Exception as e:\n            await task_logger.log_error(f\"Video processing error: {str(e)}\")\n            await db.update_task_stats(task_id, \"error\")\n            raise\n        finally:\n            self._cleanup_temp_files([video_path, audio_path])\n    \n    def _cleanup_temp_files(self, file_paths: list):\n        \"\"\"Safely cleanup temporary files\"\"\"\n        for file_path in file_paths:\n            if file_path and os.path.exists(file_path):\n                try:\n                    os.remove(file_path)\n                    error_logger.log_info(f\"Cleaned up temp file: {file_path}\")\n                except Exception as e:\n                    error_logger.log_warning(f\"Failed to cleanup {file_path}: {str(e)}\")\n    \n    async def cleanup_old_temp_files(self, max_age_hours: int = 24):\n        \"\"\"Cleanup old temporary files that might be left over\"\"\"\n        import time\n        try:\n            current_time = time.time()\n            max_age_seconds = max_age_hours * 3600\n            cleaned = 0\n            \n            for filename in os.listdir(self.temp_dir):\n                filepath = os.path.join(self.temp_dir, filename)\n                if os.path.isfile(filepath):\n                    file_age = current_time - os.path.getmtime(filepath)\n                    if file_age > max_age_seconds:\n                        try:\n                            os.remove(filepath)\n                            cleaned += 1\n                        except Exception:\n                            pass\n            \n            if cleaned > 0:\n                error_logger.log_info(f\"Cleaned up {cleaned} old temp files\")\n        except Exception as e:\n            error_logger.log_warning(f\"Temp cleanup error: {str(e)}\")\n\nvideo_processor = VideoProcessor()\n","path":null,"size_bytes":13955,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, boolean, jsonb, serial } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Users and Admins\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  role: text(\"role\").notNull().default(\"user\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const admins = pgTable(\"admins\", {\n  id: serial(\"id\").primaryKey(),\n  telegramId: text(\"telegram_id\").notNull().unique(),\n  username: text(\"username\"),\n  addedBy: integer(\"added_by\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Channels and Sources\nexport const channels = pgTable(\"channels\", {\n  id: serial(\"id\").primaryKey(),\n  type: text(\"type\").notNull(), // 'telegram_channel' | 'telegram_group' | 'website'\n  identifier: text(\"identifier\").notNull(), // channel ID or URL\n  title: text(\"title\"),\n  description: text(\"description\"),\n  metadata: jsonb(\"metadata\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// AI Providers and Models\nexport const aiProviders = pgTable(\"ai_providers\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull().unique(), // 'openai' | 'groq' | 'huggingface' | 'claude'\n  displayName: text(\"display_name\"),\n  apiKey: text(\"api_key\"),\n  baseUrl: text(\"base_url\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  config: jsonb(\"config\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const aiModels = pgTable(\"ai_models\", {\n  id: serial(\"id\").primaryKey(),\n  providerId: integer(\"provider_id\").notNull().references(() => aiProviders.id),\n  modelName: text(\"model_name\").notNull(),\n  displayName: text(\"display_name\").notNull(),\n  capabilities: jsonb(\"capabilities\"),\n  \n  // Rate limits\n  tpmLimit: integer(\"tpm_limit\"), // Tokens Per Minute\n  rpmLimit: integer(\"rpm_limit\"), // Requests Per Minute\n  tpdLimit: integer(\"tpd_limit\"), // Tokens Per Day\n  \n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Forwarding Tasks\nexport const forwardingTasks = pgTable(\"forwarding_tasks\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  \n  // Source and target channels (arrays of channel IDs)\n  sourceChannels: jsonb(\"source_channels\").notNull(), // [1, 2, 3]\n  targetChannels: jsonb(\"target_channels\").notNull(), // [4, 5, 6]\n  \n  // AI Configuration (master toggle)\n  aiEnabled: boolean(\"ai_enabled\").notNull().default(false),\n  aiProviderId: integer(\"ai_provider_id\").references(() => aiProviders.id),\n  aiModelId: integer(\"ai_model_id\").references(() => aiModels.id),\n  \n  // Text Summarization\n  summarizationEnabled: boolean(\"summarization_enabled\").notNull().default(false),\n  summarizationProviderId: integer(\"summarization_provider_id\").references(() => aiProviders.id),\n  summarizationModelId: integer(\"summarization_model_id\").references(() => aiModels.id),\n  \n  // Video Processing\n  videoProcessingEnabled: boolean(\"video_processing_enabled\").notNull().default(false),\n  videoAiProviderId: integer(\"video_ai_provider_id\").references(() => aiProviders.id),\n  videoAiModelId: integer(\"video_ai_model_id\").references(() => aiModels.id),\n  \n  // Audio Processing (voice messages and audio files)\n  audioProcessingEnabled: boolean(\"audio_processing_enabled\").notNull().default(false),\n  audioAiProviderId: integer(\"audio_ai_provider_id\").references(() => aiProviders.id),\n  audioAiModelId: integer(\"audio_ai_model_id\").references(() => aiModels.id),\n  \n  // Link Processing (download videos from social media links)\n  linkProcessingEnabled: boolean(\"link_processing_enabled\").notNull().default(false),\n  linkVideoDownloadEnabled: boolean(\"link_video_download_enabled\").notNull().default(true),\n  linkVideoQuality: text(\"link_video_quality\").notNull().default(\"high\"), // 'low' | 'medium' | 'high' | 'best'\n  \n  // Statistics\n  totalForwarded: integer(\"total_forwarded\").notNull().default(0),\n  lastForwardedAt: timestamp(\"last_forwarded_at\"),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// AI Rules for Tasks (Enhanced with multiple rule types)\nexport const aiRules = pgTable(\"ai_rules\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").notNull().references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  type: text(\"type\").notNull(), // 'summarize' | 'audio_summarize' | 'video_summarize' | 'transform' | 'filter' | 'entity_replace' | 'context_neutralize' | 'sentiment_adjust' | 'format'\n  category: text(\"category\").notNull().default(\"general\"), // 'preprocessing' | 'processing' | 'postprocessing' | 'general'\n  name: text(\"name\").notNull(),\n  prompt: text(\"prompt\").notNull(),\n  config: jsonb(\"config\"), // Additional configuration for the rule\n  isActive: boolean(\"is_active\").notNull().default(true),\n  priority: integer(\"priority\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Entity Replacement Rules (for name substitutions like \"ŸÖÿ≠ŸÖÿØ ŸÖÿµÿ∑ŸÅŸâ\" ‚Üí \"ÿßŸÑÿ®ÿ∑ŸÑ ŸÖÿ≠ŸÖÿØ ŸÖÿµÿ∑ŸÅŸâ\")\nexport const aiEntityReplacements = pgTable(\"ai_entity_replacements\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").notNull().references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  entityType: text(\"entity_type\").notNull(), // 'person' | 'organization' | 'location' | 'event' | 'custom'\n  originalText: text(\"original_text\").notNull(),\n  replacementText: text(\"replacement_text\").notNull(),\n  caseSensitive: boolean(\"case_sensitive\").notNull().default(false),\n  useContext: boolean(\"use_context\").notNull().default(true), // AI analyzes context before replacing\n  isActive: boolean(\"is_active\").notNull().default(true),\n  priority: integer(\"priority\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Context Rules (for sentiment/tone adjustments)\nexport const aiContextRules = pgTable(\"ai_context_rules\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").notNull().references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  ruleType: text(\"rule_type\").notNull(), // 'neutralize_negative' | 'enhance_positive' | 'formal_tone' | 'remove_bias' | 'custom'\n  triggerPattern: text(\"trigger_pattern\"), // Regex or keywords that trigger this rule\n  targetSentiment: text(\"target_sentiment\"), // 'neutral' | 'positive' | 'formal' | 'professional'\n  instructions: text(\"instructions\").notNull(), // AI instructions for this context rule\n  examples: jsonb(\"examples\"), // Example transformations for AI learning\n  isActive: boolean(\"is_active\").notNull().default(true),\n  priority: integer(\"priority\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// AI Training Examples (for learning user preferences)\nexport const aiTrainingExamples = pgTable(\"ai_training_examples\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").notNull().references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  exampleType: text(\"example_type\").notNull(), // 'correction' | 'preference' | 'style' | 'terminology'\n  inputText: text(\"input_text\").notNull(),\n  expectedOutput: text(\"expected_output\").notNull(),\n  explanation: text(\"explanation\"), // Why this transformation is preferred\n  tags: jsonb(\"tags\"), // ['politics', 'sports', 'formal']\n  useCount: integer(\"use_count\").notNull().default(0),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// AI Processing Configuration (global and per-task settings)\nexport const aiProcessingConfig = pgTable(\"ai_processing_config\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  configType: text(\"config_type\").notNull(), // 'global' | 'task_specific'\n  \n  // Preprocessing options\n  enableEntityExtraction: boolean(\"enable_entity_extraction\").notNull().default(true),\n  enableSentimentAnalysis: boolean(\"enable_sentiment_analysis\").notNull().default(true),\n  enableKeywordDetection: boolean(\"enable_keyword_detection\").notNull().default(true),\n  \n  // Processing options\n  maxRetries: integer(\"max_retries\").notNull().default(3),\n  timeoutSeconds: integer(\"timeout_seconds\").notNull().default(60),\n  preserveFormatting: boolean(\"preserve_formatting\").notNull().default(true),\n  \n  // Postprocessing options\n  enableOutputValidation: boolean(\"enable_output_validation\").notNull().default(true),\n  enableRuleVerification: boolean(\"enable_rule_verification\").notNull().default(true),\n  outputFormat: text(\"output_format\").notNull().default(\"markdown\"), // 'plain' | 'markdown' | 'html'\n  \n  // Quality settings\n  temperature: text(\"temperature\").notNull().default(\"0.7\"),\n  qualityLevel: text(\"quality_level\").notNull().default(\"balanced\"), // 'fast' | 'balanced' | 'high_quality'\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// AI Usage Statistics\nexport const aiUsageStats = pgTable(\"ai_usage_stats\", {\n  id: serial(\"id\").primaryKey(),\n  providerId: integer(\"provider_id\").notNull().references(() => aiProviders.id),\n  modelId: integer(\"model_id\").references(() => aiModels.id),\n  modelName: text(\"model_name\").notNull(),\n  taskId: integer(\"task_id\").references(() => forwardingTasks.id),\n  \n  // Usage metrics\n  requestCount: integer(\"request_count\").notNull().default(0),\n  totalTokensInput: integer(\"total_tokens_input\").notNull().default(0),\n  totalTokensOutput: integer(\"total_tokens_output\").notNull().default(0),\n  totalCost: text(\"total_cost\"),\n  \n  // Time tracking\n  usageDate: timestamp(\"usage_date\").notNull(),\n  \n  // Additional metadata\n  avgLatency: integer(\"avg_latency\"),\n  errorCount: integer(\"error_count\").notNull().default(0),\n  successCount: integer(\"success_count\").notNull().default(0),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Task Logs\nexport const taskLogs = pgTable(\"task_logs\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  level: text(\"level\").notNull(), // 'info' | 'warning' | 'error' | 'success'\n  message: text(\"message\").notNull(),\n  metadata: jsonb(\"metadata\"),\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n});\n\n// Error Logs\nexport const errorLogs = pgTable(\"error_logs\", {\n  id: serial(\"id\").primaryKey(),\n  component: text(\"component\").notNull(), // 'bot' | 'api' | 'worker' | 'webhook'\n  function: text(\"function\").notNull(),\n  errorType: text(\"error_type\").notNull(),\n  errorMessage: text(\"error_message\").notNull(),\n  stackTrace: text(\"stack_trace\"),\n  metadata: jsonb(\"metadata\"),\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n});\n\n// Task Statistics\nexport const taskStats = pgTable(\"task_stats\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").notNull().references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  date: text(\"date\").notNull(), // YYYY-MM-DD\n  messagesForwarded: integer(\"messages_forwarded\").notNull().default(0),\n  messagesProcessed: integer(\"messages_processed\").notNull().default(0),\n  aiProcessed: integer(\"ai_processed\").notNull().default(0),\n  videoProcessed: integer(\"video_processed\").notNull().default(0),\n  errors: integer(\"errors\").notNull().default(0),\n});\n\n// Queue Jobs\nexport const queueJobs = pgTable(\"queue_jobs\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  type: text(\"type\").notNull(), // 'forward' | 'ai_process' | 'video_process'\n  status: text(\"status\").notNull().default(\"pending\"), // 'pending' | 'processing' | 'completed' | 'failed'\n  priority: integer(\"priority\").notNull().default(0),\n  payload: jsonb(\"payload\").notNull(),\n  result: jsonb(\"result\"),\n  attempts: integer(\"attempts\").notNull().default(0),\n  maxAttempts: integer(\"max_attempts\").notNull().default(3),\n  error: text(\"error\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  processedAt: timestamp(\"processed_at\"),\n});\n\n// Bot Configuration\nexport const botConfig = pgTable(\"bot_config\", {\n  id: serial(\"id\").primaryKey(),\n  key: text(\"key\").notNull().unique(),\n  value: text(\"value\").notNull(),\n  description: text(\"description\"),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Userbot Sessions for MTProto authentication\nexport const userbotSessions = pgTable(\"userbot_sessions\", {\n  id: serial(\"id\").primaryKey(),\n  phoneNumber: text(\"phone_number\").notNull(),\n  sessionString: text(\"session_string\"),\n  isActive: boolean(\"is_active\").notNull().default(false),\n  isPrimary: boolean(\"is_primary\").notNull().default(false),\n  status: text(\"status\").notNull().default(\"pending\"), // 'pending' | 'awaiting_code' | 'awaiting_password' | 'active' | 'expired' | 'error'\n  loginState: jsonb(\"login_state\"), // temporary state during login flow\n  lastLoginAt: timestamp(\"last_login_at\"),\n  errorMessage: text(\"error_message\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// GitHub Repository Settings\nexport const githubSettings = pgTable(\"github_settings\", {\n  id: serial(\"id\").primaryKey(),\n  repoOwner: text(\"repo_owner\").notNull(),\n  repoName: text(\"repo_name\").notNull(),\n  linkedAt: timestamp(\"linked_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// AI Content Filters (for filtering messages before forwarding based on context/content)\nexport const aiContentFilters = pgTable(\"ai_content_filters\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").notNull().references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  name: text(\"name\").notNull(),\n  filterType: text(\"filter_type\").notNull(), // 'allow' | 'block' | 'require'\n  matchType: text(\"match_type\"),\n  pattern: text(\"pattern\").notNull(), // The pattern/keywords to match\n  contextDescription: text(\"context_description\"),\n  sentimentTarget: text(\"sentiment_target\"),\n  action: text(\"action\").notNull().default(\"skip\"), // 'skip' | 'forward' | 'modify' | 'flag'\n  modifyInstructions: text(\"modify_instructions\"),\n  priority: integer(\"priority\").notNull().default(0),\n  matchCount: integer(\"match_count\").notNull().default(0), // Stats: how many times matched\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// AI Publishing Templates (for controlling final message format)\nexport const aiPublishingTemplates = pgTable(\"ai_publishing_templates\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").notNull().references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  name: text(\"name\").notNull(),\n  isDefault: boolean(\"is_default\").notNull().default(false),\n  templateType: text(\"template_type\").notNull(), // 'news' | 'report' | 'interview' | 'summary' | 'custom'\n  \n  // Template structure with formatting\n  headerText: text(\"header_text\"), // Static header text\n  headerFormatting: text(\"header_formatting\"), // 'bold' | 'italic' | 'code' | 'quote' | 'spoiler' | 'strikethrough' | 'underline' | 'none'\n  footerText: text(\"footer_text\"), // Static footer text\n  footerFormatting: text(\"footer_formatting\"), // 'bold' | 'italic' | 'code' | 'quote' | 'spoiler' | 'strikethrough' | 'underline' | 'none'\n  \n  // Global settings\n  fieldSeparator: text(\"field_separator\").default(\"\\n\"), // Separator between fields\n  useNewlineAfterHeader: boolean(\"use_newline_after_header\").notNull().default(true),\n  useNewlineBeforeFooter: boolean(\"use_newline_before_footer\").notNull().default(true),\n  \n  maxLength: integer(\"max_length\"), // Maximum output length\n  \n  // General AI extraction prompt (optional override)\n  extractionPrompt: text(\"extraction_prompt\"), // Custom AI prompt for extracting all fields\n  \n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Template Custom Fields (dynamic fields with individual formatting and AI instructions)\nexport const templateCustomFields = pgTable(\"template_custom_fields\", {\n  id: serial(\"id\").primaryKey(),\n  templateId: integer(\"template_id\").notNull().references(() => aiPublishingTemplates.id, { onDelete: 'cascade' }),\n  \n  // Field identification\n  fieldName: text(\"field_name\").notNull(), // Internal name like 'news_type', 'province', 'source'\n  fieldLabel: text(\"field_label\").notNull(), // Display label like 'ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±', 'ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©', 'ÿßŸÑŸÖÿµÿØÿ±'\n  \n  // AI extraction instructions\n  extractionInstructions: text(\"extraction_instructions\").notNull(), // AI instructions for extracting this field\n  defaultValue: text(\"default_value\"), // Default if extraction fails (e.g., today's date)\n  useDefaultIfEmpty: boolean(\"use_default_if_empty\").notNull().default(true),\n  \n  // Formatting options (Telegram entities)\n  formatting: text(\"formatting\").notNull().default(\"none\"), // 'bold' | 'italic' | 'code' | 'quote' | 'spoiler' | 'strikethrough' | 'underline' | 'none'\n  \n  // Field position and display\n  displayOrder: integer(\"display_order\").notNull().default(0),\n  showLabel: boolean(\"show_label\").notNull().default(false), // Whether to show \"ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±: \" prefix\n  labelSeparator: text(\"label_separator\").default(\": \"), // Separator after label\n  prefix: text(\"prefix\"), // Text before the value (e.g., emoji)\n  suffix: text(\"suffix\"), // Text after the value\n  \n  // Special field types\n  fieldType: text(\"field_type\").notNull().default(\"extracted\"), // 'extracted' | 'summary' | 'static' | 'date_today'\n  \n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Message Archive (for storing processed and forwarded messages with serial numbering)\nexport const messageArchive = pgTable(\"message_archive\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").notNull().references(() => forwardingTasks.id, { onDelete: 'cascade' }),\n  \n  // Serial number per task (ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ)\n  serialNumber: integer(\"serial_number\").notNull(),\n  \n  // Message identification\n  sourceMessageId: text(\"source_message_id\"), // Original Telegram message ID\n  sourceChannelId: text(\"source_channel_id\"), // Source channel identifier\n  sourceChannelTitle: text(\"source_channel_title\"), // Source channel name\n  targetChannelId: text(\"target_channel_id\"), // Target channel identifier\n  targetChannelTitle: text(\"target_channel_title\"), // Target channel name\n  targetMessageId: text(\"target_message_id\"), // Forwarded message ID\n  \n  // Content\n  title: text(\"title\"), // AI-generated or manual title (ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖŸÑÿÆÿµ)\n  originalText: text(\"original_text\"), // Original message text\n  processedText: text(\"processed_text\"), // AI-processed/summarized text\n  publishedText: text(\"published_text\"), // Final published text with template applied\n  \n  // Telegraph integration\n  telegraphUrl: text(\"telegraph_url\"), // Link to full original text on Telegraph\n  telegraphTitle: text(\"telegraph_title\"), // Telegraph page title\n  \n  // Extracted metadata (from AI)\n  classification: text(\"classification\"), // ÿßŸÑÿ™ÿµŸÜŸäŸÅ (ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±)\n  newsType: text(\"news_type\"), // ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ± (ÿπÿßÿ¨ŸÑÿå ÿ™ŸÇÿ±Ÿäÿ±ÿå ÿßŸÑÿÆ)\n  province: text(\"province\"), // ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©\n  specialist: text(\"specialist\"), // ÿßŸÑŸÖÿÆÿ™ÿµ\n  tags: jsonb(\"tags\"), // Array of tags/keywords\n  extractedFields: jsonb(\"extracted_fields\"), // All AI-extracted fields as JSON\n  \n  // Media information\n  hasMedia: boolean(\"has_media\").notNull().default(false),\n  mediaType: text(\"media_type\"), // 'photo' | 'video' | 'document' | 'audio' | 'media_group'\n  mediaCount: integer(\"media_count\").default(0),\n  mediaGroupId: text(\"media_group_id\"),\n  \n  // Processing metadata\n  processingDuration: integer(\"processing_duration\"), // Processing time in ms\n  aiProvider: text(\"ai_provider\"), // Which AI provider was used\n  aiModel: text(\"ai_model\"), // Which AI model was used\n  templateName: text(\"template_name\"), // Publishing template used\n  \n  // Status and flags\n  status: text(\"status\").notNull().default(\"published\"), // 'pending' | 'published' | 'edited' | 'deleted' | 'flagged'\n  isEdited: boolean(\"is_edited\").notNull().default(false),\n  isPinned: boolean(\"is_pinned\").notNull().default(false),\n  isFlagged: boolean(\"is_flagged\").notNull().default(false),\n  flagReason: text(\"flag_reason\"),\n  \n  // Notes and comments\n  notes: text(\"notes\"), // Admin notes\n  \n  // Audit fields\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Archive Serial Counter (for tracking serial numbers per task)\nexport const archiveSerialCounter = pgTable(\"archive_serial_counter\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").notNull().references(() => forwardingTasks.id, { onDelete: 'cascade' }).unique(),\n  lastSerial: integer(\"last_serial\").notNull().default(0),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Insert Schemas\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true });\nexport const insertAdminSchema = createInsertSchema(admins).omit({ id: true, createdAt: true });\nexport const insertChannelSchema = createInsertSchema(channels).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertAiProviderSchema = createInsertSchema(aiProviders).omit({ id: true, createdAt: true });\nexport const insertAiModelSchema = createInsertSchema(aiModels).omit({ id: true });\nexport const insertForwardingTaskSchema = createInsertSchema(forwardingTasks).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true, \n  totalForwarded: true, \n  lastForwardedAt: true \n});\nexport const insertAiRuleSchema = createInsertSchema(aiRules).omit({ id: true, createdAt: true });\nexport const insertAiEntityReplacementSchema = createInsertSchema(aiEntityReplacements).omit({ id: true, createdAt: true });\nexport const insertAiContextRuleSchema = createInsertSchema(aiContextRules).omit({ id: true, createdAt: true });\nexport const insertAiTrainingExampleSchema = createInsertSchema(aiTrainingExamples).omit({ id: true, createdAt: true, useCount: true });\nexport const insertAiProcessingConfigSchema = createInsertSchema(aiProcessingConfig).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertAiUsageStatsSchema = createInsertSchema(aiUsageStats).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertTaskLogSchema = createInsertSchema(taskLogs).omit({ id: true, timestamp: true });\nexport const insertErrorLogSchema = createInsertSchema(errorLogs).omit({ id: true, timestamp: true });\nexport const insertTaskStatsSchema = createInsertSchema(taskStats).omit({ id: true });\nexport const insertQueueJobSchema = createInsertSchema(queueJobs).omit({ \n  id: true, \n  createdAt: true, \n  processedAt: true,\n  attempts: true,\n  result: true,\n  error: true\n});\nexport const insertBotConfigSchema = createInsertSchema(botConfig).omit({ id: true, updatedAt: true });\nexport const insertUserbotSessionSchema = createInsertSchema(userbotSessions).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true,\n  lastLoginAt: true,\n  sessionString: true,\n  isActive: true,\n  isPrimary: true,\n  status: true,\n  loginState: true,\n  errorMessage: true\n});\nexport const insertGithubSettingsSchema = createInsertSchema(githubSettings).omit({ id: true, linkedAt: true, updatedAt: true });\nexport const insertAiContentFilterSchema = createInsertSchema(aiContentFilters).omit({ id: true, createdAt: true, matchCount: true });\nexport const insertAiPublishingTemplateSchema = createInsertSchema(aiPublishingTemplates).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertTemplateCustomFieldSchema = createInsertSchema(templateCustomFields).omit({ id: true, createdAt: true });\nexport const insertMessageArchiveSchema = createInsertSchema(messageArchive).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true\n});\nexport const insertArchiveSerialCounterSchema = createInsertSchema(archiveSerialCounter).omit({ \n  id: true, \n  updatedAt: true \n});\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\n\nexport type Admin = typeof admins.$inferSelect;\nexport type InsertAdmin = z.infer<typeof insertAdminSchema>;\n\nexport type Channel = typeof channels.$inferSelect;\nexport type InsertChannel = z.infer<typeof insertChannelSchema>;\n\nexport type AiProvider = typeof aiProviders.$inferSelect;\nexport type InsertAiProvider = z.infer<typeof insertAiProviderSchema>;\n\nexport type AiModel = typeof aiModels.$inferSelect;\nexport type InsertAiModel = z.infer<typeof insertAiModelSchema>;\n\nexport type ForwardingTask = typeof forwardingTasks.$inferSelect;\nexport type InsertForwardingTask = z.infer<typeof insertForwardingTaskSchema>;\n\nexport type AiRule = typeof aiRules.$inferSelect;\nexport type InsertAiRule = z.infer<typeof insertAiRuleSchema>;\n\nexport type AiEntityReplacement = typeof aiEntityReplacements.$inferSelect;\nexport type InsertAiEntityReplacement = z.infer<typeof insertAiEntityReplacementSchema>;\n\nexport type AiContextRule = typeof aiContextRules.$inferSelect;\nexport type InsertAiContextRule = z.infer<typeof insertAiContextRuleSchema>;\n\nexport type AiTrainingExample = typeof aiTrainingExamples.$inferSelect;\nexport type InsertAiTrainingExample = z.infer<typeof insertAiTrainingExampleSchema>;\n\nexport type AiProcessingConfig = typeof aiProcessingConfig.$inferSelect;\nexport type InsertAiProcessingConfig = z.infer<typeof insertAiProcessingConfigSchema>;\n\nexport type AiUsageStats = typeof aiUsageStats.$inferSelect;\nexport type InsertAiUsageStats = z.infer<typeof insertAiUsageStatsSchema>;\n\nexport type TaskLog = typeof taskLogs.$inferSelect;\nexport type InsertTaskLog = z.infer<typeof insertTaskLogSchema>;\n\nexport type ErrorLog = typeof errorLogs.$inferSelect;\nexport type InsertErrorLog = z.infer<typeof insertErrorLogSchema>;\n\nexport type TaskStats = typeof taskStats.$inferSelect;\nexport type InsertTaskStats = z.infer<typeof insertTaskStatsSchema>;\n\nexport type QueueJob = typeof queueJobs.$inferSelect;\nexport type InsertQueueJob = z.infer<typeof insertQueueJobSchema>;\n\nexport type BotConfig = typeof botConfig.$inferSelect;\nexport type InsertBotConfig = z.infer<typeof insertBotConfigSchema>;\n\nexport type UserbotSession = typeof userbotSessions.$inferSelect;\nexport type InsertUserbotSession = z.infer<typeof insertUserbotSessionSchema>;\n\nexport type GitHubSettings = typeof githubSettings.$inferSelect;\nexport type InsertGithubSettings = z.infer<typeof insertGithubSettingsSchema>;\n\nexport type AiContentFilter = typeof aiContentFilters.$inferSelect;\nexport type InsertAiContentFilter = z.infer<typeof insertAiContentFilterSchema>;\n\nexport type AiPublishingTemplate = typeof aiPublishingTemplates.$inferSelect;\nexport type InsertAiPublishingTemplate = z.infer<typeof insertAiPublishingTemplateSchema>;\n\nexport type MessageArchive = typeof messageArchive.$inferSelect;\nexport type InsertMessageArchive = z.infer<typeof insertMessageArchiveSchema>;\n\nexport type ArchiveSerialCounter = typeof archiveSerialCounter.$inferSelect;\nexport type InsertArchiveSerialCounter = z.infer<typeof insertArchiveSerialCounterSchema>;\n","path":null,"size_bytes":28089,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"telegram_bot/services/forwarding_engine.py":{"content":"\"\"\"\nForwarding Engine\nCore engine for message forwarding with AI processing support\nHandles multiple sources and targets with parallel processing\nSupports all media types including media groups, entities, and formatting\nFull detailed logging for every operation\n\"\"\"\nimport asyncio\nimport os\nimport traceback\nfrom datetime import datetime\nfrom typing import List, Dict, Any, Optional, Tuple\nfrom pyrogram.client import Client\nfrom pyrogram.types import Message, MessageEntity, InputMediaPhoto, InputMediaVideo, InputMediaDocument, InputMediaAudio\nfrom pyrogram.enums import MessageEntityType, MessageMediaType, ParseMode\nfrom pyrogram.errors import FloodWait, RPCError, ChannelPrivate, ChatWriteForbidden\nimport re\nfrom utils.error_handler import handle_errors, ErrorLogger, TaskLogger\nfrom utils.database import db\nfrom services.ai_providers import ai_manager\nfrom services.queue_system import queue_manager\nfrom services.telegraph_service import telegraph_manager\nfrom services.link_processor import link_processor\nfrom services.video_processor import video_processor\nfrom services.audio_processor import audio_processor\nfrom services.ai_pipeline import ai_pipeline\n\nerror_logger = ErrorLogger(\"forwarding_engine\")\n\ndef log_detailed(level: str, component: str, function: str, message: str, data: Optional[Dict[str, Any]] = None):\n    \"\"\"Log with full details\"\"\"\n    timestamp = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S.%f\")[:-3]\n    log_msg = f\"[{timestamp}] [{level.upper()}] [{component}::{function}] {message}\"\n    if data:\n        log_msg += f\" | Data: {data}\"\n    print(log_msg)\n    if level == \"error\":\n        error_logger.log_warning(log_msg)\n    else:\n        error_logger.log_info(log_msg)\n\nclass ForwardingEngine:\n    \"\"\"Main forwarding engine\"\"\"\n\n    def __init__(self, client: Client):\n        self.client = client\n        self.active_tasks: Dict[int, bool] = {}\n        self.message_cache: Dict[str, Any] = {}\n        self.media_group_cache: Dict[str, List[Message]] = {}\n        self.media_group_lock = asyncio.Lock()\n        self.media_group_tasks: Dict[str, asyncio.Task] = {}  # Track processing tasks\n        self.media_group_config: Dict[str, Dict[str, Any]] = {}  # Store task config for each group\n        log_detailed(\"info\", \"forwarding_engine\", \"__init__\", \"Forwarding engine initialized\")\n\n    @handle_errors(\"forwarding_engine\", \"forward_message\")\n    async def forward_message(\n        self,\n        message: Message,\n        task_id: int,\n        task_config: Dict[str, Any]\n    ):\n        \"\"\"\n        Forward message from source to targets\n        Supports all media types including media groups with entities preservation\n        \"\"\"\n        task_logger = TaskLogger(task_id)\n\n        log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Starting message forward\", {\n            \"task_id\": task_id,\n            \"task_name\": task_config.get('name'),\n            \"message_id\": message.id,\n            \"chat_id\": message.chat.id,\n            \"chat_title\": message.chat.title,\n            \"has_text\": bool(message.text),\n            \"has_caption\": bool(message.caption),\n            \"has_media\": bool(message.media),\n            \"media_type\": str(message.media) if message.media else None,\n            \"media_group_id\": message.media_group_id\n        })\n\n        try:\n            # Get target channels\n            target_channels = task_config.get(\"target_channels\", [])\n\n            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Target channels\", {\n                \"target_ids\": target_channels,\n                \"count\": len(target_channels)\n            })\n\n            if not target_channels:\n                log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", \"No target channels configured\")\n                await task_logger.log_warning(\"No target channels configured\")\n                return\n\n            # Check if this is part of a media group\n            if message.media_group_id:\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Message is part of media group\", {\n                    \"media_group_id\": message.media_group_id\n                })\n                await self._handle_media_group(message, task_id, task_config, task_logger)\n                return\n\n            # Check if processing is enabled (read from correct database column names)\n            ai_enabled = task_config.get(\"aiEnabled\", False) or task_config.get(\"ai_enabled\", False)\n            video_processing = task_config.get(\"videoProcessingEnabled\", False) or task_config.get(\"video_processing_enabled\", False)\n            audio_processing = task_config.get(\"audioProcessingEnabled\", False) or task_config.get(\"audio_processing_enabled\", False)\n            summarization_enabled = task_config.get(\"summarizationEnabled\", False) or task_config.get(\"summarization_enabled\", False)\n            link_processing = task_config.get(\"linkProcessingEnabled\", False) or task_config.get(\"link_processing_enabled\", False)\n\n            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Processing options\", {\n                \"ai_enabled\": ai_enabled,\n                \"video_processing\": video_processing,\n                \"audio_processing\": audio_processing,\n                \"summarization_enabled\": summarization_enabled,\n                \"link_processing\": link_processing\n            })\n\n            # Generate serial number EARLY so it's available for all processing types\n            serial_number = await db.get_next_serial_number(task_id)\n            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Assigned serial number #{serial_number} (early generation)\")\n            \n            # Pre-populate extracted_data with serial number for all media types\n            initial_extracted_data = {\n                \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\": f\"#{serial_number}\",\n                \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\": f\"#{serial_number}\",\n                \"serial_number\": serial_number\n            }\n\n            # Check for link processing (message contains only a URL)\n            message_text = message.text or \"\"\n            link_processed = False\n            if link_processing and message_text and link_processor.is_video_link(message_text):\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Processing video link...\")\n                url = link_processor.extract_url(message_text)\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Extracted URL: {url}\")\n                if url:\n                    try:\n                        link_result = await link_processor.process_link(url, task_id, task_config)\n                        if link_result:\n                            summary, video_path, telegraph_url, video_info = link_result\n                            video_title = video_info.get('title', '') if video_info else ''\n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Link processed: summary={len(summary)} chars, has_video={video_path is not None}, telegraph={telegraph_url}, title={video_title[:30]}\")\n\n                            # Apply content filters to summary (same as regular text processing)\n                            should_forward, action, filter_matched, filtered_summary = await self._check_content_filters(\n                                summary, task_id, None\n                            )\n                            \n                            if not should_forward:\n                                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"‚õî Link summary blocked by filter: {filter_matched['name'] if filter_matched else 'unknown'}\")\n                                await task_logger.log_warning(f\"Link summary blocked by content filter\")\n                                return\n                            \n                            summary = filtered_summary\n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"‚úÖ Link summary passed content filters, final length: {len(summary)} chars\")\n\n                            # ‚úÖ COMPREHENSIVE FIX: Extract fields from ALL video data (title, description, transcript)\n                            # This ensures ÿßŸÑÿ™ÿµŸÜŸäŸÅ, ŸÜŸàÿπ_ÿßŸÑÿÆÿ®ÿ±, ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©, ÿßŸÑŸÖÿµÿØÿ± are populated from actual video content\n                            template_data = initial_extracted_data.copy()\n                            \n                            # Get ALL video data for field extraction\n                            transcript = video_info.get('transcript', '') if video_info else ''\n                            video_title = video_info.get('title', '') if video_info else ''\n                            video_description = video_info.get('description', '') if video_info else ''\n                            uploader = video_info.get('uploader', '') if video_info else ''\n                            platform = video_info.get('platform', '') if video_info else ''\n                            channel = video_info.get('channel', '') if video_info else ''\n                            \n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"üìù Video data available:\", {\n                                \"transcript_chars\": len(transcript),\n                                \"title\": video_title[:50] if video_title else \"EMPTY\",\n                                \"description_chars\": len(video_description),\n                                \"uploader\": uploader or \"EMPTY\",\n                                \"platform\": platform or \"EMPTY\"\n                            })\n                            \n                            # ‚úÖ FIX: Build comprehensive source info with fallbacks\n                            if video_info:\n                                # Build source info with multiple fallbacks\n                                source_parts = []\n                                if uploader and uploader.strip():\n                                    source_parts.append(uploader.strip())\n                                elif channel and channel.strip():\n                                    source_parts.append(channel.strip())\n                                \n                                if platform and platform.strip():\n                                    if source_parts:\n                                        source_parts.append(f\"({platform.strip()})\")\n                                    else:\n                                        source_parts.append(platform.strip())\n                                \n                                source_info = \" \".join(source_parts) if source_parts else \"ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ\"\n                                template_data['ÿßŸÑŸÖÿµÿØÿ±'] = source_info\n                                template_data['source'] = source_info\n                                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"‚úÖ Added video source to template: {source_info}\")\n                            \n                            # ‚úÖ FIX: Build COMBINED extraction text from ALL sources (title + description + transcript)\n                            # This gives AI more context to extract fields accurately\n                            extraction_parts = []\n                            if video_title and video_title.strip():\n                                extraction_parts.append(f\"ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÅŸäÿØŸäŸà: {video_title.strip()}\")\n                            if video_description and video_description.strip():\n                                extraction_parts.append(f\"ŸàÿµŸÅ ÿßŸÑŸÅŸäÿØŸäŸà: {video_description.strip()}\")\n                            if transcript and transcript.strip():\n                                # Limit transcript to first 3000 chars to avoid overwhelming AI\n                                transcript_text = transcript.strip()[:3000]\n                                extraction_parts.append(f\"ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑŸÖŸèŸÅÿ±Ÿëÿ∫: {transcript_text}\")\n                            \n                            combined_extraction_text = \"\\n\\n\".join(extraction_parts) if extraction_parts else transcript\n                            \n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \n                                        f\"ü§ñ Built combined extraction text: {len(combined_extraction_text)} chars from {len(extraction_parts)} sources\")\n                            \n                            # Get template and fields\n                            template = await db.get_task_publishing_template(task_id)\n                            # ‚úÖ FIX: get_task_publishing_template returns 'fields' NOT 'custom_fields'\n                            fields_to_extract = template.get(\"fields\", []) if template else []\n                            \n                            # ‚úÖ FIX: Check extraction conditions with better logging\n                            if not template:\n                                log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", \n                                            \"‚ö†Ô∏è NO TEMPLATE found for this task - cannot extract fields!\")\n                            elif not fields_to_extract:\n                                log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", \n                                            \"‚ö†Ô∏è Template has NO fields defined - cannot extract fields!\")\n                            elif not combined_extraction_text:\n                                log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", \n                                            \"‚ö†Ô∏è No video content available (title/description/transcript all empty) - cannot extract fields!\")\n                            \n                            # ‚úÖ FIX: Try to extract fields even with partial data\n                            if template and fields_to_extract and combined_extraction_text:\n                                provider_name = None\n                                model_name = None\n                                provider_id = task_config.get(\"summarization_provider_id\") or task_config.get(\"summarizationProviderId\")\n                                model_id = task_config.get(\"summarization_model_id\") or task_config.get(\"summarizationModelId\")\n                                \n                                log_detailed(\"debug\", \"forwarding_engine\", \"forward_message\", \n                                            f\"üìã Template found with {len(fields_to_extract)} fields to extract\", {\n                                                \"provider_id\": provider_id, \"model_id\": model_id,\n                                                \"fields\": [f.get('field_name') for f in fields_to_extract]\n                                            })\n                                \n                                if provider_id:\n                                    provider_info = await db.get_ai_provider(provider_id)\n                                    if provider_info:\n                                        provider_name = provider_info[\"name\"]\n                                \n                                if model_id:\n                                    model_info = await db.get_ai_model(model_id)\n                                    if model_info:\n                                        model_name = model_info.get(\"name\") or model_info.get(\"model_name\")\n                                \n                                log_detailed(\"debug\", \"forwarding_engine\", \"forward_message\", \n                                            f\"üîß Provider/Model resolved\", {\n                                                \"provider_name\": provider_name, \"model_name\": model_name\n                                            })\n                                \n                                if provider_name and model_name:\n                                    # ‚úÖ CRITICAL FIX: Use combined_extraction_text which includes title, description AND transcript\n                                    extracted_data = await self._extract_fields_with_ai(\n                                        combined_extraction_text,  # ‚úÖ Use ALL video data (title + description + transcript)\n                                        task_id,\n                                        provider_name,\n                                        model_name,\n                                        fields_to_extract,\n                                        serial_number=serial_number,\n                                        processed_text=summary,  # Use summary as processed text for ÿßŸÑÿ™ŸÑÿÆŸäÿµ field\n                                        original_text=combined_extraction_text,  # Use combined text for field extraction\n                                        video_metadata={  # ‚úÖ NEW: Pass video metadata for better extraction\n                                            'title': video_title,\n                                            'description': video_description,\n                                            'uploader': uploader,\n                                            'platform': platform,\n                                            'channel': channel\n                                        }\n                                    )\n                                    # Merge with template_data\n                                    template_data.update(extracted_data)\n                                    log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \n                                                f\"‚úÖ Extracted {len(extracted_data)} fields from link summary\", {\n                                                    \"fields\": list(extracted_data.keys()),\n                                                    \"values_preview\": {k: str(v)[:50] for k, v in extracted_data.items() if v}\n                                                })\n                                else:\n                                    log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", \n                                                \"‚ùå No AI provider/model configured for field extraction - using defaults\")\n                                    # ‚úÖ FIX: Add default values for fields when AI is not available\n                                    for field in fields_to_extract:\n                                        field_name = field.get(\"field_name\", \"\")\n                                        default_value = field.get(\"default_value\", \"\")\n                                        if default_value:\n                                            template_data[field_name] = default_value\n                                            log_detailed(\"debug\", \"forwarding_engine\", \"forward_message\", \n                                                        f\"Using default for {field_name}: {default_value}\")\n                            \n                            # ‚úÖ FIX: Use template_data (which contains merged extracted data) for template application\n                            # Apply publishing template to the summary\n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Applying publishing template to link summary...\", {\n                                \"template_data_keys\": list(template_data.keys()),\n                                \"template_data_count\": len(template_data)\n                            })\n                            template_result, extracted_data = await self._apply_publishing_template(\n                                summary, \n                                task_id, \n                                template_data,  # ‚úÖ CRITICAL FIX: Use template_data which contains all merged extracted fields\n                                original_text=summary  # Pass summary as original for consistent extraction\n                            )\n                            if template_result and template_result.strip():\n                                caption = template_result\n                                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Publishing template applied to link summary: {len(caption)} chars\")\n                            else:\n                                # Fallback to default format if no template\n                                caption = f'üîó <b>ŸÖŸÑÿÆÿµ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖŸÜ ÿßŸÑÿ±ÿßÿ®ÿ∑:</b>\\n\\n{summary}'\n                                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"No publishing template, using default format\")\n\n                            # Add Telegraph link after template\n                            if telegraph_url:\n                                caption += f'\\n\\nüìÑ <a href=\"{telegraph_url}\">ÿßŸÇÿ±ÿ£ ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä ÿßŸÑŸÉÿßŸÖŸÑ</a>'\n\n                            # Send to all target channels\n                            for target_id in target_channels:\n                                target_channel = await db.get_channel(target_id)\n                                if target_channel:\n                                    try:\n                                        target_identifier = int(target_channel[\"identifier\"])\n                                    except (ValueError, TypeError):\n                                        target_identifier = target_channel[\"identifier\"]\n\n                                    # Check if video should be sent\n                                    if video_path:\n                                        log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Video from link: path={video_path[:50]}..., exists={os.path.exists(video_path)}\")\n\n                                        if os.path.exists(video_path):\n                                            try:\n                                                # Ensure mp4 extension\n                                                video_path = link_processor.ensure_mp4_extension(video_path)\n\n                                                # Get video metadata (duration, width, height)\n                                                metadata = link_processor.get_video_metadata(video_path)\n                                                duration = metadata.get('duration', 0)\n                                                width = metadata.get('width', 0)\n                                                height = metadata.get('height', 0)\n\n                                                # Generate thumbnail\n                                                thumb_path = await link_processor.generate_thumbnail(video_path)\n\n                                                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Video metadata: duration={duration}s, {width}x{height}, thumb={thumb_path is not None}\")\n\n                                                # Truncate caption if too long (Telegram max is 1024)\n                                                send_caption = caption\n                                                if len(send_caption) > 1024:\n                                                    send_caption = send_caption[:1020] + \"...\"\n\n                                                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Sending video from link to {target_id} with caption ({len(send_caption)} chars)...\")\n\n                                                # Get filename from video title or path\n                                                if video_title:\n                                                    safe_title = \"\".join(c for c in video_title if c.isalnum() or c in (' ', '-', '_', '.'))[:50]\n                                                    file_name = f\"{safe_title}.mp4\" if safe_title else \"video.mp4\"\n                                                else:\n                                                    file_name = os.path.basename(video_path)\n                                                    if not file_name.lower().endswith('.mp4'):\n                                                        file_name = file_name.rsplit('.', 1)[0] + '.mp4'\n\n                                                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Using file_name: {file_name}\")\n\n                                                await self.client.send_video(\n                                                    chat_id=target_identifier,\n                                                    video=video_path,\n                                                    caption=send_caption,\n                                                    parse_mode=ParseMode.HTML,\n                                                    duration=duration,\n                                                    width=width,\n                                                    height=height,\n                                                    thumb=thumb_path,\n                                                    file_name=file_name,\n                                                    supports_streaming=True\n                                                )\n\n                                                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"‚úì Video sent successfully to {target_id}\")\n\n                                                # Try to cleanup after sending\n                                                try:\n                                                    if os.path.exists(video_path):\n                                                        os.remove(video_path)\n                                                        log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Cleaned up video file after sending\")\n                                                    if thumb_path and os.path.exists(thumb_path):\n                                                        os.remove(thumb_path)\n                                                        log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Cleaned up thumbnail after sending\")\n                                                except Exception as cleanup_err:\n                                                    log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", f\"Failed to cleanup video: {str(cleanup_err)}\")\n\n                                            except Exception as send_err:\n                                                log_detailed(\"error\", \"forwarding_engine\", \"forward_message\", f\"Failed to send video: {str(send_err)}, sending summary as text instead\")\n                                                await self.client.send_message(\n                                                    chat_id=target_identifier,\n                                                    text=caption,\n                                                    parse_mode=ParseMode.HTML\n                                                )\n                                        else:\n                                            log_detailed(\"error\", \"forwarding_engine\", \"forward_message\", f\"Video file not found (already deleted?): {video_path}\")\n                                            await self.client.send_message(\n                                                chat_id=target_identifier,\n                                                text=caption,\n                                                parse_mode=ParseMode.HTML\n                                            )\n                                    else:\n                                        # No video to send, send summary as text only\n                                        log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"No video from link, sending summary as text only\")\n                                        await self.client.send_message(\n                                            chat_id=target_identifier,\n                                            text=caption,\n                                            parse_mode=ParseMode.HTML\n                                        )\n\n                            await db.increment_task_counter(task_id)\n                            await db.update_task_stats(task_id, \"forwarded\")\n                            await task_logger.log_success(f\"Link processed and forwarded to {len(target_channels)} targets\")\n                            link_processed = True\n                    except Exception as e:\n                        log_detailed(\"error\", \"forwarding_engine\", \"forward_message\", f\"Link processing error: {str(e)}\")\n                        await task_logger.log_warning(f\"Link processing failed, forwarding original: {str(e)}\")\n\n            # If link was processed successfully, save to archive and return\n            if link_processed:\n                # Save link to archive\n                try:\n                    await self._save_to_archive(\n                        message=message,\n                        task_id=task_id,\n                        task_config=task_config,\n                        original_text=message_text,\n                        processed_text=summary if 'summary' in dir() else caption,\n                        target_channels=target_channels,\n                        extracted_data=extracted_data if 'extracted_data' in dir() else initial_extracted_data,\n                        serial_number=serial_number\n                    )\n                except Exception as archive_err:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\",\n                                f\"Failed to save link to archive: {str(archive_err)}\")\n                return\n\n            # Check for video processing (message contains a video)\n            video_processed = False\n            video_summary = None\n            telegraph_url = None\n            if video_processing and message.video:\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Processing video message...\")\n                try:\n                    video_result = await video_processor.process_video(\n                        client=self.client,\n                        message_id=message.id,\n                        chat_id=message.chat.id,\n                        task_id=task_id,\n                        task_config=task_config\n                    )\n                    if video_result:\n                        summary, transcript, telegraph_url = video_result\n                        log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Video processed successfully: summary={len(summary)} chars, telegraph={telegraph_url}\")\n                        \n                        # Apply content filters to summary (same as regular text processing)\n                        should_forward, action, filter_matched, filtered_summary = await self._check_content_filters(\n                            summary, task_id, None\n                        )\n                        \n                        if not should_forward:\n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"‚õî Video summary blocked by filter: {filter_matched['name'] if filter_matched else 'unknown'}\")\n                            await task_logger.log_warning(f\"Video summary blocked by content filter\")\n                            video_summary = None\n                            video_processed = False\n                        else:\n                            summary = filtered_summary\n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"‚úÖ Video summary passed content filters, final length: {len(summary)} chars\")\n                            video_summary = summary\n                            video_processed = True\n                except Exception as e:\n                    log_detailed(\"error\", \"forwarding_engine\", \"forward_message\", f\"Video processing error: {str(e)}\")\n                    await task_logger.log_warning(f\"Video processing failed, forwarding original with summary: {str(e)}\")\n                    video_summary = None\n                    telegraph_url = None\n\n            # If video was processed, forward the original video with summary as caption\n            if video_processed and video_summary:\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Forwarding video with summary caption...\")\n                \n                # ‚úÖ FIX: Extract fields from video summary BEFORE applying template\n                # This ensures ÿßŸÑÿ™ÿµŸÜŸäŸÅ, ŸÜŸàÿπ_ÿßŸÑÿÆÿ®ÿ±, ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©, ÿßŸÑŸÖÿµÿØÿ± are populated\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Extracting fields from video summary...\")\n                template = await db.get_task_publishing_template(task_id)\n                fields_to_extract = template.get(\"custom_fields\", []) if template else []\n                \n                # ‚úÖ CRITICAL FIX: Create template_data from initial_extracted_data (contains serial number)\n                template_data = initial_extracted_data.copy()\n                \n                if template and fields_to_extract:\n                    # Get AI provider/model for extraction\n                    provider_name = None\n                    model_name = None\n                    provider_id = task_config.get(\"summarization_provider_id\") or task_config.get(\"summarizationProviderId\")\n                    model_id = task_config.get(\"summarization_model_id\") or task_config.get(\"summarizationModelId\")\n                    \n                    if provider_id:\n                        provider_info = await db.get_ai_provider(provider_id)\n                        if provider_info:\n                            provider_name = provider_info[\"name\"]\n                    \n                    if model_id:\n                        model_info = await db.get_ai_model(model_id)\n                        if model_info:\n                            model_name = model_info.get(\"name\") or model_info.get(\"model_name\")\n                    \n                    # Extract fields with AI (use video_summary for extraction)\n                    if provider_name and model_name:\n                        extracted_data = await self._extract_fields_with_ai(\n                            video_summary,\n                            task_id,\n                            provider_name,\n                            model_name,\n                            fields_to_extract,\n                            serial_number=serial_number,\n                            processed_text=video_summary,\n                            original_text=message.caption or \"\"\n                        )\n                        # ‚úÖ CRITICAL FIX: Merge with template_data (which contains merged extracted fields)\n                        template_data.update(extracted_data)\n                        log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \n                                    f\"‚úÖ Extracted {len(extracted_data)} fields from video summary\", {\n                                        \"fields\": list(extracted_data.keys()),\n                                        \"values_preview\": {k: str(v)[:50] for k, v in extracted_data.items() if v}\n                                    })\n                    else:\n                        log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", \n                                    \"‚ùå No AI provider/model configured for field extraction - using defaults\")\n                        # ‚úÖ FIX: Add default values for fields when AI is not available\n                        for field in fields_to_extract:\n                            field_name = field.get(\"field_name\", \"\")\n                            default_value = field.get(\"default_value\", \"\")\n                            if default_value:\n                                template_data[field_name] = default_value\n                                log_detailed(\"debug\", \"forwarding_engine\", \"forward_message\", \n                                            f\"Using default for {field_name}: {default_value}\")\n                else:\n                    log_detailed(\"debug\", \"forwarding_engine\", \"forward_message\", \n                                \"No template or fields configured for extraction\")\n                \n                # ‚úÖ CRITICAL FIX: Add summary to template_data BEFORE applying template\n                # This ensures the summary field is available for template processing\n                template_data[\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"] = video_summary\n                template_data[\"summary\"] = video_summary\n                log_detailed(\"debug\", \"forwarding_engine\", \"forward_message\", \n                            f\"‚úÖ Added summary to template_data: {len(video_summary)} chars\")\n                \n                # ‚úÖ FIX: Use template_data (which contains merged extracted data) for template application\n                # Apply publishing template to the video summary\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Applying publishing template to video summary...\", {\n                    \"template_data_keys\": list(template_data.keys()),\n                    \"template_data_count\": len(template_data)\n                })\n                # ‚úÖ CRITICAL: Pass video_summary as TEXT and template_data as EXTRACTED_DATA\n                template_result, extracted_data = await self._apply_publishing_template(\n                    video_summary,  # The processed text (for summary field)\n                    task_id,\n                    extracted_data=template_data  # All extracted fields including summary\n                )\n                if template_result and template_result.strip():\n                    caption = template_result\n                    log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Publishing template applied to video summary: {len(caption)} chars\")\n                else:\n                    # Fallback to default format if no template\n                    caption = f'üìπ <b>ŸÖŸÑÿÆÿµ ÿßŸÑŸÅŸäÿØŸäŸà:</b>\\n\\n{video_summary}'\n                    log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"No publishing template, using default format\")\n\n                # Add Telegraph link after template\n                if telegraph_url:\n                    caption += f'\\n\\nüìÑ <a href=\"{telegraph_url}\">ÿßŸÇÿ±ÿ£ ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä ÿßŸÑŸÉÿßŸÖŸÑ</a>'\n\n                # Truncate caption if too long (Telegram limit is 1024 chars for caption)\n                if len(caption) > 1024:\n                    caption = caption[:1020] + \"...\"\n\n                for target_id in target_channels:\n                    target_channel = await db.get_channel(target_id)\n                    if target_channel:\n                        try:\n                            target_identifier = int(target_channel[\"identifier\"])\n                        except (ValueError, TypeError):\n                            target_identifier = target_channel[\"identifier\"]\n\n                        try:\n                            # Forward the original video with the summary caption (HTML format)\n                            await self.client.copy_message(\n                                chat_id=target_identifier,\n                                from_chat_id=message.chat.id,\n                                message_id=message.id,\n                                caption=caption,\n                                parse_mode=ParseMode.HTML\n                            )\n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Video forwarded to target {target_id} with summary and Telegraph link\")\n                        except Exception as copy_err:\n                            # Fallback: send just the summary text\n                            log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", f\"Failed to copy video: {str(copy_err)}, sending summary as text\")\n                            await self.client.send_message(\n                                chat_id=target_identifier,\n                                text=caption,\n                                parse_mode=ParseMode.HTML\n                            )\n\n                await db.increment_task_counter(task_id)\n                await db.update_task_stats(task_id, \"forwarded\")\n                await task_logger.log_success(f\"Video with summary forwarded to {len(target_channels)} targets\")\n                \n                # Save video to archive\n                try:\n                    await self._save_to_archive(\n                        message=message,\n                        task_id=task_id,\n                        task_config=task_config,\n                        original_text=transcript if transcript else (message.caption or \"\"),\n                        processed_text=video_summary,\n                        target_channels=target_channels,\n                        extracted_data=extracted_data,\n                        serial_number=serial_number\n                    )\n                except Exception as archive_err:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\",\n                                f\"Failed to save video to archive: {str(archive_err)}\")\n                return\n\n            # Check for audio processing (message contains audio, voice, or audio document)\n            # Always try to process audio if present, regardless of flag setting\n            audio_processed = False\n            audio_summary = None\n            audio_telegraph_url = None\n            audio_transcript = None\n            has_audio = message.audio or message.voice\n            \n            # Also check if document is an audio file\n            if not has_audio and message.document and message.document.file_name:\n                has_audio = audio_processor.is_audio_file(message.document.file_name)\n                if has_audio:\n                    log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Detected audio file in document: {message.document.file_name}\")\n            \n            if has_audio:\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Processing audio message...\")\n                try:\n                    audio_result = await audio_processor.process_audio(\n                        client=self.client,\n                        message_id=message.id,\n                        chat_id=message.chat.id,\n                        task_id=task_id,\n                        task_config=task_config\n                    )\n                    if audio_result:\n                        summary, audio_transcript, audio_telegraph_url = audio_result\n                        log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Audio processed successfully: summary={len(summary)} chars, telegraph={audio_telegraph_url}\")\n                        \n                        should_forward, action, filter_matched, filtered_summary = await self._check_content_filters(\n                            summary, task_id, None\n                        )\n                        \n                        if not should_forward:\n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"‚õî Audio summary blocked by filter: {filter_matched['name'] if filter_matched else 'unknown'}\")\n                            await task_logger.log_warning(f\"Audio summary blocked by content filter\")\n                            audio_summary = None\n                            audio_processed = False\n                        else:\n                            summary = filtered_summary\n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"‚úÖ Audio summary passed content filters, final length: {len(summary)} chars\")\n                            audio_summary = summary\n                            audio_processed = True\n                except Exception as e:\n                    log_detailed(\"error\", \"forwarding_engine\", \"forward_message\", f\"Audio processing error: {str(e)}\")\n                    await task_logger.log_warning(f\"Audio processing failed, forwarding original: {str(e)}\")\n                    audio_summary = None\n                    audio_telegraph_url = None\n\n            # If audio was processed, forward the original audio with summary as caption\n            if audio_processed and audio_summary:\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Forwarding audio with summary caption...\")\n                \n                # ‚úÖ FIX: Extract fields from audio summary BEFORE applying template\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Extracting fields from audio summary...\")\n                template = await db.get_task_publishing_template(task_id)\n                fields_to_extract = template.get(\"custom_fields\", []) if template else []\n                \n                # ‚úÖ CRITICAL FIX: Create template_data from initial_extracted_data (contains serial number)\n                template_data = initial_extracted_data.copy()\n                \n                if template and fields_to_extract:\n                    provider_name = None\n                    model_name = None\n                    provider_id = task_config.get(\"summarization_provider_id\") or task_config.get(\"summarizationProviderId\")\n                    model_id = task_config.get(\"summarization_model_id\") or task_config.get(\"summarizationModelId\")\n                    \n                    if provider_id:\n                        provider_info = await db.get_ai_provider(provider_id)\n                        if provider_info:\n                            provider_name = provider_info[\"name\"]\n                    \n                    if model_id:\n                        model_info = await db.get_ai_model(model_id)\n                        if model_info:\n                            model_name = model_info.get(\"name\") or model_info.get(\"model_name\")\n                    \n                    if provider_name and model_name:\n                        extracted_data = await self._extract_fields_with_ai(\n                            audio_summary,\n                            task_id,\n                            provider_name,\n                            model_name,\n                            fields_to_extract,\n                            serial_number=serial_number,\n                            processed_text=audio_summary,\n                            original_text=message.caption or \"\"\n                        )\n                        # ‚úÖ CRITICAL FIX: Merge with template_data (which contains merged extracted fields)\n                        template_data.update(extracted_data)\n                        log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \n                                    f\"‚úÖ Extracted {len(extracted_data)} fields from audio summary\", {\n                                        \"fields\": list(extracted_data.keys()),\n                                        \"values_preview\": {k: str(v)[:50] for k, v in extracted_data.items() if v}\n                                    })\n                    else:\n                        log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", \n                                    \"‚ùå No AI provider/model configured for field extraction - using defaults\")\n                        # ‚úÖ FIX: Add default values for fields when AI is not available\n                        for field in fields_to_extract:\n                            field_name = field.get(\"field_name\", \"\")\n                            default_value = field.get(\"default_value\", \"\")\n                            if default_value:\n                                template_data[field_name] = default_value\n                                log_detailed(\"debug\", \"forwarding_engine\", \"forward_message\", \n                                            f\"Using default for {field_name}: {default_value}\")\n                \n                # ‚úÖ CRITICAL FIX: Add summary to template_data BEFORE applying template\n                # This ensures the summary field is available for template processing\n                template_data[\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"] = audio_summary\n                template_data[\"summary\"] = audio_summary\n                log_detailed(\"debug\", \"forwarding_engine\", \"forward_message\", \n                            f\"‚úÖ Added summary to template_data: {len(audio_summary)} chars\")\n                \n                # ‚úÖ FIX: Use template_data (which contains merged extracted data) for template application\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Applying publishing template to audio summary...\", {\n                    \"template_data_keys\": list(template_data.keys()),\n                    \"template_data_count\": len(template_data)\n                })\n                # ‚úÖ CRITICAL: Pass audio_summary as TEXT and template_data as EXTRACTED_DATA\n                template_result, extracted_data = await self._apply_publishing_template(\n                    audio_summary,  # The processed text (for summary field)\n                    task_id,\n                    extracted_data=template_data  # All extracted fields including summary\n                )\n                if template_result and template_result.strip():\n                    caption = template_result\n                    log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Publishing template applied to audio summary: {len(caption)} chars\")\n                else:\n                    caption = f'üéôÔ∏è <b>ŸÖŸÑÿÆÿµ ÿßŸÑŸÖŸÇÿ∑ÿπ ÿßŸÑÿµŸàÿ™Ÿä:</b>\\n\\n{audio_summary}'\n                    log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"No publishing template, using default format\")\n\n                if audio_telegraph_url:\n                    caption += f'\\n\\nüìÑ <a href=\"{audio_telegraph_url}\">ÿßŸÇÿ±ÿ£ ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ ÿßŸÑŸÖŸèŸÅÿ±Ÿëÿ∫</a>'\n\n                if len(caption) > 1024:\n                    caption = caption[:1020] + \"...\"\n\n                for target_id in target_channels:\n                    target_channel = await db.get_channel(target_id)\n                    if target_channel:\n                        try:\n                            target_identifier = int(target_channel[\"identifier\"])\n                        except (ValueError, TypeError):\n                            target_identifier = target_channel[\"identifier\"]\n\n                        try:\n                            await self.client.copy_message(\n                                chat_id=target_identifier,\n                                from_chat_id=message.chat.id,\n                                message_id=message.id,\n                                caption=caption,\n                                parse_mode=ParseMode.HTML\n                            )\n                            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Audio forwarded to target {target_id} with summary and Telegraph link\")\n                        except Exception as copy_err:\n                            log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\", f\"Failed to copy audio: {str(copy_err)}, sending summary as text\")\n                            await self.client.send_message(\n                                chat_id=target_identifier,\n                                text=caption,\n                                parse_mode=ParseMode.HTML\n                            )\n\n                await db.increment_task_counter(task_id)\n                await db.update_task_stats(task_id, \"forwarded\")\n                await task_logger.log_success(f\"Audio with summary forwarded to {len(target_channels)} targets\")\n                \n                # Save audio to archive\n                try:\n                    await self._save_to_archive(\n                        message=message,\n                        task_id=task_id,\n                        task_config=task_config,\n                        original_text=audio_transcript if audio_transcript else \"\",\n                        processed_text=audio_summary,\n                        target_channels=target_channels,\n                        extracted_data=extracted_data,\n                        serial_number=serial_number\n                    )\n                except Exception as archive_err:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\",\n                                f\"Failed to save audio to archive: {str(archive_err)}\")\n                return\n\n            # Generate cache key\n            cache_key = f\"{message.chat.id}_{message.id}\"\n\n            # Use the serial number generated earlier (no need to generate again)\n\n            # Process message with AI/summarization (only once)\n            processed_text = None\n            extracted_data = None\n            if ai_enabled or summarization_enabled:\n                if cache_key not in self.message_cache:\n                    log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Processing message with AI...\")\n                    result = await self._process_message(\n                        message,\n                        task_id,\n                        task_config,\n                        task_logger,\n                        serial_number=serial_number\n                    )\n                    # _process_message may return tuple (text, data) or just text\n                    if isinstance(result, tuple):\n                        processed_text, extracted_data = result\n                    else:\n                        processed_text = result\n                    self.message_cache[cache_key] = (processed_text, extracted_data)\n                else:\n                    cached = self.message_cache[cache_key]\n                    if isinstance(cached, tuple):\n                        processed_text, extracted_data = cached\n                    else:\n                        processed_text = cached\n                    log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Using cached processed text\")\n            else:\n                # Even without AI processing, add serial number to extracted_data\n                extracted_data = {\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\": f\"#{serial_number}\", \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\": f\"#{serial_number}\"}\n\n            # CRITICAL: Ensure serial number is in extracted_data with # prefix\n            if not extracted_data:\n                extracted_data = {}\n            if serial_number is not None:\n                serial_with_hash = f\"#{serial_number}\"\n                extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\"] = serial_with_hash\n                extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\"] = serial_with_hash\n                extracted_data[\"serial_number\"] = serial_number\n                log_detailed(\"info\", \"forwarding_engine\", \"forward_message\",\n                            f\"‚úÖ Serial number set in extracted_data: {serial_with_hash}\")\n\n            # Forward to all targets in parallel\n            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", f\"Forwarding to {len(target_channels)} targets in parallel...\")\n\n            forward_tasks = []\n            for target_id in target_channels:\n                task = asyncio.create_task(\n                    self._forward_to_target(\n                        message,\n                        target_id,\n                        processed_text,\n                        task_logger,\n                        task_id=task_id,\n                        extracted_data=extracted_data\n                    )\n                )\n                forward_tasks.append(task)\n\n            # Wait for all forwards to complete\n            results = await asyncio.gather(*forward_tasks, return_exceptions=True)\n\n            # Count successful forwards\n            successful = 0\n            failed = 0\n            for i, r in enumerate(results):\n                if isinstance(r, Exception):\n                    failed += 1\n                    log_detailed(\"error\", \"forwarding_engine\", \"forward_message\", f\"Forward failed to target {target_channels[i]}\", {\n                        \"error\": str(r)\n                    })\n                else:\n                    successful += 1\n\n            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"Forward results\", {\n                \"successful\": successful,\n                \"failed\": failed,\n                \"total\": len(target_channels)\n            })\n\n            # Update statistics\n            await db.increment_task_counter(task_id)\n            await db.update_task_stats(task_id, \"forwarded\")\n\n            await task_logger.log_success(\n                f\"Message forwarded to {successful}/{len(target_channels)} targets\",\n                {\"message_id\": message.id, \"source\": message.chat.id}\n            )\n\n            log_detailed(\"info\", \"forwarding_engine\", \"forward_message\", \"‚úÖ Forward completed successfully\")\n\n            # Save to archive if forwarding was successful\n            if successful > 0:\n                try:\n                    await self._save_to_archive(\n                        message=message,\n                        task_id=task_id,\n                        task_config=task_config,\n                        original_text=message.text or message.caption or \"\",\n                        processed_text=processed_text or \"\",\n                        target_channels=target_channels,\n                        extracted_data=extracted_data,\n                        serial_number=serial_number\n                    )\n                except Exception as archive_err:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"forward_message\",\n                                f\"Failed to save to archive: {str(archive_err)}\")\n\n            # Clean cache (keep last 100 messages)\n            if len(self.message_cache) > 100:\n                oldest_key = list(self.message_cache.keys())[0]\n                del self.message_cache[oldest_key]\n\n        except Exception as e:\n            log_detailed(\"error\", \"forwarding_engine\", \"forward_message\", f\"Forward error: {str(e)}\", {\n                \"traceback\": traceback.format_exc()\n            })\n            await task_logger.log_error(f\"Forward error: {str(e)}\")\n            await db.update_task_stats(task_id, \"error\")\n            raise\n\n    async def _handle_media_group(\n        self,\n        message: Message,\n        task_id: int,\n        task_config: Dict[str, Any],\n        task_logger: TaskLogger\n    ):\n        \"\"\"Handle media group messages (multiple photos/videos sent together)\"\"\"\n        media_group_id = message.media_group_id\n        cache_key = f\"{message.chat.id}_{media_group_id}\"\n\n        log_detailed(\"info\", \"forwarding_engine\", \"_handle_media_group\", \"Handling media group\", {\n            \"media_group_id\": media_group_id,\n            \"cache_key\": cache_key,\n            \"is_first_message\": cache_key not in self.media_group_cache\n        })\n\n        async with self.media_group_lock:\n            # Add message to cache\n            if cache_key not in self.media_group_cache:\n                self.media_group_cache[cache_key] = []\n                self.media_group_config[cache_key] = {\n                    \"task_id\": task_id,\n                    \"task_config\": task_config,\n                    \"task_logger\": task_logger\n                }\n                is_first = True\n                log_detailed(\"info\", \"forwarding_engine\", \"_handle_media_group\", \"Created new media group cache - scheduling processing\")\n            else:\n                is_first = False\n\n            self.media_group_cache[cache_key].append(message)\n            log_detailed(\"info\", \"forwarding_engine\", \"_handle_media_group\", f\"Added message to cache\", {\n                \"cache_size\": len(self.media_group_cache[cache_key]),\n                \"is_first\": is_first\n            })\n\n        # Only first message in group schedules the processing\n        if is_first:\n            log_detailed(\"info\", \"forwarding_engine\", \"_handle_media_group\", \"Scheduling media group processing in 2.5 seconds...\")\n            # Schedule processing task\n            task = asyncio.create_task(self._process_media_group_after_delay(cache_key))\n            self.media_group_tasks[cache_key] = task\n        else:\n            log_detailed(\"info\", \"forwarding_engine\", \"_handle_media_group\", \"Media group processing already scheduled, just added message to cache\")\n\n    async def _process_media_group_after_delay(self, cache_key: str):\n        \"\"\"Process media group after waiting for all messages to arrive\"\"\"\n        try:\n            # Wait for all media in group to arrive\n            log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", f\"Waiting 2.5 seconds for complete media group...\", {\n                \"cache_key\": cache_key\n            })\n            await asyncio.sleep(2.5)\n\n            async with self.media_group_lock:\n                if cache_key not in self.media_group_cache:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"_process_media_group_after_delay\", \"Cache expired or already processed\")\n                    return\n\n                messages = self.media_group_cache.pop(cache_key)\n                config = self.media_group_config.pop(cache_key, {})\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", f\"Processing {len(messages)} messages in group\")\n\n            task_id = config.get(\"task_id\")\n            task_config = config.get(\"task_config\", {})\n            task_logger = config.get(\"task_logger\")\n\n            # Create download wrapper for media group\n            async def download_wrapper(fid):\n                try:\n                    result = await self.client.download_media(fid)\n                    log_detailed(\"debug\", \"forwarding_engine\", \"_process_media_group_after_delay\", f\"Downloaded to: {result}\")\n                    return result\n                except Exception as e:\n                    log_detailed(\"error\", \"forwarding_engine\", \"_process_media_group_after_delay\", f\"Download error: {str(e)[:60]}\")\n                    return None\n\n            # ‚úÖ FIX 1: Generate serial number EARLY for media groups (same as regular messages)\n            serial_number = await db.get_next_serial_number(task_id)\n            log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                        f\"Assigned serial number #{serial_number} for media group\")\n            \n            # Process media group caption through AI if enabled\n            processed_caption = None\n            extracted_data = {}\n            original_caption = None\n            \n            # Collect all captions first (needed regardless of summarization)\n            all_captions = []\n            for msg in messages:\n                if msg.caption:\n                    all_captions.append(msg.caption)\n            combined_caption = \"\\n\".join(all_captions) if all_captions else \"\"\n            original_caption = combined_caption\n            \n            # ‚úÖ FIX 2: Check BOTH key names for summarization (same as regular messages line 107)\n            summarization_enabled = task_config.get(\"summarizationEnabled\", False) or task_config.get(\"summarization_enabled\", False)\n            ai_enabled = task_config.get(\"aiEnabled\", False) or task_config.get(\"ai_enabled\", False)\n            \n            if combined_caption and (ai_enabled or summarization_enabled):\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                            \"Processing media group captions with AI Pipeline (same as regular messages)...\", {\n                                \"ai_enabled\": ai_enabled,\n                                \"summarization_enabled\": summarization_enabled,\n                                \"caption_length\": len(combined_caption)\n                            })\n                \n                # ‚úÖ CRITICAL FIX: Use AI Pipeline for media groups (same as regular messages)\n                # This ensures consistent processing across all content types\n                provider_id = task_config.get(\"summarization_provider_id\") or task_config.get(\"summarizationProviderId\")\n                model_id = task_config.get(\"summarization_model_id\") or task_config.get(\"summarizationModelId\")\n\n                provider_name = None\n                model_name = None\n\n                if provider_id:\n                    provider_info = await db.get_ai_provider(provider_id)\n                    if provider_info:\n                        provider_name = provider_info[\"name\"]\n                        if not provider_info.get(\"api_key\"):\n                            log_detailed(\"error\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                                        f\"Provider {provider_name} has no API key configured\")\n                            provider_name = None\n\n                if model_id:\n                    model_info = await db.get_ai_model(model_id)\n                    if model_info:\n                        model_name = model_info.get(\"name\") or model_info.get(\"model_name\")\n\n                # Get AI rules for the task\n                all_rules = await db.get_task_rules(task_id)\n                rules = [r for r in all_rules if r[\"type\"] == \"summarize\" and r[\"is_active\"]]\n\n                # ‚úÖ Get template fields for combined extraction (same as regular messages)\n                fields_to_extract = []\n                try:\n                    template = await db.get_task_publishing_template(task_id)\n                    # ‚úÖ CRITICAL FIX: get_task_publishing_template() returns 'fields' NOT 'custom_fields'\n                    if template and template.get(\"fields\"):\n                        fields_to_extract = template.get(\"fields\", [])\n                        log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                                    f\"‚úÖ Loaded {len(fields_to_extract)} template fields for combined extraction\", {\n                                        \"field_names\": [f.get(\"field_name\") for f in fields_to_extract]\n                                    })\n                    else:\n                        log_detailed(\"warning\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                                    f\"No template fields found (template={bool(template)}, has_fields={template.get('fields') if template else False})\")\n                except Exception as e:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                                f\"Could not load template fields: {str(e)}\", {\n                                    \"error\": str(e)\n                                })\n\n                # ‚úÖ Use AI Pipeline if provider/model available (SAME AS REGULAR MESSAGES)\n                if provider_name and model_name:\n                    log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\",\n                                f\"üöÄ Starting AI Pipeline for media group | Provider: {provider_name} | Model: {model_name}\", {\n                                    \"rules_count\": len(rules),\n                                    \"fields_count\": len(fields_to_extract)\n                                })\n                    \n                    system_prompt = await db.get_setting(\"default_prompt\")\n                    \n                    pipeline_result = await ai_pipeline.process(\n                        text=combined_caption,\n                        task_id=task_id,\n                        provider=provider_name,\n                        model=model_name,\n                        system_prompt=system_prompt,\n                        custom_rules=rules,\n                        fields_to_extract=fields_to_extract,\n                        serial_number=serial_number\n                    )\n\n                    processed_caption = pipeline_result.final_text\n                    extracted_data = pipeline_result.extracted_fields or {}\n                    \n                    # ‚úÖ CRITICAL: Log all extracted fields\n                    log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                                f\"‚úÖ AI Pipeline completed for media group\", {\n                                    \"original_length\": len(combined_caption),\n                                    \"processed_length\": len(processed_caption),\n                                    \"rules_applied\": pipeline_result.rules_applied_count,\n                                    \"extracted_fields_count\": len(extracted_data),\n                                    \"extracted_field_names\": list(extracted_data.keys()),\n                                    \"extracted_data_preview\": {k: str(v)[:50] if v else \"\" for k, v in extracted_data.items()}\n                                })\n                    await db.update_task_stats(task_id, \"ai\")\n                else:\n                    # No AI provider/model configured - use original\n                    log_detailed(\"warning\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                                \"No AI provider/model configured, using original caption\")\n                    processed_caption = combined_caption\n            else:\n                # Even if AI disabled, set processed_caption to combined\n                processed_caption = combined_caption\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                            \"AI processing disabled, using original caption\")\n            \n            # ‚úÖ CRITICAL: Ensure extracted_data is properly populated\n            # If AI Pipeline was used, it's already in extracted_data\n            # If not, populate from template or use defaults\n            if not extracted_data:\n                extracted_data = {}\n            \n            # ‚úÖ Ensure summary field is set from processed_caption\n            if processed_caption and \"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\" not in extracted_data:\n                extracted_data[\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"] = processed_caption\n            if processed_caption and \"summary\" not in extracted_data:\n                extracted_data[\"summary\"] = processed_caption\n            \n            # ‚úÖ Ensure serial number is always in extracted_data\n            if serial_number is not None:\n                extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\"] = f\"#{serial_number}\"\n                extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\"] = f\"#{serial_number}\"\n                extracted_data[\"serial_number\"] = serial_number\n            \n            log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", \n                       f\"‚úÖ Media group field extraction complete\", {\n                           \"extracted_fields_count\": len(extracted_data),\n                           \"has_summary\": bool(extracted_data.get(\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\") or extracted_data.get(\"summary\")),\n                           \"summary_length\": len(extracted_data.get(\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\") or extracted_data.get(\"summary\") or \"\"),\n                           \"serial_number\": serial_number\n                       })\n\n            # Forward media group to all targets\n            target_channels = task_config.get(\"target_channels\", [])\n\n            for target_id in target_channels:\n                try:\n                    log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", f\"Forwarding media group to target {target_id}\")\n                    await self._forward_media_group(\n                        messages,\n                        target_id,\n                        task_logger or TaskLogger(task_id),\n                        processed_caption=processed_caption,\n                        download_func=download_wrapper,\n                        task_id=task_id,\n                        extracted_data=extracted_data\n                    )\n                except Exception as e:\n                    log_detailed(\"error\", \"forwarding_engine\", \"_process_media_group_after_delay\", f\"Media group forward error: {str(e)}\", {\n                        \"target_id\": target_id,\n                        \"traceback\": traceback.format_exc()\n                    })\n                    if task_logger:\n                        await task_logger.log_error(f\"Media group forward error: {str(e)}\")\n\n            # Update statistics\n            if task_id:\n                await db.increment_task_counter(task_id)\n                await db.update_task_stats(task_id, \"forwarded\")\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\", \"‚úÖ Media group forwarded successfully\")\n        finally:\n            # Clean up task reference\n            async with self.media_group_lock:\n                self.media_group_tasks.pop(cache_key, None)\n\n    async def _forward_media_group(\n        self,\n        messages: List[Message],\n        target_id: int,\n        task_logger: TaskLogger,\n        processed_caption: Optional[str] = None,\n        download_func: Optional[Any] = None,\n        task_id: Optional[int] = None,\n        extracted_data: Optional[Dict[str, Any]] = None\n    ):\n        \"\"\"Forward a media group to target\"\"\"\n        log_detailed(\"info\", \"forwarding_engine\", \"_forward_media_group\", f\"Building media group for target {target_id}\", {\n            \"message_count\": len(messages)\n        })\n\n        target_channel = await db.get_channel(target_id)\n        if not target_channel:\n            log_detailed(\"error\", \"forwarding_engine\", \"_forward_media_group\", f\"Target channel not found: {target_id}\")\n            return\n\n        target_identifier_str = target_channel[\"identifier\"]\n\n        # Convert identifier to integer for Pyrogram\n        try:\n            target_identifier = int(target_identifier_str)\n        except (ValueError, TypeError):\n            target_identifier = target_identifier_str\n\n        log_detailed(\"info\", \"forwarding_engine\", \"_forward_media_group\", f\"Target: {target_channel['title']}\", {\n            \"identifier\": target_identifier,\n            \"identifier_type\": type(target_identifier).__name__\n        })\n\n        # Collect original captions first (needed for comparison and telegraph)\n        first_caption_entities = None\n        original_combined_caption = None\n        all_original_captions = []\n        for msg in messages:\n            if msg.caption:\n                all_original_captions.append(msg.caption)\n                # Keep first caption entities if available\n                if first_caption_entities is None and msg.caption_entities:\n                    first_caption_entities = msg.caption_entities\n        \n        original_combined_caption = \"\\n\".join(all_original_captions) if all_original_captions else \"\"\n        \n        # Use processed caption if provided (from AI processing), otherwise use original\n        # ‚úÖ CRITICAL: Keep track of BOTH original and processed separately!\n        combined_caption = processed_caption if processed_caption is not None else original_combined_caption\n        caption_count = len(all_original_captions)\n\n        log_detailed(\"info\", \"forwarding_engine\", \"_forward_media_group\", f\"Combined captions from {caption_count} messages\", {\n            \"caption_length\": len(combined_caption),\n            \"caption_preview\": combined_caption[:100] if combined_caption else \"No caption\",\n            \"is_processed\": processed_caption is not None,\n            \"original_length\": len(original_combined_caption)\n        })\n\n        # ‚úÖ FIXED: Apply template using PROCESSED caption (or original if no processing), pass ORIGINAL for reference\n        template_applied_caption = combined_caption\n        if task_id and combined_caption:\n            log_detailed(\"debug\", \"forwarding_engine\", \"_forward_media_group\",\n                        \"Attempting to apply publishing template to media group caption...\")\n            template_result, _ = await self._apply_publishing_template(\n                combined_caption,  # Use processed_caption (already in combined_caption)\n                task_id, \n                extracted_data=extracted_data or {},\n                original_text=original_combined_caption  # Pass original for comparison\n            )\n            # ‚úÖ CRITICAL FIX: Always use template_result if it's not None (even if empty)\n            if template_result is not None:\n                template_applied_caption = template_result\n                combined_caption = template_applied_caption\n                first_caption_entities = None  # Reset entities since text was modified\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_media_group\",\n                            \"‚úÖ Template applied to media group caption\", {\n                                \"original_length\": len(combined_caption),\n                                \"final_length\": len(template_applied_caption),\n                                \"has_content\": bool(template_applied_caption)\n                            })\n            else:\n                log_detailed(\"warning\", \"forwarding_engine\", \"_forward_media_group\",\n                            \"‚ö†Ô∏è Template returned None, using original caption\")\n\n        # Create Telegraph page if caption was processed (shortened)\n        final_caption = combined_caption\n        if processed_caption:\n            # Get original caption for comparison\n            original_captions = []\n            for msg in messages:\n                if msg.caption:\n                    original_captions.append(msg.caption)\n            original_combined = \"\\n\".join(original_captions) if original_captions else \"\"\n\n            if original_combined and len(processed_caption) != len(original_combined):\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_media_group\", \"Creating Telegraph page for original album content with media...\")\n\n                # Collect all media from the group\n                all_photos = [msg.photo.file_id for msg in messages if msg.photo]\n                all_videos = [{'file_id': msg.video.file_id, 'title': 'ŸÅŸäÿØŸäŸà'} for msg in messages if msg.video]\n\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_media_group\", \"Collected media for Telegraph\", {\n                    \"photos\": len(all_photos),\n                    \"videos\": len(all_videos)\n                })\n\n                telegraph_url = await telegraph_manager.create_original_content_page(\n                    original_combined,\n                    photos_file_ids=all_photos if all_photos else None,\n                    videos_info=all_videos if all_videos else None,\n                    download_func=download_func if (all_photos or all_videos) else None\n                )\n                if telegraph_url:\n                    # ‚úÖ CRITICAL FIX: Use combined_caption (with template) NOT processed_caption (summary only)\n                    final_caption = f'{combined_caption}\\n\\nüì∞ <a href=\"{telegraph_url}\">ÿßŸÇÿ±ÿ£ ŸÉÿßŸÖŸÑ ÿßŸÑÿÆÿ®ÿ±</a>'\n                    log_detailed(\"info\", \"forwarding_engine\", \"_forward_media_group\", \"‚úÖ Added Telegraph link to album caption (with template applied)\", {\n                        \"caption_with_template\": len(combined_caption),\n                        \"final_caption\": len(final_caption)\n                    })\n\n        # Build media list\n        media_list = []\n        for i, msg in enumerate(messages):\n            # Only first media item gets the combined caption\n            if i == 0:\n                caption: str = final_caption or \"\"\n                caption_entities: list = first_caption_entities or []\n            else:\n                caption = \"\"\n                caption_entities = []\n\n            log_detailed(\"debug\", \"forwarding_engine\", \"_forward_media_group\", f\"Processing media {i+1}\", {\n                \"has_caption\": bool(caption),\n                \"caption_preview\": caption[:50] if caption else \"No caption\"\n            })\n\n            if msg.photo:\n                media_list.append(InputMediaPhoto(\n                    media=msg.photo.file_id,\n                    caption=caption,\n                    caption_entities=caption_entities\n                ))\n                log_detailed(\"debug\", \"forwarding_engine\", \"_forward_media_group\", f\"Added photo {i+1}\")\n            elif msg.video:\n                media_list.append(InputMediaVideo(\n                    media=msg.video.file_id,\n                    caption=caption,\n                    caption_entities=caption_entities\n                ))\n                log_detailed(\"debug\", \"forwarding_engine\", \"_forward_media_group\", f\"Added video {i+1}\")\n            elif msg.document:\n                media_list.append(InputMediaDocument(\n                    media=msg.document.file_id,\n                    caption=caption,\n                    caption_entities=caption_entities\n                ))\n                log_detailed(\"debug\", \"forwarding_engine\", \"_forward_media_group\", f\"Added document {i+1}\")\n            elif msg.audio:\n                media_list.append(InputMediaAudio(\n                    media=msg.audio.file_id,\n                    caption=caption,\n                    caption_entities=caption_entities\n                ))\n                log_detailed(\"debug\", \"forwarding_engine\", \"_forward_media_group\", f\"Added audio {i+1}\")\n\n        if media_list:\n            log_detailed(\"info\", \"forwarding_engine\", \"_forward_media_group\", f\"Sending {len(media_list)} media items\")\n            await self.client.send_media_group(\n                chat_id=target_identifier,\n                media=media_list\n            )\n            log_detailed(\"info\", \"forwarding_engine\", \"_forward_media_group\", f\"‚úÖ Media group sent to {target_channel['title']}\")\n            await task_logger.log_info(f\"Media group sent to {target_identifier}\")\n\n    @handle_errors(\"forwarding_engine\", \"process_message\")\n    async def _check_content_filters(\n        self,\n        text: str,\n        task_id: int,\n        preprocessing_result: Any = None\n    ) -> tuple:\n        \"\"\"\n        Check content filters to determine if message should be processed\n        Returns: (should_forward: bool, action: str, filter_matched: Optional[dict], modified_text: str)\n        \"\"\"\n        try:\n            filters = await db.get_content_filters(task_id)\n\n            if not filters:\n                return (True, \"forward\", None, text)\n\n            for filter_rule in filters:\n                filter_type = filter_rule.get(\"filter_type\", \"block\")\n                match_type = filter_rule.get(\"match_type\", \"contains\")\n                pattern = filter_rule.get(\"pattern\", \"\")\n                action = filter_rule.get(\"action\", \"skip\")\n\n                matched = False\n\n                if match_type == \"contains\":\n                    matched = pattern.lower() in text.lower()\n                elif match_type == \"exact\":\n                    matched = text.strip().lower() == pattern.lower()\n                elif match_type == \"regex\":\n                    try:\n                        matched = bool(re.search(pattern, text, re.IGNORECASE))\n                    except:\n                        matched = False\n                elif match_type == \"sentiment\" and preprocessing_result:\n                    target_sentiment = filter_rule.get(\"sentiment_target\", \"any\")\n                    current_sentiment = getattr(preprocessing_result, 'sentiment', None)\n                    if current_sentiment:\n                        sentiment_value = getattr(current_sentiment, 'overall', 'neutral')\n                        if target_sentiment == \"any\":\n                            matched = True\n                        else:\n                            matched = sentiment_value == target_sentiment\n                elif match_type == \"context\":\n                    context_desc = filter_rule.get(\"context_description\", \"\")\n                    if context_desc and context_desc.lower() in text.lower():\n                        matched = True\n\n                if matched:\n                    await db.increment_filter_match_count(filter_rule[\"id\"])\n                    log_detailed(\"info\", \"forwarding_engine\", \"_check_content_filters\",\n                                f\"Filter matched: {filter_rule['name']}\", {\n                                    \"filter_type\": filter_type,\n                                    \"action\": action,\n                                    \"pattern\": pattern[:50]\n                                })\n\n                    if filter_type == \"block\":\n                        return (False, \"skip\", filter_rule, text)\n                    elif filter_type == \"allow\":\n                        return (True, \"forward\", filter_rule, text)\n                    elif filter_type == \"require\":\n                        if action == \"modify\" and filter_rule.get(\"modify_instructions\"):\n                            return (True, \"modify\", filter_rule, text)\n                        return (True, action, filter_rule, text)\n\n            return (True, \"forward\", None, text)\n\n        except Exception as e:\n            log_detailed(\"error\", \"forwarding_engine\", \"_check_content_filters\", f\"Filter check error: {str(e)}\")\n            return (True, \"forward\", None, text)\n\n    async def _apply_summarization_rules(self, text: str, task_id: int) -> str:\n        \"\"\"\n        ‚úÖ FIXED: Apply user-defined summarization rules to summary text\n        Rules support: maxLength, style, keyPointsCount\n        \"\"\"\n        try:\n            if not text:\n                return text\n            \n            # Get summarization rules for this task\n            ai_rules = await db.get_task_rules(task_id)\n            if not ai_rules:\n                return text\n            \n            # Convert Row objects to dicts and filter\n            summarization_rules = []\n            for r in ai_rules:\n                # Convert Row to dict if needed\n                rule_dict = dict(r) if hasattr(r, '__iter__') and not isinstance(r, dict) else r\n                if isinstance(rule_dict, dict) and rule_dict.get('type') == 'summarize' and rule_dict.get('is_active'):\n                    summarization_rules.append(rule_dict)\n            \n            if not summarization_rules:\n                log_detailed(\"debug\", \"forwarding_engine\", \"_apply_summarization_rules\", \"No active summarization rules found\")\n                return text\n            \n            # Apply each active rule sorted by priority\n            processed_text = text\n            original_length = len(text)\n            \n            for rule in sorted(summarization_rules, key=lambda r: r.get('priority', 0), reverse=True):\n                rule_name = rule.get('name', 'Unknown')\n                rule_config = rule.get('config', {})\n                \n                # Parse config if it's a string (JSON)\n                if isinstance(rule_config, str):\n                    try:\n                        import json\n                        rule_config = json.loads(rule_config)\n                    except:\n                        rule_config = {}\n                \n                # Extract all config options\n                max_length = rule_config.get('maxLength') or rule_config.get('max_length')\n                style = rule_config.get('style', 'balanced')\n                key_points = rule_config.get('keyPointsCount', 0)\n                \n                log_detailed(\"debug\", \"forwarding_engine\", \"_apply_summarization_rules\",\n                            f\"üìã Processing rule: {rule_name}\", {\n                                \"max_length\": max_length,\n                                \"style\": style,\n                                \"key_points\": key_points,\n                                \"current_text_length\": len(processed_text)\n                            })\n                \n                # ‚úÖ FIXED: Apply max_length truncation ONLY if specified\n                if max_length and isinstance(max_length, (int, float)) and max_length > 0:\n                    if len(processed_text) > max_length:\n                        # Truncate to max_length, but try to end at a word boundary\n                        processed_text = processed_text[:int(max_length)].rsplit(' ', 1)[0]\n                        if not processed_text.endswith(('...', 'ÿå', '.', 'ÿü')):\n                            processed_text += '...'\n                        \n                        log_detailed(\"info\", \"forwarding_engine\", \"_apply_summarization_rules\",\n                                    f\"‚úÖ Applied max_length truncation: {rule_name}\", {\n                                        \"original_length\": original_length,\n                                        \"max_length_rule\": max_length,\n                                        \"processed_length\": len(processed_text),\n                                        \"reduction\": f\"{100 - (len(processed_text) * 100 // original_length)}%\" if original_length > 0 else \"0%\"\n                                    })\n            \n            return processed_text\n            \n        except Exception as e:\n            log_detailed(\"warning\", \"forwarding_engine\", \"_apply_summarization_rules\",\n                        f\"Error applying summarization rules: {str(e)}\")\n            return text\n\n    def _apply_formatting(self, text: str, formatting: str) -> str:\n        \"\"\"\n        Apply Telegram HTML entity formatting to text\n        Supported: bold, italic, code, quote, spoiler, strikethrough, underline, none\n        Uses HTML format for full compatibility with Telegram\n        \"\"\"\n        if not text or formatting == \"none\":\n            return text\n\n        formatting_map = {\n            \"bold\": f\"<b>{text}</b>\",\n            \"italic\": f\"<i>{text}</i>\",\n            \"code\": f\"<code>{text}</code>\",\n            \"spoiler\": f\"<tg-spoiler>{text}</tg-spoiler>\",\n            \"strikethrough\": f\"<s>{text}</s>\",\n            \"underline\": f\"<u>{text}</u>\",\n            \"quote\": f\"<blockquote>{text}</blockquote>\",\n        }\n\n        return formatting_map.get(formatting, text)\n\n    def _parse_html_to_entities(self, html_text: str) -> tuple:\n        \"\"\"\n        Parse HTML text and create MessageEntity objects for formatting.\n        Pyrogram's HTML parser doesn't fully support all tags (especially blockquote),\n        so we manually parse and create entities.\n\n        Returns: (plain_text, list of MessageEntity)\n        \"\"\"\n        import re\n        from pyrogram.types import MessageEntity\n\n        # Tag patterns with their entity types\n        tag_patterns = [\n            (r'<blockquote>(.*?)</blockquote>', MessageEntityType.BLOCKQUOTE),\n            (r'<b>(.*?)</b>', MessageEntityType.BOLD),\n            (r'<strong>(.*?)</strong>', MessageEntityType.BOLD),\n            (r'<i>(.*?)</i>', MessageEntityType.ITALIC),\n            (r'<em>(.*?)</em>', MessageEntityType.ITALIC),\n            (r'<u>(.*?)</u>', MessageEntityType.UNDERLINE),\n            (r'<s>(.*?)</s>', MessageEntityType.STRIKETHROUGH),\n            (r'<code>(.*?)</code>', MessageEntityType.CODE),\n            (r'<tg-spoiler>(.*?)</tg-spoiler>', MessageEntityType.SPOILER),\n        ]\n\n        # Link pattern is special - needs to extract href\n        link_pattern = r'<a href=\"([^\"]+)\">([^<]+)</a>'\n\n        entities = []\n        plain_text = html_text\n\n        # First pass: collect all tags with their positions in original text\n        tag_info = []\n\n        # Process regular tags\n        for pattern, entity_type in tag_patterns:\n            for match in re.finditer(pattern, html_text, re.DOTALL):\n                tag_info.append({\n                    'full_match': match.group(0),\n                    'content': match.group(1),\n                    'entity_type': entity_type,\n                    'start': match.start(),\n                    'url': None\n                })\n\n        # Process links\n        for match in re.finditer(link_pattern, html_text, re.DOTALL):\n            tag_info.append({\n                'full_match': match.group(0),\n                'content': match.group(2),  # Link text\n                'entity_type': MessageEntityType.TEXT_LINK,\n                'start': match.start(),\n                'url': match.group(1)  # URL\n            })\n\n        # Sort by position in original text\n        tag_info.sort(key=lambda x: x['start'])\n\n        # Second pass: build plain text and calculate entity offsets\n        current_offset = 0\n        offset_adjustment = 0\n\n        for tag in tag_info:\n            original_start = tag['start']\n            tag_full = tag['full_match']\n            content = tag['content']\n\n            # Calculate the adjusted offset in plain text\n            adjusted_start = original_start - offset_adjustment\n\n            # Create entity\n            if tag['entity_type'] == MessageEntityType.TEXT_LINK:\n                entity = MessageEntity(\n                    type=tag['entity_type'],\n                    offset=adjusted_start,\n                    length=len(content),\n                    url=tag['url']\n                )\n            else:\n                entity = MessageEntity(\n                    type=tag['entity_type'],\n                    offset=adjusted_start,\n                    length=len(content)\n                )\n            entities.append(entity)\n\n            # Update offset adjustment (difference between full tag and content)\n            offset_adjustment += len(tag_full) - len(content)\n\n        # Remove all HTML tags from text\n        plain_text = html_text\n        for pattern, _ in tag_patterns:\n            plain_text = re.sub(pattern, r'\\1', plain_text, flags=re.DOTALL)\n        plain_text = re.sub(link_pattern, r'\\2', plain_text, flags=re.DOTALL)\n\n        # Recalculate entity offsets after all substitutions\n        entities_final = []\n        for tag in tag_info:\n            # Find the content position in the final plain text\n            content = tag['content']\n\n            # Search for content, considering it might appear multiple times\n            # Use approximate position based on original position ratio\n            approx_pos = int(tag['start'] * len(plain_text) / len(html_text)) if len(html_text) > 0 else 0\n\n            # Search nearby the approximate position\n            search_start = max(0, approx_pos - len(content) - 50)\n            search_end = min(len(plain_text), approx_pos + len(content) + 50)\n\n            search_region = plain_text[search_start:search_end]\n            pos_in_region = search_region.find(content)\n\n            if pos_in_region >= 0:\n                actual_offset = search_start + pos_in_region\n            else:\n                # Fallback: search in entire text\n                actual_offset = plain_text.find(content)\n                if actual_offset < 0:\n                    continue  # Skip if content not found\n\n            if tag['entity_type'] == MessageEntityType.TEXT_LINK:\n                entity = MessageEntity(\n                    type=tag['entity_type'],\n                    offset=actual_offset,\n                    length=len(content),\n                    url=tag['url']\n                )\n            else:\n                entity = MessageEntity(\n                    type=tag['entity_type'],\n                    offset=actual_offset,\n                    length=len(content)\n                )\n            entities_final.append(entity)\n\n        log_detailed(\"debug\", \"forwarding_engine\", \"_parse_html_to_entities\",\n                    f\"Parsed HTML to entities\", {\n                        \"html_length\": len(html_text),\n                        \"plain_length\": len(plain_text),\n                        \"entities_count\": len(entities_final),\n                        \"entity_types\": [str(e.type) for e in entities_final]\n                    })\n\n        return plain_text, entities_final\n\n    def _escape_html(self, text: str) -> str:\n        \"\"\"Escape HTML special characters\"\"\"\n        if not text:\n            return text\n        return text.replace(\"&\", \"&amp;\").replace(\"<\", \"&lt;\").replace(\">\", \"&gt;\")\n\n    async def _extract_fields_with_ai(\n        self,\n        text: str,\n        task_id: int,\n        provider_name: str,\n        model_name: str,\n        fields: List[Dict[str, Any]],\n        serial_number: Optional[int] = None,\n        processed_text: Optional[str] = None,\n        original_text: Optional[str] = None,\n        video_metadata: Optional[Dict[str, Any]] = None\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Extract custom fields using AI based on template field definitions\n        Uses original_text for extraction if provided, falls back to text otherwise\n        \n        Args:\n            text: Main text for extraction\n            task_id: Task ID\n            provider_name: AI provider name\n            model_name: AI model name\n            fields: List of fields to extract\n            serial_number: Optional serial number\n            processed_text: Processed/summarized text for summary fields\n            original_text: Original text for field extraction\n            video_metadata: Optional video metadata (title, description, uploader, platform)\n        \"\"\"\n        extracted = {}\n\n        # Always add serial number FIRST with # prefix if provided\n        if serial_number is not None:\n            serial_with_hash = f\"#{serial_number}\"\n            extracted[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\"] = serial_with_hash\n            extracted[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\"] = serial_with_hash\n            extracted[\"serial_number\"] = serial_number\n            log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                        f\"Set serial number: {serial_with_hash} (raw: {serial_number})\")\n\n        if not fields:\n            return extracted\n\n        # Separate fields that need AI extraction from auto-populated ones\n        fields_to_extract = []\n\n        for field in fields:\n            field_type = field.get(\"field_type\", \"extracted\")\n            field_name = field.get(\"field_name\", \"\")\n\n            if field_type == \"summary\" or field_type == \"content\":\n                # ‚úÖ FIX: Summary/Content MUST use processed_text (AI-summarized), NEVER original\n                # This is the critical fix to prevent original caption from appearing in summary field\n                if processed_text:\n                    summary_text = processed_text\n                    log_detailed(\"info\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                f\"‚úÖ Using AI-processed text for {field_type}: {field_name} ({len(summary_text)} chars)\")\n                else:\n                    # Fallback to text only if processed_text not available\n                    summary_text = text\n                    log_detailed(\"warning\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                f\"‚ö†Ô∏è No processed_text available, using original text for {field_type}: {field_name}\")\n                extracted[field_name] = summary_text\n            elif field_type == \"date_today\":\n                # Use today's date\n                extracted[field_name] = datetime.now().strftime(\"%Y-%m-%d\")\n                log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                            f\"Set date field: {field_name} = {extracted[field_name]}\")\n            elif field_type == \"date_time\":\n                # Use current date and time\n                extracted[field_name] = datetime.now().strftime(\"%Y-%m-%d %H:%M\")\n                log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                            f\"Set datetime field: {field_name} = {extracted[field_name]}\")\n            elif field_type == \"static\":\n                # Use default value as static\n                extracted[field_name] = field.get(\"default_value\", \"\")\n                log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                            f\"Set static field: {field_name} = {extracted[field_name]}\")\n            elif field_type == \"extracted\":\n                # ‚úÖ FIXED: Only use default if use_default_if_empty is true AND field is empty after AI extraction\n                # Always add to AI extraction queue FIRST\n                fields_to_extract.append(field)\n\n        # Extract fields using AI if needed\n        if fields_to_extract and ai_manager:\n            try:\n                # Build extraction prompt with clear field instructions\n                fields_prompt = \"\"\n                json_fields = {}\n                \n                for f in fields_to_extract:\n                    field_name = f.get('field_name', '')\n                    instructions = f.get('extraction_instructions', '').strip()\n                    default_val = f.get('default_value', '')\n                    \n                    # Add default value hint to instructions\n                    if default_val:\n                        fields_prompt += f\"\\n‚Ä¢ {field_name}:\\n  {instructions}\\n  (ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ÿ¨ÿØ: {default_val})\\n\"\n                    else:\n                        fields_prompt += f\"\\n‚Ä¢ {field_name}:\\n  {instructions}\\n\"\n                    json_fields[field_name] = \"ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©\"\n                \n                # Create JSON template for response\n                json_template = \"{\\n\" + \",\\n\".join([f'  \"{k}\": \"{v}\"' for k, v in json_fields.items()]) + \"\\n}\"\n\n                # Use original_text for extraction if available (it has more details), fallback to text\n                extraction_source_text = original_text if original_text else text\n                \n                # ‚úÖ FIX: Build video metadata section if available\n                video_metadata_section = \"\"\n                if video_metadata:\n                    metadata_parts = []\n                    if video_metadata.get('title'):\n                        metadata_parts.append(f\"ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÅŸäÿØŸäŸà: {video_metadata['title']}\")\n                    if video_metadata.get('uploader'):\n                        metadata_parts.append(f\"ÿµÿßÿ≠ÿ® ÿßŸÑŸÅŸäÿØŸäŸà/ÿßŸÑŸÇŸÜÿßÿ©: {video_metadata['uploader']}\")\n                    if video_metadata.get('channel'):\n                        metadata_parts.append(f\"ÿßÿ≥ŸÖ ÿßŸÑŸÇŸÜÿßÿ©: {video_metadata['channel']}\")\n                    if video_metadata.get('platform'):\n                        metadata_parts.append(f\"ÿßŸÑŸÖŸÜÿµÿ©: {video_metadata['platform']}\")\n                    if video_metadata.get('description'):\n                        desc = video_metadata['description'][:500]  # Limit description\n                        metadata_parts.append(f\"ŸàÿµŸÅ ÿßŸÑŸÅŸäÿØŸäŸà: {desc}\")\n                    \n                    if metadata_parts:\n                        video_metadata_section = \"\\n\\nüìπ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©:\\n\" + \"\\n\".join(metadata_parts)\n                \n                extraction_prompt = f\"\"\"ÿ£ŸÜÿ™ ŸÖÿ™ÿÆÿµÿµ ŸÅŸä ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÖŸÜ ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ŸàÿßŸÑŸÅŸäÿØŸäŸàŸáÿßÿ™. ŸÇŸÖ ÿ®ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿßŸÑŸä ÿ®ÿπŸÜÿßŸäÿ© Ÿàÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ®ÿØŸÇÿ©.\n\nÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨Ÿáÿß Ÿàÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨:\n{fields_prompt}\n\nüìÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖÿ±ÿßÿØ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÖŸÜŸá:\n---\n{extraction_source_text}\n---{video_metadata_section}\n\nÿ£ÿ¨ÿ® ÿ®ŸÄ JSON ŸÅŸÇÿ∑ ÿ®ÿØŸàŸÜ ÿ£Ÿä ŸÜÿµ ÿ•ÿ∂ÿßŸÅŸä ÿ£Ÿà ÿ¥ÿ±ÿ≠. ÿßÿ≥ÿ™ÿÆÿØŸÖ Ÿáÿ∞ÿß ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿ®ÿßŸÑÿ∂ÿ®ÿ∑:\n{json_template}\n\n‚ö†Ô∏è ÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÖŸáŸÖÿ© ÿ¨ÿØÿßŸã:\n1. ÿßÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿπŸÜŸàÿßŸÜ ŸàÿßŸÑŸàÿµŸÅ ŸàŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖÿπÿßŸã ŸÑŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™\n2. ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿßŸÑŸÇŸäŸÖ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÉŸÑ ÿ≠ŸÇŸÑ ÿ®ÿØŸÇÿ©\n3. ÿ•ÿ∞ÿß Ÿàÿ¨ÿØÿ™ ÿßŸÑŸÇŸäŸÖÿ© ŸÅŸä ÿ£Ÿä ŸÖŸÉÿßŸÜ (ÿßŸÑÿπŸÜŸàÿßŸÜÿå ÿßŸÑŸàÿµŸÅÿå ÿ£Ÿà ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ)ÿå ÿßÿ≥ÿ™ÿÆÿ±ÿ¨Ÿáÿß\n4. ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠Ÿäÿ© ÿ®ÿπŸÜÿßŸäÿ©:\n   * \"ÿßŸÑŸÖÿµÿØÿ±\": ÿßÿ≥ŸÖ ÿßŸÑŸÇŸÜÿßÿ©ÿå ÿµÿßÿ≠ÿ® ÿßŸÑŸÅŸäÿØŸäŸàÿå ÿßŸÑŸÖŸÜÿµÿ©ÿå ÿ£Ÿà ÿ£Ÿä ŸÖÿµÿØÿ± ŸÖÿ∞ŸÉŸàÿ±\n   * \"ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©\": ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿßÿ™ ŸàÿßŸÑŸÖÿØŸÜ ÿßŸÑÿπÿ±ÿßŸÇŸäÿ© (ÿ®ÿ∫ÿØÿßÿØÿå ÿßŸÑŸÖŸàÿµŸÑÿå ÿßŸÑÿ®ÿµÿ±ÿ©ÿå ŸÉÿ±ÿ®ŸÑÿßÿ°ÿå ÿßŸÑŸÜÿ¨ŸÅÿå ÿßŸÑÿ£ŸÜÿ®ÿßÿ±ÿå ÿµŸÑÿßÿ≠ ÿßŸÑÿØŸäŸÜÿå ÿØŸäÿßŸÑŸâÿå ŸÉÿ±ŸÉŸàŸÉÿå ÿ∞Ÿä ŸÇÿßÿ±ÿå Ÿàÿßÿ≥ÿ∑ÿå ŸÖŸäÿ≥ÿßŸÜÿå ÿßŸÑŸÖÿ´ŸÜŸâÿå ÿßŸÑŸÇÿßÿØÿ≥Ÿäÿ©ÿå ÿ®ÿßÿ®ŸÑÿå ÿßŸÑÿ≥ŸÑŸäŸÖÿßŸÜŸäÿ©ÿå ÿ£ÿ±ÿ®ŸäŸÑÿå ÿØŸáŸàŸÉÿå ŸÜŸäŸÜŸàŸâÿå ÿßŸÑŸÜÿ¨ŸÅÿå ÿ•ŸÑÿÆ)\n   * \"ÿßŸÑÿ™ÿµŸÜŸäŸÅ\": ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ± (ÿ≥Ÿäÿßÿ≥Ÿäÿå ÿ±Ÿäÿßÿ∂Ÿäÿå ÿ´ŸÇÿßŸÅŸäÿå ÿßŸÇÿ™ÿµÿßÿØŸäÿå ÿßÿ¨ÿ™ŸÖÿßÿπŸäÿå ÿ£ŸÖŸÜŸäÿå ÿµÿ≠Ÿäÿå ÿ™ÿπŸÑŸäŸÖŸäÿå ŸÅŸÜŸäÿå ÿØŸäŸÜŸäÿå ÿ•ŸÑÿÆ)\n   * \"ŸÜŸàÿπ_ÿßŸÑÿÆÿ®ÿ±\": ÿ¥ŸÉŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ (ÿÆÿ®ÿ±ÿå ÿ™ÿ≠ŸÑŸäŸÑÿå ÿ™ŸÇÿ±Ÿäÿ±ÿå ŸÖŸÇÿßŸÑÿå ŸÖŸÇÿßÿ®ŸÑÿ©ÿå ÿ™ÿµÿ±Ÿäÿ≠ÿå ÿ®ŸäÿßŸÜÿå ÿ•ŸÑÿÆ)\n5. ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ£Ÿà ÿßŸÑŸàÿµŸÅ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿßÿ≥ŸÖ ŸÖÿØŸäŸÜÿ©/ŸÖÿ≠ÿßŸÅÿ∏ÿ©ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖŸáÿß ŸÑŸÑÿ≠ŸÇŸÑ \"ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©\"\n6. ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿßÿ≥ŸÖ ŸÇŸÜÿßÿ© ÿ£Ÿà ÿµÿßÿ≠ÿ® ŸÅŸäÿØŸäŸàÿå ÿßÿ≥ÿ™ÿÆÿØŸÖŸá ŸÑŸÑÿ≠ŸÇŸÑ \"ÿßŸÑŸÖÿµÿØÿ±\"\n7. ÿ≠ŸÑŸÑ ŸÖŸàÿ∂Ÿàÿπ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÑÿ™ÿ≠ÿØŸäÿØ \"ÿßŸÑÿ™ÿµŸÜŸäŸÅ\" Ÿà\"ŸÜŸàÿπ_ÿßŸÑÿÆÿ®ÿ±\"\n8. ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ÿ¨ÿØ ŸÇŸäŸÖÿ© ÿ®ÿπÿØ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ¥ÿßŸÖŸÑÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ÿ•ÿ∞ÿß ÿ∞ŸèŸÉÿ±ÿ™ÿå Ÿàÿ•ŸÑÿß ÿßÿ™ÿ±ŸÉ ÿßŸÑÿ≠ŸÇŸÑ ÿ®ŸÇŸäŸÖÿ© ŸÅÿßÿ±ÿ∫ÿ© \"\"\n9. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÄ JSON ÿµÿ≠Ÿäÿ≠ ŸàŸäŸÖŸÉŸÜ ŸÅÿ≠ÿµŸá\n10. ŸÑÿß ÿ™ÿ∂ŸÅ ÿ£Ÿä ÿ™ŸÅÿ≥Ÿäÿ±ÿßÿ™ ÿ£Ÿà ŸÜÿµŸàÿµ ÿ•ÿ∂ÿßŸÅŸäÿ©\"\"\"\n\n                # ‚úÖ FIX: Use the provider/model passed to the function directly instead of re-fetching\n                # This avoids redundant database calls and ensures consistency\n                provider_name_for_ai = provider_name\n                model_name_for_ai = model_name\n                \n                if not provider_name_for_ai or not model_name_for_ai:\n                    log_detailed(\"error\", \"forwarding_engine\", \"_extract_fields_with_ai\", \n                                \"‚ùå No AI provider/model configured for field extraction\")\n                    # ‚úÖ FIX: Return extracted (not extracted_data) and use defaults\n                    for field in fields_to_extract:\n                        field_name = field.get(\"field_name\", \"\")\n                        default_value = field.get(\"default_value\", \"\")\n                        if default_value:\n                            extracted[field_name] = default_value\n                            log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                        f\"Using default for {field_name}: {default_value}\")\n                        else:\n                            extracted[field_name] = \"\"\n                    return extracted\n\n                # Call AI to extract fields - use generate method (not generate_text)\n                log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                            f\"Extracting fields with {provider_name_for_ai}/{model_name_for_ai}\", {\n                                \"fields_count\": len(fields_to_extract),\n                                \"prompt_length\": len(extraction_prompt)\n                            })\n\n                ai_response = await ai_manager.generate(\n                    provider=provider_name_for_ai,\n                    model=model_name_for_ai,\n                    prompt=extraction_prompt,\n                    max_tokens=8000,\n                    temperature=0.1\n                )\n\n                if ai_response:\n                    # Parse JSON response\n                    import json\n                    import re\n\n                    log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                f\"AI response received\", {\"response_length\": len(ai_response), \"response_preview\": ai_response[:500]})\n\n                    # Try to extract JSON from response - use greedy match for nested objects\n                    json_match = re.search(r'\\{[\\s\\S]*\\}', ai_response, re.DOTALL)\n                    if json_match:\n                        try:\n                            ai_extracted = json.loads(json_match.group())\n                            log_detailed(\"info\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                        f\"AI extracted fields\", {\"ai_extracted\": ai_extracted})\n                            for field in fields_to_extract:\n                                field_name = field.get(\"field_name\", \"\")\n                                default_value = field.get(\"default_value\", \"\")\n                                use_default = field.get(\"use_default_if_empty\", True)\n                                \n                                if field_name in ai_extracted:\n                                    # Get the value from AI response\n                                    extracted_value = ai_extracted[field_name]\n                                    # Check if value is not empty\n                                    if extracted_value and str(extracted_value).strip():\n                                        extracted[field_name] = str(extracted_value).strip()\n                                        log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                                    f\"Field {field_name}: Using AI value: {extracted_value}\")\n                                    else:\n                                        # Value is empty, use default if available\n                                        if use_default and default_value:\n                                            extracted[field_name] = default_value\n                                            log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                                        f\"Field {field_name}: AI returned empty, using default: {default_value}\")\n                                        else:\n                                            extracted[field_name] = \"\"\n                                            log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                                        f\"Field {field_name}: AI returned empty, no default\")\n                                else:\n                                    # Field not in AI response, use default\n                                    if use_default and default_value:\n                                        extracted[field_name] = default_value\n                                        log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                                    f\"Field {field_name}: Not in AI response, using default: {default_value}\")\n                                    else:\n                                        extracted[field_name] = \"\"\n                                        log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                                    f\"Field {field_name}: Not in AI response, no default\")\n                            log_detailed(\"info\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                        f\"Final extracted fields\", {\"extracted\": extracted})\n                        except json.JSONDecodeError as je:\n                            log_detailed(\"warning\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                        \"Failed to parse AI JSON response\")\n                            # Use defaults for all fields\n                            for field in fields_to_extract:\n                                field_name = field.get(\"field_name\", \"\")\n                                if field.get(\"use_default_if_empty\") and field.get(\"default_value\"):\n                                    extracted[field_name] = field.get(\"default_value\")\n                                else:\n                                    extracted[field_name] = \"\"\n\n            except Exception as e:\n                log_detailed(\"error\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                            f\"AI extraction error: {str(e)}\")\n                # Use defaults for all fields on error\n                for field in fields_to_extract:\n                    field_name = field.get(\"field_name\", \"\")\n                    if field.get(\"use_default_if_empty\") and field.get(\"default_value\"):\n                        extracted[field_name] = field.get(\"default_value\")\n                    else:\n                        extracted[field_name] = \"\"\n\n        # ‚úÖ ENSURE SUMMARY FIELDS ARE ALWAYS POPULATED if processed_text available\n        if processed_text:\n            # Check if we have any summary fields in the template\n            for field in fields:\n                field_type = field.get(\"field_type\", \"\")\n                field_name = field.get(\"field_name\", \"\")\n                if field_type == \"summary\" or field_type == \"content\":\n                    if field_name not in extracted:\n                        extracted[field_name] = processed_text\n                        log_detailed(\"debug\", \"forwarding_engine\", \"_extract_fields_with_ai\",\n                                    f\"‚úÖ Fallback: Assigned processed_text to {field_name}\")\n\n        return extracted\n\n    async def _apply_publishing_template(\n        self,\n        text: str,\n        task_id: int,\n        extracted_data: Optional[Dict[str, Any]] = None,\n        original_text: Optional[str] = None\n    ) -> Tuple[str, Dict[str, Any]]:\n        \"\"\"\n        Apply publishing template to format the output with custom fields and formatting\n        Args:\n            text: The processed/summarized text (used for summary field)\n            task_id: Task ID\n            extracted_data: Pre-extracted data like serial number\n            original_text: The original text before summarization (used for field extraction like source, classification)\n        Returns: (formatted_text, extracted_data_dict)\n        \"\"\"\n        try:\n            template = await db.get_default_template_with_fields(task_id)\n\n            if not template:\n                log_detailed(\"debug\", \"forwarding_engine\", \"_apply_publishing_template\",\n                            f\"No template found for task {task_id}, returning original text\")\n                return (text, extracted_data or {})\n            \n            # ‚úÖ CHECK IF TEMPLATE IS ENABLED - CRITICAL FIX\n            template_active = template.get(\"is_active\", True)\n            template_name = template.get(\"name\", \"Unknown\")\n            \n            if not template_active:\n                log_detailed(\"info\", \"forwarding_engine\", \"_apply_publishing_template\",\n                            f\"‚õî SKIPPING DISABLED TEMPLATE '{template_name}' (is_active=false)\")\n                return (text, extracted_data or {})\n\n            # ‚úÖ FIX: Load fields from EITHER \"fields\" OR \"custom_fields\" key\n            custom_fields = template.get(\"fields\", []) or template.get(\"custom_fields\", [])\n            \n            log_detailed(\"info\", \"forwarding_engine\", \"_apply_publishing_template\",\n                        f\"üìã Loaded {len(custom_fields)} template fields for combined extraction\")\n            \n            header_text = template.get(\"header_text\", \"\")\n            header_formatting = template.get(\"header_formatting\", \"none\")\n            footer_text = template.get(\"footer_text\", \"\")\n            footer_formatting = template.get(\"footer_formatting\", \"none\")\n            field_separator = template.get(\"field_separator\", \"\\n\")\n            use_newline_after_header = template.get(\"use_newline_after_header\", True)\n            use_newline_before_footer = template.get(\"use_newline_before_footer\", True)\n            max_length = template.get(\"max_length\")\n\n            # Extract custom fields using AI\n            if custom_fields:\n                # Check if any fields require AI extraction\n                fields_need_ai = any(f.get(\"field_type\") == \"extracted\" for f in custom_fields)\n                \n                provider_name = None\n                model_name = None\n                \n                # Only check for AI provider/model if we have fields that need extraction\n                if fields_need_ai:\n                    task_config = await db.get_task(task_id)\n                    provider_id = task_config.get(\"summarization_provider_id\") if task_config else None\n                    model_id = task_config.get(\"summarization_model_id\") if task_config else None\n\n                    if provider_id:\n                        provider_info = await db.get_ai_provider(provider_id)\n                        if provider_info:\n                            provider_name = provider_info[\"name\"]\n\n                    if model_id:\n                        model_info = await db.get_ai_model(model_id)\n                        if model_info:\n                            model_name = model_info.get(\"name\") or model_info.get(\"model_name\")\n                    \n                    if not provider_name or not model_name:\n                        log_detailed(\"error\", \"forwarding_engine\", \"_apply_publishing_template\", \"No AI provider/model configured for field extraction\")\n                        # Still continue with non-extracted fields (summary, date_today, static)\n                        provider_name = None\n                        model_name = None\n\n                # Get serial number from extracted_data (try multiple keys)\n                current_serial = None\n                if extracted_data:\n                    current_serial = extracted_data.get(\"serial_number\")\n                    if current_serial is None:\n                        # Try to extract from Arabic keys\n                        arabic_serial = extracted_data.get(\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\") or extracted_data.get(\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\")\n                        if arabic_serial:\n                            # Remove # if present and convert to int\n                            current_serial = int(str(arabic_serial).replace(\"#\", \"\")) if arabic_serial else None\n                \n                log_detailed(\"debug\", \"forwarding_engine\", \"_apply_publishing_template\",\n                            f\"Extracted serial from data: {current_serial}\", {\n                                \"extracted_data_keys\": list(extracted_data.keys()) if extracted_data else []\n                            })\n                \n                # Check if fields were already extracted by pipeline (combined extraction)\n                # This skips the second AI call if fields are already present\n                fields_already_extracted = False\n                if extracted_data:\n                    # Check if we have any of the custom fields already\n                    for field in custom_fields:\n                        field_name = field.get(\"field_name\", \"\")\n                        if field_name and field_name in extracted_data and extracted_data[field_name]:\n                            fields_already_extracted = True\n                            break\n                \n                if fields_already_extracted:\n                    log_detailed(\"info\", \"forwarding_engine\", \"_apply_publishing_template\",\n                                f\"‚úÖ Using pre-extracted fields from pipeline (skipping second AI call)\", {\n                                    \"existing_fields\": list(extracted_data.keys())\n                                })\n                    # Just ensure summary and serial are properly set\n                    if \"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\" not in extracted_data and text:\n                        extracted_data[\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"] = text\n                    if current_serial is not None:\n                        extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\"] = f\"#{current_serial}\"\n                        extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\"] = f\"#{current_serial}\"\n                        extracted_data[\"serial_number\"] = current_serial\n                else:\n                    # Extract new fields with AI (fallback for non-combined extraction)\n                    extraction_text = original_text if original_text else text\n                    log_detailed(\"info\", \"forwarding_engine\", \"_apply_publishing_template\",\n                                f\"üìã Using {'original' if original_text else 'summarized'} text for field extraction\", {\n                                    \"extraction_text_length\": len(extraction_text),\n                                    \"summary_text_length\": len(text)\n                                })\n                    \n                    new_extracted = await self._extract_fields_with_ai(\n                        extraction_text,  # Fallback text\n                        task_id,\n                        provider_name,\n                        model_name,\n                        custom_fields,\n                        serial_number=current_serial,\n                        processed_text=text,  # Use summarized text for summary field\n                        original_text=extraction_text  # Use original text for field extraction\n                    )\n                    \n                    # Merge with existing extracted_data instead of replacing\n                    if extracted_data:\n                        extracted_data.update(new_extracted)\n                    else:\n                        extracted_data = new_extracted\n                \n                # Double-check serial number is present with # prefix\n                if current_serial is not None:\n                    serial_with_hash = f\"#{current_serial}\"\n                    extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\"] = serial_with_hash\n                    extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\"] = serial_with_hash\n                    extracted_data[\"serial_number\"] = current_serial\n                    log_detailed(\"debug\", \"forwarding_engine\", \"_apply_publishing_template\",\n                                f\"Force-set serial in extracted_data: {serial_with_hash}\")\n            else:\n                extracted_data = extracted_data or {}\n                # Ensure at least the summary is present if no custom fields\n                if \"summary\" not in extracted_data:\n                    extracted_data[\"summary\"] = text\n            \n            # Double-check serial number is in extracted_data\n            if extracted_data and \"serial_number\" not in extracted_data and \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\" not in extracted_data:\n                # This should not happen, but as a safety measure\n                log_detailed(\"warning\", \"forwarding_engine\", \"_apply_publishing_template\",\n                            \"Serial number missing from extracted_data, this should not happen!\")\n                extracted_data[\"serial_number\"] = 0\n                extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\"] = \"ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ\"\n                extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\"] = \"ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ\"\n\n            result_parts = []\n\n            # Add header if exists\n            if header_text:\n                formatted_header = self._apply_formatting(header_text.strip(), header_formatting)\n                result_parts.append(formatted_header)\n                if use_newline_after_header:\n                    result_parts.append(\"\")\n\n            # ‚úÖ LOG SUMMARY: Verify summary/ÿßŸÑÿ™ŸÑÿÆŸäÿµ is in extracted_data BEFORE building template\n            if extracted_data:\n                has_summary = extracted_data.get(\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\") or extracted_data.get(\"summary\")\n                if has_summary:\n                    log_detailed(\"info\", \"forwarding_engine\", \"_apply_publishing_template\",\n                                f\"‚úÖ Summary field present in extracted_data: {len(has_summary)} chars\")\n                else:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"_apply_publishing_template\",\n                                f\"‚ö†Ô∏è WARNING: Summary field NOT found in extracted_data! Keys: {list(extracted_data.keys())}\")\n            \n            # Add custom fields in order\n            field_parts = []\n            log_detailed(\"debug\", \"forwarding_engine\", \"_apply_publishing_template\",\n                        f\"Starting to process {len(custom_fields)} fields\", {\n                            \"extracted_data_keys\": list(extracted_data.keys()) if extracted_data else []\n                        })\n            for field in custom_fields:\n                field_name = field.get(\"field_name\", \"\")\n                field_label = field.get(\"field_label\", \"\")\n                formatting = field.get(\"formatting\", \"none\")\n                show_label = field.get(\"show_label\", True)  # ‚úÖ FIX: Default to True so labels SHOW\n                label_separator = field.get(\"label_separator\", \": \")\n                prefix = field.get(\"prefix\", \"\") or \"\"\n                suffix = field.get(\"suffix\", \"\") or \"\"\n                is_active = field.get(\"is_active\", True)\n\n                # Skip inactive fields\n                if not is_active:\n                    continue\n\n                # Get field type to handle special types\n                field_type = field.get(\"field_type\", \"extracted\")\n                \n                # Handle special field types FIRST\n                if field_type == \"date_today\":\n                    # Generate current date in Arabic-friendly format\n                    from datetime import datetime\n                    value = datetime.now().strftime(\"%Y-%m-%d\")\n                elif field_type == \"summary\":\n                    # ‚úÖ CRITICAL FIX: Summary fields MUST use extracted_data which has processed text\n                    # Try both Arabic and English names for summary field\n                    value = extracted_data.get(field_name, \"\") or extracted_data.get(\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\", \"\") or extracted_data.get(\"summary\", \"\") if extracted_data else \"\"\n                    if value:\n                        log_detailed(\"info\", \"forwarding_engine\", \"_apply_publishing_template\",\n                                    f\"‚úÖ Summary field '{field_name}' using extracted value: {len(value)} chars\")\n                    else:\n                        # Fallback only if not in extracted_data\n                        value = text if text else \"\"\n                        log_detailed(\"warning\", \"forwarding_engine\", \"_apply_publishing_template\",\n                                    f\"‚ö†Ô∏è Summary field '{field_name}' NOT in extracted_data, fallback to text: {len(value)} chars\")\n                elif field_type == \"static\":\n                    # ‚úÖ FIXED: For static fields, ALWAYS use default_value (never from extracted_data)\n                    # Exception: Serial number can come from extracted_data\n                    if field_name in [\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\", \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\", \"serial_number\"]:\n                        value = extracted_data.get(field_name, \"\")\n                        if not value:\n                            value = field.get(\"default_value\", \"\")\n                    else:\n                        # For all other static fields, use default_value ONLY\n                        value = field.get(\"default_value\", \"\")\n                else:\n                    # For 'extracted' type - get from extracted_data\n                    value = extracted_data.get(field_name, \"\")\n                    # Fallback to default if no value\n                    if not value and field.get(\"use_default_if_empty\"):\n                        value = field.get(\"default_value\", \"\")\n\n                # Log field extraction status\n                log_detailed(\"debug\", \"forwarding_engine\", \"_apply_publishing_template\",\n                            f\"Processing field: {field_name}\", {\n                                \"has_value\": bool(value),\n                                \"value_preview\": str(value)[:50] if value else \"empty\",\n                                \"field_type\": field.get(\"field_type\", \"extracted\"),\n                                \"use_default_if_empty\": field.get(\"use_default_if_empty\"),\n                                \"is_active\": is_active\n                            })\n\n                # Add ALL active fields, even if empty (unless completely missing)\n                # The field should appear if it's active, regardless of value\n                if is_active:\n                    # Convert to string and apply formatting\n                    formatted_value = self._apply_formatting(str(value), formatting) if value else \"\"\n\n                    log_detailed(\"debug\", \"forwarding_engine\", \"_apply_publishing_template\",\n                                f\"Field formatted: {field_name}\", {\n                                    \"formatting\": formatting,\n                                    \"original_length\": len(str(value)) if value else 0,\n                                    \"formatted_length\": len(formatted_value),\n                                    \"has_html_tags\": any(tag in formatted_value for tag in ['<b>', '<i>', '<blockquote>']),\n                                    \"formatted_preview\": formatted_value[:100] if len(formatted_value) > 100 else formatted_value\n                                })\n\n                    # Build the field text (don't strip - preserves formatting)\n                    if show_label and field_label:\n                        field_text = f\"{field_label}{label_separator}{prefix}{formatted_value}{suffix}\"\n                    else:\n                        field_text = f\"{prefix}{formatted_value}{suffix}\"\n\n                    # Always add the field if it's active (show_label determines if we include label)\n                    field_parts.append(field_text)\n\n            if field_parts:\n                result_parts.append(field_separator.join(field_parts))\n\n            # Add footer if exists\n            if footer_text:\n                if use_newline_before_footer:\n                    result_parts.append(\"\")\n                formatted_footer = self._apply_formatting(footer_text.strip(), footer_formatting)\n                result_parts.append(formatted_footer)\n\n            # Join all parts\n            result = \"\\n\".join(filter(None, result_parts))\n\n            # Apply max length\n            if max_length and len(result) > max_length:\n                result = result[:max_length - 3] + \"...\"\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_apply_publishing_template\",\n                        f\"Template applied: {template['name']}\", {\n                            \"output_length\": len(result),\n                            \"fields_count\": len(custom_fields),\n                            \"extracted_count\": len(extracted_data),\n                            \"field_parts_count\": len(field_parts),\n                            \"result_parts_count\": len(result_parts),\n                            \"result_preview\": result[:200] if result else \"EMPTY\"\n                        })\n\n            return (result, extracted_data)\n\n        except Exception as e:\n            log_detailed(\"error\", \"forwarding_engine\", \"_apply_publishing_template\",\n                        f\"Template error: {str(e)}\", {\"traceback\": traceback.format_exc()})\n            return (text, extracted_data or {})\n\n    async def _process_message(\n        self,\n        message: Message,\n        task_id: int,\n        task_config: Dict[str, Any],\n        task_logger: TaskLogger,\n        serial_number: Optional[int] = None\n    ) -> Optional[Tuple[Optional[str], Dict[str, Any]]]:\n        \"\"\"Process message with unified AI pipeline including content filters and publishing templates\"\"\"\n        text = \"\"\n\n        log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", \"Starting message processing\", {\n            \"task_id\": task_id,\n            \"has_text\": bool(message.text),\n            \"has_caption\": bool(message.caption),\n            \"has_video\": bool(message.video),\n            \"ai_enabled\": task_config.get(\"ai_enabled\"),\n            \"summarization_enabled\": task_config.get(\"summarization_enabled\")\n        })\n\n        try:\n            text = message.text or message.caption or \"\"\n\n            if not text:\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", \"No text to process\")\n                extracted = {\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\": f\"#{serial_number}\", \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\": f\"#{serial_number}\"} if serial_number else {}\n                return (None, extracted) if serial_number else None\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", f\"Text length: {len(text)} chars\")\n\n            if (task_config.get(\"videoProcessingEnabled\") or task_config.get(\"video_processing_enabled\")) and message.video:\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", \"Video detected, adding to queue\")\n                await task_logger.log_info(\"Video detected, processing...\")\n                video_provider_id = task_config.get(\"video_ai_provider_id\")\n                video_model_id = task_config.get(\"video_ai_model_id\")\n                await queue_manager.add_job(\n                    \"video_process\",\n                    {\n                        \"message_id\": message.id,\n                        \"chat_id\": message.chat.id,\n                        \"task_id\": task_id,\n                        \"video_provider_id\": video_provider_id,\n                        \"video_model_id\": video_model_id\n                    },\n                    task_id=task_id,\n                    priority=5\n                )\n                extracted = {\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\": f\"#{serial_number}\", \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\": f\"#{serial_number}\"} if serial_number else {}\n                return (None, extracted) if serial_number else None\n\n            # Apply AI Pipeline if AI is enabled (regardless of summarization_enabled)\n            # summarization_enabled controls whether to SUMMARIZE, but ai_enabled controls whether to apply AI RULES\n            if not task_config.get(\"ai_enabled\"):\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", \"AI not enabled for this task\")\n                extracted = {\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\": f\"#{serial_number}\", \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\": f\"#{serial_number}\"} if serial_number else {}\n                return (text, extracted)\n\n            provider_id = task_config.get(\"summarization_provider_id\") or task_config.get(\"summarizationProviderId\")\n            model_id = task_config.get(\"summarization_model_id\") or task_config.get(\"summarizationModelId\")\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", f\"Retrieved IDs from task_config\", {\n                \"provider_id\": provider_id,\n                \"model_id\": model_id,\n                \"config_keys\": list(task_config.keys())\n            })\n\n            provider_name = None\n            model_name = None\n\n            if provider_id:\n                provider_info = await db.get_ai_provider(provider_id)\n                if provider_info:\n                    provider_name = provider_info[\"name\"]\n                    log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", f\"‚úÖ Using provider: {provider_name}\")\n                else:\n                    log_detailed(\"error\", \"forwarding_engine\", \"_process_message\", f\"Provider {provider_id} not found in DB\")\n            else:\n                log_detailed(\"error\", \"forwarding_engine\", \"_process_message\", f\"No provider_id configured for this task\")\n\n            if model_id:\n                model_info = await db.get_ai_model(model_id)\n                if model_info:\n                    model_name = model_info.get(\"name\") or model_info.get(\"model_name\")\n                    log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", f\"‚úÖ Using model: {model_name}\")\n                else:\n                    log_detailed(\"error\", \"forwarding_engine\", \"_process_message\", f\"Model {model_id} not found in DB\")\n            else:\n                log_detailed(\"error\", \"forwarding_engine\", \"_process_message\", f\"No model_id configured for this task\")\n\n            if not provider_name or not model_name:\n                log_detailed(\"error\", \"forwarding_engine\", \"_process_message\", \"AI processing skipped - no provider/model configured\")\n                extracted = {\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\": f\"#{serial_number}\", \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\": f\"#{serial_number}\"} if serial_number else {}\n                return (text, extracted)\n\n            system_prompt = await db.get_setting(\"default_prompt\")\n            if system_prompt:\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", f\"Using system prompt: {system_prompt[:80]}...\")\n\n            all_rules = await db.get_task_rules(task_id)\n            rules = [r for r in all_rules if r[\"type\"] == \"summarize\" and r[\"is_active\"]]\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_process_message\",\n                        f\"üìã Fetched rules from database\", {\n                            \"total_rules\": len(all_rules),\n                            \"summarization_rules\": len(rules),\n                            \"rule_types\": list(set(r.get(\"type\") for r in all_rules))\n                        })\n            \n            for i, rule in enumerate(rules, 1):\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_message\",\n                            f\"üìå Rule #{i}: {rule.get('name', 'unnamed')}\", {\n                                \"id\": rule.get(\"id\"),\n                                \"type\": rule.get(\"type\"),\n                                \"priority\": rule.get(\"priority\"),\n                                \"config\": str(rule.get(\"config\", {}))[:200]\n                            })\n\n            # Get publishing template fields for combined extraction\n            fields_to_extract = []\n            try:\n                template = await db.get_task_publishing_template(task_id)\n                if template and template.get(\"fields\"):\n                    fields_to_extract = template.get(\"fields\", [])\n                    log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", \n                                f\"üìã Loaded {len(fields_to_extract)} template fields for combined extraction\")\n            except Exception as e:\n                log_detailed(\"warning\", \"forwarding_engine\", \"_process_message\", \n                            f\"Could not load template fields: {str(e)}\")\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_process_message\",\n                        f\"üöÄ Starting AI Pipeline processing (combined summarization + extraction)\", {\n                            \"text_input_length\": len(text),\n                            \"rules_count\": len(rules),\n                            \"fields_count\": len(fields_to_extract),\n                            \"provider\": provider_name,\n                            \"model\": model_name\n                        })\n\n            pipeline_result = await ai_pipeline.process(\n                text=text,\n                task_id=task_id,\n                provider=provider_name,\n                model=model_name,\n                system_prompt=system_prompt,\n                custom_rules=rules,\n                fields_to_extract=fields_to_extract,\n                serial_number=serial_number\n            )\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", \"üìä AI Pipeline completed\", {\n                \"original_length\": len(text),\n                \"final_length\": len(pipeline_result.final_text),\n                \"stages\": len(pipeline_result.stages),\n                \"rules_applied\": pipeline_result.rules_applied_count,\n                \"quality_score\": pipeline_result.quality_score,\n                \"total_time\": f\"{pipeline_result.total_time:.2f}s\"\n            })\n\n            for stage in pipeline_result.stages:\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_message\",\n                            f\"  ‚îú‚îÄ {stage.stage_name}: {'‚úÖ' if stage.success else '‚ùå'} ({stage.processing_time:.2f}s)\")\n\n            if pipeline_result.entities_replaced:\n                for entity_type, replacements in pipeline_result.entities_replaced.items():\n                    log_detailed(\"info\", \"forwarding_engine\", \"_process_message\",\n                                f\"  ‚îú‚îÄ Entity replacements ({entity_type}): {len(replacements)}\")\n\n            processed_text = pipeline_result.final_text\n\n            should_forward, action, filter_matched, processed_text = await self._check_content_filters(\n                processed_text, task_id, pipeline_result.preprocessing\n            )\n\n            if not should_forward:\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_message\",\n                            f\"‚õî Message blocked by filter: {filter_matched['name'] if filter_matched else 'unknown'}\")\n                await task_logger.log_warning(f\"Message blocked by content filter\")\n                return None\n\n            if action == \"modify\" and filter_matched:\n                log_detailed(\"info\", \"forwarding_engine\", \"_process_message\",\n                            f\"üîÑ Applying filter modification: {filter_matched['name']}\")\n\n            # ‚úÖ NOTE: Summarization rules are now applied in AI Pipeline (post-processing)\n            # This ensures rules are applied IMMEDIATELY after AI output, before template\n\n            # NOTE: Publishing template is now applied in _forward_to_target as the LAST step\n            # This ensures it works for both AI and non-AI forwarding\n\n            await task_logger.log_info(\n                f\"AI Pipeline completed | From {len(text)} ‚Üí {len(processed_text)} chars\",\n                {\n                    \"rules_applied\": pipeline_result.rules_applied_count,\n                    \"quality_score\": pipeline_result.quality_score,\n                    \"provider\": provider_name,\n                    \"model\": model_name\n                }\n            )\n            await db.update_task_stats(task_id, \"ai\")\n\n            reduction_percent = 100 - (len(processed_text) * 100 // len(text)) if len(text) > 0 else 0\n            log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", \"‚úÖ Message processing completed\", {\n                \"original_length\": len(text),\n                \"processed_length\": len(processed_text),\n                \"total_reduction\": len(text) - len(processed_text),\n                \"reduction_percent\": reduction_percent,\n                \"final_preview\": processed_text[:150]\n            })\n\n            # Use extracted fields from pipeline (already includes serial number)\n            extracted = pipeline_result.extracted_fields or {}\n            if serial_number and \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\" not in extracted:\n                extracted[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\"] = f\"#{serial_number}\"\n                extracted[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\"] = f\"#{serial_number}\"\n            \n            # ‚úÖ FIXED: Add PROCESSED (rules-applied) text as summary for template\n            if processed_text and \"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\" not in extracted:\n                extracted[\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"] = processed_text\n            \n            log_detailed(\"info\", \"forwarding_engine\", \"_process_message\", \n                        f\"üì¶ Combined extraction complete | Fields: {len(extracted)}\", {\n                            \"field_names\": list(extracted.keys())\n                        })\n            \n            return (processed_text, extracted)\n\n        except Exception as e:\n            log_detailed(\"error\", \"forwarding_engine\", \"_process_message\", f\"AI processing error: {str(e)}\", {\n                \"traceback\": traceback.format_exc()\n            })\n            await task_logger.log_error(f\"AI processing error: {str(e)}\")\n            # Return tuple with serial number on error too\n            extracted = {\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\": f\"#{serial_number}\", \"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\": f\"#{serial_number}\"} if serial_number else {}\n            return (text, extracted)\n\n    @handle_errors(\"forwarding_engine\", \"forward_to_target\")\n    async def _forward_to_target(\n        self,\n        message: Message,\n        target_id: int,\n        processed_text: Optional[str],\n        task_logger: TaskLogger,\n        task_id: Optional[int] = None,\n        extracted_data: Optional[Dict[str, Any]] = None\n    ):\n        \"\"\"Forward message to a single target with full support for all media types and entities\"\"\"\n\n        log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", f\"Forwarding to target {target_id}\", {\n            \"message_id\": message.id,\n            \"has_processed_text\": bool(processed_text),\n            \"task_id\": task_id\n        })\n\n        try:\n            # Get target channel info from database\n            target_channel = await db.get_channel(target_id)\n\n            if not target_channel:\n                log_detailed(\"error\", \"forwarding_engine\", \"_forward_to_target\", f\"Target channel not found: {target_id}\")\n                await task_logger.log_warning(f\"Target channel {target_id} not found\")\n                return\n\n            target_identifier_str = target_channel[\"identifier\"]\n            target_title = target_channel[\"title\"]\n\n            # Use target identifier as-is (already in correct format from database)\n            try:\n                target_identifier = int(target_identifier_str)\n            except (ValueError, TypeError):\n                target_identifier = target_identifier_str\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", f\"Target: {target_title}\", {\n                \"identifier\": target_identifier,\n                \"identifier_type\": type(target_identifier).__name__\n            })\n\n            # Get original text/caption and entities\n            original_text = message.text or message.caption or \"\"\n            original_entities = message.entities or message.caption_entities\n\n            # Determine if we should use processed text\n            use_processed = processed_text and processed_text != original_text\n\n            final_text = processed_text if use_processed else original_text\n            final_entities = None if use_processed else original_entities\n\n            # ALWAYS apply publishing template as the LAST step (even without AI)\n            # This ensures template is applied to ALL forwarded messages\n            if task_id and final_text:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                            \"üîß [TEMPLATE STAGE 1] Starting publishing template application...\", {\n                                \"task_id\": task_id,\n                                \"text_length\": len(final_text),\n                                \"original_text_length\": len(original_text),\n                                \"has_entities\": bool(final_entities),\n                                \"extracted_data\": extracted_data\n                            })\n                # Pass original_text for field extraction (source, classification, etc.)\n                # Pass final_text (summarized) for summary field\n                template_result = await self._apply_publishing_template(final_text, task_id, extracted_data, original_text=original_text)\n                # Unpack the tuple: (formatted_text, extracted_data_dict)\n                template_applied_text, extracted_data = template_result if isinstance(template_result, tuple) else (template_result, extracted_data)\n\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                            \"üîß [TEMPLATE STAGE 2] Template function returned\", {\n                                \"returned_length\": len(template_applied_text) if template_applied_text else 0,\n                                \"is_empty\": not template_applied_text,\n                                \"is_same_as_input\": template_applied_text == final_text,\n                                \"has_html_formatting\": any(tag in (template_applied_text or \"\") for tag in ['<b>', '<i>', '<blockquote>', '<u>', '<s>', '<a href=']),\n                                \"preview\": (template_applied_text or \"\")[:150],\n                                \"extracted_data_updated\": True\n                            })\n\n                if template_applied_text and template_applied_text != final_text:\n                    final_text = template_applied_text\n                    final_entities = None  # Reset entities since text was modified by template\n                    log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                                \"‚úÖ [TEMPLATE STAGE 3] Template applied successfully\", {\n                                    \"original_length\": len(original_text),\n                                    \"template_length\": len(final_text),\n                                    \"has_html_formatting\": any(tag in final_text for tag in ['<b>', '<i>', '<blockquote>', '<u>', '<s>']),\n                                    \"entities_reset\": True\n                                })\n                elif not template_applied_text:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"_forward_to_target\",\n                                \"‚ö†Ô∏è [TEMPLATE STAGE 3] Template returned empty result\")\n                else:\n                    log_detailed(\"debug\", \"forwarding_engine\", \"_forward_to_target\",\n                                \"‚ÑπÔ∏è [TEMPLATE STAGE 3] Template returned same text (no changes)\")\n\n            # Create Telegraph page if text was processed\n            telegraph_url = None\n            if use_processed and original_text:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                            \"üîó [TELEGRAPH STAGE 1] Starting Telegraph page creation\")\n\n                # Collect media\n                photos_ids = [message.photo.file_id] if message.photo else []\n                videos_info = [{'file_id': message.video.file_id, 'title': 'ŸÅŸäÿØŸäŸà'} if message.video else None]\n                videos_info = [v for v in videos_info if v]\n\n                # Create download wrapper\n                async def download_wrapper(fid):\n                    try:\n                        result = await self.client.download_media(fid)\n                        log_detailed(\"debug\", \"forwarding_engine\", \"_forward_to_target\",\n                                    \"Downloaded media\", {\"path\": result})\n                        return result\n                    except Exception as e:\n                        log_detailed(\"warning\", \"forwarding_engine\", \"_forward_to_target\",\n                                    f\"Media download failed: {str(e)[:60]}\")\n                        return None\n\n                telegraph_url = await telegraph_manager.create_original_content_page(\n                    original_text=original_text,\n                    photos_file_ids=photos_ids if photos_ids else None,\n                    videos_info=videos_info if videos_info else None,\n                    download_func=download_wrapper if (photos_ids or videos_info) else None\n                )\n\n                if telegraph_url:\n                    log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                                \"üîó [TELEGRAPH STAGE 2] Telegraph page created, adding link\")\n                    final_text_before_link = final_text\n                    final_text = f'{final_text}\\n\\nüì∞ <a href=\"{telegraph_url}\">ÿßŸÇÿ±ÿ£ ŸÉÿßŸÖŸÑ ÿßŸÑÿÆÿ®ÿ±</a>'\n                    log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                                \"üîó [TELEGRAPH STAGE 3] Link added to text\", {\n                                    \"url\": telegraph_url,\n                                    \"text_before_link\": len(final_text_before_link),\n                                    \"text_after_link\": len(final_text),\n                                    \"new_content\": final_text[len(final_text_before_link):] if len(final_text) > len(final_text_before_link) else \"N/A\"\n                                })\n                else:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"_forward_to_target\",\n                                \"‚ö†Ô∏è [TELEGRAPH STAGE 2] Telegraph page creation failed\")\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Text processing\", {\n                \"original_length\": len(original_text),\n                \"final_length\": len(final_text) if final_text else 0,\n                \"use_processed\": use_processed,\n                \"has_entities\": bool(final_entities)\n            })\n\n            # Determine if we should use parse_mode (when template applied) or entities\n            use_parse_mode = not final_entities\n\n            # Check if caption has HTML tags for entity parsing\n            caption_has_html = any(tag in (final_text or \"\") for tag in ['<b>', '<i>', '<blockquote>', '<u>', '<s>', '<a href='])\n\n            # Prepare caption entities if HTML present\n            caption_plain = final_text\n            caption_entities_parsed = None\n            if use_parse_mode and caption_has_html and final_text:\n                caption_plain, caption_entities_parsed = self._parse_html_to_entities(final_text)\n\n            # Handle different message types with entity preservation\n            if message.photo:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending photo...\")\n                if caption_entities_parsed:\n                    await self.client.send_photo(\n                        chat_id=target_identifier,\n                        photo=message.photo.file_id,\n                        caption=caption_plain or \"\",\n                        caption_entities=caption_entities_parsed\n                    )\n                elif final_entities:\n                    await self.client.send_photo(\n                        chat_id=target_identifier,\n                        photo=message.photo.file_id,\n                        caption=final_text or \"\",\n                        caption_entities=final_entities\n                    )\n                else:\n                    await self.client.send_photo(\n                        chat_id=target_identifier,\n                        photo=message.photo.file_id,\n                        caption=final_text or \"\"\n                    )\n            elif message.video:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending video...\")\n                if caption_entities_parsed:\n                    await self.client.send_video(\n                        chat_id=target_identifier,\n                        video=message.video.file_id,\n                        caption=caption_plain or \"\",\n                        caption_entities=caption_entities_parsed,\n                        duration=message.video.duration,\n                        width=message.video.width,\n                        height=message.video.height\n                    )\n                elif final_entities:\n                    await self.client.send_video(\n                        chat_id=target_identifier,\n                        video=message.video.file_id,\n                        caption=final_text or \"\",\n                        caption_entities=final_entities,\n                        duration=message.video.duration,\n                        width=message.video.width,\n                        height=message.video.height\n                    )\n                else:\n                    await self.client.send_video(\n                        chat_id=target_identifier,\n                        video=message.video.file_id,\n                        caption=final_text or \"\",\n                        duration=message.video.duration,\n                        width=message.video.width,\n                        height=message.video.height\n                    )\n            elif message.animation:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending animation...\")\n                if caption_entities_parsed:\n                    await self.client.send_animation(\n                        chat_id=target_identifier,\n                        animation=message.animation.file_id,\n                        caption=caption_plain or \"\",\n                        caption_entities=caption_entities_parsed\n                    )\n                elif final_entities:\n                    await self.client.send_animation(\n                        chat_id=target_identifier,\n                        animation=message.animation.file_id,\n                        caption=final_text or \"\",\n                        caption_entities=final_entities\n                    )\n                else:\n                    await self.client.send_animation(\n                        chat_id=target_identifier,\n                        animation=message.animation.file_id,\n                        caption=final_text or \"\"\n                    )\n            elif message.audio:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending audio...\")\n                if caption_entities_parsed:\n                    await self.client.send_audio(\n                        chat_id=target_identifier,\n                        audio=message.audio.file_id,\n                        caption=caption_plain or \"\",\n                        caption_entities=caption_entities_parsed,\n                        duration=message.audio.duration,\n                        performer=message.audio.performer,\n                        title=message.audio.title\n                    )\n                elif final_entities:\n                    await self.client.send_audio(\n                        chat_id=target_identifier,\n                        audio=message.audio.file_id,\n                        caption=final_text or \"\",\n                        caption_entities=final_entities,\n                        duration=message.audio.duration,\n                        performer=message.audio.performer,\n                        title=message.audio.title\n                    )\n                else:\n                    await self.client.send_audio(\n                        chat_id=target_identifier,\n                        audio=message.audio.file_id,\n                        caption=final_text or \"\",\n                        duration=message.audio.duration,\n                        performer=message.audio.performer,\n                        title=message.audio.title\n                    )\n            elif message.voice:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending voice...\")\n                if caption_entities_parsed:\n                    await self.client.send_voice(\n                        chat_id=target_identifier,\n                        voice=message.voice.file_id,\n                        caption=caption_plain or \"\",\n                        caption_entities=caption_entities_parsed,\n                        duration=message.voice.duration\n                    )\n                elif final_entities:\n                    await self.client.send_voice(\n                        chat_id=target_identifier,\n                        voice=message.voice.file_id,\n                        caption=final_text or \"\",\n                        caption_entities=final_entities,\n                        duration=message.voice.duration\n                    )\n                else:\n                    await self.client.send_voice(\n                        chat_id=target_identifier,\n                        voice=message.voice.file_id,\n                        caption=final_text or \"\",\n                        duration=message.voice.duration\n                    )\n            elif message.video_note:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending video note...\")\n                await self.client.send_video_note(\n                    chat_id=target_identifier,\n                    video_note=message.video_note.file_id,\n                    duration=message.video_note.duration,\n                    length=message.video_note.length\n                )\n            elif message.document:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending document...\")\n                if caption_entities_parsed:\n                    await self.client.send_document(\n                        chat_id=target_identifier,\n                        document=message.document.file_id,\n                        caption=caption_plain or \"\",\n                        caption_entities=caption_entities_parsed,\n                        file_name=message.document.file_name\n                    )\n                elif final_entities:\n                    await self.client.send_document(\n                        chat_id=target_identifier,\n                        document=message.document.file_id,\n                        caption=final_text or \"\",\n                        caption_entities=final_entities,\n                        file_name=message.document.file_name\n                    )\n                else:\n                    await self.client.send_document(\n                        chat_id=target_identifier,\n                        document=message.document.file_id,\n                        caption=final_text or \"\",\n                        file_name=message.document.file_name\n                    )\n            elif message.sticker:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending sticker...\")\n                await self.client.send_sticker(\n                    chat_id=target_identifier,\n                    sticker=message.sticker.file_id\n                )\n            elif message.poll:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending poll...\")\n                poll_options = [opt.text for opt in (message.poll.options or [])]\n                await self.client.send_poll(\n                    chat_id=target_identifier,\n                    question=message.poll.question,\n                    options=poll_options,\n                    is_anonymous=message.poll.is_anonymous,\n                    type=message.poll.type,\n                    allows_multiple_answers=message.poll.allows_multiple_answers\n                )\n            elif message.contact:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending contact...\")\n                await self.client.send_contact(\n                    chat_id=target_identifier,\n                    phone_number=message.contact.phone_number,\n                    first_name=message.contact.first_name,\n                    last_name=message.contact.last_name\n                )\n            elif message.location:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending location...\")\n                await self.client.send_location(\n                    chat_id=target_identifier,\n                    latitude=message.location.latitude,\n                    longitude=message.location.longitude\n                )\n            elif message.venue:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending venue...\")\n                await self.client.send_venue(\n                    chat_id=target_identifier,\n                    latitude=message.venue.location.latitude,\n                    longitude=message.venue.location.longitude,\n                    title=message.venue.title,\n                    address=message.venue.address\n                )\n            elif message.dice:\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Sending dice...\")\n                await self.client.send_dice(\n                    chat_id=target_identifier,\n                    emoji=message.dice.emoji\n                )\n            elif final_text:\n                # Text message with entities preserved or manually parsed\n                has_html = any(tag in final_text for tag in ['<b>', '<i>', '<blockquote>', '<u>', '<s>', '<a href='])\n\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                            \"üì§ [SEND STAGE 1] Preparing text message...\", {\n                                \"use_parse_mode\": use_parse_mode,\n                                \"has_html_tags\": has_html,\n                                \"text_length\": len(final_text),\n                                \"text_preview\": final_text[:200] if len(final_text) > 200 else final_text\n                            })\n\n                if use_parse_mode and has_html:\n                    # Use manual entity parsing since Pyrogram doesn't support blockquote in parse_mode\n                    plain_text, parsed_entities = self._parse_html_to_entities(final_text)\n\n                    log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                                \"üì§ [SEND STAGE 2] Sending with manually parsed entities\", {\n                                    \"chat_id\": target_identifier,\n                                    \"plain_text_length\": len(plain_text),\n                                    \"entities_count\": len(parsed_entities),\n                                    \"entity_types\": [str(e.type) for e in parsed_entities],\n                                    \"plain_text_preview\": plain_text[:150]\n                                })\n\n                    await self.client.send_message(\n                        chat_id=target_identifier,\n                        text=plain_text,\n                        entities=parsed_entities,\n                        disable_web_page_preview=True\n                    )\n                elif use_parse_mode:\n                    # No HTML tags - send plain text\n                    log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                                \"üì§ [SEND STAGE 2] Sending plain text (no HTML)\", {\n                                    \"chat_id\": target_identifier,\n                                    \"text_length\": len(final_text)\n                                })\n                    await self.client.send_message(\n                        chat_id=target_identifier,\n                        text=final_text,\n                        disable_web_page_preview=True\n                    )\n                else:\n                    log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\",\n                                \"üì§ [SEND STAGE 2] Sending with original entities\", {\n                                    \"chat_id\": target_identifier,\n                                    \"entities_count\": len(final_entities) if final_entities else 0\n                                })\n                    await self.client.send_message(\n                        chat_id=target_identifier,\n                        text=final_text,\n                        entities=final_entities,\n                        disable_web_page_preview=True\n                    )\n            else:\n                # Fallback: forward original message\n                log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", \"Using fallback forward...\")\n                await message.forward(target_identifier)\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_forward_to_target\", f\"‚úÖ Forwarded to {target_title}\")\n            await task_logger.log_info(\n                f\"Forwarded to {target_title or target_identifier}\"\n            )\n\n        except ChannelPrivate:\n            log_detailed(\"error\", \"forwarding_engine\", \"_forward_to_target\", f\"Channel is private or bot not member: {target_id}\")\n            await task_logger.log_error(f\"Channel private or bot not member: {target_id}\")\n        except ChatWriteForbidden:\n            log_detailed(\"error\", \"forwarding_engine\", \"_forward_to_target\", f\"Bot cannot write to channel: {target_id}\")\n            await task_logger.log_error(f\"Bot cannot write to channel: {target_id}\")\n        except FloodWait as e:\n            delay = float(e.value) if isinstance(e.value, (int, str)) else 5.0\n            log_detailed(\"warning\", \"forwarding_engine\", \"_forward_to_target\", f\"FloodWait: {delay}s\")\n            await asyncio.sleep(delay)\n            raise\n        except Exception as e:\n            log_detailed(\"error\", \"forwarding_engine\", \"_forward_to_target\", f\"Failed to forward: {str(e)}\", {\n                \"target_id\": target_id,\n                \"traceback\": traceback.format_exc()\n            })\n            await task_logger.log_error(\n                f\"Failed to forward to {target_id}: {str(e)}\"\n            )\n            raise\n\n    async def _save_to_archive(\n        self,\n        message: Message,\n        task_id: int,\n        task_config: Dict[str, Any],\n        original_text: str,\n        processed_text: str,\n        target_channels: List[int],\n        extracted_data: Optional[Dict[str, Any]] = None,\n        telegraph_url: Optional[str] = None,\n        serial_number: Optional[int] = None\n    ):\n        \"\"\"Save processed message to archive with serial number\"\"\"\n        import time\n        start_time = time.time()\n\n        try:\n            # Use provided serial number or get next one\n            if serial_number is None:\n                serial_number = await db.get_next_serial_number(task_id)\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_save_to_archive\",\n                        f\"Saving message to archive with serial #{serial_number}\", {\n                            \"task_id\": task_id,\n                            \"message_id\": message.id\n                        })\n\n            # Get source channel info\n            source_channel_title = message.chat.title if message.chat else \"Unknown\"\n            source_channel_id = str(message.chat.id) if message.chat else None\n\n            # Get first target channel info\n            target_channel_title = None\n            target_channel_id = None\n            if target_channels:\n                first_target = await db.get_channel(target_channels[0])\n                if first_target:\n                    target_channel_title = first_target.get(\"title\")\n                    target_channel_id = first_target.get(\"identifier\")\n\n            # Extract metadata from extracted_data or text\n            classification = None\n            news_type = None\n            province = None\n            specialist = None\n            title = None\n            summarized_text = processed_text  # Use processed text by default\n\n            if extracted_data:\n                classification = extracted_data.get(\"ÿßŸÑÿ™ÿµŸÜŸäŸÅ_\") or extracted_data.get(\"ÿßŸÑÿ™ÿµŸÜŸäŸÅ\") or extracted_data.get(\"classification\")\n                news_type = extracted_data.get(\"ŸÜŸàÿπ_ÿßŸÑÿÆÿ®ÿ±\") or extracted_data.get(\"news_type\")\n                province = extracted_data.get(\"ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏Ÿá_\") or extracted_data.get(\"ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©\") or extracted_data.get(\"province\")\n                specialist = extracted_data.get(\"ÿßŸÑŸÖÿÆÿ™ÿµ\") or extracted_data.get(\"specialist\")\n                title = extracted_data.get(\"ÿßŸÑÿπŸÜŸàÿßŸÜ\") or extracted_data.get(\"title\")\n\n            # Apply summarization rule if configured\n            try:\n                if task_config.get(\"summarization_rule_id\"):\n                    rule_info = await db.get_rule(task_config[\"summarization_rule_id\"])\n                    if rule_info and rule_info.get(\"config\"):\n                        from services.ai_rule_engine import ai_rule_engine\n                        rule_result = await ai_rule_engine.apply_summarization_rule(\n                            processed_text or original_text,\n                            rule_info.get(\"config\"),\n                            task_config\n                        )\n                        if rule_result and rule_result.get(\"text\"):\n                            summarized_text = rule_result[\"text\"]\n                            log_detailed(\"info\", \"forwarding_engine\", \"_save_to_archive\", \n                                       f\"Applied summarization rule, text reduced from {len(processed_text or original_text)} to {len(summarized_text)} chars\")\n            except Exception as summarize_err:\n                log_detailed(\"warning\", \"forwarding_engine\", \"_save_to_archive\", \n                           f\"Summarization rule failed: {str(summarize_err)}, using original text\")\n\n            # Generate title using AI if not extracted\n            if not title:\n                try:\n                    # Use AI to generate a proper title\n                    from services.ai_providers import ai_manager\n                    \n                    text_for_title = summarized_text or processed_text or original_text\n                    title_prompt = f\"\"\"ÿ£ŸÜÿ™ ŸÖÿ™ÿÆÿµÿµ ŸÅŸä ŸÉÿ™ÿßÿ®ÿ© ÿßŸÑÿπŸÜÿßŸàŸäŸÜ ÿßŸÑÿ•ÿÆÿ®ÿßÿ±Ÿäÿ© ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©.\nŸÇŸÖ ÿ®ÿ•ŸÜÿ¥ÿßÿ° ÿπŸÜŸàÿßŸÜ ŸÇÿµŸäÿ± Ÿàÿßÿ≠ÿ™ÿ±ÿßŸÅŸä (ŸÑÿß Ÿäÿ≤ŸäÿØ ÿπŸÜ 10 ŸÉŸÑŸÖÿßÿ™) ŸÑŸÑŸÜÿµ ÿßŸÑÿ™ÿßŸÑŸä:\n\n{text_for_title[:800]}\n\nÿ£ÿ¨ÿ® ÿ®ÿßŸÑÿπŸÜŸàÿßŸÜ ŸÅŸÇÿ∑ ÿ®ÿØŸàŸÜ ÿ¥ÿ±ÿ≠ ÿ£Ÿà ÿ™ŸÅÿ≥Ÿäÿ±.\"\"\"\n                    \n                    # Get AI provider/model from task config\n                    provider_name = None\n                    model_name = None\n                    \n                    if task_config.get(\"summarization_provider_id\"):\n                        provider_info = await db.get_ai_provider(task_config[\"summarization_provider_id\"])\n                        if provider_info:\n                            provider_name = provider_info.get(\"name\")\n                    \n                    if task_config.get(\"summarization_model_id\"):\n                        model_info = await db.get_ai_model(task_config[\"summarization_model_id\"])\n                        if model_info:\n                            model_name = model_info.get(\"name\") or model_info.get(\"model_name\")\n                    \n                    if not provider_name or not model_name:\n                        raise Exception(\"No AI provider/model configured for this task\")\n                    \n                    generated_title = await ai_manager.generate(\n                        provider=provider_name,\n                        model=model_name,\n                        prompt=title_prompt,\n                        max_tokens=100,\n                        temperature=0.5\n                    )\n                    \n                    if generated_title:\n                        title = generated_title.strip()[:100]  # Limit to 100 chars\n                        log_detailed(\"info\", \"forwarding_engine\", \"_save_to_archive\", \n                                    f\"Generated title using AI: {title[:50]}\")\n                except Exception as title_err:\n                    log_detailed(\"warning\", \"forwarding_engine\", \"_save_to_archive\",\n                                f\"Failed to generate AI title: {str(title_err)}, using fallback\")\n                    # Fallback: use first line or first 50 chars\n                    title = (text_for_title.split('\\n')[0] or text_for_title)[:80]\n\n            # Get AI provider/model info\n            ai_provider = None\n            ai_model = None\n            template_name = None\n\n            if task_config.get(\"summarization_provider_id\"):\n                provider_info = await db.get_ai_provider(task_config[\"summarization_provider_id\"])\n                if provider_info:\n                    ai_provider = provider_info.get(\"name\")\n\n            if task_config.get(\"summarization_model_id\"):\n                model_info = await db.get_ai_model(task_config[\"summarization_model_id\"])\n                if model_info:\n                    ai_model = model_info.get(\"name\") or model_info.get(\"model_name\")\n\n            # Get template name\n            default_template = await db.get_default_template_with_fields(task_id)\n            if default_template:\n                template_name = default_template.get(\"name\")\n\n            # Determine media info\n            has_media = bool(message.media)\n            media_type = None\n            media_count = 0\n\n            if message.photo:\n                media_type = \"photo\"\n                media_count = 1\n            elif message.video:\n                media_type = \"video\"\n                media_count = 1\n            elif message.document:\n                media_type = \"document\"\n                media_count = 1\n            elif message.audio:\n                media_type = \"audio\"\n                media_count = 1\n\n            # Calculate processing duration\n            processing_duration = int((time.time() - start_time) * 1000)\n\n            # Apply publishing template to get the full formatted text with all fields\n            # This ensures published_text in archive matches what was actually sent to Telegram\n            published_text = processed_text\n            try:\n                # Ensure extracted_data has serial number\n                if extracted_data is None:\n                    extracted_data = {}\n                extracted_data[\"serial_number\"] = serial_number\n                extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\"] = f\"#{serial_number}\"\n                extracted_data[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\"] = f\"#{serial_number}\"\n                \n                # Apply the publishing template to get formatted text with all fields\n                template_result = await self._apply_publishing_template(\n                    processed_text or original_text,\n                    task_id,\n                    extracted_data,\n                    original_text=original_text\n                )\n                \n                # Unpack the result\n                if isinstance(template_result, tuple):\n                    formatted_text, updated_extracted_data = template_result\n                    extracted_data = updated_extracted_data\n                else:\n                    formatted_text = template_result\n                \n                # Use the formatted template text as published_text\n                if formatted_text and formatted_text.strip():\n                    published_text = formatted_text\n                    log_detailed(\"info\", \"forwarding_engine\", \"_save_to_archive\",\n                                f\"Applied publishing template for archive\", {\n                                    \"original_length\": len(processed_text or \"\"),\n                                    \"formatted_length\": len(published_text)\n                                })\n                else:\n                    # Fallback: just add serial number header\n                    if published_text:\n                        published_text = f\"üìã ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ: #{serial_number}\\n\\n{published_text}\"\n            except Exception as template_err:\n                log_detailed(\"warning\", \"forwarding_engine\", \"_save_to_archive\",\n                            f\"Failed to apply template for archive: {str(template_err)}, using fallback\")\n                # Fallback: just add serial number header\n                if published_text:\n                    published_text = f\"üìã ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ: #{serial_number}\\n\\n{published_text}\"\n\n            # Create archive entry\n            # ‚úÖ FIX: Keep processed_text as pure summary (no source/date/fields)\n            # published_text contains the template-formatted output sent to channel\n            archive_data = {\n                \"task_id\": task_id,\n                \"serial_number\": serial_number,\n                \"source_message_id\": str(message.id),\n                \"source_channel_id\": source_channel_id,\n                \"source_channel_title\": source_channel_title,\n                \"target_channel_id\": target_channel_id,\n                \"target_channel_title\": target_channel_title,\n                \"target_message_id\": None,  # We don't have this info here\n                \"title\": title,\n                \"original_text\": original_text,\n                \"processed_text\": processed_text,  # Pure summary/AI output - NO fields added\n                \"published_text\": published_text,  # Template applied - includes fields separately\n                \"telegraph_url\": telegraph_url,\n                \"telegraph_title\": title if telegraph_url else None,\n                \"classification\": classification,\n                \"news_type\": news_type,\n                \"province\": province,\n                \"specialist\": specialist,\n                \"tags\": [],\n                \"extracted_fields\": extracted_data or {},\n                \"has_media\": has_media,\n                \"media_type\": media_type,\n                \"media_count\": media_count,\n                \"media_group_id\": message.media_group_id,\n                \"processing_duration\": processing_duration,\n                \"ai_provider\": ai_provider,\n                \"ai_model\": ai_model,\n                \"template_name\": template_name,\n                \"status\": \"published\"\n            }\n\n            archive_id = await db.create_archive_message(archive_data)\n\n            log_detailed(\"info\", \"forwarding_engine\", \"_save_to_archive\",\n                        f\"‚úÖ Message saved to archive\", {\n                            \"archive_id\": archive_id,\n                            \"serial_number\": serial_number,\n                            \"title\": title[:50] if title else None,\n                            \"has_classification\": bool(classification),\n                            \"has_province\": bool(province)\n                        })\n\n            return archive_id\n\n        except Exception as e:\n            log_detailed(\"error\", \"forwarding_engine\", \"_save_to_archive\",\n                        f\"Failed to save to archive: {str(e)}\", {\n                            \"traceback\": traceback.format_exc()\n                        })\n            raise\n\n    async def start_task_monitoring(self, task_id: int):\n        \"\"\"Start monitoring a task\"\"\"\n        self.active_tasks[task_id] = True\n        log_detailed(\"info\", \"forwarding_engine\", \"start_task_monitoring\", f\"Started monitoring task {task_id}\")\n\n    async def stop_task_monitoring(self, task_id: int):\n        \"\"\"Stop monitoring a task\"\"\"\n        self.active_tasks[task_id] = False\n        log_detailed(\"info\", \"forwarding_engine\", \"stop_task_monitoring\", f\"Stopped monitoring task {task_id}\")\n\n    def is_task_active(self, task_id: int) -> bool:\n        \"\"\"Check if task is actively being monitored\"\"\"\n        return self.active_tasks.get(task_id, False)\n\n# Global forwarding engine (will be initialized with client)\nforwarding_engine: Optional[ForwardingEngine] = None","path":null,"size_bytes":181482,"size_tokens":null},"telegram_bot/utils/error_handler.py":{"content":"\"\"\"\nAdvanced Error Handling and Logging System\nComprehensive error tracking with detailed logging for each component\n\"\"\"\nimport traceback\nimport logging\nfrom datetime import datetime\nfrom typing import Optional, Dict, Any\nfrom functools import wraps\nimport asyncio\nfrom logging.handlers import RotatingFileHandler\n\n# Configure logging\nimport os\n\n# Create logs directory if it doesn't exist\nlog_dir = os.path.join(os.path.dirname(os.path.dirname(__file__)), 'logs')\nos.makedirs(log_dir, exist_ok=True)\nlog_file = os.path.join(log_dir, 'bot.log')\n\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n    handlers=[\n        RotatingFileHandler(log_file, maxBytes=5*1024*1024, backupCount=2),\n        logging.StreamHandler()\n    ]\n)\n\nclass ErrorLogger:\n    \"\"\"Centralized error logging system\"\"\"\n    \n    def __init__(self, component: str):\n        self.component = component\n        self.logger = logging.getLogger(component)\n    \n    async def log_error(\n        self,\n        function: str,\n        error: Exception,\n        metadata: Optional[Dict[str, Any]] = None\n    ):\n        \"\"\"Log error to database and file\"\"\"\n        error_data = {\n            \"component\": self.component,\n            \"function\": function,\n            \"error_type\": type(error).__name__,\n            \"error_message\": str(error),\n            \"stack_trace\": traceback.format_exc(),\n            \"metadata\": metadata or {},\n            \"timestamp\": datetime.utcnow().isoformat()\n        }\n        \n        # Log to file\n        self.logger.error(\n            f\"Error in {function}: {error_data['error_message']}\\n\"\n            f\"Stack trace: {error_data['stack_trace']}\"\n        )\n        \n        # TODO: Log to database\n        # await db.insert_error_log(error_data)\n        \n        return error_data\n    \n    def log_info(self, message: str, metadata: Optional[Dict[str, Any]] = None):\n        \"\"\"Log informational message\"\"\"\n        self.logger.info(f\"{message} | {metadata or {}}\")\n    \n    def log_warning(self, message: str, metadata: Optional[Dict[str, Any]] = None):\n        \"\"\"Log warning message\"\"\"\n        self.logger.warning(f\"{message} | {metadata or {}}\")\n\n\ndef handle_errors(component: str, function_name: Optional[str] = None):\n    \"\"\"\n    Decorator for comprehensive error handling\n    Usage: @handle_errors(\"bot\", \"start_command\")\n    \"\"\"\n    def decorator(func):\n        error_logger = ErrorLogger(component)\n        fname = function_name or func.__name__\n        \n        @wraps(func)\n        async def async_wrapper(*args, **kwargs):\n            try:\n                return await func(*args, **kwargs)\n            except Exception as e:\n                await error_logger.log_error(fname, e, {\n                    \"args\": str(args)[:200],  # Limit size\n                    \"kwargs\": str(kwargs)[:200]\n                })\n                # Re-raise in development, suppress in production\n                raise\n        \n        @wraps(func)\n        def sync_wrapper(*args, **kwargs):\n            try:\n                return func(*args, **kwargs)\n            except Exception as e:\n                # For sync functions, we can't await\n                error_logger.logger.error(\n                    f\"Error in {fname}: {str(e)}\\n{traceback.format_exc()}\"\n                )\n                raise\n        \n        return async_wrapper if asyncio.iscoroutinefunction(func) else sync_wrapper\n    \n    return decorator\n\n\nclass TaskLogger:\n    \"\"\"Logging system for forwarding tasks\"\"\"\n    \n    def __init__(self, task_id: int):\n        self.task_id = task_id\n        self.logger = logging.getLogger(f\"task_{task_id}\")\n    \n    async def log_event(\n        self,\n        level: str,\n        message: str,\n        metadata: Optional[Dict[str, Any]] = None\n    ):\n        \"\"\"Log task event to database\"\"\"\n        log_data = {\n            \"task_id\": self.task_id,\n            \"level\": level,\n            \"message\": message,\n            \"metadata\": metadata or {},\n            \"timestamp\": datetime.utcnow().isoformat()\n        }\n        \n        # Log to file\n        if level == \"error\":\n            self.logger.error(message)\n        elif level == \"warning\":\n            self.logger.warning(message)\n        else:\n            self.logger.info(message)\n        \n        # TODO: Log to database\n        # await db.insert_task_log(log_data)\n        \n        return log_data\n    \n    async def log_success(self, message: str, metadata: Optional[Dict[str, Any]] = None):\n        \"\"\"Log successful operation\"\"\"\n        await self.log_event(\"success\", message, metadata)\n    \n    async def log_error(self, message: str, metadata: Optional[Dict[str, Any]] = None):\n        \"\"\"Log error\"\"\"\n        await self.log_event(\"error\", message, metadata)\n    \n    async def log_info(self, message: str, metadata: Optional[Dict[str, Any]] = None):\n        \"\"\"Log information\"\"\"\n        await self.log_event(\"info\", message, metadata)\n    \n    async def log_warning(self, message: str, metadata: Optional[Dict[str, Any]] = None):\n        \"\"\"Log warning\"\"\"\n        await self.log_event(\"warning\", message, metadata)\n","path":null,"size_bytes":5140,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"telegram_bot/handlers/task.py":{"content":"\"\"\"\nTask Management Handlers\nHandle task creation, management, and monitoring\n\"\"\"\nfrom pyrogram.client import Client\nfrom pyrogram import filters\nfrom pyrogram.types import Message\nfrom utils.database import db\nfrom utils.error_handler import handle_errors, ErrorLogger\nfrom handlers.admin import admin_only\nimport json\n\nerror_logger = ErrorLogger(\"task_handler\")\n\ndef register_task_handlers(app: Client):\n    \"\"\"Register task management handlers\"\"\"\n    \n    @app.on_message(filters.command(\"create_task\") & filters.private & admin_only)\n    @handle_errors(\"task_handler\", \"create_task_command\")\n    async def create_task_command(client: Client, message: Message):\n        \"\"\"Create new forwarding task - interactive wizard\"\"\"\n        await message.reply_text(\n            \"üìù **ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ© ÿ™Ÿàÿ¨ŸäŸá ÿ¨ÿØŸäÿØÿ©**\\n\\n\"\n            \"ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ Web ŸÑÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáÿßŸÖ ÿ¨ÿØŸäÿØÿ© ÿ®ÿ≥ŸáŸàŸÑÿ© ÿ£ŸÉÿ®ÿ±.\\n\\n\"\n            \"ÿ£Ÿà ÿ£ÿ±ÿ≥ŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ™ÿßŸÑŸä:\\n\"\n            \"```\\n\"\n            \"/create_task name=[ÿßÿ≥ŸÖ ÿßŸÑŸÖŸáŸÖÿ©] sources=[1,2,3] targets=[4,5,6]\\n\"\n            \"```\\n\\n\"\n            \"ÿ≠Ÿäÿ´:\\n\"\n            \"‚Ä¢ name: ÿßÿ≥ŸÖ ÿßŸÑŸÖŸáŸÖÿ©\\n\"\n            \"‚Ä¢ sources: ÿ£ÿ±ŸÇÿßŸÖ ID ŸÑŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑŸÖÿµÿØÿ± (ŸÖŸÅÿµŸàŸÑÿ© ÿ®ŸÅŸàÿßÿµŸÑ)\\n\"\n            \"‚Ä¢ targets: ÿ£ÿ±ŸÇÿßŸÖ ID ŸÑŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑŸáÿØŸÅ (ŸÖŸÅÿµŸàŸÑÿ© ÿ®ŸÅŸàÿßÿµŸÑ)\"\n        )\n\n    @app.on_message(filters.command(\"list_tasks\") & filters.private & admin_only)\n    @handle_errors(\"task_handler\", \"list_tasks_command\")\n    async def list_tasks_command(client: Client, message: Message):\n        \"\"\"List all forwarding tasks\"\"\"\n        tasks = await db.fetch(\"SELECT * FROM forwarding_tasks ORDER BY created_at DESC\")\n        \n        if not tasks:\n            await message.reply_text(\"üìã ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸáÿßŸÖ ÿ≠ÿßŸÑŸäÿßŸã\\n\\nÿßÿ≥ÿ™ÿÆÿØŸÖ /create_task ŸÑÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ© ÿ¨ÿØŸäÿØÿ©\")\n            return\n        \n        text = \"üìã **ŸÇÿßÿ¶ŸÖÿ© ŸÖŸáÿßŸÖ ÿßŸÑÿ™Ÿàÿ¨ŸäŸá:**\\n\\n\"\n        \n        for task in tasks:\n            status_icon = \"üü¢\" if task['is_active'] else \"üî¥\"\n            ai_icon = \"ü§ñ\" if task['ai_enabled'] else \"\"\n            video_icon = \"üé•\" if task['video_processing_enabled'] else \"\"\n            \n            source_channels = task.get('source_channels') or []\n            target_channels = task.get('target_channels') or []\n            source_count = len(source_channels) if isinstance(source_channels, list) else 0\n            target_count = len(target_channels) if isinstance(target_channels, list) else 0\n            \n            text += f\"{status_icon} **{task['name']}** {ai_icon}{video_icon}\\n\"\n            text += f\"   ID: `{task['id']}`\\n\"\n            text += f\"   ÿßŸÑŸÖÿµÿßÿØÿ±: {source_count} | ÿßŸÑÿ£ŸáÿØÿßŸÅ: {target_count}\\n\"\n            text += f\"   ÿ™ŸÖ ÿ™Ÿàÿ¨ŸäŸáŸá: {task['total_forwarded']} ÿ±ÿ≥ÿßŸÑÿ©\\n\\n\"\n        \n        text += \"\\nüí° ÿßÿ≥ÿ™ÿÆÿØŸÖ `/task_stats [id]` ŸÑÿπÿ±ÿ∂ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÖŸáŸÖÿ© ŸÖÿπŸäŸÜÿ©\"\n        \n        await message.reply_text(text)\n\n    @app.on_message(filters.command(\"toggle_task\") & filters.private & admin_only)\n    @handle_errors(\"task_handler\", \"toggle_task_command\")\n    async def toggle_task_command(client: Client, message: Message):\n        \"\"\"Toggle task active status\"\"\"\n        try:\n            parts = message.text.split() if message.text else []\n            if len(parts) < 2:\n                await message.reply_text(\n                    \"‚ùå ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ: `/toggle_task [task_id]`\\n\"\n                    \"ŸÖÿ´ÿßŸÑ: `/toggle_task 1`\"\n                )\n                return\n            \n            task_id = int(parts[1])\n            \n            # Get current task\n            task = await db.get_task(task_id)\n            if not task:\n                await message.reply_text(\"‚ùå ÿßŸÑŸÖŸáŸÖÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©\")\n                return\n            \n            # Toggle status\n            new_status = not task['is_active']\n            await db.update_task(task_id, {\"is_active\": new_status})\n            \n            status_text = \"‚úÖ ŸÜÿ¥ÿ∑ÿ©\" if new_status else \"‚è∏ ŸÖÿπÿ∑ŸÑÿ©\"\n            await message.reply_text(\n                f\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖŸáŸÖÿ© **{task['name']}**\\n\"\n                f\"ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©: {status_text}\"\n            )\n            \n            # Update forwarding engine\n            from services.forwarding_engine import forwarding_engine\n            if forwarding_engine:\n                if new_status:\n                    await forwarding_engine.start_task_monitoring(task_id)\n                else:\n                    await forwarding_engine.stop_task_monitoring(task_id)\n            \n        except ValueError:\n            await message.reply_text(\"‚ùå Task ID ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\")\n        except Exception as e:\n            await message.reply_text(f\"‚ùå ÿÆÿ∑ÿ£: {str(e)}\")\n\n    @app.on_message(filters.command(\"delete_task\") & filters.private & admin_only)\n    @handle_errors(\"task_handler\", \"delete_task_command\")\n    async def delete_task_command(client: Client, message: Message):\n        \"\"\"Delete a task\"\"\"\n        try:\n            parts = message.text.split() if message.text else []\n            if len(parts) < 2:\n                await message.reply_text(\n                    \"‚ùå ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ: `/delete_task [task_id]`\\n\"\n                    \"ŸÖÿ´ÿßŸÑ: `/delete_task 1`\"\n                )\n                return\n            \n            task_id = int(parts[1])\n            \n            # Get task\n            task = await db.get_task(task_id)\n            if not task:\n                await message.reply_text(\"‚ùå ÿßŸÑŸÖŸáŸÖÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©\")\n                return\n            \n            # Delete task\n            await db.delete_task(task_id)\n            \n            await message.reply_text(\n                f\"üóë ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸáŸÖÿ© **{task['name']}** ÿ®ŸÜÿ¨ÿßÿ≠\"\n            )\n            \n            user_id = message.from_user.id if message.from_user else \"unknown\"\n            error_logger.log_info(f\"Task {task_id} deleted by admin {user_id}\")\n            \n        except ValueError:\n            await message.reply_text(\"‚ùå Task ID ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\")\n        except Exception as e:\n            await message.reply_text(f\"‚ùå ÿÆÿ∑ÿ£: {str(e)}\")\n\n    @app.on_message(filters.command(\"task_stats\") & filters.private & admin_only)\n    @handle_errors(\"task_handler\", \"task_stats_command\")\n    async def task_stats_command(client: Client, message: Message):\n        \"\"\"Show task statistics\"\"\"\n        try:\n            parts = message.text.split() if message.text else []\n            if len(parts) < 2:\n                await message.reply_text(\n                    \"‚ùå ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ: `/task_stats [task_id]`\\n\"\n                    \"ŸÖÿ´ÿßŸÑ: `/task_stats 1`\"\n                )\n                return\n            \n            task_id = int(parts[1])\n            \n            # Get task\n            task = await db.get_task(task_id)\n            if not task:\n                await message.reply_text(\"‚ùå ÿßŸÑŸÖŸáŸÖÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©\")\n                return\n            \n            # Get statistics\n            stats = await db.get_task_stats(task_id, days=7)\n            \n            status_icon = \"üü¢\" if task['is_active'] else \"üî¥\"\n            \n            text = f\"\"\"\nüìä **ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ©: {task['name']}**\n\n**ÿßŸÑÿ≠ÿßŸÑÿ©:** {status_icon} {'ŸÜÿ¥ÿ∑ÿ©' if task['is_active'] else 'ŸÖÿπÿ∑ŸÑÿ©'}\n\n**ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿπÿßŸÖÿ©:**\n‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÖŸàÿ¨Ÿáÿ©: {task['total_forwarded']}\n‚Ä¢ ÿ¢ÿÆÿ± ÿ™Ÿàÿ¨ŸäŸá: {task['last_forwarded_at'] or 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿ®ÿπÿØ'}\n\n**ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™:**\n‚Ä¢ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä: {'ü§ñ ŸÖŸÅÿπŸÑ' if task['ai_enabled'] else '‚ùå ŸÖÿπÿ∑ŸÑ'}\n‚Ä¢ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà: {'üé• ŸÖŸÅÿπŸÑÿ©' if task['video_processing_enabled'] else '‚ùå ŸÖÿπÿ∑ŸÑÿ©'}\n\n**ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ¢ÿÆÿ± 7 ÿ£ŸäÿßŸÖ:**\n\"\"\"\n            \n            if stats:\n                for stat in stats:\n                    text += f\"\\nüìÖ {stat['date']}:\\n\"\n                    text += f\"   ‚Ä¢ ŸÖŸàÿ¨Ÿáÿ©: {stat['messages_forwarded']}\\n\"\n                    text += f\"   ‚Ä¢ ŸÖÿπÿßŸÑÿ¨ÿ©: {stat['messages_processed']}\\n\"\n                    if task['ai_enabled']:\n                        text += f\"   ‚Ä¢ AI: {stat['ai_processed']}\\n\"\n                    if task['video_processing_enabled']:\n                        text += f\"   ‚Ä¢ ŸÅŸäÿØŸäŸà: {stat['video_processed']}\\n\"\n                    if stat['errors'] > 0:\n                        text += f\"   ‚Ä¢ ‚ö†Ô∏è ÿ£ÿÆÿ∑ÿßÿ°: {stat['errors']}\\n\"\n            else:\n                text += \"\\nüìã ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ®ÿπÿØ\"\n            \n            await message.reply_text(text)\n            \n        except ValueError:\n            await message.reply_text(\"‚ùå Task ID ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\")\n        except Exception as e:\n            await message.reply_text(f\"‚ùå ÿÆÿ∑ÿ£: {str(e)}\")\n\n    @app.on_message(filters.command(\"test_task\") & filters.private & admin_only)\n    @handle_errors(\"task_handler\", \"test_task_command\")\n    async def test_task_command(client: Client, message: Message):\n        \"\"\"Test a task\"\"\"\n        try:\n            parts = message.text.split() if message.text else []\n            if len(parts) < 2:\n                await message.reply_text(\n                    \"‚ùå ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ: `/test_task [task_id]`\\n\"\n                    \"ŸÖÿ´ÿßŸÑ: `/test_task 1`\"\n                )\n                return\n            \n            task_id = int(parts[1])\n            \n            # Get task\n            task = await db.get_task(task_id)\n            if not task:\n                await message.reply_text(\"‚ùå ÿßŸÑŸÖŸáŸÖÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©\")\n                return\n            \n            source_channels = task.get('source_channels') or []\n            target_channels = task.get('target_channels') or []\n            source_count = len(source_channels) if isinstance(source_channels, list) else 0\n            target_count = len(target_channels) if isinstance(target_channels, list) else 0\n            \n            await message.reply_text(\n                f\"üß™ **ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÖŸáŸÖÿ©: {task['name']}**\\n\\n\"\n                f\"ÿ£ÿ±ÿ≥ŸÑ ÿ±ÿ≥ÿßŸÑÿ© ÿßÿÆÿ™ÿ®ÿßÿ± ÿ•ŸÑŸâ ÿßŸÑŸÇŸÜÿßÿ© ÿßŸÑŸÖÿµÿØÿ± Ÿàÿ≥Ÿäÿ™ŸÖ ÿ™Ÿàÿ¨ŸäŸáŸáÿß ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã.\\n\\n\"\n                f\"ÿßŸÑŸÖÿµÿßÿØÿ±: {source_count}\\n\"\n                f\"ÿßŸÑÿ£ŸáÿØÿßŸÅ: {target_count}\"\n            )\n            \n        except ValueError:\n            await message.reply_text(\"‚ùå Task ID ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\")\n        except Exception as e:\n            await message.reply_text(f\"‚ùå ÿÆÿ∑ÿ£: {str(e)}\")\n","path":null,"size_bytes":10669,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { useLocation } from \"wouter\";\nimport { useState, useEffect } from \"react\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport Layout from \"@/components/layout\";\nimport AuthPage from \"@/pages/auth-page\";\nimport Dashboard from \"@/pages/dashboard\";\nimport TasksPage from \"@/pages/tasks\";\nimport AIConfigPage from \"@/pages/ai-config\";\nimport AIRulesPage from \"@/pages/ai-rules\";\nimport ChannelsPage from \"@/pages/channels\";\nimport SettingsPage from \"@/pages/settings\";\nimport ErrorLogsPage from \"@/pages/error-logs\";\nimport GitHubPage from \"@/pages/github\";\nimport ArchivePage from \"@/pages/archive\";\nimport NotFound from \"@/pages/not-found\";\nimport { ThemeProvider } from \"next-themes\";\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      staleTime: 5 * 60 * 1000, // 5 minutes\n      gcTime: 10 * 60 * 1000,\n    },\n  },\n});\n\n// Protected Route Wrapper\nfunction ProtectedRoute({ children }: { children: React.ReactNode }) {\n  const [, setLocation] = useLocation();\n  const [isLoading, setIsLoading] = useState(true);\n  const isAdmin = typeof window !== 'undefined' ? localStorage.getItem(\"isAdmin\") === \"true\" : false;\n\n  useEffect(() => {\n    if (!isAdmin) {\n      setLocation(\"/auth\");\n    }\n    setIsLoading(false);\n  }, [isAdmin, setLocation]);\n\n  if (isLoading) return null;\n  if (!isAdmin) return null;\n\n  return <>{children}</>;\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider attribute=\"class\" defaultTheme=\"light\" enableSystem>\n        <Switch>\n          <Route path=\"/auth\" component={AuthPage} />\n          \n          {/* Protected Routes */}\n          <Route path=\"/\">\n            <ProtectedRoute>\n              <Layout><Dashboard /></Layout>\n            </ProtectedRoute>\n          </Route>\n          <Route path=\"/tasks\">\n            <ProtectedRoute>\n              <Layout><TasksPage /></Layout>\n            </ProtectedRoute>\n          </Route>\n          <Route path=\"/channels\">\n            <ProtectedRoute>\n              <Layout><ChannelsPage /></Layout>\n            </ProtectedRoute>\n          </Route>\n          <Route path=\"/ai-config\">\n            <ProtectedRoute>\n              <Layout><AIConfigPage /></Layout>\n            </ProtectedRoute>\n          </Route>\n          <Route path=\"/ai-rules\">\n            <ProtectedRoute>\n              <Layout><AIRulesPage /></Layout>\n            </ProtectedRoute>\n          </Route>\n          <Route path=\"/settings\">\n            <ProtectedRoute>\n              <Layout><SettingsPage /></Layout>\n            </ProtectedRoute>\n          </Route>\n          <Route path=\"/error-logs\">\n            <ProtectedRoute>\n              <Layout><ErrorLogsPage /></Layout>\n            </ProtectedRoute>\n          </Route>\n          <Route path=\"/github\">\n            <ProtectedRoute>\n              <Layout><GitHubPage /></Layout>\n            </ProtectedRoute>\n          </Route>\n          <Route path=\"/archive\">\n            <ProtectedRoute>\n              <Layout><ArchivePage /></Layout>\n            </ProtectedRoute>\n          </Route>\n          \n          <Route component={NotFound} />\n        </Switch>\n        <Toaster />\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":3355,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/pages/error-logs.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Loader, Trash2, AlertCircle } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\n\nexport default function ErrorLogsPage() {\n  const { t } = useTranslation();\n  const [filter, setFilter] = useState<string>(\"\");\n  const [selectedError, setSelectedError] = useState<any>(null);\n\n  const { data: errors = [], isLoading, refetch } = useQuery({\n    queryKey: [\"error-logs\"],\n    queryFn: () => api.getErrorLogs(),\n    refetchInterval: 5000, // ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑ 5 ÿ´ŸàÿßŸÜŸä\n  });\n\n  const filteredErrors = errors.filter(\n    (error: any) =>\n      error.component?.toLowerCase().includes(filter.toLowerCase()) ||\n      error.errorMessage?.toLowerCase().includes(filter.toLowerCase()) ||\n      error.function?.toLowerCase().includes(filter.toLowerCase())\n  );\n\n  const getComponentColor = (component: string) => {\n    switch (component) {\n      case \"bot\":\n        return \"bg-red-500/10 text-red-600 dark:text-red-400\";\n      case \"api\":\n        return \"bg-blue-500/10 text-blue-600 dark:text-blue-400\";\n      case \"worker\":\n        return \"bg-yellow-500/10 text-yellow-600 dark:text-yellow-400\";\n      case \"webhook\":\n        return \"bg-purple-500/10 text-purple-600 dark:text-purple-400\";\n      default:\n        return \"bg-gray-500/10 text-gray-600 dark:text-gray-400\";\n    }\n  };\n\n  const getErrorTypeColor = (type: string) => {\n    if (type?.includes(\"WARN\")) return \"bg-yellow-500/10 text-yellow-600\";\n    if (type?.includes(\"ERROR\")) return \"bg-red-500/10 text-red-600\";\n    if (type?.includes(\"INFO\")) return \"bg-blue-500/10 text-blue-600\";\n    return \"bg-gray-500/10 text-gray-600\";\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <Loader className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl md:text-3xl font-display font-bold text-foreground tracking-wide\">ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°</h2>\n        <p className=\"text-muted-foreground mt-1 text-sm md:text-base\">ÿπÿ±ÿ∂ Ÿàÿ™ÿ™ÿ®ÿπ ÿ¨ŸÖŸäÿπ ÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑŸÜÿ∏ÿßŸÖ ŸàÿßŸÑÿ®Ÿàÿ™</p>\n      </div>\n\n      <div className=\"flex gap-2\">\n        <Input\n          placeholder=\"ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°...\"\n          value={filter}\n          onChange={(e) => setFilter(e.target.value)}\n          className=\"flex-1\"\n          data-testid=\"input-error-filter\"\n        />\n        <Button variant=\"outline\" onClick={() => refetch()} data-testid=\"button-refresh-errors\">\n          ÿ™ÿ≠ÿØŸäÿ´\n        </Button>\n      </div>\n\n      <Card className=\"border shadow-sm\">\n        <CardHeader className=\"border-b\">\n          <CardTitle>\n            ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°: {filteredErrors.length}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-0 overflow-x-auto\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"text-muted-foreground\">ÿßŸÑŸÖŸÉŸàŸÜ</TableHead>\n                <TableHead className=\"text-muted-foreground\">ÿßŸÑÿØÿßŸÑÿ©</TableHead>\n                <TableHead className=\"text-muted-foreground hidden md:table-cell\">ŸÜŸàÿπ ÿßŸÑÿÆÿ∑ÿ£</TableHead>\n                <TableHead className=\"text-muted-foreground\">ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©</TableHead>\n                <TableHead className=\"text-muted-foreground hidden lg:table-cell\">ÿßŸÑŸàŸÇÿ™</TableHead>\n                <TableHead className=\"text-right text-muted-foreground\">ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredErrors.map((error: any, idx: number) => (\n                <TableRow key={idx} className=\"hover:bg-muted/50 transition-colors\" data-testid={`row-error-${idx}`}>\n                  <TableCell>\n                    <Badge className={getComponentColor(error.component)}>\n                      {error.component}\n                    </Badge>\n                  </TableCell>\n                  <TableCell className=\"font-mono text-sm\">{error.function}</TableCell>\n                  <TableCell className=\"hidden md:table-cell\">\n                    <Badge className={getErrorTypeColor(error.errorType)} variant=\"secondary\">\n                      {error.errorType}\n                    </Badge>\n                  </TableCell>\n                  <TableCell className=\"max-w-xs truncate text-sm\">\n                    {error.errorMessage}\n                  </TableCell>\n                  <TableCell className=\"text-sm hidden lg:table-cell text-muted-foreground\">\n                    {new Date(error.timestamp).toLocaleString(\"ar-SA\")}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      className=\"h-8 w-8\"\n                      onClick={() => setSelectedError(error)}\n                      data-testid={`button-view-error-${idx}`}\n                    >\n                      <AlertCircle className=\"h-4 w-4\" />\n                    </Button>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n          {filteredErrors.length === 0 && (\n            <div className=\"p-8 text-center text-muted-foreground\">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿÆÿ∑ÿßÿ° ÿ≠ÿßŸÑŸäÿßŸã. ÿßŸÑŸÜÿ∏ÿßŸÖ ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠! ‚úÖ</div>\n          )}\n        </CardContent>\n      </Card>\n\n      {selectedError && (\n        <Dialog open={!!selectedError} onOpenChange={() => setSelectedError(null)}>\n          <DialogContent className=\"max-w-2xl max-h-96 overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿÆÿ∑ÿ£</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-3 text-sm\">\n              <div>\n                <span className=\"font-semibold\">ÿßŸÑŸÖŸÉŸàŸÜ:</span>\n                <Badge className=\"ml-2\">{selectedError.component}</Badge>\n              </div>\n              <div>\n                <span className=\"font-semibold\">ÿßŸÑÿØÿßŸÑÿ©:</span>\n                <code className=\"ml-2 bg-muted p-1 rounded\">{selectedError.function}</code>\n              </div>\n              <div>\n                <span className=\"font-semibold\">ŸÜŸàÿπ ÿßŸÑÿÆÿ∑ÿ£:</span>\n                <code className=\"ml-2 bg-muted p-1 rounded\">{selectedError.errorType}</code>\n              </div>\n              <div>\n                <span className=\"font-semibold\">ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©:</span>\n                <p className=\"mt-1 p-2 bg-red-500/10 rounded\">{selectedError.errorMessage}</p>\n              </div>\n              {selectedError.stackTrace && (\n                <div>\n                  <span className=\"font-semibold\">Stack Trace:</span>\n                  <pre className=\"mt-1 p-2 bg-muted rounded overflow-x-auto text-xs max-h-32 overflow-y-auto\">\n                    {selectedError.stackTrace}\n                  </pre>\n                </div>\n              )}\n              {selectedError.metadata && (\n                <div>\n                  <span className=\"font-semibold\">ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©:</span>\n                  <pre className=\"mt-1 p-2 bg-muted rounded overflow-x-auto text-xs max-h-32 overflow-y-auto\">\n                    {JSON.stringify(selectedError.metadata, null, 2)}\n                  </pre>\n                </div>\n              )}\n              <div>\n                <span className=\"font-semibold\">ÿßŸÑŸàŸÇÿ™:</span>\n                <span className=\"ml-2 text-muted-foreground\">\n                  {new Date(selectedError.timestamp).toLocaleString(\"ar-SA\")}\n                </span>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":8249,"size_tokens":null},"telegram_bot/services/queue_system.py":{"content":"\"\"\"\nQueue and Worker System\nImplements parallel processing with workers and task queues\n\"\"\"\nimport asyncio\nfrom typing import Dict, Any, Callable, Optional\nfrom datetime import datetime\nfrom utils.error_handler import handle_errors, ErrorLogger\nfrom utils.database import db\n\nerror_logger = ErrorLogger(\"queue_system\")\n\nclass QueueWorker:\n    \"\"\"Worker to process queue jobs\"\"\"\n    \n    def __init__(self, worker_id: int, handler: Callable):\n        self.worker_id = worker_id\n        self.handler = handler\n        self.is_running = False\n        self.current_job: Optional[Dict[str, Any]] = None\n    \n    @handle_errors(\"queue_worker\", \"process_job\")\n    async def process_job(self, job: Dict[str, Any]) -> bool:\n        \"\"\"Process a single job\"\"\"\n        self.current_job = job\n        job_id = job[\"id\"]\n        \n        try:\n            error_logger.log_info(\n                f\"Worker {self.worker_id} processing job {job_id}\",\n                {\"job_type\": job[\"type\"]}\n            )\n            \n            # Update job status to processing\n            await db.update_job_status(job_id, \"processing\")\n            \n            # Execute the handler\n            result = await self.handler(job)\n            \n            # Update job as completed\n            await db.update_job_status(job_id, \"completed\", result=result)\n            \n            error_logger.log_info(f\"Worker {self.worker_id} completed job {job_id}\")\n            return True\n            \n        except Exception as e:\n            # Update job as failed\n            await db.update_job_status(\n                job_id, \n                \"failed\" if job[\"attempts\"] >= job[\"max_attempts\"] else \"pending\",\n                error=str(e)\n            )\n            \n            error_logger.log_warning(\n                f\"Worker {self.worker_id} failed job {job_id}: {str(e)}\"\n            )\n            return False\n        finally:\n            self.current_job = None\n    \n    async def start(self):\n        \"\"\"Start worker loop\"\"\"\n        self.is_running = True\n        error_logger.log_info(f\"Worker {self.worker_id} started\")\n    \n    async def stop(self):\n        \"\"\"Stop worker\"\"\"\n        self.is_running = False\n        error_logger.log_info(f\"Worker {self.worker_id} stopped\")\n\n\nclass QueueManager:\n    \"\"\"Manage queue and workers\"\"\"\n    \n    def __init__(self, max_workers: int = 10):\n        self.max_workers = max_workers\n        self.workers: list[QueueWorker] = []\n        self.is_running = False\n        self.job_handlers: Dict[str, Callable] = {}\n    \n    def register_handler(self, job_type: str, handler: Callable):\n        \"\"\"Register handler for job type\"\"\"\n        self.job_handlers[job_type] = handler\n        error_logger.log_info(f\"Registered handler for job type: {job_type}\")\n    \n    @handle_errors(\"queue_manager\", \"add_job\")\n    async def add_job(\n        self,\n        job_type: str,\n        payload: Dict[str, Any],\n        task_id: Optional[int] = None,\n        priority: int = 0\n    ) -> int:\n        \"\"\"Add job to queue\"\"\"\n        job_data = {\n            \"task_id\": task_id,\n            \"type\": job_type,\n            \"payload\": payload,\n            \"priority\": priority\n        }\n        \n        job_id = await db.add_queue_job(job_data)\n        error_logger.log_info(f\"Added job {job_id} of type {job_type} to queue\")\n        \n        return job_id\n    \n    @handle_errors(\"queue_manager\", \"process_queue\")\n    async def process_queue(self):\n        \"\"\"Main queue processing loop\"\"\"\n        while self.is_running:\n            try:\n                # Get pending jobs\n                jobs = await db.get_pending_jobs(limit=self.max_workers * 2)\n                \n                if not jobs:\n                    await asyncio.sleep(1)\n                    continue\n                \n                # Create tasks for available workers\n                tasks = []\n                for job in jobs[:self.max_workers]:\n                    if job[\"type\"] not in self.job_handlers:\n                        error_logger.log_warning(\n                            f\"No handler for job type: {job['type']}\"\n                        )\n                        continue\n                    \n                    handler = self.job_handlers[job[\"type\"]]\n                    worker = QueueWorker(len(self.workers) + 1, handler)\n                    self.workers.append(worker)\n                    \n                    task = asyncio.create_task(worker.process_job(job))\n                    tasks.append(task)\n                \n                # Wait for all tasks to complete\n                if tasks:\n                    await asyncio.gather(*tasks, return_exceptions=True)\n                \n                # Clean up finished workers\n                self.workers = [w for w in self.workers if w.is_running]\n                \n            except Exception as e:\n                await error_logger.log_error(\"process_queue\", e)\n                await asyncio.sleep(5)\n    \n    async def start(self):\n        \"\"\"Start queue manager\"\"\"\n        self.is_running = True\n        error_logger.log_info(f\"Queue manager started with {self.max_workers} max workers\")\n        \n        # Start queue processing\n        asyncio.create_task(self.process_queue())\n    \n    async def stop(self):\n        \"\"\"Stop queue manager\"\"\"\n        self.is_running = False\n        \n        # Stop all workers\n        for worker in self.workers:\n            await worker.stop()\n        \n        error_logger.log_info(\"Queue manager stopped\")\n    \n    def get_stats(self) -> Dict[str, Any]:\n        \"\"\"Get queue statistics\"\"\"\n        return {\n            \"active_workers\": len([w for w in self.workers if w.is_running]),\n            \"total_workers\": len(self.workers),\n            \"max_workers\": self.max_workers,\n            \"is_running\": self.is_running\n        }\n\n# Global queue manager instance\nqueue_manager = QueueManager(max_workers=10)\n","path":null,"size_bytes":5888,"size_tokens":null},"telegram_bot/utils/database.py":{"content":"\"\"\"\nDatabase connection and operations\nPostgreSQL database handler with async support\n\"\"\"\nimport asyncpg\nfrom typing import List, Dict, Any, Optional\nfrom config.settings import settings\nfrom utils.error_handler import ErrorLogger\nimport json\n\nerror_logger = ErrorLogger(\"database\")\n\nclass Database:\n    \"\"\"PostgreSQL database handler\"\"\"\n\n    def __init__(self):\n        self.pool: Optional[asyncpg.Pool] = None\n\n    async def connect(self):\n        \"\"\"Initialize database connection pool\"\"\"\n        try:\n            self.pool = await asyncpg.create_pool(\n                settings.DATABASE_URL,\n                min_size=5,\n                max_size=20,\n                command_timeout=60\n            )\n            error_logger.log_info(\"Database connected successfully\")\n        except Exception as e:\n            error_logger.log_info(f\"Database connection error: {str(e)}\")\n            raise\n\n    async def disconnect(self):\n        \"\"\"Close database connection pool\"\"\"\n        if self.pool:\n            await self.pool.close()\n            error_logger.log_info(\"Database disconnected\")\n\n    async def execute(self, query: str, *args) -> str:\n        \"\"\"Execute a query without returning results\"\"\"\n        if not self.pool:\n            raise Exception(\"Database not connected\")\n        async with self.pool.acquire() as conn:\n            return await conn.execute(query, *args)\n\n    async def fetch(self, query: str, *args) -> List[Dict[str, Any]]:\n        \"\"\"Fetch multiple rows\"\"\"\n        if not self.pool:\n            raise Exception(\"Database not connected\")\n        async with self.pool.acquire() as conn:\n            rows = await conn.fetch(query, *args)\n            return [dict(row) for row in rows]\n\n    async def fetchrow(self, query: str, *args) -> Optional[Dict[str, Any]]:\n        \"\"\"Fetch single row\"\"\"\n        if not self.pool:\n            raise Exception(\"Database not connected\")\n        async with self.pool.acquire() as conn:\n            row = await conn.fetchrow(query, *args)\n            return dict(row) if row else None\n\n    async def fetchval(self, query: str, *args) -> Any:\n        \"\"\"Fetch single value\"\"\"\n        if not self.pool:\n            raise Exception(\"Database not connected\")\n        async with self.pool.acquire() as conn:\n            return await conn.fetchval(query, *args)\n\n    # Admin Management\n    async def is_admin(self, telegram_id: int) -> bool:\n        \"\"\"Check if user is admin\"\"\"\n        result = await self.fetchval(\n            \"SELECT COUNT(*) FROM admins WHERE telegram_id = $1\",\n            str(telegram_id)\n        )\n        return result > 0\n\n    async def add_admin(self, telegram_id: int, username: Optional[str] = None, added_by: Optional[int] = None):\n        \"\"\"Add new admin\"\"\"\n        return await self.execute(\n            \"\"\"INSERT INTO admins (telegram_id, username, added_by) \n               VALUES ($1, $2, $3) ON CONFLICT (telegram_id) DO NOTHING\"\"\",\n            str(telegram_id), username or \"\", added_by\n        )\n\n    async def get_admins(self) -> List[Dict[str, Any]]:\n        \"\"\"Get all admins\"\"\"\n        return await self.fetch(\"SELECT * FROM admins ORDER BY created_at DESC\")\n\n    # Task Management\n    async def create_task(self, task_data: Dict[str, Any]) -> int:\n        \"\"\"Create new forwarding task\"\"\"\n        source_channels = json.dumps(task_data[\"source_channels\"]) if isinstance(task_data[\"source_channels\"], list) else task_data[\"source_channels\"]\n        target_channels = json.dumps(task_data[\"target_channels\"]) if isinstance(task_data[\"target_channels\"], list) else task_data[\"target_channels\"]\n\n        return await self.fetchval(\n            \"\"\"INSERT INTO forwarding_tasks \n               (name, description, source_channels, target_channels, \n                ai_enabled, video_processing_enabled)\n               VALUES ($1, $2, $3, $4, $5, $6) RETURNING id\"\"\",\n            task_data[\"name\"],\n            task_data.get(\"description\", \"\"),\n            source_channels,\n            target_channels,\n            task_data.get(\"ai_enabled\", False),\n            task_data.get(\"video_processing_enabled\", False)\n        )\n\n    def _parse_task_json_fields(self, task: Optional[Dict[str, Any]]) -> Optional[Dict[str, Any]]:\n        \"\"\"Parse JSON string fields in task to proper Python objects\"\"\"\n        if task is None:\n            return None\n\n        result = dict(task)\n\n        # Parse source_channels if it's a string\n        if 'source_channels' in result and isinstance(result['source_channels'], str):\n            try:\n                result['source_channels'] = json.loads(result['source_channels'])\n            except (json.JSONDecodeError, TypeError):\n                result['source_channels'] = []\n\n        # Parse target_channels if it's a string\n        if 'target_channels' in result and isinstance(result['target_channels'], str):\n            try:\n                result['target_channels'] = json.loads(result['target_channels'])\n            except (json.JSONDecodeError, TypeError):\n                result['target_channels'] = []\n\n        return result\n\n    async def get_task(self, task_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"Get task by ID\"\"\"\n        task = await self.fetchrow(\n            \"SELECT * FROM forwarding_tasks WHERE id = $1\",\n            task_id\n        )\n        return self._parse_task_json_fields(task) if task else None\n\n    async def get_active_tasks(self) -> List[Dict[str, Any]]:\n        \"\"\"Get all active tasks\"\"\"\n        tasks = await self.fetch(\n            \"SELECT * FROM forwarding_tasks WHERE is_active = true\"\n        )\n        return [parsed for parsed in [self._parse_task_json_fields(task) for task in tasks] if parsed is not None]\n\n    async def update_task(self, task_id: int, updates: Dict[str, Any]):\n        \"\"\"Update task\"\"\"\n        set_clauses = []\n        values = []\n        idx = 1\n\n        for key, value in updates.items():\n            set_clauses.append(f\"{key} = ${idx}\")\n            values.append(value)\n            idx += 1\n\n        values.append(task_id)\n        query = f\"UPDATE forwarding_tasks SET {', '.join(set_clauses)} WHERE id = ${idx}\"\n\n        return await self.execute(query, *values)\n\n    async def delete_task(self, task_id: int):\n        \"\"\"Delete task\"\"\"\n        return await self.execute(\n            \"DELETE FROM forwarding_tasks WHERE id = $1\",\n            task_id\n        )\n\n    async def increment_task_counter(self, task_id: int):\n        \"\"\"Increment task forwarded counter\"\"\"\n        return await self.execute(\n            \"\"\"UPDATE forwarding_tasks \n               SET total_forwarded = total_forwarded + 1,\n                   last_forwarded_at = NOW()\n               WHERE id = $1\"\"\",\n            task_id\n        )\n\n    # Channel Management\n    async def add_channel(self, channel_data: Dict[str, Any]) -> int:\n        \"\"\"Add new channel/group/website\"\"\"\n        metadata = json.dumps(channel_data.get(\"metadata\", {})) if isinstance(channel_data.get(\"metadata\"), dict) else channel_data.get(\"metadata\", \"{}\")\n\n        return await self.fetchval(\n            \"\"\"INSERT INTO channels (type, identifier, title, description, metadata)\n               VALUES ($1, $2, $3, $4, $5) RETURNING id\"\"\",\n            channel_data[\"type\"],\n            channel_data[\"identifier\"],\n            channel_data.get(\"title\", \"\"),\n            channel_data.get(\"description\", \"\"),\n            metadata\n        )\n\n    async def get_channels(self, channel_type: Optional[str] = None) -> List[Dict[str, Any]]:\n        \"\"\"Get all channels, optionally filtered by type\"\"\"\n        if channel_type:\n            return await self.fetch(\n                \"SELECT * FROM channels WHERE type = $1 AND is_active = true\",\n                channel_type\n            )\n        return await self.fetch(\"SELECT * FROM channels WHERE is_active = true\")\n\n    async def get_channel(self, channel_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"Get channel by ID\"\"\"\n        return await self.fetchrow(\n            \"SELECT * FROM channels WHERE id = $1\",\n            channel_id\n        )\n\n    # AI Providers and Models Management\n    async def get_ai_provider(self, provider_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"Get AI provider by ID\"\"\"\n        return await self.fetchrow(\n            \"SELECT * FROM ai_providers WHERE id = $1\",\n            provider_id\n        )\n\n    async def get_ai_provider_by_name(self, name: str) -> Optional[Dict[str, Any]]:\n        \"\"\"Get AI provider by name\"\"\"\n        return await self.fetchrow(\n            \"SELECT * FROM ai_providers WHERE name = $1\",\n            name\n        )\n\n    async def get_ai_model(self, model_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"Get AI model by ID\"\"\"\n        return await self.fetchrow(\n            \"SELECT * FROM ai_models WHERE id = $1\",\n            model_id\n        )\n\n    async def get_active_providers(self) -> List[Dict[str, Any]]:\n        \"\"\"Get all active AI providers\"\"\"\n        return await self.fetch(\n            \"SELECT * FROM ai_providers WHERE is_active = true\"\n        )\n\n    # AI Rules Management\n    async def add_ai_rule(self, rule_data: Dict[str, Any]) -> int:\n        \"\"\"Add AI rule for task\"\"\"\n        config = json.dumps(rule_data.get(\"config\")) if rule_data.get(\"config\") else None\n\n        return await self.fetchval(\n            \"\"\"INSERT INTO ai_rules (task_id, type, category, name, prompt, config, priority)\n               VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING id\"\"\",\n            rule_data[\"task_id\"],\n            rule_data[\"type\"],\n            rule_data.get(\"category\", \"general\"),\n            rule_data[\"name\"],\n            rule_data[\"prompt\"],\n            config,\n            rule_data.get(\"priority\", 0)\n        )\n\n    async def get_task_rules(self, task_id: int) -> List[Dict[str, Any]]:\n        \"\"\"Get all active rules for a task\"\"\"\n        return await self.fetch(\n            \"\"\"SELECT * FROM ai_rules \n               WHERE task_id = $1 AND is_active = true \n               ORDER BY priority DESC\"\"\",\n            task_id\n        )\n\n    async def update_rule(self, rule_id: int, updates: Dict[str, Any]):\n        \"\"\"Update AI rule\"\"\"\n        set_clauses = []\n        values = []\n        idx = 1\n\n        allowed_fields = ['type', 'category', 'name', 'prompt', 'config', 'is_active', 'priority']\n\n        for key in allowed_fields:\n            if key in updates:\n                value = updates[key]\n                if key == 'config' and value is not None:\n                    value = json.dumps(value) if isinstance(value, dict) else value\n                set_clauses.append(f\"{key} = ${idx}\")\n                values.append(value)\n                idx += 1\n\n        if not set_clauses:\n            return\n\n        values.append(rule_id)\n        query = f\"UPDATE ai_rules SET {', '.join(set_clauses)} WHERE id = ${idx}\"\n\n        return await self.execute(query, *values)\n\n    async def delete_rule(self, rule_id: int):\n        \"\"\"Delete AI rule\"\"\"\n        return await self.execute(\"DELETE FROM ai_rules WHERE id = $1\", rule_id)\n\n    # Statistics\n    async def update_task_stats(self, task_id: int, stat_type: str, date_str: Optional[str] = None):\n        \"\"\"Update task statistics\"\"\"\n        from datetime import datetime, date as date_type\n        \n        if date_str:\n            stat_date = datetime.strptime(date_str, \"%Y-%m-%d\").date().isoformat()\n        else:\n            stat_date = datetime.utcnow().date().isoformat()\n\n        column_map = {\n            \"forwarded\": \"messages_forwarded\",\n            \"processed\": \"messages_processed\",\n            \"ai\": \"ai_processed\",\n            \"video\": \"video_processed\",\n            \"error\": \"errors\"\n        }\n\n        column = column_map.get(stat_type, \"messages_forwarded\")\n\n        try:\n            return await self.execute(\n                f\"\"\"INSERT INTO task_stats (task_id, date, {column})\n                    VALUES ($1, $2, 1)\n                    ON CONFLICT (task_id, date) \n                    DO UPDATE SET {column} = task_stats.{column} + 1\"\"\",\n                task_id, stat_date\n            )\n        except Exception as e:\n            if \"no unique or exclusion constraint\" in str(e):\n                update_result = await self.execute(\n                    f\"\"\"UPDATE task_stats \n                       SET {column} = {column} + 1\n                       WHERE task_id = $1 AND date = $2\"\"\",\n                    task_id, stat_date\n                )\n                if update_result == \"UPDATE 0\":\n                    await self.execute(\n                        f\"\"\"INSERT INTO task_stats (task_id, date, {column})\n                            VALUES ($1, $2, 1)\"\"\",\n                        task_id, stat_date\n                    )\n                return update_result\n            else:\n                raise\n\n    async def get_task_stats(self, task_id: int, days: int = 7) -> List[Dict[str, Any]]:\n        \"\"\"Get task statistics for last N days\"\"\"\n        return await self.fetch(\n            \"\"\"SELECT * FROM task_stats \n               WHERE task_id = $1 \n               ORDER BY date DESC \n               LIMIT $2\"\"\",\n            task_id, days\n        )\n\n    # Queue Management\n    async def add_queue_job(self, job_data: Dict[str, Any]) -> int:\n        \"\"\"Add job to queue\"\"\"\n        payload = json.dumps(job_data[\"payload\"]) if isinstance(job_data[\"payload\"], dict) else job_data[\"payload\"]\n\n        return await self.fetchval(\n            \"\"\"INSERT INTO queue_jobs (task_id, type, payload, priority, max_attempts)\n               VALUES ($1, $2, $3, $4, $5) RETURNING id\"\"\",\n            job_data.get(\"task_id\"),\n            job_data[\"type\"],\n            payload,\n            job_data.get(\"priority\", 0),\n            job_data.get(\"max_attempts\", 3)\n        )\n\n    async def get_pending_jobs(self, limit: int = 100) -> List[Dict[str, Any]]:\n        \"\"\"Get pending jobs from queue\"\"\"\n        return await self.fetch(\n            \"\"\"SELECT * FROM queue_jobs \n               WHERE status = 'pending' \n               ORDER BY priority DESC, created_at ASC \n               LIMIT $1\"\"\",\n            limit\n        )\n\n    async def update_job_status(\n        self, \n        job_id: int, \n        status: str, \n        result: Optional[Dict[str, Any]] = None,\n        error: Optional[str] = None\n    ):\n        \"\"\"Update job status\"\"\"\n        result_json = json.dumps(result) if result else None\n        return await self.execute(\n            \"\"\"UPDATE queue_jobs \n               SET status = $1, result = $2, error = $3, \n                   processed_at = NOW(), attempts = attempts + 1\n               WHERE id = $4\"\"\",\n            status, result_json, error or \"\", job_id\n        )\n\n    # Bot Settings\n    async def get_setting(self, key: str) -> Optional[str]:\n        \"\"\"Get bot config setting by key\"\"\"\n        result = await self.fetchrow(\n            \"SELECT value FROM bot_config WHERE key = $1\",\n            key\n        )\n        return result[\"value\"] if result else None\n\n    async def set_setting(self, key: str, value: str, description: Optional[str] = None):\n        \"\"\"Set bot config setting\"\"\"\n        return await self.execute(\n            \"\"\"INSERT INTO bot_config (key, value, description)\n               VALUES ($1, $2, $3)\n               ON CONFLICT (key) DO UPDATE SET value = $2, updated_at = NOW()\"\"\",\n            key, value, description or \"\"\n        )\n\n    # ============================================\n    # Advanced AI Rules - Training Examples\n    # ============================================\n\n    async def get_training_examples(self, task_id: Optional[int] = None, \n                                     example_type: Optional[str] = None) -> List[Dict[str, Any]]:\n        \"\"\"Get training examples for a task\"\"\"\n        if task_id and example_type:\n            return await self.fetch(\n                \"\"\"SELECT * FROM ai_training_examples \n                   WHERE task_id = $1 AND example_type = $2 AND is_active = true\n                   ORDER BY use_count DESC, created_at DESC\"\"\",\n                task_id, example_type\n            )\n        elif task_id:\n            return await self.fetch(\n                \"\"\"SELECT * FROM ai_training_examples \n                   WHERE task_id = $1 AND is_active = true\n                   ORDER BY use_count DESC, created_at DESC\"\"\",\n                task_id\n            )\n        elif example_type:\n            return await self.fetch(\n                \"\"\"SELECT * FROM ai_training_examples \n                   WHERE example_type = $1 AND is_active = true\n                   ORDER BY use_count DESC, created_at DESC\"\"\",\n                example_type\n            )\n        else:\n            return await self.fetch(\n                \"\"\"SELECT * FROM ai_training_examples \n                   WHERE is_active = true\n                   ORDER BY use_count DESC, created_at DESC\n                   LIMIT 100\"\"\"\n            )\n\n    async def add_training_example(self, data: Dict[str, Any]) -> int:\n        \"\"\"Add new training example\"\"\"\n        if not data.get(\"task_id\"):\n            raise ValueError(\"task_id is required for training examples\")\n\n        tags = json.dumps(data.get(\"tags\", [])) if data.get(\"tags\") else None\n\n        return await self.fetchval(\n            \"\"\"INSERT INTO ai_training_examples \n               (task_id, example_type, input_text, expected_output, \n                explanation, tags, is_active)\n               VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING id\"\"\",\n            data[\"task_id\"],\n            data[\"example_type\"],\n            data[\"input_text\"],\n            data[\"expected_output\"],\n            data.get(\"explanation\"),\n            tags,\n            data.get(\"is_active\", True)\n        )\n\n    async def update_training_example(self, example_id: int, data: Dict[str, Any]):\n        \"\"\"Update training example\"\"\"\n        fields = []\n        values = []\n        param_count = 1\n\n        allowed_fields = ['example_type', 'input_text', 'expected_output', \n                          'explanation', 'is_active']\n\n        for field in allowed_fields:\n            if field in data:\n                fields.append(f\"{field} = ${param_count}\")\n                values.append(data[field])\n                param_count += 1\n\n        if 'tags' in data:\n            fields.append(f\"tags = ${param_count}\")\n            values.append(json.dumps(data['tags']) if data['tags'] else None)\n            param_count += 1\n\n        if not fields:\n            return\n\n        values.append(example_id)\n        query = f\"UPDATE ai_training_examples SET {', '.join(fields)} WHERE id = ${param_count}\"\n        return await self.execute(query, *values)\n\n    async def increment_example_use_count(self, example_id: int):\n        \"\"\"Increment use count for training example\"\"\"\n        return await self.execute(\n            \"UPDATE ai_training_examples SET use_count = use_count + 1 WHERE id = $1\",\n            example_id\n        )\n\n    async def delete_training_example(self, example_id: int):\n        \"\"\"Delete training example\"\"\"\n        return await self.execute(\n            \"DELETE FROM ai_training_examples WHERE id = $1\",\n            example_id\n        )\n\n    # ============================================\n    # Advanced AI Rules - Entity Replacements\n    # ============================================\n\n    async def get_entity_replacements(self, task_id: int) -> List[Dict[str, Any]]:\n        \"\"\"Get entity replacement rules for a task\"\"\"\n        return await self.fetch(\n            \"\"\"SELECT * FROM ai_entity_replacements \n               WHERE task_id = $1 AND is_active = true\n               ORDER BY priority DESC, created_at ASC\"\"\",\n            task_id\n        )\n\n    async def add_entity_replacement(self, data: Dict[str, Any]) -> int:\n        \"\"\"Add new entity replacement rule\"\"\"\n        return await self.fetchval(\n            \"\"\"INSERT INTO ai_entity_replacements \n               (task_id, entity_type, original_text, replacement_text, \n                case_sensitive, use_context, is_active, priority)\n               VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING id\"\"\",\n            data[\"task_id\"],\n            data.get(\"entity_type\", \"custom\"),\n            data[\"original_text\"],\n            data[\"replacement_text\"],\n            data.get(\"case_sensitive\", False),\n            data.get(\"use_context\", True),\n            data.get(\"is_active\", True),\n            data.get(\"priority\", 0)\n        )\n\n    async def update_entity_replacement(self, replacement_id: int, data: Dict[str, Any]):\n        \"\"\"Update entity replacement rule\"\"\"\n        fields = []\n        values = []\n        param_count = 1\n\n        allowed_fields = ['entity_type', 'original_text', 'replacement_text', \n                          'case_sensitive', 'use_context', 'is_active', 'priority']\n\n        for field in allowed_fields:\n            if field in data:\n                fields.append(f\"{field} = ${param_count}\")\n                values.append(data[field])\n                param_count += 1\n\n        if not fields:\n            return\n\n        values.append(replacement_id)\n        query = f\"UPDATE ai_entity_replacements SET {', '.join(fields)} WHERE id = ${param_count}\"\n        return await self.execute(query, *values)\n\n    async def delete_entity_replacement(self, replacement_id: int):\n        \"\"\"Delete entity replacement rule\"\"\"\n        return await self.execute(\n            \"DELETE FROM ai_entity_replacements WHERE id = $1\",\n            replacement_id\n        )\n\n    # ============================================\n    # Advanced AI Rules - Context Rules\n    # ============================================\n\n    async def get_context_rules(self, task_id: int) -> List[Dict[str, Any]]:\n        \"\"\"Get context modification rules for a task\"\"\"\n        return await self.fetch(\n            \"\"\"SELECT * FROM ai_context_rules \n               WHERE task_id = $1 AND is_active = true\n               ORDER BY priority DESC, created_at ASC\"\"\",\n            task_id\n        )\n\n    async def add_context_rule(self, data: Dict[str, Any]) -> int:\n        \"\"\"Add new context rule\"\"\"\n        examples = json.dumps(data.get(\"examples\", [])) if data.get(\"examples\") else None\n\n        return await self.fetchval(\n            \"\"\"INSERT INTO ai_context_rules \n               (task_id, rule_type, trigger_pattern, target_sentiment, \n                instructions, examples, is_active, priority)\n               VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING id\"\"\",\n            data[\"task_id\"],\n            data[\"rule_type\"],\n            data.get(\"trigger_pattern\"),\n            data.get(\"target_sentiment\"),\n            data[\"instructions\"],\n            examples,\n            data.get(\"is_active\", True),\n            data.get(\"priority\", 0)\n        )\n\n    async def update_context_rule(self, rule_id: int, data: Dict[str, Any]):\n        \"\"\"Update context rule\"\"\"\n        fields = []\n        values = []\n        param_count = 1\n\n        allowed_fields = ['rule_type', 'trigger_pattern', 'target_sentiment', \n                          'instructions', 'is_active', 'priority']\n\n        for field in allowed_fields:\n            if field in data:\n                fields.append(f\"{field} = ${param_count}\")\n                values.append(data[field])\n                param_count += 1\n\n        if 'examples' in data:\n            fields.append(f\"examples = ${param_count}\")\n            values.append(json.dumps(data['examples']) if data['examples'] else None)\n            param_count += 1\n\n        if not fields:\n            return\n\n        values.append(rule_id)\n        query = f\"UPDATE ai_context_rules SET {', '.join(fields)} WHERE id = ${param_count}\"\n        return await self.execute(query, *values)\n\n    async def delete_context_rule(self, rule_id: int):\n        \"\"\"Delete context rule\"\"\"\n        return await self.execute(\n            \"DELETE FROM ai_context_rules WHERE id = $1\",\n            rule_id\n        )\n\n    # ============================================\n    # Advanced AI Rules - Training Examples\n    # ============================================\n\n    async def get_training_examples(self, task_id: Optional[int] = None, \n                                     example_type: Optional[str] = None) -> List[Dict[str, Any]]:\n        \"\"\"Get training examples\"\"\"\n        if task_id and example_type:\n            return await self.fetch(\n                \"\"\"SELECT * FROM ai_training_examples \n                   WHERE task_id = $1 AND example_type = $2 AND is_active = true\n                   ORDER BY use_count DESC, created_at DESC\"\"\",\n                task_id, example_type\n            )\n        elif task_id:\n            return await self.fetch(\n                \"\"\"SELECT * FROM ai_training_examples \n                   WHERE task_id = $1 AND is_active = true\n                   ORDER BY use_count DESC, created_at DESC\"\"\",\n                task_id\n            )\n        elif example_type:\n            return await self.fetch(\n                \"\"\"SELECT * FROM ai_training_examples \n                   WHERE example_type = $1 AND is_active = true\n                   ORDER BY use_count DESC, created_at DESC\"\"\",\n                example_type\n            )\n        else:\n            return await self.fetch(\n                \"\"\"SELECT * FROM ai_training_examples \n                   WHERE is_active = true\n                   ORDER BY use_count DESC, created_at DESC\n                   LIMIT 100\"\"\"\n            )\n\n    async def add_training_example(self, data: Dict[str, Any]) -> int:\n        \"\"\"Add new training example\"\"\"\n        if not data.get(\"task_id\"):\n            raise ValueError(\"task_id is required for training examples\")\n\n        tags = json.dumps(data.get(\"tags\", [])) if data.get(\"tags\") else None\n\n        return await self.fetchval(\n            \"\"\"INSERT INTO ai_training_examples \n               (task_id, example_type, input_text, expected_output, \n                explanation, tags, is_active)\n               VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING id\"\"\",\n            data[\"task_id\"],\n            data[\"example_type\"],\n            data[\"input_text\"],\n            data[\"expected_output\"],\n            data.get(\"explanation\"),\n            tags,\n            data.get(\"is_active\", True)\n        )\n\n    async def increment_example_use_count(self, example_id: int):\n        \"\"\"Increment use count for training example\"\"\"\n        return await self.execute(\n            \"UPDATE ai_training_examples SET use_count = use_count + 1 WHERE id = $1\",\n            example_id\n        )\n\n    async def delete_training_example(self, example_id: int):\n        \"\"\"Delete training example\"\"\"\n        return await self.execute(\n            \"DELETE FROM ai_training_examples WHERE id = $1\",\n            example_id\n        )\n\n    # ============================================\n    # Advanced AI Rules - Processing Config\n    # ============================================\n\n    async def get_processing_config(self, task_id: Optional[int] = None) -> Optional[Dict[str, Any]]:\n        \"\"\"Get processing configuration\"\"\"\n        if task_id:\n            config = await self.fetchrow(\n                \"\"\"SELECT * FROM ai_processing_config \n                   WHERE task_id = $1\"\"\",\n                task_id\n            )\n            if config:\n                return dict(config)\n\n        global_config = await self.fetchrow(\n            \"\"\"SELECT * FROM ai_processing_config \n               WHERE config_type = 'global' AND task_id IS NULL\"\"\"\n        )\n        return dict(global_config) if global_config else None\n\n    async def save_processing_config(self, data: Dict[str, Any]) -> int:\n        \"\"\"Save processing configuration\"\"\"\n        task_id = data.get(\"task_id\")\n        config_type = data.get(\"config_type\", \"task_specific\" if task_id else \"global\")\n\n        existing = None\n        if task_id:\n            existing = await self.fetchrow(\n                \"SELECT id FROM ai_processing_config WHERE task_id = $1\",\n                task_id\n            )\n        else:\n            existing = await self.fetchrow(\n                \"SELECT id FROM ai_processing_config WHERE config_type = 'global' AND task_id IS NULL\"\n            )\n\n        if existing:\n            return await self.fetchval(\n                \"\"\"UPDATE ai_processing_config SET\n                   enable_entity_extraction = $1,\n                   enable_sentiment_analysis = $2,\n                   enable_keyword_detection = $3,\n                   max_retries = $4,\n                   timeout_seconds = $5,\n                   preserve_formatting = $6,\n                   enable_output_validation = $7,\n                   enable_rule_verification = $8,\n                   output_format = $9,\n                   temperature = $10,\n                   quality_level = $11,\n                   updated_at = NOW()\n                   WHERE id = $12 RETURNING id\"\"\",\n                data.get(\"enable_entity_extraction\", True),\n                data.get(\"enable_sentiment_analysis\", True),\n                data.get(\"enable_keyword_detection\", True),\n                data.get(\"max_retries\", 3),\n                data.get(\"timeout_seconds\", 60),\n                data.get(\"preserve_formatting\", True),\n                data.get(\"enable_output_validation\", True),\n                data.get(\"enable_rule_verification\", True),\n                data.get(\"output_format\", \"markdown\"),\n                str(data.get(\"temperature\", \"0.7\")),\n                data.get(\"quality_level\", \"balanced\"),\n                existing[\"id\"]\n            )\n        else:\n            return await self.fetchval(\n                \"\"\"INSERT INTO ai_processing_config \n                   (task_id, config_type, enable_entity_extraction, enable_sentiment_analysis,\n                    enable_keyword_detection, max_retries, timeout_seconds, preserve_formatting,\n                    enable_output_validation, enable_rule_verification, output_format,\n                    temperature, quality_level)\n                   VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING id\"\"\",\n                task_id,\n                config_type,\n                data.get(\"enable_entity_extraction\", True),\n                data.get(\"enable_sentiment_analysis\", True),\n                data.get(\"enable_keyword_detection\", True),\n                data.get(\"max_retries\", 3),\n                data.get(\"timeout_seconds\", 60),\n                data.get(\"preserve_formatting\", True),\n                data.get(\"enable_output_validation\", True),\n                data.get(\"enable_rule_verification\", True),\n                data.get(\"output_format\", \"markdown\"),\n                str(data.get(\"temperature\", \"0.7\")),\n                data.get(\"quality_level\", \"balanced\")\n            )\n\n    # ============================================\n    # AI Content Filters\n    # ============================================\n\n    async def get_content_filters(self, task_id: int) -> List[Dict[str, Any]]:\n        \"\"\"Get content filters for a task\"\"\"\n        rows = await self.fetch(\n            \"\"\"SELECT * FROM ai_content_filters \n               WHERE task_id = $1 AND is_active = true\n               ORDER BY priority DESC, created_at ASC\"\"\",\n            task_id\n        )\n        return [dict(row) for row in rows]\n\n    async def add_content_filter(self, data: Dict[str, Any]) -> int:\n        \"\"\"Add new content filter\"\"\"\n        return await self.fetchval(\n            \"\"\"INSERT INTO ai_content_filters \n               (task_id, name, filter_type, match_type, pattern, context_description,\n                sentiment_target, action, modify_instructions, is_active, priority)\n               VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING id\"\"\",\n            data[\"task_id\"],\n            data[\"name\"],\n            data[\"filter_type\"],\n            data[\"match_type\"],\n            data[\"pattern\"],\n            data.get(\"context_description\"),\n            data.get(\"sentiment_target\"),\n            data.get(\"action\", \"skip\"),\n            data.get(\"modify_instructions\"),\n            data.get(\"is_active\", True),\n            data.get(\"priority\", 0)\n        )\n\n    async def update_content_filter(self, filter_id: int, data: Dict[str, Any]):\n        \"\"\"Update content filter\"\"\"\n        fields = []\n        values = []\n        param_count = 1\n\n        allowed_fields = ['name', 'filter_type', 'match_type', 'pattern', \n                          'context_description', 'sentiment_target', 'action',\n                          'modify_instructions', 'is_active', 'priority']\n\n        for field in allowed_fields:\n            if field in data:\n                fields.append(f\"{field} = ${param_count}\")\n                values.append(data[field])\n                param_count += 1\n\n        if not fields:\n            return\n\n        values.append(filter_id)\n        query = f\"UPDATE ai_content_filters SET {', '.join(fields)} WHERE id = ${param_count}\"\n        return await self.execute(query, *values)\n\n    async def delete_content_filter(self, filter_id: int):\n        \"\"\"Delete content filter\"\"\"\n        return await self.execute(\n            \"DELETE FROM ai_content_filters WHERE id = $1\",\n            filter_id\n        )\n\n    async def increment_filter_match_count(self, filter_id: int):\n        \"\"\"Increment match count for content filter\"\"\"\n        return await self.execute(\n            \"UPDATE ai_content_filters SET match_count = match_count + 1 WHERE id = $1\",\n            filter_id\n        )\n\n    # ============================================\n    # AI Publishing Templates\n    # ============================================\n\n    async def get_publishing_templates(self, task_id: int) -> List[Dict[str, Any]]:\n        \"\"\"Get publishing templates for a task\"\"\"\n        rows = await self.fetch(\n            \"\"\"SELECT * FROM ai_publishing_templates \n               WHERE task_id = $1 AND is_active = true\n               ORDER BY is_default DESC, created_at ASC\"\"\",\n            task_id\n        )\n        return [dict(row) for row in rows]\n\n    async def get_default_template(self, task_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"Get default publishing template for a task\"\"\"\n        row = await self.fetchrow(\n            \"\"\"SELECT * FROM ai_publishing_templates \n               WHERE task_id = $1 AND is_default = true AND is_active = true\n               LIMIT 1\"\"\",\n            task_id\n        )\n        return dict(row) if row else None\n\n    async def add_publishing_template(self, data: Dict[str, Any]) -> int:\n        \"\"\"Add new publishing template\"\"\"\n        if data.get(\"is_default\"):\n            await self.execute(\n                \"UPDATE ai_publishing_templates SET is_default = false WHERE task_id = $1\",\n                data[\"task_id\"]\n            )\n\n        return await self.fetchval(\n            \"\"\"INSERT INTO ai_publishing_templates \n               (task_id, name, is_default, template_type, header_text,\n                header_formatting, footer_text, footer_formatting, field_separator,\n                use_newline_after_header, use_newline_before_footer, max_length,\n                extraction_prompt, is_active)\n               VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING id\"\"\",\n            data[\"task_id\"],\n            data[\"name\"],\n            data.get(\"is_default\", False),\n            data.get(\"template_type\", \"custom\"),\n            data.get(\"header_text\"),\n            data.get(\"header_formatting\", \"none\"),\n            data.get(\"footer_text\"),\n            data.get(\"footer_formatting\", \"none\"),\n            data.get(\"field_separator\", \"\\n\"),\n            data.get(\"use_newline_after_header\", True),\n            data.get(\"use_newline_before_footer\", True),\n            data.get(\"max_length\"),\n            data.get(\"extraction_prompt\"),\n            data.get(\"is_active\", True)\n        )\n\n    async def update_publishing_template(self, template_id: int, data: Dict[str, Any]):\n        \"\"\"Update publishing template\"\"\"\n        if data.get(\"is_default\") and data.get(\"task_id\"):\n            await self.execute(\n                \"UPDATE ai_publishing_templates SET is_default = false WHERE task_id = $1\",\n                data[\"task_id\"]\n            )\n\n        fields = []\n        values = []\n        param_count = 1\n\n        allowed_fields = ['name', 'is_default', 'template_type', 'header_text',\n                          'header_formatting', 'footer_text', 'footer_formatting',\n                          'field_separator', 'use_newline_after_header', \n                          'use_newline_before_footer', 'max_length', \n                          'extraction_prompt', 'is_active']\n\n        for field in allowed_fields:\n            if field in data:\n                fields.append(f\"{field} = ${param_count}\")\n                values.append(data[field])\n                param_count += 1\n\n        fields.append(f\"updated_at = NOW()\")\n\n        if not values:\n            return\n\n        values.append(template_id)\n        query = f\"UPDATE ai_publishing_templates SET {', '.join(fields)} WHERE id = ${param_count}\"\n        return await self.execute(query, *values)\n\n    async def delete_publishing_template(self, template_id: int):\n        \"\"\"Delete publishing template\"\"\"\n        return await self.execute(\n            \"DELETE FROM ai_publishing_templates WHERE id = $1\",\n            template_id\n        )\n\n    # ============================================\n    # Template Custom Fields\n    # ============================================\n\n    async def get_template_custom_fields(self, template_id: int) -> List[Dict[str, Any]]:\n        \"\"\"Get custom fields for a publishing template\"\"\"\n        rows = await self.fetch(\n            \"\"\"SELECT * FROM template_custom_fields \n               WHERE template_id = $1 AND is_active = true\n               ORDER BY display_order ASC\"\"\",\n            template_id\n        )\n        return [dict(row) for row in rows]\n\n    async def get_default_template_with_fields(self, task_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"Get default publishing template for a task with its custom fields\"\"\"\n        template = await self.fetchrow(\n            \"\"\"SELECT * FROM ai_publishing_templates \n               WHERE task_id = $1 AND is_default = true AND is_active = true\n               LIMIT 1\"\"\",\n            task_id\n        )\n        if not template:\n            return None\n\n        template_dict = dict(template)\n        custom_fields = await self.get_template_custom_fields(template_dict['id'])\n        template_dict['custom_fields'] = custom_fields\n        # ‚úÖ FIX: Also populate 'fields' key for consistency with _apply_publishing_template\n        template_dict['fields'] = custom_fields\n        return template_dict\n\n    async def get_task_publishing_template(self, task_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"Get default publishing template for a task with fields formatted for AI extraction\"\"\"\n        template = await self.fetchrow(\n            \"\"\"SELECT * FROM ai_publishing_templates \n               WHERE task_id = $1 AND is_default = true AND is_active = true\n               LIMIT 1\"\"\",\n            task_id\n        )\n        if not template:\n            return None\n\n        template_dict = dict(template)\n        custom_fields = await self.get_template_custom_fields(template_dict['id'])\n        \n        # Format fields for AI extraction pipeline\n        fields = []\n        for field in custom_fields:\n            fields.append({\n                \"field_name\": field.get(\"field_name\"),\n                \"field_label\": field.get(\"field_label\"),\n                \"field_type\": field.get(\"field_type\", \"extracted\"),\n                \"extraction_instructions\": field.get(\"extraction_instructions\", \"\"),\n                \"default_value\": field.get(\"default_value\", \"\"),\n                \"use_default_if_empty\": field.get(\"use_default_if_empty\", True),\n                \"formatting\": field.get(\"formatting\", \"none\"),\n                \"show_label\": field.get(\"show_label\", True),  # ‚úÖ FIX: Default to True so labels SHOW\n                \"label_separator\": field.get(\"label_separator\", \": \"),\n                \"prefix\": field.get(\"prefix\", \"\"),\n                \"suffix\": field.get(\"suffix\", \"\"),\n                \"display_order\": field.get(\"display_order\", 0),\n                \"is_active\": field.get(\"is_active\", True)\n            })\n        \n        template_dict['fields'] = fields\n        return template_dict\n\n    async def add_template_custom_field(self, data: Dict[str, Any]) -> int:\n        \"\"\"Add new custom field to a template\"\"\"\n        return await self.fetchval(\n            \"\"\"INSERT INTO template_custom_fields \n               (template_id, field_name, field_label, extraction_instructions,\n                default_value, use_default_if_empty, formatting, display_order,\n                show_label, label_separator, prefix, suffix, field_type, is_active)\n               VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING id\"\"\",\n            data[\"template_id\"],\n            data[\"field_name\"],\n            data[\"field_label\"],\n            data[\"extraction_instructions\"],\n            data.get(\"default_value\"),\n            data.get(\"use_default_if_empty\", True),\n            data.get(\"formatting\", \"none\"),\n            data.get(\"display_order\", 0),\n            data.get(\"show_label\", False),\n            data.get(\"label_separator\", \": \"),\n            data.get(\"prefix\"),\n            data.get(\"suffix\"),\n            data.get(\"field_type\", \"extracted\"),\n            data.get(\"is_active\", True)\n        )\n\n    async def update_template_custom_field(self, field_id: int, data: Dict[str, Any]):\n        \"\"\"Update custom field\"\"\"\n        fields = []\n        values = []\n        param_count = 1\n\n        allowed_fields = ['field_name', 'field_label', 'extraction_instructions',\n                          'default_value', 'use_default_if_empty', 'formatting',\n                          'display_order', 'show_label', 'label_separator',\n                          'prefix', 'suffix', 'field_type', 'is_active']\n\n        for field in allowed_fields:\n            if field in data:\n                fields.append(f\"{field} = ${param_count}\")\n                values.append(data[field])\n                param_count += 1\n\n        if not values:\n            return\n\n        values.append(field_id)\n        query = f\"UPDATE template_custom_fields SET {', '.join(fields)} WHERE id = ${param_count}\"\n        return await self.execute(query, *values)\n\n    async def delete_template_custom_field(self, field_id: int):\n        \"\"\"Delete custom field\"\"\"\n        return await self.execute(\n            \"DELETE FROM template_custom_fields WHERE id = $1\",\n            field_id\n        )\n\n    # ============================================\n    # Message Archive\n    # ============================================\n\n    async def get_next_serial_number(self, task_id: int) -> int:\n        \"\"\"Get the next serial number for a task (ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ)\"\"\"\n        existing = await self.fetchrow(\n            \"SELECT last_serial FROM archive_serial_counter WHERE task_id = $1\",\n            task_id\n        )\n\n        if existing:\n            new_serial = existing['last_serial'] + 1\n            await self.execute(\n                \"UPDATE archive_serial_counter SET last_serial = $1, updated_at = NOW() WHERE task_id = $2\",\n                new_serial, task_id\n            )\n            return new_serial\n        else:\n            await self.execute(\n                \"INSERT INTO archive_serial_counter (task_id, last_serial) VALUES ($1, 1)\",\n                task_id\n            )\n            return 1\n\n    async def create_archive_message(self, data: Dict[str, Any]) -> int:\n        \"\"\"Create a new archive message entry\"\"\"\n        import json\n\n        def to_int(val):\n            \"\"\"Convert value to int, handling strings\"\"\"\n            if val is None:\n                return None\n            try:\n                return int(val)\n            except (ValueError, TypeError):\n                return None\n\n        tags_json = json.dumps(data.get('tags', [])) if data.get('tags') else None\n        extracted_fields_json = json.dumps(data.get('extracted_fields', {})) if data.get('extracted_fields') else None\n\n        return await self.fetchval(\n            \"\"\"INSERT INTO message_archive \n               (task_id, serial_number, source_message_id, source_channel_id, source_channel_title,\n                target_channel_id, target_channel_title, target_message_id, title, original_text,\n                processed_text, published_text, telegraph_url, telegraph_title, classification,\n                news_type, province, specialist, tags, extracted_fields, has_media, media_type,\n                media_count, media_group_id, processing_duration, ai_provider, ai_model, template_name,\n                status, is_edited, is_pinned, is_flagged, flag_reason, notes)\n               VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34)\n               RETURNING id\"\"\",\n            to_int(data['task_id']),\n            to_int(data['serial_number']),\n            str(data.get('source_message_id')) if data.get('source_message_id') else None,\n            str(data.get('source_channel_id')) if data.get('source_channel_id') else None,\n            data.get('source_channel_title'),\n            str(data.get('target_channel_id')) if data.get('target_channel_id') else None,\n            data.get('target_channel_title'),\n            str(data.get('target_message_id')) if data.get('target_message_id') else None,\n            data.get('title'),\n            data.get('original_text'),\n            data.get('processed_text'),\n            data.get('published_text'),\n            data.get('telegraph_url'),\n            data.get('telegraph_title'),\n            data.get('classification'),\n            data.get('news_type'),\n            data.get('province'),\n            data.get('specialist'),\n            tags_json,\n            extracted_fields_json,\n            bool(data.get('has_media', False)),\n            data.get('media_type'),\n            to_int(data.get('media_count', 0)) or 0,\n            data.get('media_group_id'),\n            to_int(data.get('processing_duration')),\n            data.get('ai_provider'),\n            data.get('ai_model'),\n            data.get('template_name'),\n            data.get('status', 'published'),\n            bool(data.get('is_edited', False)),\n            bool(data.get('is_pinned', False)),\n            bool(data.get('is_flagged', False)),\n            data.get('flag_reason'),\n            data.get('notes')\n        )\n\n    async def get_archive_message(self, message_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"Get archive message by ID\"\"\"\n        return await self.fetchrow(\n            \"SELECT * FROM message_archive WHERE id = $1\",\n            message_id\n        )\n\n    async def update_archive_message(self, message_id: int, data: Dict[str, Any]):\n        \"\"\"Update archive message\"\"\"\n        import json\n\n        fields = []\n        values = []\n        param_count = 1\n\n        for key, value in data.items():\n            if key in ['id', 'created_at']:\n                continue\n            if key in ['tags', 'extracted_fields']:\n                value = json.dumps(value) if value else None\n            fields.append(f\"{key} = ${param_count}\")\n            values.append(value)\n            param_count += 1\n\n        if not values:\n            return\n\n        fields.append(f\"updated_at = NOW()\")\n        values.append(message_id)\n\n        query = f\"UPDATE message_archive SET {', '.join(fields)} WHERE id = ${param_count}\"\n        return await self.execute(query, *values)\n\n    async def generate_title_from_text(self, text: str, ai_manager=None) -> Optional[str]:\n        \"\"\"Generate a title from text using AI\"\"\"\n        if not text or len(text.strip()) < 10:\n            return None\n\n        if ai_manager:\n            try:\n                prompt = f\"\"\"ŸÇŸÖ ÿ®ÿ•ŸÜÿ¥ÿßÿ° ÿπŸÜŸàÿßŸÜ ŸÇÿµŸäÿ± ŸàŸÖÿÆÿ™ÿµÿ± (5-10 ŸÉŸÑŸÖÿßÿ™) ŸÑŸáÿ∞ÿß ÿßŸÑŸÜÿµ:\n\n{text[:500]}\n\nÿ£ÿπÿØ ÿßŸÑÿπŸÜŸàÿßŸÜ ŸÅŸÇÿ∑ ÿ®ÿØŸàŸÜ ÿ£Ÿä ÿ¥ÿ±ÿ≠ ÿ£Ÿà ÿπŸÑÿßŸÖÿßÿ™ ÿ™ÿ±ŸÇŸäŸÖ ÿ•ÿ∂ÿßŸÅŸäÿ©.\"\"\"\n\n                title = await ai_manager.generate(\n                    provider=\"groq\",\n                    model=\"mixtral-8x7b-32768\",\n                    prompt=prompt,\n                    max_tokens=50,\n                    temperature=0.3\n                )\n                if title:\n                    return title.strip()[:200]\n            except Exception:\n                pass\n\n        first_line = text.split('\\n')[0].strip()\n        if len(first_line) > 10:\n            return first_line[:100] + ('...' if len(first_line) > 100 else '')\n        return text[:100] + ('...' if len(text) > 100 else '')\n\n# Global database instance\ndb = Database()","path":null,"size_bytes":48655,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"server/storage.ts":{"content":"import postgres from \"postgres\";\nimport { drizzle } from \"drizzle-orm/postgres-js\";\nimport { eq, desc, and, sql } from \"drizzle-orm\";\nimport * as schema from \"@shared/schema\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport type {\n  User,\n  InsertUser,\n  Admin,\n  InsertAdmin,\n  ForwardingTask,\n  InsertForwardingTask,\n  Channel,\n  InsertChannel,\n  AiRule,\n  InsertAiRule,\n  TaskLog,\n  InsertTaskLog,\n  TaskStats,\n  AiProvider,\n  InsertAiProvider,\n  AiModel,\n  InsertAiModel,\n  AiUsageStats,\n  InsertAiUsageStats,\n  UserbotSession,\n  InsertUserbotSession,\n  GitHubSettings,\n  InsertGithubSettings,\n} from \"@shared/schema\";\n\nfunction getLocalDatabaseUrl(): string {\n  let dbUrl = process.env.DATABASE_URL || \"\";\n  if (!dbUrl) return \"\";\n  \n  if (dbUrl.includes(',')) {\n    const atIndex = dbUrl.lastIndexOf('@');\n    if (atIndex !== -1) {\n      const beforeAt = dbUrl.substring(0, atIndex + 1);\n      const afterAt = dbUrl.substring(atIndex + 1);\n      \n      const slashIndex = afterAt.indexOf('/');\n      if (slashIndex !== -1) {\n        const hostsSection = afterAt.substring(0, slashIndex);\n        const pathSection = afterAt.substring(slashIndex);\n        \n        const primaryHost = hostsSection.split(',')[0].trim();\n        dbUrl = beforeAt + primaryHost + pathSection;\n        console.log('[DB] Using primary host from multi-host URL');\n      }\n    }\n  }\n  \n  if (!dbUrl.includes('sslmode=')) {\n    dbUrl += (dbUrl.includes('?') ? '&' : '?') + 'sslmode=require';\n  }\n  \n  return dbUrl;\n}\n\nconst connectionString = getLocalDatabaseUrl();\nconsole.log('[DB] Connecting to database...');\nconst queryClient = postgres(connectionString);\nexport const database = drizzle(queryClient, { schema });\n\n// Run migrations automatically on startup\nasync function runMigrations(): Promise<void> {\n  try {\n    console.log('[DB] Running database migrations...');\n    \n    // Create migrations tracking table if it doesn't exist\n    await queryClient`\n      CREATE TABLE IF NOT EXISTS _drizzle_migrations (\n        id SERIAL PRIMARY KEY,\n        hash TEXT NOT NULL UNIQUE,\n        created_at TIMESTAMP NOT NULL DEFAULT now()\n      )\n    `;\n    \n    // Get all migration files\n    const migrationsDir = path.join(process.cwd(), 'migrations');\n    const files = fs.readdirSync(migrationsDir).filter((f: string) => f.endsWith('.sql')).sort();\n    \n    for (const file of files) {\n      const hash = file;\n      \n      // Check if migration already ran\n      const existing = await queryClient`SELECT * FROM _drizzle_migrations WHERE hash = ${hash}`;\n      if (existing.length > 0) {\n        console.log(`[DB] Migration ${file} already applied`);\n        continue;\n      }\n      \n      // Read and execute migration\n      const filePath = path.join(migrationsDir, file);\n      const sql = fs.readFileSync(filePath, 'utf-8');\n      \n      // Split by statement breakpoints and filter out comments\n      const statements = sql\n        .split('--> statement-breakpoint')\n        .map((stmt: string) => stmt.trim())\n        .filter((stmt: string) => stmt && !stmt.startsWith('--'));\n      \n      console.log(`[DB] Applying migration ${file}...`);\n      for (const statement of statements) {\n        if (statement) {\n          try {\n            await queryClient.unsafe(statement);\n          } catch (err: any) {\n            // Ignore errors for IF NOT EXISTS clauses\n            if (!err.message?.includes('already exists')) {\n              console.warn(`[DB] Statement error (may be expected): ${err.message}`);\n            }\n          }\n        }\n      }\n      \n      // Record migration as completed - use ON CONFLICT to handle if already exists\n      try {\n        await queryClient`INSERT INTO _drizzle_migrations (hash) VALUES (${hash}) ON CONFLICT (hash) DO NOTHING`;\n        console.log(`[DB] ‚úì Migration ${file} completed`);\n      } catch (err: any) {\n        console.warn(`[DB] Could not record migration: ${err.message}`);\n      }\n    }\n    \n    console.log('[DB] All migrations applied successfully');\n  } catch (error: any) {\n    console.error('[DB] Migration error:', error);\n    throw error;\n  }\n}\n\n// Seed default AI providers and models\nasync function seedProviders(): Promise<void> {\n  try {\n    const providerCount = await queryClient`SELECT COUNT(*) as count FROM ai_providers`;\n    if (providerCount[0]?.count > 0) {\n      console.log('[DB] Providers already seeded');\n      return;\n    }\n    \n    console.log('[DB] Seeding default AI providers...');\n    \n    // Insert default providers\n    const providers = [\n      { name: 'openai', isActive: true, config: JSON.stringify({ baseUrl: 'https://api.openai.com/v1' }) },\n      { name: 'groq', isActive: true, config: JSON.stringify({ baseUrl: 'https://api.groq.com/openai/v1' }) },\n      { name: 'claude', isActive: true, config: JSON.stringify({ baseUrl: 'https://api.anthropic.com/v1' }) },\n      { name: 'huggingface', isActive: true, config: JSON.stringify({ baseUrl: 'https://api-inference.huggingface.co' }) },\n    ];\n    \n    for (const provider of providers) {\n      await queryClient`\n        INSERT INTO ai_providers (name, is_active, config, created_at)\n        VALUES (${provider.name}, ${provider.isActive}, ${provider.config}, now())\n        ON CONFLICT (name) DO NOTHING\n      `;\n    }\n    \n    console.log('[DB] ‚úì AI providers seeded successfully');\n  } catch (error: any) {\n    console.warn('[DB] Warning seeding providers:', error?.message || error);\n  }\n}\n\n// Seed default AI models\nasync function seedModels(): Promise<void> {\n  try {\n    const modelCount = await queryClient`SELECT COUNT(*) as count FROM ai_models`;\n    if (modelCount[0]?.count > 0) {\n      console.log('[DB] Models already seeded');\n      return;\n    }\n    \n    console.log('[DB] Seeding default AI models...');\n    \n    // Get provider IDs\n    const providers = await queryClient`SELECT id, name FROM ai_providers`;\n    const providerMap = new Map(providers.map((p: any) => [p.name, p.id]));\n    \n    const models = [\n      // OpenAI - GPT-5.2 Series (Latest - Dec 2025)\n      { providerId: providerMap.get('openai'), modelName: 'gpt-5.2-instant', displayName: 'GPT-5.2 Instant', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-5.2-thinking', displayName: 'GPT-5.2 Thinking', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-5.2-pro', displayName: 'GPT-5.2 Pro', isActive: true },\n      \n      // OpenAI - GPT-5.1 Series (Reasoning)\n      { providerId: providerMap.get('openai'), modelName: 'gpt-5.1', displayName: 'GPT-5.1', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-5.1-chat', displayName: 'GPT-5.1 Chat', isActive: true },\n      \n      // OpenAI - GPT-5 Series\n      { providerId: providerMap.get('openai'), modelName: 'gpt-5', displayName: 'GPT-5', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-5-mini', displayName: 'GPT-5 Mini', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-5-nano', displayName: 'GPT-5 Nano', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-5-codex', displayName: 'GPT-5 Codex', isActive: true },\n      \n      // OpenAI - GPT-4.1 Series\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4.1', displayName: 'GPT-4.1', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4.1-mini', displayName: 'GPT-4.1 Mini', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4.1-nano', displayName: 'GPT-4.1 Nano', isActive: true },\n      \n      // OpenAI - GPT-4o Series\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4o', displayName: 'GPT-4o', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4o-mini', displayName: 'GPT-4o Mini', isActive: true },\n      \n      // OpenAI - O-Series (Advanced Reasoning)\n      { providerId: providerMap.get('openai'), modelName: 'o3', displayName: 'o3', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'o4-mini', displayName: 'o4 Mini', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'o3-deep-research', displayName: 'o3 Deep Research', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'o4-mini-deep-research', displayName: 'o4 Mini Deep Research', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'o1-pro', displayName: 'o1 Pro', isActive: true },\n      \n      // OpenAI - Audio Models\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4o-transcribe', displayName: 'GPT-4o Transcribe', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4o-mini-transcribe', displayName: 'GPT-4o Mini Transcribe', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4o-mini-tts', displayName: 'GPT-4o Mini TTS', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4o-audio', displayName: 'GPT-4o Audio', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4o-mini-audio', displayName: 'GPT-4o Mini Audio', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'whisper-1', displayName: 'Whisper-1', isActive: true },\n      \n      // OpenAI - Vision & Image Generation\n      { providerId: providerMap.get('openai'), modelName: 'gpt-image-1', displayName: 'GPT Image-1', isActive: true },\n      \n      // OpenAI - Search & Specialized\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4o-search-preview', displayName: 'GPT-4o Search', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'gpt-4o-mini-search-preview', displayName: 'GPT-4o Mini Search', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'computer-use-preview', displayName: 'Computer Use Preview', isActive: true },\n      \n      // OpenAI - Embeddings\n      { providerId: providerMap.get('openai'), modelName: 'text-embedding-3-large', displayName: 'Text Embedding 3 Large', isActive: true },\n      { providerId: providerMap.get('openai'), modelName: 'text-embedding-3-small', displayName: 'Text Embedding 3 Small', isActive: true },\n      \n      // Groq models\n      { providerId: providerMap.get('groq'), modelName: 'llama-3.3-70b-versatile', displayName: 'LLaMA 3.3 70B', isActive: true },\n      { providerId: providerMap.get('groq'), modelName: 'qwen/qwen3-32b', displayName: 'Qwen 3 32B', isActive: true },\n      \n      // Claude models\n      { providerId: providerMap.get('claude'), modelName: 'claude-3-opus-20240229', displayName: 'Claude 3 Opus', isActive: true },\n      { providerId: providerMap.get('claude'), modelName: 'claude-3-sonnet-20240229', displayName: 'Claude 3 Sonnet', isActive: true },\n      \n      // HuggingFace models\n      { providerId: providerMap.get('huggingface'), modelName: 'meta-llama/Llama-2-70b-chat-hf', displayName: 'LLaMA 2 70B Chat', isActive: true },\n    ];\n    \n    for (const model of models) {\n      if (model.providerId) {\n        await queryClient`\n          INSERT INTO ai_models (provider_id, model_name, display_name, is_active, created_at)\n          VALUES (${model.providerId}, ${model.modelName}, ${model.displayName}, ${model.isActive}, now())\n          ON CONFLICT DO NOTHING\n        `;\n      }\n    }\n    \n    console.log('[DB] ‚úì AI models seeded successfully');\n  } catch (error: any) {\n    console.warn('[DB] Warning seeding models:', error?.message || error);\n  }\n}\n\n// Ensure all tables are created on startup\nexport async function ensureTablesExist(): Promise<void> {\n  try {\n    console.log('[DB] Ensuring all tables exist...');\n    \n    // Run migrations automatically\n    await runMigrations();\n    \n    // Seed default providers and models\n    await seedProviders();\n    await seedModels();\n    \n    // Verify tables exist\n    const result = await queryClient`SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' LIMIT 1`;\n    \n    if (result && result.length > 0) {\n      console.log('[DB] Database tables verified - connection successful');\n      return;\n    }\n    \n    console.log('[DB] Warning: No tables found after migration');\n  } catch (error: any) {\n    console.error('[DB] Error ensuring tables exist:', error?.message || error);\n    throw error;\n  }\n}\n\nexport interface IStorage {\n  // User Management\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n\n  // Admin Management\n  getAdmins(): Promise<Admin[]>;\n  getAdmin(telegramId: string): Promise<Admin | undefined>;\n  createAdmin(admin: InsertAdmin): Promise<Admin>;\n  deleteAdmin(id: number): Promise<void>;\n\n  // Task Management\n  getTasks(): Promise<ForwardingTask[]>;\n  getTask(id: number): Promise<ForwardingTask | undefined>;\n  createTask(task: InsertForwardingTask): Promise<ForwardingTask>;\n  updateTask(id: number, task: Partial<InsertForwardingTask>): Promise<ForwardingTask | undefined>;\n  deleteTask(id: number): Promise<void>;\n  toggleTask(id: number): Promise<ForwardingTask | undefined>;\n\n  // Channel Management\n  getChannels(): Promise<Channel[]>;\n  getChannel(id: number): Promise<Channel | undefined>;\n  createChannel(channel: InsertChannel): Promise<Channel>;\n  updateChannel(id: number, channel: Partial<InsertChannel>): Promise<Channel | undefined>;\n  deleteChannel(id: number): Promise<void>;\n\n  // AI Provider Management\n  getAiProviders(): Promise<AiProvider[]>;\n  getAiProvider(id: number): Promise<AiProvider | undefined>;\n  getAiProviderByName(name: string): Promise<AiProvider | undefined>;\n  createAiProvider(provider: InsertAiProvider): Promise<AiProvider>;\n  updateAiProvider(id: number, provider: Partial<InsertAiProvider>): Promise<AiProvider | undefined>;\n  toggleAiProvider(id: number): Promise<AiProvider | undefined>;\n\n  // AI Model Management\n  getAiModels(): Promise<AiModel[]>;\n  getAiModelsByProvider(providerId: number): Promise<AiModel[]>;\n  createAiModel(model: InsertAiModel): Promise<AiModel>;\n\n  // AI Rule Management\n  getTaskRules(taskId: number): Promise<AiRule[]>;\n  getTaskRulesByType(taskId: number, type: string): Promise<AiRule[]>;\n  createRule(rule: InsertAiRule): Promise<AiRule>;\n  updateRule(id: number, rule: Partial<InsertAiRule>): Promise<AiRule | undefined>;\n  toggleRule(id: number): Promise<AiRule | undefined>;\n  deleteRule(id: number): Promise<void>;\n\n  // Task Logs and Stats\n  getTaskLogs(taskId: number, limit?: number): Promise<TaskLog[]>;\n  getTaskStats(taskId: number, days?: number): Promise<TaskStats[]>;\n  getAllLogs(limit?: number): Promise<TaskLog[]>;\n\n  // Error Logs\n  getErrorLogs(limit?: number): Promise<any[]>;\n  createErrorLog(data: any): Promise<any>;\n\n  // Bot Config / Settings\n  getBotConfig(): Promise<{ key: string; value: string }[]>;\n  getBotConfigValue(key: string): Promise<string | undefined>;\n  setBotConfigValue(key: string, value: string, description?: string): Promise<void>;\n  deleteBotConfig(key: string): Promise<void>;\n\n  // Userbot Sessions\n  getActiveUserbotSession(): Promise<UserbotSession | undefined>;\n  createUserbotSession(data: InsertUserbotSession): Promise<UserbotSession>;\n  activateUserbotSession(phoneNumber: string, sessionString: string): Promise<void>;\n  deactivateUserbotSession(): Promise<void>;\n  cancelPendingLogin(phoneNumber: string): Promise<void>;\n\n  // GitHub Settings\n  getGithubSettings(): Promise<any>;\n  linkGithubRepository(owner: string, repo: string): Promise<any>;\n  unlinkGithubRepository(): Promise<void>;\n\n  // Dashboard Stats\n  getDashboardStats(): Promise<any>;\n\n  // Advanced AI Rules - Entity Replacements\n  getEntityReplacements(taskId: number): Promise<any[]>;\n  createEntityReplacement(data: any): Promise<any>;\n  updateEntityReplacement(id: number, data: any): Promise<void>;\n  deleteEntityReplacement(id: number): Promise<void>;\n\n  // Advanced AI Rules - Context Rules\n  getContextRules(taskId: number): Promise<any[]>;\n  createContextRule(data: any): Promise<any>;\n  updateContextRule(id: number, data: any): Promise<void>;\n  deleteContextRule(id: number): Promise<void>;\n\n  // Advanced AI Rules - Training Examples\n  getTrainingExamples(taskId?: number, exampleType?: string): Promise<any[]>;\n  createTrainingExample(data: any): Promise<any>;\n  deleteTrainingExample(id: number): Promise<void>;\n\n  // Advanced AI Rules - Processing Config\n  getProcessingConfig(taskId?: number): Promise<any>;\n  saveProcessingConfig(data: any): Promise<number>;\n}\n\nexport class DbStorage implements IStorage {\n  // User Management\n  async getUser(id: number): Promise<User | undefined> {\n    const result = await database.select().from(schema.users).where(eq(schema.users.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const result = await database.select().from(schema.users).where(eq(schema.users.username, username)).limit(1);\n    return result[0];\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const result = await database.insert(schema.users).values(insertUser).returning();\n    return result[0];\n  }\n\n  // Admin Management\n  async getAdmins(): Promise<Admin[]> {\n    return await database.select().from(schema.admins).orderBy(desc(schema.admins.createdAt));\n  }\n\n  async getAdmin(telegramId: string): Promise<Admin | undefined> {\n    const result = await database.select().from(schema.admins).where(eq(schema.admins.telegramId, telegramId)).limit(1);\n    return result[0];\n  }\n\n  async createAdmin(insertAdmin: InsertAdmin): Promise<Admin> {\n    const result = await database.insert(schema.admins).values(insertAdmin).returning();\n    return result[0];\n  }\n\n  async deleteAdmin(id: number): Promise<void> {\n    await database.delete(schema.admins).where(eq(schema.admins.id, id));\n  }\n\n  // Task Management\n  async getTasks(): Promise<ForwardingTask[]> {\n    return await database.select().from(schema.forwardingTasks).orderBy(desc(schema.forwardingTasks.createdAt));\n  }\n\n  async getTask(id: number): Promise<ForwardingTask | undefined> {\n    const result = await database.select().from(schema.forwardingTasks).where(eq(schema.forwardingTasks.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createTask(insertTask: InsertForwardingTask): Promise<ForwardingTask> {\n    const result = await database.insert(schema.forwardingTasks).values(insertTask).returning();\n    return result[0];\n  }\n\n  async updateTask(id: number, updates: Partial<InsertForwardingTask>): Promise<ForwardingTask | undefined> {\n    const result = await database\n      .update(schema.forwardingTasks)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(schema.forwardingTasks.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteTask(id: number): Promise<void> {\n    await database.delete(schema.forwardingTasks).where(eq(schema.forwardingTasks.id, id));\n  }\n\n  async toggleTask(id: number): Promise<ForwardingTask | undefined> {\n    const task = await this.getTask(id);\n    if (!task) return undefined;\n    \n    const result = await database\n      .update(schema.forwardingTasks)\n      .set({ isActive: !task.isActive, updatedAt: new Date() })\n      .where(eq(schema.forwardingTasks.id, id))\n      .returning();\n    return result[0];\n  }\n\n  // Channel Management\n  async getChannels(): Promise<Channel[]> {\n    return await database.select().from(schema.channels).where(eq(schema.channels.isActive, true));\n  }\n\n  async getChannel(id: number): Promise<Channel | undefined> {\n    const result = await database.select().from(schema.channels).where(eq(schema.channels.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createChannel(insertChannel: InsertChannel): Promise<Channel> {\n    const result = await database.insert(schema.channels).values(insertChannel).returning();\n    return result[0];\n  }\n\n  async updateChannel(id: number, updates: Partial<InsertChannel>): Promise<Channel | undefined> {\n    const result = await database\n      .update(schema.channels)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(schema.channels.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteChannel(id: number): Promise<void> {\n    await database.delete(schema.channels).where(eq(schema.channels.id, id));\n  }\n\n  // AI Provider Management\n  async getAiProviders(): Promise<AiProvider[]> {\n    return await database.select().from(schema.aiProviders);\n  }\n\n  async getAiProvider(id: number): Promise<AiProvider | undefined> {\n    const result = await database.select().from(schema.aiProviders).where(eq(schema.aiProviders.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createAiProvider(insertProvider: InsertAiProvider): Promise<AiProvider> {\n    const result = await database.insert(schema.aiProviders).values(insertProvider).returning();\n    return result[0];\n  }\n\n  async updateAiProvider(id: number, updates: Partial<InsertAiProvider>): Promise<AiProvider | undefined> {\n    const result = await database\n      .update(schema.aiProviders)\n      .set(updates)\n      .where(eq(schema.aiProviders.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async getAiProviderByName(name: string): Promise<AiProvider | undefined> {\n    const result = await database.select().from(schema.aiProviders).where(eq(schema.aiProviders.name, name)).limit(1);\n    return result[0];\n  }\n\n  async toggleAiProvider(id: number): Promise<AiProvider | undefined> {\n    const provider = await this.getAiProvider(id);\n    if (!provider) return undefined;\n    \n    const result = await database\n      .update(schema.aiProviders)\n      .set({ isActive: !provider.isActive })\n      .where(eq(schema.aiProviders.id, id))\n      .returning();\n    return result[0];\n  }\n\n  // AI Model Management\n  async getAiModels(): Promise<AiModel[]> {\n    return await database.select().from(schema.aiModels).where(eq(schema.aiModels.isActive, true));\n  }\n\n  async getAiModelsByProvider(providerId: number): Promise<AiModel[]> {\n    return await database\n      .select()\n      .from(schema.aiModels)\n      .where(and(eq(schema.aiModels.providerId, providerId), eq(schema.aiModels.isActive, true)));\n  }\n\n  async createAiModel(model: InsertAiModel): Promise<AiModel> {\n    const result = await database.insert(schema.aiModels).values(model).returning();\n    return result[0];\n  }\n\n  async getAiModel(id: number): Promise<AiModel | undefined> {\n    const result = await database.select().from(schema.aiModels).where(eq(schema.aiModels.id, id)).limit(1);\n    return result[0];\n  }\n\n  async updateModel(id: number, data: Partial<InsertAiModel>): Promise<AiModel | undefined> {\n    const result = await database\n      .update(schema.aiModels)\n      .set(data)\n      .where(eq(schema.aiModels.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async getModelsByProvider(providerId: number): Promise<AiModel[]> {\n    return await database\n      .select()\n      .from(schema.aiModels)\n      .where(eq(schema.aiModels.providerId, providerId));\n  }\n\n  // AI Usage Statistics\n  async getUsageStats(filters: {\n    providerId?: number;\n    modelId?: number;\n    taskId?: number;\n    dateFrom?: Date;\n    dateTo?: Date;\n  }): Promise<AiUsageStats[]> {\n    const conditions = [];\n    \n    if (filters.providerId) {\n      conditions.push(eq(schema.aiUsageStats.providerId, filters.providerId));\n    }\n    if (filters.modelId) {\n      conditions.push(eq(schema.aiUsageStats.modelId, filters.modelId));\n    }\n    if (filters.taskId) {\n      conditions.push(eq(schema.aiUsageStats.taskId, filters.taskId));\n    }\n    if (filters.dateFrom) {\n      conditions.push(sql`${schema.aiUsageStats.usageDate} >= ${filters.dateFrom}`);\n    }\n    if (filters.dateTo) {\n      conditions.push(sql`${schema.aiUsageStats.usageDate} <= ${filters.dateTo}`);\n    }\n    \n    if (conditions.length === 0) {\n      return await database\n        .select()\n        .from(schema.aiUsageStats)\n        .orderBy(desc(schema.aiUsageStats.usageDate))\n        .limit(100);\n    }\n    \n    return await database\n      .select()\n      .from(schema.aiUsageStats)\n      .where(and(...conditions))\n      .orderBy(desc(schema.aiUsageStats.usageDate))\n      .limit(100);\n  }\n\n  async getUsageStatsSummary(filters: {\n    providerId?: number;\n    dateFrom?: Date;\n    dateTo?: Date;\n  }): Promise<{\n    totalRequests: number;\n    totalTokensInput: number;\n    totalTokensOutput: number;\n    totalCost: string;\n    byModel: Array<{ modelName: string; requests: number; tokens: number }>;\n  }> {\n    const conditions = [];\n    \n    if (filters.providerId) {\n      conditions.push(eq(schema.aiUsageStats.providerId, filters.providerId));\n    }\n    if (filters.dateFrom) {\n      conditions.push(sql`${schema.aiUsageStats.usageDate} >= ${filters.dateFrom}`);\n    }\n    if (filters.dateTo) {\n      conditions.push(sql`${schema.aiUsageStats.usageDate} <= ${filters.dateTo}`);\n    }\n    \n    let stats: AiUsageStats[];\n    if (conditions.length === 0) {\n      stats = await database.select().from(schema.aiUsageStats);\n    } else {\n      stats = await database\n        .select()\n        .from(schema.aiUsageStats)\n        .where(and(...conditions));\n    }\n    \n    let totalRequests = 0;\n    let totalTokensInput = 0;\n    let totalTokensOutput = 0;\n    let totalCost = 0;\n    const modelStats: Record<string, { requests: number; tokens: number }> = {};\n    \n    for (const stat of stats) {\n      totalRequests += stat.requestCount;\n      totalTokensInput += stat.totalTokensInput;\n      totalTokensOutput += stat.totalTokensOutput;\n      totalCost += parseFloat(stat.totalCost || '0');\n      \n      if (!modelStats[stat.modelName]) {\n        modelStats[stat.modelName] = { requests: 0, tokens: 0 };\n      }\n      modelStats[stat.modelName].requests += stat.requestCount;\n      modelStats[stat.modelName].tokens += stat.totalTokensInput + stat.totalTokensOutput;\n    }\n    \n    const byModel = Object.entries(modelStats).map(([modelName, data]) => ({\n      modelName,\n      requests: data.requests,\n      tokens: data.tokens,\n    }));\n    \n    return {\n      totalRequests,\n      totalTokensInput,\n      totalTokensOutput,\n      totalCost: totalCost.toFixed(6),\n      byModel,\n    };\n  }\n\n  async getModelUsageStats(modelId: number): Promise<AiUsageStats[]> {\n    return await database\n      .select()\n      .from(schema.aiUsageStats)\n      .where(eq(schema.aiUsageStats.modelId, modelId))\n      .orderBy(desc(schema.aiUsageStats.usageDate))\n      .limit(30);\n  }\n\n  async recordUsage(data: InsertAiUsageStats): Promise<AiUsageStats> {\n    const result = await database\n      .insert(schema.aiUsageStats)\n      .values(data)\n      .returning();\n    return result[0];\n  }\n\n  // AI Rule Management\n  async getTaskRules(taskId: number): Promise<AiRule[]> {\n    return await database\n      .select()\n      .from(schema.aiRules)\n      .where(eq(schema.aiRules.taskId, taskId))\n      .orderBy(desc(schema.aiRules.priority));\n  }\n\n  async getTaskRulesByType(taskId: number, type: string): Promise<AiRule[]> {\n    return await database\n      .select()\n      .from(schema.aiRules)\n      .where(and(eq(schema.aiRules.taskId, taskId), eq(schema.aiRules.type, type)))\n      .orderBy(desc(schema.aiRules.priority));\n  }\n\n  async createRule(insertRule: InsertAiRule): Promise<AiRule> {\n    const result = await database.insert(schema.aiRules).values(insertRule).returning();\n    return result[0];\n  }\n\n  async updateRule(id: number, updates: Partial<InsertAiRule>): Promise<AiRule | undefined> {\n    // Filter out fields that should not be updated (createdAt, id, taskId)\n    const { createdAt, id: _, taskId, ...filteredUpdates } = updates as any;\n    \n    const result = await database\n      .update(schema.aiRules)\n      .set(filteredUpdates)\n      .where(eq(schema.aiRules.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async toggleRule(id: number): Promise<AiRule | undefined> {\n    const rule = await database.select().from(schema.aiRules).where(eq(schema.aiRules.id, id)).limit(1);\n    if (!rule[0]) return undefined;\n    \n    const result = await database\n      .update(schema.aiRules)\n      .set({ isActive: !rule[0].isActive })\n      .where(eq(schema.aiRules.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteRule(id: number): Promise<void> {\n    await database.delete(schema.aiRules).where(eq(schema.aiRules.id, id));\n  }\n\n  // Task Logs and Stats\n  async getTaskLogs(taskId: number, limit: number = 100): Promise<TaskLog[]> {\n    return await database\n      .select()\n      .from(schema.taskLogs)\n      .where(eq(schema.taskLogs.taskId, taskId))\n      .orderBy(desc(schema.taskLogs.timestamp))\n      .limit(limit);\n  }\n\n  async getTaskStats(taskId: number, days: number = 7): Promise<TaskStats[]> {\n    return await database\n      .select()\n      .from(schema.taskStats)\n      .where(eq(schema.taskStats.taskId, taskId))\n      .orderBy(desc(schema.taskStats.date))\n      .limit(days);\n  }\n\n  async getAllLogs(limit: number = 100): Promise<TaskLog[]> {\n    return await database\n      .select()\n      .from(schema.taskLogs)\n      .orderBy(desc(schema.taskLogs.timestamp))\n      .limit(limit);\n  }\n\n  // Error Logs\n  async getErrorLogs(limit: number = 100): Promise<any[]> {\n    return await database\n      .select()\n      .from(schema.errorLogs)\n      .orderBy(desc(schema.errorLogs.timestamp))\n      .limit(limit);\n  }\n\n  async createErrorLog(data: any): Promise<any> {\n    const result = await database\n      .insert(schema.errorLogs)\n      .values(data)\n      .returning();\n    return result[0];\n  }\n\n  // Bot Config / Settings\n  async getBotConfig(): Promise<{ key: string; value: string }[]> {\n    const configs = await database.select().from(schema.botConfig);\n    return configs.map(c => ({ key: c.key, value: c.value }));\n  }\n\n  async getBotConfigValue(key: string): Promise<string | undefined> {\n    const result = await database.select().from(schema.botConfig).where(eq(schema.botConfig.key, key)).limit(1);\n    return result[0]?.value;\n  }\n\n  async setBotConfigValue(key: string, value: string, description?: string): Promise<void> {\n    await database\n      .insert(schema.botConfig)\n      .values({ key, value, description })\n      .onConflictDoUpdate({\n        target: schema.botConfig.key,\n        set: { value, description, updatedAt: new Date() }\n      });\n  }\n\n  async deleteBotConfig(key: string): Promise<void> {\n    await database.delete(schema.botConfig).where(eq(schema.botConfig.key, key));\n  }\n\n  // Userbot Sessions\n  async getActiveUserbotSession(): Promise<UserbotSession | undefined> {\n    const result = await database\n      .select()\n      .from(schema.userbotSessions)\n      .where(\n        and(\n          eq(schema.userbotSessions.isActive, true),\n          eq(schema.userbotSessions.isPrimary, true)\n        )\n      )\n      .limit(1);\n    return result[0];\n  }\n\n  async createUserbotSession(data: InsertUserbotSession): Promise<UserbotSession> {\n    // Deactivate any existing sessions for this phone number first\n    await database\n      .update(schema.userbotSessions)\n      .set({ isActive: false, isPrimary: false })\n      .where(eq(schema.userbotSessions.phoneNumber, data.phoneNumber));\n    \n    const result = await database\n      .insert(schema.userbotSessions)\n      .values({\n        ...data,\n        status: \"pending\",\n      })\n      .returning();\n    return result[0];\n  }\n\n  async activateUserbotSession(phoneNumber: string, sessionString: string): Promise<void> {\n    // First deactivate all other sessions\n    await database\n      .update(schema.userbotSessions)\n      .set({ isActive: false, isPrimary: false })\n      .where(eq(schema.userbotSessions.isActive, true));\n    \n    // Then activate the new session\n    await database\n      .update(schema.userbotSessions)\n      .set({\n        sessionString,\n        isActive: true,\n        isPrimary: true,\n        status: \"active\",\n        lastLoginAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(schema.userbotSessions.phoneNumber, phoneNumber));\n  }\n\n  async deactivateUserbotSession(): Promise<void> {\n    await database\n      .update(schema.userbotSessions)\n      .set({\n        isActive: false,\n        isPrimary: false,\n        status: \"expired\",\n        sessionString: null,\n        loginState: null,\n        updatedAt: new Date(),\n      })\n      .where(eq(schema.userbotSessions.isActive, true));\n  }\n\n  async cancelPendingLogin(phoneNumber: string): Promise<void> {\n    await database\n      .update(schema.userbotSessions)\n      .set({\n        status: \"cancelled\",\n        loginState: null,\n        updatedAt: new Date(),\n      })\n      .where(\n        and(\n          eq(schema.userbotSessions.phoneNumber, phoneNumber),\n          sql`${schema.userbotSessions.status} IN ('awaiting_code', 'awaiting_password')`\n        )\n      );\n  }\n\n  // GitHub Settings\n  async getGithubSettings(): Promise<any> {\n    const result = await database.select().from(schema.githubSettings).limit(1);\n    return result[0] || null;\n  }\n\n  async linkGithubRepository(owner: string, repo: string): Promise<any> {\n    const existing = await this.getGithubSettings();\n    if (existing) {\n      const result = await database\n        .update(schema.githubSettings)\n        .set({ repoOwner: owner, repoName: repo, updatedAt: new Date() })\n        .where(eq(schema.githubSettings.id, existing.id))\n        .returning();\n      return result[0];\n    } else {\n      const result = await database\n        .insert(schema.githubSettings)\n        .values({ repoOwner: owner, repoName: repo })\n        .returning();\n      return result[0];\n    }\n  }\n\n  async unlinkGithubRepository(): Promise<void> {\n    await database.delete(schema.githubSettings);\n  }\n\n  // Dashboard Stats\n  async getDashboardStats(): Promise<any> {\n    const tasks = await this.getTasks();\n    const channels = await this.getChannels();\n    \n    const activeTasks = tasks.filter(t => t.isActive).length;\n    const totalForwarded = tasks.reduce((sum, t) => sum + t.totalForwarded, 0);\n    \n    return {\n      totalTasks: tasks.length,\n      activeTasks,\n      inactiveTasks: tasks.length - activeTasks,\n      totalChannels: channels.length,\n      totalForwarded,\n      aiEnabledTasks: tasks.filter(t => t.aiEnabled).length,\n      videoEnabledTasks: tasks.filter(t => t.videoProcessingEnabled).length,\n    };\n  }\n\n  // ============ Advanced AI Rules - Entity Replacements ============\n  async getEntityReplacements(taskId: number): Promise<any[]> {\n    return await database\n      .select()\n      .from(schema.aiEntityReplacements)\n      .where(\n        and(\n          eq(schema.aiEntityReplacements.taskId, taskId),\n          eq(schema.aiEntityReplacements.isActive, true)\n        )\n      )\n      .orderBy(desc(schema.aiEntityReplacements.priority));\n  }\n\n  async createEntityReplacement(data: any): Promise<any> {\n    const result = await database\n      .insert(schema.aiEntityReplacements)\n      .values({\n        taskId: data.taskId,\n        entityType: data.entityType || 'custom',\n        originalText: data.originalText,\n        replacementText: data.replacementText,\n        caseSensitive: data.caseSensitive ?? false,\n        useContext: data.useContext ?? true,\n        isActive: data.isActive ?? true,\n        priority: data.priority ?? 0,\n      })\n      .returning();\n    return result[0];\n  }\n\n  async updateEntityReplacement(id: number, data: any): Promise<void> {\n    const { createdAt, updatedAt, id: _, ...updateData } = data;\n    await database\n      .update(schema.aiEntityReplacements)\n      .set({\n        ...updateData,\n        updatedAt: new Date(),\n      })\n      .where(eq(schema.aiEntityReplacements.id, id));\n  }\n\n  async deleteEntityReplacement(id: number): Promise<void> {\n    await database\n      .delete(schema.aiEntityReplacements)\n      .where(eq(schema.aiEntityReplacements.id, id));\n  }\n\n  // ============ Advanced AI Rules - Context Rules ============\n  async getContextRules(taskId: number): Promise<any[]> {\n    return await database\n      .select()\n      .from(schema.aiContextRules)\n      .where(\n        and(\n          eq(schema.aiContextRules.taskId, taskId),\n          eq(schema.aiContextRules.isActive, true)\n        )\n      )\n      .orderBy(desc(schema.aiContextRules.priority));\n  }\n\n  async createContextRule(data: any): Promise<any> {\n    const result = await database\n      .insert(schema.aiContextRules)\n      .values({\n        taskId: data.taskId,\n        ruleType: data.ruleType,\n        triggerPattern: data.triggerPattern || null,\n        targetSentiment: data.targetSentiment || 'neutral',\n        instructions: data.instructions,\n        examples: data.examples || null,\n        isActive: data.isActive ?? true,\n        priority: data.priority ?? 0,\n      })\n      .returning();\n    return result[0];\n  }\n\n  async updateContextRule(id: number, data: any): Promise<void> {\n    const { createdAt, updatedAt, id: _, ...updateData } = data;\n    await database\n      .update(schema.aiContextRules)\n      .set({\n        ...updateData,\n        updatedAt: new Date(),\n      })\n      .where(eq(schema.aiContextRules.id, id));\n  }\n\n  async deleteContextRule(id: number): Promise<void> {\n    await database\n      .delete(schema.aiContextRules)\n      .where(eq(schema.aiContextRules.id, id));\n  }\n\n  // ============ Advanced AI Rules - Training Examples ============\n  async getTrainingExamples(taskId?: number, exampleType?: string): Promise<any[]> {\n    let query = database.select().from(schema.aiTrainingExamples);\n    \n    if (taskId && exampleType) {\n      return await query.where(\n        and(\n          eq(schema.aiTrainingExamples.taskId, taskId),\n          eq(schema.aiTrainingExamples.exampleType, exampleType),\n          eq(schema.aiTrainingExamples.isActive, true)\n        )\n      ).orderBy(desc(schema.aiTrainingExamples.useCount));\n    } else if (taskId) {\n      return await query.where(\n        and(\n          eq(schema.aiTrainingExamples.taskId, taskId),\n          eq(schema.aiTrainingExamples.isActive, true)\n        )\n      ).orderBy(desc(schema.aiTrainingExamples.useCount));\n    } else if (exampleType) {\n      return await query.where(\n        and(\n          eq(schema.aiTrainingExamples.exampleType, exampleType),\n          eq(schema.aiTrainingExamples.isActive, true)\n        )\n      ).orderBy(desc(schema.aiTrainingExamples.useCount));\n    }\n    \n    return await query\n      .where(eq(schema.aiTrainingExamples.isActive, true))\n      .orderBy(desc(schema.aiTrainingExamples.useCount))\n      .limit(100);\n  }\n\n  async createTrainingExample(data: any): Promise<any> {\n    if (!data.taskId) {\n      throw new Error(\"taskId is required for training examples\");\n    }\n    \n    const result = await database\n      .insert(schema.aiTrainingExamples)\n      .values({\n        taskId: data.taskId,\n        exampleType: data.exampleType,\n        inputText: data.inputText,\n        expectedOutput: data.expectedOutput,\n        explanation: data.explanation || null,\n        tags: data.tags || null,\n        isActive: data.isActive ?? true,\n      })\n      .returning();\n    return result[0];\n  }\n\n  async updateTrainingExample(id: number, data: any): Promise<any> {\n    const updateData: any = {};\n    \n    if (data.exampleType !== undefined) updateData.exampleType = data.exampleType;\n    if (data.inputText !== undefined) updateData.inputText = data.inputText;\n    if (data.expectedOutput !== undefined) updateData.expectedOutput = data.expectedOutput;\n    if (data.explanation !== undefined) updateData.explanation = data.explanation;\n    if (data.tags !== undefined) updateData.tags = data.tags;\n    if (data.isActive !== undefined) updateData.isActive = data.isActive;\n    \n    const result = await database\n      .update(schema.aiTrainingExamples)\n      .set(updateData)\n      .where(eq(schema.aiTrainingExamples.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteTrainingExample(id: number): Promise<void> {\n    await database\n      .delete(schema.aiTrainingExamples)\n      .where(eq(schema.aiTrainingExamples.id, id));\n  }\n\n  // ============ Advanced AI Rules - Processing Config ============\n  async getProcessingConfig(taskId?: number): Promise<any> {\n    if (taskId) {\n      const result = await database\n        .select()\n        .from(schema.aiProcessingConfig)\n        .where(eq(schema.aiProcessingConfig.taskId, taskId))\n        .limit(1);\n      if (result[0]) return result[0];\n    }\n    \n    const globalConfig = await database\n      .select()\n      .from(schema.aiProcessingConfig)\n      .where(\n        and(\n          eq(schema.aiProcessingConfig.configType, 'global'),\n          sql`${schema.aiProcessingConfig.taskId} IS NULL`\n        )\n      )\n      .limit(1);\n    \n    return globalConfig[0] || null;\n  }\n\n  async saveProcessingConfig(data: any): Promise<number> {\n    const taskId = data.taskId || null;\n    const configType = data.configType || (taskId ? 'task_specific' : 'global');\n    \n    let existing = null;\n    if (taskId) {\n      const result = await database\n        .select()\n        .from(schema.aiProcessingConfig)\n        .where(eq(schema.aiProcessingConfig.taskId, taskId))\n        .limit(1);\n      existing = result[0];\n    } else {\n      const result = await database\n        .select()\n        .from(schema.aiProcessingConfig)\n        .where(\n          and(\n            eq(schema.aiProcessingConfig.configType, 'global'),\n            sql`${schema.aiProcessingConfig.taskId} IS NULL`\n          )\n        )\n        .limit(1);\n      existing = result[0];\n    }\n    \n    if (existing) {\n      await database\n        .update(schema.aiProcessingConfig)\n        .set({\n          enableEntityExtraction: data.enableEntityExtraction ?? true,\n          enableSentimentAnalysis: data.enableSentimentAnalysis ?? true,\n          enableKeywordDetection: data.enableKeywordDetection ?? true,\n          maxRetries: data.maxRetries ?? 3,\n          timeoutSeconds: data.timeoutSeconds ?? 60,\n          preserveFormatting: data.preserveFormatting ?? true,\n          enableOutputValidation: data.enableOutputValidation ?? true,\n          enableRuleVerification: data.enableRuleVerification ?? true,\n          outputFormat: data.outputFormat ?? 'markdown',\n          temperature: data.temperature?.toString() ?? '0.7',\n          qualityLevel: data.qualityLevel ?? 'balanced',\n          updatedAt: new Date(),\n        })\n        .where(eq(schema.aiProcessingConfig.id, existing.id));\n      return existing.id;\n    } else {\n      const result = await database\n        .insert(schema.aiProcessingConfig)\n        .values({\n          taskId: taskId,\n          configType: configType,\n          enableEntityExtraction: data.enableEntityExtraction ?? true,\n          enableSentimentAnalysis: data.enableSentimentAnalysis ?? true,\n          enableKeywordDetection: data.enableKeywordDetection ?? true,\n          maxRetries: data.maxRetries ?? 3,\n          timeoutSeconds: data.timeoutSeconds ?? 60,\n          preserveFormatting: data.preserveFormatting ?? true,\n          enableOutputValidation: data.enableOutputValidation ?? true,\n          enableRuleVerification: data.enableRuleVerification ?? true,\n          outputFormat: data.outputFormat ?? 'markdown',\n          temperature: data.temperature?.toString() ?? '0.7',\n          qualityLevel: data.qualityLevel ?? 'balanced',\n        })\n        .returning();\n      return result[0].id;\n    }\n  }\n\n  // ============ AI Content Filters ============\n  async getContentFilters(taskId: number): Promise<any[]> {\n    return await database\n      .select()\n      .from(schema.aiContentFilters)\n      .where(\n        and(\n          eq(schema.aiContentFilters.taskId, taskId),\n          eq(schema.aiContentFilters.isActive, true)\n        )\n      )\n      .orderBy(desc(schema.aiContentFilters.priority));\n  }\n\n  async createContentFilter(data: any): Promise<any> {\n    const result = await database\n      .insert(schema.aiContentFilters)\n      .values({\n        taskId: data.taskId,\n        name: data.filterName || data.name,\n        filterType: data.filterType || 'block',\n        matchType: data.matchType,\n        pattern: data.pattern,\n        contextDescription: data.contextDescription,\n        sentimentTarget: data.sentimentTarget,\n        action: data.action || 'skip',\n        modifyInstructions: data.modifyInstructions,\n        isActive: data.isActive ?? true,\n        priority: data.priority ?? 0,\n      })\n      .returning();\n    return result[0];\n  }\n\n  async updateContentFilter(id: number, data: any): Promise<void> {\n    const { createdAt, updatedAt, id: _, ...updateData } = data;\n    await database\n      .update(schema.aiContentFilters)\n      .set({\n        ...updateData,\n        updatedAt: new Date(),\n      })\n      .where(eq(schema.aiContentFilters.id, id));\n  }\n\n  async deleteContentFilter(id: number): Promise<void> {\n    await database\n      .delete(schema.aiContentFilters)\n      .where(eq(schema.aiContentFilters.id, id));\n  }\n\n  async incrementFilterMatchCount(id: number): Promise<void> {\n    await database\n      .update(schema.aiContentFilters)\n      .set({ matchCount: sql`${schema.aiContentFilters.matchCount} + 1` })\n      .where(eq(schema.aiContentFilters.id, id));\n  }\n\n  // ============ AI Publishing Templates ============\n  async getPublishingTemplates(taskId: number): Promise<any[]> {\n    const templates = await database\n      .select()\n      .from(schema.aiPublishingTemplates)\n      .where(\n        and(\n          eq(schema.aiPublishingTemplates.taskId, taskId),\n          eq(schema.aiPublishingTemplates.isActive, true)\n        )\n      )\n      .orderBy(desc(schema.aiPublishingTemplates.isDefault));\n    \n    // Load custom fields for each template\n    const templatesWithFields = await Promise.all(\n      templates.map(async (template) => {\n        const customFields = await this.getTemplateCustomFields(template.id);\n        return { ...template, customFields };\n      })\n    );\n    \n    return templatesWithFields;\n  }\n\n  async getDefaultTemplate(taskId: number): Promise<any> {\n    const result = await database\n      .select()\n      .from(schema.aiPublishingTemplates)\n      .where(\n        and(\n          eq(schema.aiPublishingTemplates.taskId, taskId),\n          eq(schema.aiPublishingTemplates.isDefault, true),\n          eq(schema.aiPublishingTemplates.isActive, true)\n        )\n      )\n      .limit(1);\n    \n    if (!result[0]) return null;\n    \n    // Load custom fields for the template\n    const customFields = await this.getTemplateCustomFields(result[0].id);\n    return { ...result[0], customFields };\n  }\n\n  async createPublishingTemplate(data: any): Promise<any> {\n    if (data.isDefault) {\n      await database\n        .update(schema.aiPublishingTemplates)\n        .set({ isDefault: false })\n        .where(eq(schema.aiPublishingTemplates.taskId, data.taskId));\n    }\n    \n    const result = await database\n      .insert(schema.aiPublishingTemplates)\n      .values({\n        taskId: data.taskId,\n        name: data.name,\n        isDefault: data.isDefault ?? false,\n        templateType: data.templateType || 'custom',\n        headerText: data.headerText || null,\n        headerFormatting: data.headerFormatting || 'none',\n        footerText: data.footerText || null,\n        footerFormatting: data.footerFormatting || 'none',\n        fieldSeparator: data.fieldSeparator || '\\n',\n        useNewlineAfterHeader: data.useNewlineAfterHeader ?? true,\n        useNewlineBeforeFooter: data.useNewlineBeforeFooter ?? true,\n        maxLength: data.maxLength || null,\n        extractionPrompt: data.extractionPrompt || null,\n        isActive: data.isActive ?? true,\n      })\n      .returning();\n    \n    // Create custom fields if provided\n    if (data.customFields && Array.isArray(data.customFields)) {\n      for (const field of data.customFields) {\n        await this.createTemplateCustomField({\n          ...field,\n          templateId: result[0].id\n        });\n      }\n    }\n    \n    return result[0];\n  }\n\n  async updatePublishingTemplate(id: number, data: any): Promise<void> {\n    if (data.isDefault && data.taskId) {\n      await database\n        .update(schema.aiPublishingTemplates)\n        .set({ isDefault: false })\n        .where(eq(schema.aiPublishingTemplates.taskId, data.taskId));\n    }\n    \n    const { customFields, createdAt, updatedAt, id: _, ...templateData } = data;\n    \n    await database\n      .update(schema.aiPublishingTemplates)\n      .set({ ...templateData, updatedAt: new Date() })\n      .where(eq(schema.aiPublishingTemplates.id, id));\n    \n    if (customFields && Array.isArray(customFields)) {\n      await database\n        .delete(schema.templateCustomFields)\n        .where(eq(schema.templateCustomFields.templateId, id));\n      \n      for (let i = 0; i < customFields.length; i++) {\n        const field = customFields[i];\n        await this.createTemplateCustomField({\n          templateId: id,\n          fieldName: field.fieldName,\n          fieldLabel: field.fieldLabel,\n          extractionInstructions: field.extractionInstructions,\n          defaultValue: field.defaultValue,\n          useDefaultIfEmpty: field.useDefaultIfEmpty,\n          formatting: field.formatting,\n          displayOrder: i,\n          showLabel: field.showLabel,\n          labelSeparator: field.labelSeparator,\n          prefix: field.prefix,\n          suffix: field.suffix,\n          fieldType: field.fieldType,\n          isActive: field.isActive ?? true\n        });\n      }\n    }\n  }\n\n  async deletePublishingTemplate(id: number): Promise<void> {\n    // Custom fields are deleted automatically via cascade\n    await database\n      .delete(schema.aiPublishingTemplates)\n      .where(eq(schema.aiPublishingTemplates.id, id));\n  }\n\n  // ============ Template Custom Fields ============\n  async getTemplateCustomFields(templateId: number): Promise<any[]> {\n    return await database\n      .select()\n      .from(schema.templateCustomFields)\n      .where(\n        and(\n          eq(schema.templateCustomFields.templateId, templateId),\n          eq(schema.templateCustomFields.isActive, true)\n        )\n      )\n      .orderBy(schema.templateCustomFields.displayOrder);\n  }\n\n  async getTemplateCustomField(id: number): Promise<any> {\n    const result = await database\n      .select()\n      .from(schema.templateCustomFields)\n      .where(eq(schema.templateCustomFields.id, id))\n      .limit(1);\n    return result[0] || null;\n  }\n\n  async createTemplateCustomField(data: any): Promise<any> {\n    const result = await database\n      .insert(schema.templateCustomFields)\n      .values({\n        templateId: data.templateId,\n        fieldName: data.fieldName,\n        fieldLabel: data.fieldLabel,\n        extractionInstructions: data.extractionInstructions,\n        defaultValue: data.defaultValue || null,\n        useDefaultIfEmpty: data.useDefaultIfEmpty ?? true,\n        formatting: data.formatting || 'none',\n        displayOrder: data.displayOrder || 0,\n        showLabel: data.showLabel ?? false,\n        labelSeparator: data.labelSeparator || ': ',\n        prefix: data.prefix || null,\n        suffix: data.suffix || null,\n        fieldType: data.fieldType || 'extracted',\n        isActive: data.isActive ?? true,\n      })\n      .returning();\n    return result[0];\n  }\n\n  async updateTemplateCustomField(id: number, data: any): Promise<void> {\n    const { createdAt, updatedAt, id: _, ...updateData } = data;\n    await database\n      .update(schema.templateCustomFields)\n      .set({\n        ...updateData,\n        updatedAt: new Date(),\n      })\n      .where(eq(schema.templateCustomFields.id, id));\n  }\n\n  async deleteTemplateCustomField(id: number): Promise<void> {\n    await database\n      .delete(schema.templateCustomFields)\n      .where(eq(schema.templateCustomFields.id, id));\n  }\n\n  async reorderTemplateCustomFields(templateId: number, fieldOrders: { id: number; order: number }[]): Promise<void> {\n    for (const { id, order } of fieldOrders) {\n      await database\n        .update(schema.templateCustomFields)\n        .set({ displayOrder: order })\n        .where(\n          and(\n            eq(schema.templateCustomFields.id, id),\n            eq(schema.templateCustomFields.templateId, templateId)\n          )\n        );\n    }\n  }\n\n  // ============ Message Archive ============\n  async getArchiveMessages(filters: {\n    taskId?: number;\n    search?: string;\n    classification?: string;\n    province?: string;\n    specialist?: string;\n    newsType?: string;\n    status?: string;\n    dateFrom?: string;\n    dateTo?: string;\n    isPinned?: boolean;\n    isFlagged?: boolean;\n    hasMedia?: boolean;\n    limit?: number;\n    offset?: number;\n    sortBy?: string;\n    sortOrder?: 'asc' | 'desc';\n  } = {}): Promise<{ messages: any[]; total: number }> {\n    const conditions: any[] = [];\n    \n    if (filters.taskId) {\n      conditions.push(eq(schema.messageArchive.taskId, filters.taskId));\n    }\n    if (filters.classification) {\n      conditions.push(eq(schema.messageArchive.classification, filters.classification));\n    }\n    if (filters.province) {\n      conditions.push(eq(schema.messageArchive.province, filters.province));\n    }\n    if (filters.specialist) {\n      conditions.push(eq(schema.messageArchive.specialist, filters.specialist));\n    }\n    if (filters.newsType) {\n      conditions.push(eq(schema.messageArchive.newsType, filters.newsType));\n    }\n    if (filters.status) {\n      conditions.push(eq(schema.messageArchive.status, filters.status));\n    }\n    if (filters.isPinned !== undefined) {\n      conditions.push(eq(schema.messageArchive.isPinned, filters.isPinned));\n    }\n    if (filters.isFlagged !== undefined) {\n      conditions.push(eq(schema.messageArchive.isFlagged, filters.isFlagged));\n    }\n    if (filters.hasMedia !== undefined) {\n      conditions.push(eq(schema.messageArchive.hasMedia, filters.hasMedia));\n    }\n    if (filters.dateFrom) {\n      conditions.push(sql`${schema.messageArchive.createdAt} >= ${filters.dateFrom}::timestamp`);\n    }\n    if (filters.dateTo) {\n      conditions.push(sql`${schema.messageArchive.createdAt} <= ${filters.dateTo}::timestamp`);\n    }\n    if (filters.search) {\n      conditions.push(sql`(\n        ${schema.messageArchive.title} ILIKE ${'%' + filters.search + '%'} OR\n        ${schema.messageArchive.originalText} ILIKE ${'%' + filters.search + '%'} OR\n        ${schema.messageArchive.processedText} ILIKE ${'%' + filters.search + '%'} OR\n        ${schema.messageArchive.publishedText} ILIKE ${'%' + filters.search + '%'}\n      )`);\n    }\n\n    const whereClause = conditions.length > 0 ? and(...conditions) : undefined;\n    \n    // Get total count\n    const countResult = await database\n      .select({ count: sql<number>`count(*)::int` })\n      .from(schema.messageArchive)\n      .where(whereClause);\n    const total = countResult[0]?.count || 0;\n\n    // Get messages with pagination\n    let query = database\n      .select()\n      .from(schema.messageArchive)\n      .where(whereClause);\n\n    // Apply sorting\n    const sortColumn = filters.sortBy === 'serialNumber' ? schema.messageArchive.serialNumber :\n                       filters.sortBy === 'title' ? schema.messageArchive.title :\n                       schema.messageArchive.createdAt;\n    \n    if (filters.sortOrder === 'asc') {\n      query = query.orderBy(sortColumn) as any;\n    } else {\n      query = query.orderBy(desc(sortColumn)) as any;\n    }\n\n    // Apply pagination\n    const limit = filters.limit || 50;\n    const offset = filters.offset || 0;\n    query = query.limit(limit).offset(offset) as any;\n\n    const messages = await query;\n    return { messages, total };\n  }\n\n  async getArchiveMessage(id: number): Promise<any> {\n    const result = await database\n      .select()\n      .from(schema.messageArchive)\n      .where(eq(schema.messageArchive.id, id))\n      .limit(1);\n    return result[0] || null;\n  }\n\n  async getArchiveMessageBySerial(taskId: number, serialNumber: number): Promise<any> {\n    const result = await database\n      .select()\n      .from(schema.messageArchive)\n      .where(\n        and(\n          eq(schema.messageArchive.taskId, taskId),\n          eq(schema.messageArchive.serialNumber, serialNumber)\n        )\n      )\n      .limit(1);\n    return result[0] || null;\n  }\n\n  async createArchiveMessage(data: any): Promise<any> {\n    const result = await database\n      .insert(schema.messageArchive)\n      .values({\n        taskId: data.taskId,\n        serialNumber: data.serialNumber,\n        sourceMessageId: data.sourceMessageId,\n        sourceChannelId: data.sourceChannelId,\n        sourceChannelTitle: data.sourceChannelTitle,\n        targetChannelId: data.targetChannelId,\n        targetChannelTitle: data.targetChannelTitle,\n        targetMessageId: data.targetMessageId,\n        title: data.title,\n        originalText: data.originalText,\n        processedText: data.processedText,\n        publishedText: data.publishedText,\n        telegraphUrl: data.telegraphUrl,\n        telegraphTitle: data.telegraphTitle,\n        classification: data.classification,\n        newsType: data.newsType,\n        province: data.province,\n        specialist: data.specialist,\n        tags: data.tags,\n        extractedFields: data.extractedFields,\n        hasMedia: data.hasMedia || false,\n        mediaType: data.mediaType,\n        mediaCount: data.mediaCount || 0,\n        mediaGroupId: data.mediaGroupId,\n        processingDuration: data.processingDuration,\n        aiProvider: data.aiProvider,\n        aiModel: data.aiModel,\n        templateName: data.templateName,\n        status: data.status || 'published',\n        isEdited: data.isEdited || false,\n        isPinned: data.isPinned || false,\n        isFlagged: data.isFlagged || false,\n        flagReason: data.flagReason,\n        notes: data.notes,\n      })\n      .returning();\n    return result[0];\n  }\n\n  async updateArchiveMessage(id: number, data: any): Promise<any> {\n    // Get current message to merge extractedFields\n    const current = await this.getArchiveMessage(id);\n    \n    const updateData: any = { ...data, updatedAt: new Date() };\n    \n    // Mark as edited if content changed\n    if (data.title !== undefined || data.processedText !== undefined || data.publishedText !== undefined) {\n      updateData.isEdited = true;\n      updateData.editedAt = new Date();\n    }\n    \n    // Handle extractedFields - merge with existing if partial update\n    if (data.extractedFields) {\n      // If extractedFields is provided, merge with existing\n      const currentExtracted = current?.extractedFields || {};\n      updateData.extractedFields = { ...currentExtracted, ...data.extractedFields };\n    }\n    \n    // Sync individual fields to extractedFields for consistency\n    const fieldsToSync = ['classification', 'newsType', 'province', 'specialist', 'title'];\n    const arabicFieldMap: Record<string, string> = {\n      'classification': 'ÿßŸÑÿ™ÿµŸÜŸäŸÅ_',\n      'newsType': 'ŸÜŸàÿπ_ÿßŸÑÿÆÿ®ÿ±',\n      'province': 'ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏Ÿá_',\n      'specialist': 'ÿßŸÑŸÖÿÆÿ™ÿµ',\n      'title': 'ÿßŸÑÿπŸÜŸàÿßŸÜ'\n    };\n    \n    // Check if any syncable field is being updated\n    const hasFieldUpdates = fieldsToSync.some(f => data[f] !== undefined);\n    \n    if (hasFieldUpdates) {\n      // Get current extractedFields or create new\n      const currentExtracted = updateData.extractedFields || current?.extractedFields || {};\n      \n      // Sync each updated field to extractedFields\n      for (const field of fieldsToSync) {\n        if (data[field] !== undefined) {\n          const arabicKey = arabicFieldMap[field];\n          if (arabicKey) {\n            currentExtracted[arabicKey] = data[field];\n          }\n          currentExtracted[field] = data[field];\n        }\n      }\n      \n      updateData.extractedFields = currentExtracted;\n      updateData.isEdited = true;\n      updateData.editedAt = new Date();\n    }\n    \n    const result = await database\n      .update(schema.messageArchive)\n      .set(updateData)\n      .where(eq(schema.messageArchive.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteArchiveMessage(id: number): Promise<void> {\n    await database\n      .delete(schema.messageArchive)\n      .where(eq(schema.messageArchive.id, id));\n  }\n\n  async deleteArchiveMessagesByTask(taskId: number): Promise<number> {\n    const result = await database\n      .delete(schema.messageArchive)\n      .where(eq(schema.messageArchive.taskId, taskId))\n      .returning();\n    return result.length;\n  }\n\n  async toggleArchivePin(id: number): Promise<any> {\n    const message = await this.getArchiveMessage(id);\n    if (!message) return null;\n    \n    return await this.updateArchiveMessage(id, { isPinned: !message.isPinned });\n  }\n\n  async toggleArchiveFlag(id: number, reason?: string): Promise<any> {\n    const message = await this.getArchiveMessage(id);\n    if (!message) return null;\n    \n    return await this.updateArchiveMessage(id, { \n      isFlagged: !message.isFlagged,\n      flagReason: !message.isFlagged ? reason : null\n    });\n  }\n\n  // ============ Archive Serial Counter ============\n  async getNextSerialNumber(taskId: number): Promise<number> {\n    // Try to get existing counter\n    const existing = await database\n      .select()\n      .from(schema.archiveSerialCounter)\n      .where(eq(schema.archiveSerialCounter.taskId, taskId))\n      .limit(1);\n\n    if (existing.length > 0) {\n      // Increment and return\n      const newSerial = existing[0].lastSerial + 1;\n      await database\n        .update(schema.archiveSerialCounter)\n        .set({ lastSerial: newSerial, updatedAt: new Date() })\n        .where(eq(schema.archiveSerialCounter.taskId, taskId));\n      return newSerial;\n    } else {\n      // Create new counter\n      await database\n        .insert(schema.archiveSerialCounter)\n        .values({ taskId, lastSerial: 1 });\n      return 1;\n    }\n  }\n\n  async getCurrentSerialNumber(taskId: number): Promise<number> {\n    const existing = await database\n      .select()\n      .from(schema.archiveSerialCounter)\n      .where(eq(schema.archiveSerialCounter.taskId, taskId))\n      .limit(1);\n    return existing[0]?.lastSerial || 0;\n  }\n\n  async resetSerialCounter(taskId: number): Promise<void> {\n    await database\n      .update(schema.archiveSerialCounter)\n      .set({ lastSerial: 0, updatedAt: new Date() })\n      .where(eq(schema.archiveSerialCounter.taskId, taskId));\n  }\n\n  // ============ Archive Statistics ============\n  async getArchiveStats(taskId?: number): Promise<{\n    totalMessages: number;\n    todayMessages: number;\n    pinnedMessages: number;\n    flaggedMessages: number;\n    byClassification: { classification: string; count: number }[];\n    byProvince: { province: string; count: number }[];\n    byNewsType: { newsType: string; count: number }[];\n    recentActivity: { date: string; count: number }[];\n  }> {\n    const conditions: any[] = [];\n    if (taskId) {\n      conditions.push(eq(schema.messageArchive.taskId, taskId));\n    }\n    const whereClause = conditions.length > 0 ? and(...conditions) : undefined;\n\n    // Total messages\n    const totalResult = await database\n      .select({ count: sql<number>`count(*)::int` })\n      .from(schema.messageArchive)\n      .where(whereClause);\n    const totalMessages = totalResult[0]?.count || 0;\n\n    // Today's messages\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const todayConditions = [...conditions, sql`${schema.messageArchive.createdAt} >= ${today.toISOString()}::timestamp`];\n    const todayResult = await database\n      .select({ count: sql<number>`count(*)::int` })\n      .from(schema.messageArchive)\n      .where(and(...todayConditions));\n    const todayMessages = todayResult[0]?.count || 0;\n\n    // Pinned messages\n    const pinnedConditions = [...conditions, eq(schema.messageArchive.isPinned, true)];\n    const pinnedResult = await database\n      .select({ count: sql<number>`count(*)::int` })\n      .from(schema.messageArchive)\n      .where(and(...pinnedConditions));\n    const pinnedMessages = pinnedResult[0]?.count || 0;\n\n    // Flagged messages\n    const flaggedConditions = [...conditions, eq(schema.messageArchive.isFlagged, true)];\n    const flaggedResult = await database\n      .select({ count: sql<number>`count(*)::int` })\n      .from(schema.messageArchive)\n      .where(and(...flaggedConditions));\n    const flaggedMessages = flaggedResult[0]?.count || 0;\n\n    // By classification\n    const byClassification = await database\n      .select({\n        classification: schema.messageArchive.classification,\n        count: sql<number>`count(*)::int`\n      })\n      .from(schema.messageArchive)\n      .where(whereClause)\n      .groupBy(schema.messageArchive.classification);\n\n    // By province\n    const byProvince = await database\n      .select({\n        province: schema.messageArchive.province,\n        count: sql<number>`count(*)::int`\n      })\n      .from(schema.messageArchive)\n      .where(whereClause)\n      .groupBy(schema.messageArchive.province);\n\n    // By news type\n    const byNewsType = await database\n      .select({\n        newsType: schema.messageArchive.newsType,\n        count: sql<number>`count(*)::int`\n      })\n      .from(schema.messageArchive)\n      .where(whereClause)\n      .groupBy(schema.messageArchive.newsType);\n\n    // Recent activity (last 7 days)\n    const recentActivity = await database\n      .select({\n        date: sql<string>`DATE(${schema.messageArchive.createdAt})::text`,\n        count: sql<number>`count(*)::int`\n      })\n      .from(schema.messageArchive)\n      .where(whereClause)\n      .groupBy(sql`DATE(${schema.messageArchive.createdAt})`)\n      .orderBy(desc(sql`DATE(${schema.messageArchive.createdAt})`))\n      .limit(7);\n\n    return {\n      totalMessages,\n      todayMessages,\n      pinnedMessages,\n      flaggedMessages,\n      byClassification: byClassification.filter(c => c.classification) as any,\n      byProvince: byProvince.filter(p => p.province) as any,\n      byNewsType: byNewsType.filter(n => n.newsType) as any,\n      recentActivity: recentActivity as any\n    };\n  }\n\n  async getArchiveFilterOptions(taskId?: number): Promise<{\n    classifications: string[];\n    provinces: string[];\n    newsTypes: string[];\n    specialists: string[];\n  }> {\n    const conditions: any[] = [];\n    if (taskId) {\n      conditions.push(eq(schema.messageArchive.taskId, taskId));\n    }\n    const whereClause = conditions.length > 0 ? and(...conditions) : undefined;\n\n    const classifications = await database\n      .selectDistinct({ value: schema.messageArchive.classification })\n      .from(schema.messageArchive)\n      .where(whereClause);\n\n    const provinces = await database\n      .selectDistinct({ value: schema.messageArchive.province })\n      .from(schema.messageArchive)\n      .where(whereClause);\n\n    const newsTypes = await database\n      .selectDistinct({ value: schema.messageArchive.newsType })\n      .from(schema.messageArchive)\n      .where(whereClause);\n\n    const specialists = await database\n      .selectDistinct({ value: schema.messageArchive.specialist })\n      .from(schema.messageArchive)\n      .where(whereClause);\n\n    return {\n      classifications: classifications.map(c => c.value).filter(Boolean) as string[],\n      provinces: provinces.map(p => p.value).filter(Boolean) as string[],\n      newsTypes: newsTypes.map(n => n.value).filter(Boolean) as string[],\n      specialists: specialists.map(s => s.value).filter(Boolean) as string[]\n    };\n  }\n}\n\nexport const storage = new DbStorage();\n","path":null,"size_bytes":67386,"size_tokens":null},"client/src/pages/github.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Loader2, CheckCircle, AlertCircle, Github, Link2, Unlink2, ChevronDown } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { motion } from \"framer-motion\";\n\ninterface GitHubRepo {\n  name: string;\n  owner: string;\n  url: string;\n  private: boolean;\n}\n\ninterface GitHubBranch {\n  name: string;\n}\n\nexport default function GitHubPage() {\n  const [repos, setRepos] = useState<GitHubRepo[]>([]);\n  const [branches, setBranches] = useState<string[]>([]);\n  const [selectedRepo, setSelectedRepo] = useState<string>(\"\");\n  const [selectedBranch, setSelectedBranch] = useState<string>(\"main\");\n  const [commitMessage, setCommitMessage] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [info, setInfo] = useState<any>(null);\n  const [loadingRepos, setLoadingRepos] = useState(true);\n  const [linkedRepo, setLinkedRepo] = useState<any>(null);\n  const [loadingLinked, setLoadingLinked] = useState(true);\n  const [linkingLoading, setLinkingLoading] = useState(false);\n  const [showCommitForm, setShowCommitForm] = useState(false);\n  const [pushSuccess, setPushSuccess] = useState(false);\n\n  useEffect(() => {\n    loadGitHubInfo();\n    loadLinkedRepo();\n\n    // Auto-refresh GitHub info every 5 seconds to show real-time connection status\n    const statusCheckInterval = setInterval(() => {\n      fetch(\"/api/github/info\")\n        .then((res) => res.json())\n        .then((data) => {\n          setInfo((prevInfo: any) => {\n            // Only update if status changed to show connection update\n            if (prevInfo?.status !== data.status) {\n              return data;\n            }\n            return prevInfo;\n          });\n        })\n        .catch(() => {\n          // Silently fail on network errors\n        });\n    }, 5000);\n\n    return () => clearInterval(statusCheckInterval);\n  }, []);\n\n  const loadLinkedRepo = async () => {\n    try {\n      const res = await fetch(\"/api/github/linked-repo\");\n      const data = await res.json();\n      setLinkedRepo(data);\n    } catch (error) {\n      console.error(\"Failed to load linked repo:\", error);\n    } finally {\n      setLoadingLinked(false);\n    }\n  };\n\n  const handleLinkRepo = async () => {\n    if (!selectedRepo || !selectedRepo.includes(\"/\")) {\n      toast.error(\"ÿßÿÆÿ™ÿ± ŸÖÿ≥ÿ™ŸàÿØÿπ ÿµÿ≠Ÿäÿ≠\");\n      return;\n    }\n    const [owner, repo] = selectedRepo.split(\"/\");\n    setLinkingLoading(true);\n    try {\n      const res = await fetch(\"/api/github/link-repo\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ owner, repo }),\n      });\n      if (res.ok) {\n        toast.success(\"‚úì ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿ®ŸÜÿ¨ÿßÿ≠!\");\n        await loadLinkedRepo();\n      } else {\n        toast.error(\"ŸÅÿ¥ŸÑ ÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ\");\n      }\n    } catch (error) {\n      console.error(\"Link failed:\", error);\n      toast.error(\"ÿÆÿ∑ÿ£: ŸÅÿ¥ŸÑ ÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ\");\n    } finally {\n      setLinkingLoading(false);\n    }\n  };\n\n  const handleUnlinkRepo = async () => {\n    setLinkingLoading(true);\n    try {\n      const res = await fetch(\"/api/github/unlink-repo\", { method: \"POST\" });\n      if (res.ok) {\n        toast.success(\"‚úì ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ±ÿ®ÿ∑ ÿ®ŸÜÿ¨ÿßÿ≠!\");\n        setLinkedRepo(null);\n        setSelectedRepo(\"\");\n      } else {\n        toast.error(\"ŸÅÿ¥ŸÑ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ±ÿ®ÿ∑\");\n      }\n    } catch (error) {\n      console.error(\"Unlink failed:\", error);\n      toast.error(\"ÿÆÿ∑ÿ£: ŸÅÿ¥ŸÑ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ±ÿ®ÿ∑\");\n    } finally {\n      setLinkingLoading(false);\n    }\n  };\n\n  const loadGitHubInfo = async () => {\n    try {\n      setLoadingRepos(true);\n      const infoRes = await fetch(\"/api/github/info\");\n      const infoData = await infoRes.json();\n      setInfo(infoData);\n\n      const [reposRes, branchesRes] = await Promise.all([\n        fetch(\"/api/github/repos\"),\n        fetch(\"/api/github/branches\"),\n      ]);\n\n      const reposData = await reposRes.json();\n      const branchesData = await branchesRes.json();\n      \n      const validRepos = (reposData.repos || []).filter((r: any) => r.owner && r.name);\n      setRepos(validRepos);\n      setBranches(branchesData.branches || [\"main\"]);\n      setSelectedRepo(\"\");\n    } catch (error) {\n      console.error(\"Failed to load GitHub info:\", error);\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿπŸÑŸàŸÖÿßÿ™ GitHub\");\n    } finally {\n      setLoadingRepos(false);\n    }\n  };\n\n  const handlePush = async () => {\n    if (!commitMessage.trim()) {\n      toast.error(\"ÿ£ÿØÿÆŸÑ ÿ±ÿ≥ÿßŸÑÿ© commit\");\n      return;\n    }\n\n    if (!linkedRepo) {\n      toast.error(\"Ÿäÿ¨ÿ® ÿ±ÿ®ÿ∑ ŸÖÿ≥ÿ™ŸàÿØÿπ ÿ£ŸàŸÑÿßŸã\");\n      return;\n    }\n\n    setLoading(true);\n    setPushSuccess(false);\n    \n    try {\n      const repoValue = `${linkedRepo.owner}/${linkedRepo.repo}`;\n\n      if (!repoValue || !repoValue.includes(\"/\")) {\n        toast.error(\"ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©\");\n        setLoading(false);\n        return;\n      }\n      \n      const parts = repoValue.split(\"/\");\n      let owner = parts[0]?.trim();\n      let repo = parts[1]?.trim();\n      \n      if (!owner || owner === \"undefined\" || !repo || repo === \"undefined\") {\n        toast.error(\"ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©\");\n        setLoading(false);\n        return;\n      }\n      \n      const res = await fetch(\"/api/github/push\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          message: commitMessage,\n          owner,\n          repo,\n          branch: selectedBranch,\n        }),\n      });\n\n      const data = await res.json();\n      if (res.ok) {\n        // Delay for visual feedback\n        await new Promise(resolve => setTimeout(resolve, 1500));\n        setPushSuccess(true);\n        toast.success(\"‚úì ÿ™ŸÖ ÿØŸÅÿπ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿ•ŸÑŸâ GitHub ÿ®ŸÜÿ¨ÿßÿ≠!\");\n        \n        // Reset after success message\n        setTimeout(() => {\n          setCommitMessage(\"\");\n          setShowCommitForm(false);\n          setPushSuccess(false);\n        }, 2000);\n      } else {\n        toast.error(data.error || \"ŸÅÿ¥ŸÑ ÿØŸÅÿπ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™\");\n      }\n    } catch (error) {\n      console.error(\"Push failed:\", error);\n      toast.error(\"ÿÆÿ∑ÿ£: ŸÅÿ¥ŸÑ ÿØŸÅÿπ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isLinked = linkedRepo?.status === \"linked\";\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"github-page\">\n      <div>\n        <h1 className=\"text-3xl font-bold flex items-center gap-3\" data-testid=\"heading-github\">\n          <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center\">\n            <Github className=\"w-6 h-6 text-white\" />\n          </div>\n          GitHub Integration\n        </h1>\n        <p className=\"text-gray-600 dark:text-gray-400 mt-2\">ÿ±ÿ®ÿ∑ Ÿàÿ™ÿ≤ÿßŸÖŸÜ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸÖÿπ GitHub ÿ®ÿ≥ŸáŸàŸÑÿ© Ÿàÿ£ŸÖÿßŸÜ</p>\n      </div>\n\n      {/* Status and Connection Card */}\n      <Card className=\"border border-blue-500/20 bg-gradient-to-r from-blue-500/5 to-transparent\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2 text-gray-900 dark:text-white\">\n            {info?.status === \"connected\" ? (\n              <>\n                <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                ŸÖÿ™ÿµŸÑ ÿ®ŸÄ GitHub\n              </>\n            ) : (\n              <>\n                <AlertCircle className=\"w-5 h-5 text-yellow-500\" />\n                ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ŸàÿµŸäŸÑ GitHub\n              </>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {info?.status === \"connected\" ? (\n            <div className=\"space-y-4\">\n              {/* Username Section */}\n              <div className=\"space-y-2\">\n                <p className=\"text-xs text-gray-600 dark:text-gray-400 uppercase tracking-wider\">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</p>\n                <p className=\"text-sm font-mono bg-gray-100 dark:bg-gray-900/50 px-3 py-2 rounded border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white\">\n                  {info.owner}\n                </p>\n              </div>\n\n              {/* Repository Selection / Status */}\n              {!isLinked ? (\n                <motion.div \n                  className=\"space-y-3\"\n                  initial={{ opacity: 0, height: 0 }}\n                  animate={{ opacity: 1, height: \"auto\" }}\n                  exit={{ opacity: 0, height: 0 }}\n                >\n                  <label className=\"text-sm font-semibold text-gray-900 dark:text-gray-300\">ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ</label>\n                  <Select value={selectedRepo} onValueChange={setSelectedRepo} disabled={loadingRepos}>\n                    <SelectTrigger className=\"bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white\" data-testid=\"select-repo\">\n                      <SelectValue placeholder=\"-- ÿßÿÆÿ™ÿ± ŸÖÿ≥ÿ™ŸàÿØÿπ --\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {repos.length === 0 ? (\n                        <div className=\"px-2 py-1.5 text-xs text-muted-foreground\">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ≥ÿ™ŸàÿØÿπÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ©</div>\n                      ) : (\n                        repos.map((repo) => (\n                          <SelectItem key={`${repo.owner}/${repo.name}`} value={`${repo.owner}/${repo.name}`}>\n                            <div className=\"flex items-center gap-2\">\n                              <span>{repo.owner}/{repo.name}</span>\n                              <span className=\"text-xs\">{repo.private ? \"üîí\" : \"üåê\"}</span>\n                            </div>\n                          </SelectItem>\n                        ))\n                      )}\n                    </SelectContent>\n                  </Select>\n\n                  <Button\n                    onClick={handleLinkRepo}\n                    disabled={linkingLoading || !selectedRepo}\n                    size=\"sm\"\n                    className=\"w-full bg-emerald-600 hover:bg-emerald-700 text-white dark:bg-emerald-600 dark:hover:bg-emerald-700\"\n                    data-testid=\"button-link-repo\"\n                  >\n                    {linkingLoading ? (\n                      <>\n                        <Loader2 className=\"w-3 h-3 mr-2 animate-spin\" />\n                        ÿ¨ÿßÿ±Ÿä...\n                      </>\n                    ) : (\n                      <>\n                        <Link2 className=\"w-3 h-3 mr-2\" />\n                        ÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ\n                      </>\n                    )}\n                  </Button>\n                </motion.div>\n              ) : (\n                <motion.div \n                  className=\"flex items-center justify-between gap-3 p-3 rounded-lg bg-green-100 dark:bg-green-500/10 border border-green-300 dark:border-green-500/30\"\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"w-4 h-4 text-green-600 dark:text-green-500\" />\n                    <div>\n                      <p className=\"text-xs text-green-700 dark:text-green-400\">ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿßŸÑŸÖÿ±ÿ®Ÿàÿ∑</p>\n                      <p className=\"text-sm text-green-800 dark:text-green-300 font-mono font-bold\">{linkedRepo.owner}/{linkedRepo.repo}</p>\n                    </div>\n                  </div>\n                  <Button\n                    onClick={handleUnlinkRepo}\n                    disabled={linkingLoading}\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    className=\"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-100 dark:hover:bg-red-500/10 h-auto\"\n                    data-testid=\"button-unlink-repo\"\n                  >\n                    {linkingLoading ? (\n                      <Loader2 className=\"w-3 h-3 animate-spin\" />\n                    ) : (\n                      <>\n                        <Unlink2 className=\"w-3 h-3 mr-1\" />\n                        ŸÇÿ∑ÿπ\n                      </>\n                    )}\n                  </Button>\n                </motion.div>\n              )}\n            </div>\n          ) : (\n            <Alert className=\"bg-yellow-100 dark:bg-yellow-500/10 border border-yellow-300 dark:border-yellow-500/30\">\n              <AlertDescription className=\"text-yellow-800 dark:text-yellow-200\">\n                ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ŸÅÿπŸäŸÑ GitHub connector ŸÅŸä ÿ•ÿπÿØÿßÿØÿßÿ™ Replit\n              </AlertDescription>\n            </Alert>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Push to GitHub - Main Card */}\n      <Card className=\"border border-green-500/20 bg-gradient-to-r from-green-500/5 to-transparent\">\n        <CardHeader>\n          <CardTitle className=\"text-gray-900 dark:text-white\">üì§ ÿØŸÅÿπ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™</CardTitle>\n          <CardDescription className=\"text-gray-600 dark:text-gray-400\">\n            {isLinked \n              ? `ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿßŸÑŸÖÿ±ÿ®Ÿàÿ∑: ${linkedRepo.owner}/${linkedRepo.repo}` \n              : \"Ÿäÿ¨ÿ® ÿ±ÿ®ÿ∑ ŸÖÿ≥ÿ™ŸàÿØÿπ ÿ£ŸàŸÑÿßŸã\"}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {/* Branch Selection */}\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-semibold text-gray-900 dark:text-gray-300\">ÿßŸÑŸÅÿ±ÿπ</label>\n            <Select value={selectedBranch} onValueChange={setSelectedBranch} disabled={!isLinked}>\n              <SelectTrigger className=\"bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white disabled:opacity-50\" data-testid=\"select-branch\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {branches.map((branch) => (\n                  <SelectItem key={branch} value={branch}>\n                    {branch}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Push Button */}\n          <Button\n            onClick={() => {\n              if (isLinked) {\n                setShowCommitForm(!showCommitForm);\n              } else {\n                toast.error(\"Ÿäÿ¨ÿ® ÿ±ÿ®ÿ∑ ŸÖÿ≥ÿ™ŸàÿØÿπ ÿ£ŸàŸÑÿßŸã\");\n              }\n            }}\n            className=\"w-full h-10 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 dark:from-blue-600 dark:to-blue-700 dark:hover:from-blue-700 dark:hover:to-blue-800 text-white font-medium border border-blue-500/50 justify-between disabled:opacity-50\"\n            data-testid=\"button-toggle-commit\"\n            disabled={!isLinked && !loading}\n          >\n            <span className=\"flex-1\">üì§ ÿØŸÅÿπ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™</span>\n            <ChevronDown className={`w-4 h-4 transition-transform ${showCommitForm ? 'rotate-180' : ''}`} />\n          </Button>\n\n          {/* Commit Form */}\n          {showCommitForm && (\n            <motion.div \n              className=\"space-y-3 pt-3 border-t border-gray-300 dark:border-gray-700/50\"\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: \"auto\" }}\n              exit={{ opacity: 0, height: 0 }}\n            >\n              <div>\n                <label className=\"text-sm font-semibold text-gray-900 dark:text-gray-300\">ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ™ÿ∫ŸäŸäÿ±</label>\n                <Input\n                  placeholder=\"ŸÖÿ´ÿßŸÑ: ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸäÿ≤ÿ© ÿ¨ÿØŸäÿØÿ© ÿ£Ÿà ÿ•ÿµŸÑÿßÿ≠ ÿÆŸÑŸÑ...\"\n                  value={commitMessage}\n                  onChange={(e) => setCommitMessage(e.target.value)}\n                  className=\"mt-2 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white placeholder:text-gray-500 dark:placeholder:text-gray-500\"\n                  data-testid=\"input-commit-message\"\n                  disabled={loading}\n                />\n              </div>\n\n              {loading && !pushSuccess && (\n                <motion.div\n                  className=\"flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-100 dark:bg-blue-500/10 border border-blue-300 dark:border-blue-500/30\"\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                >\n                  <Loader2 className=\"w-5 h-5 animate-spin text-blue-600 dark:text-blue-400\" />\n                  <span className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">ÿ¨ÿßÿ±Ÿä ÿØŸÅÿπ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™...</span>\n                </motion.div>\n              )}\n\n              {pushSuccess && (\n                <motion.div\n                  className=\"flex items-center justify-center gap-3 p-4 rounded-lg bg-green-100 dark:bg-green-500/10 border border-green-300 dark:border-green-500/30\"\n                  initial={{ opacity: 0, scale: 0.95 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                >\n                  <CheckCircle className=\"w-5 h-5 text-green-600 dark:text-green-500\" />\n                  <span className=\"text-sm font-medium text-green-700 dark:text-green-300\">‚úì ÿ™ŸÖ ÿßŸÑÿØŸÅÿπ ÿ®ŸÜÿ¨ÿßÿ≠!</span>\n                </motion.div>\n              )}\n\n              <Button\n                onClick={handlePush}\n                disabled={loading || !commitMessage.trim()}\n                className=\"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 dark:from-green-600 dark:to-green-700 dark:hover:from-green-700 dark:hover:to-green-800 text-white font-medium border border-green-500/50 disabled:opacity-50\"\n              >\n                {loading && !pushSuccess ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    ÿ¨ÿßÿ±Ÿä ÿßŸÑÿØŸÅÿπ...\n                  </>\n                ) : pushSuccess ? (\n                  <>\n                    <CheckCircle className=\"w-4 h-4 mr-2\" />\n                    ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠!\n                  </>\n                ) : (\n                  <>‚úì ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿØŸÅÿπ</>\n                )}\n              </Button>\n            </motion.div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Quick Tips Card */}\n      <Card className=\"border border-gray-300 dark:border-gray-700/50 bg-gray-50 dark:bg-gray-900/30\">\n        <CardHeader>\n          <CardTitle className=\"text-sm text-gray-900 dark:text-white\">üí° ŸÜÿµÿßÿ¶ÿ≠ ÿ≥ÿ±Ÿäÿπÿ©</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ul className=\"space-y-2 text-xs text-gray-700 dark:text-gray-400\">\n            <li className=\"flex gap-2\">\n              <span className=\"text-blue-500 dark:text-blue-400\">‚Ä¢</span>\n              <span>ÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÑÿ™ÿ®ŸÇŸâ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ ŸÖÿ≠ŸÅŸàÿ∏ÿ©</span>\n            </li>\n            <li className=\"flex gap-2\">\n              <span className=\"text-green-500 dark:text-green-400\">‚Ä¢</span>\n              <span>ÿ®ÿπÿØ ÿßŸÑÿ±ÿ®ÿ∑ÿå ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿ•ŸÑÿß ÿ®ŸÇÿ∑ÿπ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ£ŸàŸÑÿßŸã</span>\n            </li>\n            <li className=\"flex gap-2\">\n              <span className=\"text-yellow-600 dark:text-yellow-400\">‚Ä¢</span>\n              <span>ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ±ÿπ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ŸÇÿ®ŸÑ ÿØŸÅÿπ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™</span>\n            </li>\n            <li className=\"flex gap-2\">\n              <span className=\"text-purple-600 dark:text-purple-400\">‚Ä¢</span>\n              <span>ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ© Ÿàÿßÿ∂ÿ≠ÿ© ŸàŸÖŸàÿ¨ÿ≤ÿ© ŸÑŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™</span>\n            </li>\n          </ul>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":20085,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"telegram_bot/services/__init__.py":{"content":"# Services package\n","path":null,"size_bytes":19,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { authServiceManager } from \"./auth-service-manager\";\nimport bcrypt from \"bcryptjs\";\nimport { insertUserSchema, insertForwardingTaskSchema, insertChannelSchema, insertAiRuleSchema } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { pushToGitHub, getGitHubInfo, listGitHubRepos, pushToGitHubRepo, getBranches, getFileChanges } from \"./github-sync\";\n\nconst handleError = (res: Response, error: unknown, message: string = \"An error occurred\") => {\n  console.error(error);\n  res.status(500).json({ error: message, details: error instanceof Error ? error.message : String(error) });\n};\n\nexport async function registerRoutes(httpServer: Server, app: Express): Promise<Server> {\n  // ============ Authentication ============\n  \n  app.post(\"/api/auth/admin-login\", async (req: Request, res: Response) => {\n    try {\n      const { username, password } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ error: \"Username and password are required\" });\n      }\n      \n      const secretUsername = process.env.ADMIN_USERNAME;\n      const secretPassword = process.env.ADMIN_PASSWORD;\n      \n      if (!secretUsername || !secretPassword) {\n        console.error(\"[Auth] Admin credentials not configured in secrets\");\n        return res.status(500).json({ error: \"Admin authentication not configured\" });\n      }\n      \n      if (username !== secretUsername || password !== secretPassword) {\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      \n      res.json({ \n        admin: true,\n        username: secretUsername,\n        message: \"Admin login successful\",\n        token: Buffer.from(`${secretUsername}:${Date.now()}`).toString('base64')\n      });\n    } catch (error) {\n      handleError(res, error, \"Admin login failed\");\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req: Request, res: Response) => {\n    try {\n      const { username, password } = req.body;\n      if (!username || !password) {\n        return res.status(400).json({ error: \"Username and password are required\" });\n      }\n      const user = await storage.getUserByUsername(username);\n      if (!user) {\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      const isValid = await bcrypt.compare(password, user.password);\n      if (!isValid) {\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      const { password: _, ...userWithoutPassword } = user;\n      res.json({ user: userWithoutPassword, message: \"Login successful\" });\n    } catch (error) {\n      handleError(res, error, \"Login failed\");\n    }\n  });\n\n  app.post(\"/api/auth/register\", async (req: Request, res: Response) => {\n    try {\n      const { username, password } = req.body;\n      if (!username || !password) {\n        return res.status(400).json({ error: \"Username and password are required\" });\n      }\n      const existingUser = await storage.getUserByUsername(username);\n      if (existingUser) {\n        return res.status(400).json({ error: \"Username already exists\" });\n      }\n      const hashedPassword = await bcrypt.hash(password, 10);\n      const user = await storage.createUser({ username, password: hashedPassword, role: \"admin\" });\n      const { password: _, ...userWithoutPassword } = user;\n      res.json({ user: userWithoutPassword, message: \"Registration successful\" });\n    } catch (error) {\n      handleError(res, error, \"Registration failed\");\n    }\n  });\n\n  // ============ Dashboard ============\n  app.get(\"/api/dashboard/stats\", async (req: Request, res: Response) => {\n    try {\n      const stats = await storage.getDashboardStats();\n      res.json(stats);\n    } catch (error) {\n      handleError(res, error, \"Failed to get dashboard stats\");\n    }\n  });\n\n  // ============ Tasks ============\n  app.get(\"/api/tasks\", async (req: Request, res: Response) => {\n    try {\n      const tasks = await storage.getTasks();\n      res.json(tasks);\n    } catch (error) {\n      handleError(res, error, \"Failed to get tasks\");\n    }\n  });\n\n  app.post(\"/api/tasks\", async (req: Request, res: Response) => {\n    try {\n      const parsed = insertForwardingTaskSchema.parse(req.body);\n      const task = await storage.createTask(parsed);\n      res.status(201).json({ task });\n    } catch (error) {\n      handleError(res, error, \"Failed to create task\");\n    }\n  });\n\n  app.put(\"/api/tasks/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const task = await storage.updateTask(id, req.body);\n      res.json({ task });\n    } catch (error) {\n      handleError(res, error, \"Failed to update task\");\n    }\n  });\n\n  app.patch(\"/api/tasks/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const task = await storage.updateTask(id, req.body);\n      res.json({ task });\n    } catch (error) {\n      handleError(res, error, \"Failed to update task\");\n    }\n  });\n\n  app.post(\"/api/tasks/:id/toggle\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const task = await storage.toggleTask(id);\n      res.json({ task });\n    } catch (error) {\n      handleError(res, error, \"Failed to toggle task\");\n    }\n  });\n\n  app.delete(\"/api/tasks/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteTask(id);\n      res.json({ message: \"Task deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete task\");\n    }\n  });\n\n  // Task Rules endpoints\n  app.get(\"/api/tasks/:taskId/rules\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const rules = await storage.getTaskRules(taskId);\n      res.json(rules);\n    } catch (error) {\n      handleError(res, error, \"Failed to get task rules\");\n    }\n  });\n\n  app.post(\"/api/tasks/:taskId/rules\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const data = { ...req.body, taskId };\n      const parsed = insertAiRuleSchema.parse(data);\n      const rule = await storage.createRule(parsed);\n      res.status(201).json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to create rule\");\n    }\n  });\n\n  app.patch(\"/api/rules/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const rule = await storage.updateRule(id, req.body);\n      res.json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to update rule\");\n    }\n  });\n\n  app.post(\"/api/rules/:id/toggle\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const rule = await storage.toggleRule(id);\n      res.json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to toggle rule\");\n    }\n  });\n\n  app.delete(\"/api/rules/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteRule(id);\n      res.json({ message: \"Rule deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete rule\");\n    }\n  });\n\n  // ============ Summarization Rules ============\n  app.get(\"/api/tasks/:taskId/summarization-rules\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const allRules = await storage.getTaskRules(taskId);\n      const rules = allRules.filter((r: any) => r.type === \"summarize\" || r.type === \"audio_summarize\");\n      res.json(rules);\n    } catch (error) {\n      handleError(res, error, \"Failed to get summarization rules\");\n    }\n  });\n\n  app.post(\"/api/tasks/:taskId/summarization-rules\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const { maxLength, style, keyPointsCount, type, ...rest } = req.body;\n      const config = {\n        maxLength: maxLength || 300,\n        style: style || 'balanced',\n        keyPointsCount: keyPointsCount || 3\n      };\n      const data = { ...rest, taskId, type: type || \"summarize\", config };\n      const rule = await storage.createRule(data);\n      res.status(201).json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to create summarization rule\");\n    }\n  });\n\n  app.patch(\"/api/summarization-rules/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { maxLength, style, keyPointsCount, ...rest } = req.body;\n      const updates = { ...rest };\n      \n      if (maxLength !== undefined || style !== undefined || keyPointsCount !== undefined) {\n        updates.config = {\n          maxLength: maxLength || 300,\n          style: style || 'balanced',\n          keyPointsCount: keyPointsCount || 3\n        };\n      }\n      \n      const rule = await storage.updateRule(id, updates);\n      res.json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to update summarization rule\");\n    }\n  });\n\n  app.post(\"/api/summarization-rules/:id/toggle\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const rule = await storage.toggleRule(id);\n      res.json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to toggle summarization rule\");\n    }\n  });\n\n  app.delete(\"/api/summarization-rules/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteRule(id);\n      res.json({ message: \"Summarization rule deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete summarization rule\");\n    }\n  });\n\n  // ============ Video Processing Rules ============\n  app.get(\"/api/tasks/:taskId/video-processing-rules\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const rules = await storage.getTaskRulesByType(taskId, \"video_summarize\");\n      res.json(rules);\n    } catch (error) {\n      handleError(res, error, \"Failed to get video processing rules\");\n    }\n  });\n\n  app.post(\"/api/tasks/:taskId/video-processing-rules\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const data = { ...req.body, taskId, type: \"video_summarize\" };\n      const rule = await storage.createRule(data);\n      res.status(201).json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to create video processing rule\");\n    }\n  });\n\n  app.patch(\"/api/video-processing-rules/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const rule = await storage.updateRule(id, req.body);\n      res.json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to update video processing rule\");\n    }\n  });\n\n  app.post(\"/api/video-processing-rules/:id/toggle\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const rule = await storage.toggleRule(id);\n      res.json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to toggle video processing rule\");\n    }\n  });\n\n  app.delete(\"/api/video-processing-rules/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteRule(id);\n      res.json({ message: \"Video processing rule deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete video processing rule\");\n    }\n  });\n\n  // ============ Channels ============\n  app.get(\"/api/channels\", async (req: Request, res: Response) => {\n    try {\n      const channels = await storage.getChannels();\n      res.json(channels);\n    } catch (error) {\n      handleError(res, error, \"Failed to get channels\");\n    }\n  });\n\n  app.post(\"/api/channels\", async (req: Request, res: Response) => {\n    try {\n      const parsed = insertChannelSchema.parse(req.body);\n      const channel = await storage.createChannel(parsed);\n      res.status(201).json({ channel });\n    } catch (error) {\n      handleError(res, error, \"Failed to create channel\");\n    }\n  });\n\n  app.patch(\"/api/channels/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const channel = await storage.updateChannel(id, req.body);\n      res.json(channel);\n    } catch (error) {\n      handleError(res, error, \"Failed to update channel\");\n    }\n  });\n\n  app.delete(\"/api/channels/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteChannel(id);\n      res.json({ message: \"Channel deleted successfully\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete channel\");\n    }\n  });\n\n  // ============ AI Config ============\n  app.get(\"/api/ai/providers\", async (req: Request, res: Response) => {\n    try {\n      const providers = await storage.getAiProviders();\n      res.json(providers);\n    } catch (error) {\n      handleError(res, error, \"Failed to get AI providers\");\n    }\n  });\n\n  app.get(\"/api/ai/models\", async (req: Request, res: Response) => {\n    try {\n      const models = await storage.getAiModels();\n      res.json(models);\n    } catch (error) {\n      handleError(res, error, \"Failed to get AI models\");\n    }\n  });\n\n  app.patch(\"/api/ai/providers/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const provider = await storage.updateAiProvider(id, req.body);\n      res.json(provider);\n    } catch (error) {\n      handleError(res, error, \"Failed to update AI provider\");\n    }\n  });\n\n  app.post(\"/api/ai/providers/:id/toggle\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const provider = await storage.toggleAiProvider(id);\n      res.json(provider);\n    } catch (error) {\n      handleError(res, error, \"Failed to toggle AI provider\");\n    }\n  });\n\n  // ============ AI Model Management ============\n  app.get(\"/api/ai-providers/:providerId/models\", async (req: Request, res: Response) => {\n    try {\n      const providerId = parseInt(req.params.providerId);\n      if (isNaN(providerId)) {\n        return res.status(400).json({ error: \"Invalid provider ID\" });\n      }\n      const models = await storage.getModelsByProvider(providerId);\n      res.json(models);\n    } catch (error) {\n      handleError(res, error, \"Failed to get models for provider\");\n    }\n  });\n\n  app.put(\"/api/ai-models/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ error: \"Invalid model ID\" });\n      }\n      const model = await storage.updateModel(id, req.body);\n      if (!model) {\n        return res.status(404).json({ error: \"Model not found\" });\n      }\n      res.json(model);\n    } catch (error) {\n      handleError(res, error, \"Failed to update AI model\");\n    }\n  });\n\n  app.get(\"/api/ai-models/:id/stats\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ error: \"Invalid model ID\" });\n      }\n      const stats = await storage.getModelUsageStats(id);\n      res.json(stats);\n    } catch (error) {\n      handleError(res, error, \"Failed to get model usage stats\");\n    }\n  });\n\n  // ============ AI Usage Statistics ============\n  app.get(\"/api/ai-usage-stats\", async (req: Request, res: Response) => {\n    try {\n      const filters: {\n        providerId?: number;\n        modelId?: number;\n        taskId?: number;\n        dateFrom?: Date;\n        dateTo?: Date;\n      } = {};\n      \n      if (req.query.providerId) {\n        filters.providerId = parseInt(req.query.providerId as string);\n      }\n      if (req.query.modelId) {\n        filters.modelId = parseInt(req.query.modelId as string);\n      }\n      if (req.query.taskId) {\n        filters.taskId = parseInt(req.query.taskId as string);\n      }\n      if (req.query.dateFrom) {\n        filters.dateFrom = new Date(req.query.dateFrom as string);\n      }\n      if (req.query.dateTo) {\n        filters.dateTo = new Date(req.query.dateTo as string);\n      }\n      \n      const stats = await storage.getUsageStats(filters);\n      res.json(stats);\n    } catch (error) {\n      handleError(res, error, \"Failed to get usage statistics\");\n    }\n  });\n\n  app.get(\"/api/ai-usage-stats/summary\", async (req: Request, res: Response) => {\n    try {\n      const filters: {\n        providerId?: number;\n        dateFrom?: Date;\n        dateTo?: Date;\n      } = {};\n      \n      if (req.query.providerId) {\n        filters.providerId = parseInt(req.query.providerId as string);\n      }\n      if (req.query.dateFrom) {\n        filters.dateFrom = new Date(req.query.dateFrom as string);\n      }\n      if (req.query.dateTo) {\n        filters.dateTo = new Date(req.query.dateTo as string);\n      }\n      \n      const summary = await storage.getUsageStatsSummary(filters);\n      res.json(summary);\n    } catch (error) {\n      handleError(res, error, \"Failed to get usage statistics summary\");\n    }\n  });\n\n  app.post(\"/api/ai-usage-stats\", async (req: Request, res: Response) => {\n    try {\n      const { providerId, modelId, modelName, taskId, requestCount, totalTokensInput, totalTokensOutput, totalCost, usageDate, avgLatency, errorCount, successCount } = req.body;\n      \n      if (!providerId || !modelName || !usageDate) {\n        return res.status(400).json({ error: \"providerId, modelName, and usageDate are required\" });\n      }\n      \n      const usage = await storage.recordUsage({\n        providerId,\n        modelId: modelId || null,\n        modelName,\n        taskId: taskId || null,\n        requestCount: requestCount || 1,\n        totalTokensInput: totalTokensInput || 0,\n        totalTokensOutput: totalTokensOutput || 0,\n        totalCost: totalCost || null,\n        usageDate: new Date(usageDate),\n        avgLatency: avgLatency || null,\n        errorCount: errorCount || 0,\n        successCount: successCount || 1,\n      });\n      \n      res.status(201).json(usage);\n    } catch (error) {\n      handleError(res, error, \"Failed to record usage statistics\");\n    }\n  });\n\n  // Settings\n  app.get(\"/api/settings\", async (req: Request, res: Response) => {\n    try {\n      const settings = await storage.getBotConfig();\n      res.json(settings);\n    } catch (error) {\n      handleError(res, error, \"Failed to get settings\");\n    }\n  });\n\n  app.post(\"/api/settings\", async (req: Request, res: Response) => {\n    try {\n      const { key, value, description } = req.body;\n      if (!key || !value) {\n        return res.status(400).json({ error: \"Key and value are required\" });\n      }\n      await storage.setBotConfigValue(key, value, description);\n      res.json({ message: \"Setting saved successfully\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to save setting\");\n    }\n  });\n\n  // AI Rules\n  app.get(\"/api/ai/rules\", async (req: Request, res: Response) => {\n    try {\n      const taskId = req.query.taskId ? parseInt(req.query.taskId as string) : undefined;\n      if (taskId) {\n        const rules = await storage.getTaskRules(taskId);\n        res.json(rules);\n      } else {\n        res.status(400).json({ error: \"taskId is required\" });\n      }\n    } catch (error) {\n      handleError(res, error, \"Failed to get AI rules\");\n    }\n  });\n\n  app.post(\"/api/ai/rules\", async (req: Request, res: Response) => {\n    try {\n      const parsed = insertAiRuleSchema.parse(req.body);\n      const rule = await storage.createRule(parsed);\n      res.status(201).json({ rule });\n    } catch (error) {\n      handleError(res, error, \"Failed to create AI rule\");\n    }\n  });\n\n  // ============ Error Logs ============\n  app.get(\"/api/error-logs\", async (req: Request, res: Response) => {\n    try {\n      const logs = await storage.getErrorLogs();\n      res.json(logs);\n    } catch (error) {\n      handleError(res, error, \"Failed to get error logs\");\n    }\n  });\n\n  // ============ Userbot ============\n  \n  app.get(\"/api/userbot/status\", async (req: Request, res: Response) => {\n    try {\n      const session = await storage.getActiveUserbotSession();\n      if (session && session.isActive) {\n        res.json({ \n          status: \"connected\", \n          phoneNumber: session.phoneNumber,\n          lastLoginAt: session.lastLoginAt \n        });\n      } else {\n        res.json({ status: \"disconnected\" });\n      }\n    } catch (error) {\n      res.json({ status: \"disconnected\" });\n    }\n  });\n\n  app.post(\"/api/userbot/login/start\", async (req: Request, res: Response) => {\n    try {\n      const { phoneNumber } = req.body;\n      if (!phoneNumber) {\n        return res.status(400).json({ status: \"error\", message: \"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ŸÖÿ∑ŸÑŸàÿ®\" });\n      }\n      \n      const phoneRegex = /^\\+?[1-9]\\d{6,14}$/;\n      const cleanPhone = phoneNumber.replace(/[\\s-]/g, '');\n      if (!phoneRegex.test(cleanPhone)) {\n        return res.status(400).json({ status: \"error\", message: \"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠\" });\n      }\n      \n      const response = await authServiceManager.startLogin(phoneNumber);\n      res.json(response.data);\n    } catch (error: any) {\n      console.error(\"Login start error:\", error);\n      const errorMessage = error?.response?.data?.message || \"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ\";\n      res.json({ status: \"error\", message: errorMessage });\n    }\n  });\n\n  app.post(\"/api/userbot/login/verify\", async (req: Request, res: Response) => {\n    try {\n      const { phoneNumber, code } = req.body;\n      if (!phoneNumber || !code) {\n        return res.status(400).json({ status: \"error\", message: \"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ Ÿàÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖÿ∑ŸÑŸàÿ®ÿßŸÜ\" });\n      }\n      \n      const response = await authServiceManager.verifyCode(phoneNumber, code);\n      \n      if (response.data.status === \"success\" && response.data.session_string) {\n        await storage.activateUserbotSession(phoneNumber, response.data.session_string);\n      }\n      \n      res.json(response.data);\n    } catch (error: any) {\n      console.error(\"Verify code error:\", error);\n      const errorMessage = error?.response?.data?.message || \"ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\";\n      res.json({ status: \"error\", message: errorMessage });\n    }\n  });\n\n  app.post(\"/api/userbot/login/2fa\", async (req: Request, res: Response) => {\n    try {\n      const { phoneNumber, password } = req.body;\n      if (!phoneNumber || !password) {\n        return res.status(400).json({ status: \"error\", message: \"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ŸÖÿ∑ŸÑŸàÿ®ÿßŸÜ\" });\n      }\n      \n      const response = await authServiceManager.verify2FA(phoneNumber, password);\n      \n      if (response.data.status === \"success\" && response.data.session_string) {\n        await storage.activateUserbotSession(phoneNumber, response.data.session_string);\n      }\n      \n      res.json(response.data);\n    } catch (error: any) {\n      console.error(\"2FA verification error:\", error);\n      const errorMessage = error?.response?.data?.message || \"ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©\";\n      res.json({ status: \"error\", message: errorMessage });\n    }\n  });\n\n  app.post(\"/api/userbot/login/cancel\", async (req: Request, res: Response) => {\n    try {\n      const { phoneNumber } = req.body;\n      if (!phoneNumber) {\n        return res.status(400).json({ status: \"error\", message: \"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ŸÖÿ∑ŸÑŸàÿ®\" });\n      }\n      \n      const response = await authServiceManager.cancelLogin(phoneNumber);\n      res.json(response.data);\n    } catch (error: any) {\n      console.error(\"Cancel login error:\", error);\n      res.json({ status: \"error\", message: \"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ŸÑÿ∫ÿßÿ° ÿπŸÖŸÑŸäÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ\" });\n    }\n  });\n\n  app.post(\"/api/userbot/logout\", async (req: Request, res: Response) => {\n    try {\n      const session = await storage.getActiveUserbotSession();\n      \n      try {\n        await authServiceManager.logout(session?.phoneNumber);\n      } catch (authError) {\n        console.warn(\"Auth service logout warning:\", authError);\n      }\n      \n      await storage.deactivateUserbotSession();\n      \n      res.json({ status: \"success\", message: \"ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to logout\");\n    }\n  });\n\n  // ============ GitHub Integration ============\n  app.get(\"/api/github/info\", async (req: Request, res: Response) => {\n    try {\n      const info = await getGitHubInfo();\n      if (info) {\n        res.json({ status: \"connected\", ...info });\n      } else {\n        res.status(400).json({ status: \"disconnected\", message: \"GitHub not connected\" });\n      }\n    } catch (error) {\n      handleError(res, error, \"Failed to get GitHub info\");\n    }\n  });\n\n  app.get(\"/api/github/repos\", async (req: Request, res: Response) => {\n    try {\n      const repos = await listGitHubRepos();\n      res.json({ repos });\n    } catch (error) {\n      handleError(res, error, \"Failed to list repositories\");\n    }\n  });\n\n  app.get(\"/api/github/branches\", async (req: Request, res: Response) => {\n    try {\n      const branches = await getBranches();\n      res.json({ branches });\n    } catch (error) {\n      handleError(res, error, \"Failed to get branches\");\n    }\n  });\n\n  app.get(\"/api/github/changes\", async (req: Request, res: Response) => {\n    try {\n      const changes = await getFileChanges();\n      res.json({ \n        status: \"success\",\n        changes,\n        summary: `${changes.modified.length} modified, ${changes.created.length} created, ${changes.deleted.length} deleted`\n      });\n    } catch (error) {\n      handleError(res, error, \"Failed to get file changes\");\n    }\n  });\n\n  app.post(\"/api/github/push\", async (req: Request, res: Response) => {\n    try {\n      const { message, owner, repo, branch } = req.body;\n      \n      if (!message) {\n        return res.status(400).json({ error: \"Commit message is required\" });\n      }\n\n      if (!owner || !repo) {\n        return res.status(400).json({ error: \"Repository owner and name are required\" });\n      }\n\n      const targetBranch = branch || \"main\";\n      console.log(\"[GitHub] Received push request:\", { owner, repo, branch: targetBranch, message });\n      const result = await pushToGitHubRepo(owner, repo, message, targetBranch);\n\n      if (result.success) {\n        res.json({ status: \"success\", message: \"Changes pushed successfully\", branch: targetBranch });\n      } else {\n        res.status(500).json({ error: \"Failed to push changes\" });\n      }\n    } catch (error) {\n      handleError(res, error, \"Failed to push to GitHub\");\n    }\n  });\n\n  app.get(\"/api/github/linked-repo\", async (req: Request, res: Response) => {\n    try {\n      const settings = await storage.getGithubSettings();\n      if (settings) {\n        res.json({ status: \"linked\", owner: settings.repoOwner, repo: settings.repoName });\n      } else {\n        res.json({ status: \"not_linked\" });\n      }\n    } catch (error) {\n      handleError(res, error, \"Failed to get linked repository\");\n    }\n  });\n\n  app.post(\"/api/github/link-repo\", async (req: Request, res: Response) => {\n    try {\n      const { owner, repo } = req.body;\n      if (!owner || !repo) {\n        return res.status(400).json({ error: \"Owner and repo name required\" });\n      }\n      const settings = await storage.linkGithubRepository(owner, repo);\n      res.json({ status: \"success\", settings });\n    } catch (error) {\n      handleError(res, error, \"Failed to link repository\");\n    }\n  });\n\n  app.post(\"/api/github/unlink-repo\", async (req: Request, res: Response) => {\n    try {\n      await storage.unlinkGithubRepository();\n      res.json({ status: \"success\", message: \"Repository unlinked\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to unlink repository\");\n    }\n  });\n\n  // ============ Advanced AI Rules - Entity Replacements ============\n  app.get(\"/api/tasks/:taskId/entity-replacements\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const replacements = await storage.getEntityReplacements(taskId);\n      res.json(replacements);\n    } catch (error) {\n      handleError(res, error, \"Failed to get entity replacements\");\n    }\n  });\n\n  app.post(\"/api/tasks/:taskId/entity-replacements\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const data = { ...req.body, taskId };\n      const replacement = await storage.createEntityReplacement(data);\n      res.json(replacement);\n    } catch (error) {\n      handleError(res, error, \"Failed to create entity replacement\");\n    }\n  });\n\n  app.patch(\"/api/entity-replacements/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.updateEntityReplacement(id, req.body);\n      res.json({ message: \"Entity replacement updated\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to update entity replacement\");\n    }\n  });\n\n  app.delete(\"/api/entity-replacements/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteEntityReplacement(id);\n      res.json({ message: \"Entity replacement deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete entity replacement\");\n    }\n  });\n\n  // ============ Advanced AI Rules - Context Rules ============\n  app.get(\"/api/tasks/:taskId/context-rules\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const rules = await storage.getContextRules(taskId);\n      res.json(rules);\n    } catch (error) {\n      handleError(res, error, \"Failed to get context rules\");\n    }\n  });\n\n  app.post(\"/api/tasks/:taskId/context-rules\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const data = { ...req.body, taskId };\n      const rule = await storage.createContextRule(data);\n      res.json(rule);\n    } catch (error) {\n      handleError(res, error, \"Failed to create context rule\");\n    }\n  });\n\n  app.patch(\"/api/context-rules/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.updateContextRule(id, req.body);\n      res.json({ message: \"Context rule updated\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to update context rule\");\n    }\n  });\n\n  app.delete(\"/api/context-rules/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteContextRule(id);\n      res.json({ message: \"Context rule deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete context rule\");\n    }\n  });\n\n  // ============ Advanced AI Rules - Training Examples ============\n  app.get(\"/api/training-examples\", async (req: Request, res: Response) => {\n    try {\n      const taskId = req.query.taskId ? parseInt(req.query.taskId as string) : undefined;\n      const exampleType = req.query.exampleType as string | undefined;\n      const examples = await storage.getTrainingExamples(taskId, exampleType);\n      res.json(examples);\n    } catch (error) {\n      handleError(res, error, \"Failed to get training examples\");\n    }\n  });\n\n  app.post(\"/api/training-examples\", async (req: Request, res: Response) => {\n    try {\n      const { taskId, exampleType, inputText, expectedOutput } = req.body;\n      \n      if (!taskId) {\n        return res.status(400).json({ error: \"taskId is required\" });\n      }\n      \n      if (!exampleType || !inputText || !expectedOutput) {\n        return res.status(400).json({ error: \"exampleType, inputText, and expectedOutput are required\" });\n      }\n      \n      const example = await storage.createTrainingExample(req.body);\n      res.json(example);\n    } catch (error) {\n      handleError(res, error, \"Failed to create training example\");\n    }\n  });\n\n  app.patch(\"/api/training-examples/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updated = await storage.updateTrainingExample(id, req.body);\n      res.json(updated);\n    } catch (error) {\n      handleError(res, error, \"Failed to update training example\");\n    }\n  });\n\n  app.delete(\"/api/training-examples/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteTrainingExample(id);\n      res.json({ message: \"Training example deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete training example\");\n    }\n  });\n\n  // ============ Advanced AI Rules - Processing Config ============\n  app.get(\"/api/processing-config\", async (req: Request, res: Response) => {\n    try {\n      const taskId = req.query.taskId ? parseInt(req.query.taskId as string) : undefined;\n      const config = await storage.getProcessingConfig(taskId);\n      res.json(config || {});\n    } catch (error) {\n      handleError(res, error, \"Failed to get processing config\");\n    }\n  });\n\n  app.post(\"/api/processing-config\", async (req: Request, res: Response) => {\n    try {\n      const configId = await storage.saveProcessingConfig(req.body);\n      res.json({ id: configId, message: \"Processing config saved\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to save processing config\");\n    }\n  });\n\n  // ============ AI Content Filters ============\n  app.get(\"/api/tasks/:taskId/content-filters\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const filters = await storage.getContentFilters(taskId);\n      res.json(filters);\n    } catch (error) {\n      handleError(res, error, \"Failed to get content filters\");\n    }\n  });\n\n  app.post(\"/api/tasks/:taskId/content-filters\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const data = { ...req.body, taskId };\n      const filter = await storage.createContentFilter(data);\n      res.json(filter);\n    } catch (error) {\n      handleError(res, error, \"Failed to create content filter\");\n    }\n  });\n\n  app.patch(\"/api/content-filters/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.updateContentFilter(id, req.body);\n      res.json({ message: \"Content filter updated\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to update content filter\");\n    }\n  });\n\n  app.delete(\"/api/content-filters/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteContentFilter(id);\n      res.json({ message: \"Content filter deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete content filter\");\n    }\n  });\n\n  // ============ AI Publishing Templates ============\n  app.get(\"/api/tasks/:taskId/publishing-templates\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const templates = await storage.getPublishingTemplates(taskId);\n      res.json(templates);\n    } catch (error) {\n      handleError(res, error, \"Failed to get publishing templates\");\n    }\n  });\n\n  app.get(\"/api/tasks/:taskId/publishing-templates/default\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const template = await storage.getDefaultTemplate(taskId);\n      res.json(template || {});\n    } catch (error) {\n      handleError(res, error, \"Failed to get default template\");\n    }\n  });\n\n  app.post(\"/api/tasks/:taskId/publishing-templates\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const data = { ...req.body, taskId };\n      const template = await storage.createPublishingTemplate(data);\n      res.json(template);\n    } catch (error) {\n      handleError(res, error, \"Failed to create publishing template\");\n    }\n  });\n\n  app.patch(\"/api/publishing-templates/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.updatePublishingTemplate(id, req.body);\n      res.json({ message: \"Publishing template updated\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to update publishing template\");\n    }\n  });\n\n  app.delete(\"/api/publishing-templates/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deletePublishingTemplate(id);\n      res.json({ message: \"Publishing template deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete publishing template\");\n    }\n  });\n\n  // ============ Template Custom Fields ============\n  app.get(\"/api/publishing-templates/:templateId/custom-fields\", async (req: Request, res: Response) => {\n    try {\n      const templateId = parseInt(req.params.templateId);\n      const fields = await storage.getTemplateCustomFields(templateId);\n      res.json(fields);\n    } catch (error) {\n      handleError(res, error, \"Failed to get custom fields\");\n    }\n  });\n\n  app.post(\"/api/publishing-templates/:templateId/custom-fields\", async (req: Request, res: Response) => {\n    try {\n      const templateId = parseInt(req.params.templateId);\n      const data = { ...req.body, templateId };\n      const field = await storage.createTemplateCustomField(data);\n      res.json(field);\n    } catch (error) {\n      handleError(res, error, \"Failed to create custom field\");\n    }\n  });\n\n  app.patch(\"/api/custom-fields/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.updateTemplateCustomField(id, req.body);\n      res.json({ message: \"Custom field updated\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to update custom field\");\n    }\n  });\n\n  app.delete(\"/api/custom-fields/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteTemplateCustomField(id);\n      res.json({ message: \"Custom field deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete custom field\");\n    }\n  });\n\n  app.post(\"/api/publishing-templates/:templateId/custom-fields/reorder\", async (req: Request, res: Response) => {\n    try {\n      const templateId = parseInt(req.params.templateId);\n      const { fieldOrders } = req.body;\n      await storage.reorderTemplateCustomFields(templateId, fieldOrders);\n      res.json({ message: \"Custom fields reordered\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to reorder custom fields\");\n    }\n  });\n\n  // ============ Message Archive ============\n  app.get(\"/api/archive\", async (req: Request, res: Response) => {\n    try {\n      const filters = {\n        taskId: req.query.taskId ? parseInt(req.query.taskId as string) : undefined,\n        search: req.query.search as string,\n        classification: req.query.classification as string,\n        province: req.query.province as string,\n        specialist: req.query.specialist as string,\n        newsType: req.query.newsType as string,\n        status: req.query.status as string,\n        dateFrom: req.query.dateFrom as string,\n        dateTo: req.query.dateTo as string,\n        isPinned: req.query.isPinned === 'true' ? true : req.query.isPinned === 'false' ? false : undefined,\n        isFlagged: req.query.isFlagged === 'true' ? true : req.query.isFlagged === 'false' ? false : undefined,\n        limit: req.query.limit ? parseInt(req.query.limit as string) : 50,\n        offset: req.query.offset ? parseInt(req.query.offset as string) : 0,\n        sortBy: req.query.sortBy as string,\n        sortOrder: (req.query.sortOrder as 'asc' | 'desc') || 'desc',\n      };\n      const result = await storage.getArchiveMessages(filters);\n      res.json(result);\n    } catch (error) {\n      handleError(res, error, \"Failed to get archive messages\");\n    }\n  });\n\n  app.get(\"/api/archive/stats\", async (req: Request, res: Response) => {\n    try {\n      const taskId = req.query.taskId ? parseInt(req.query.taskId as string) : undefined;\n      const stats = await storage.getArchiveStats(taskId);\n      res.json(stats);\n    } catch (error) {\n      handleError(res, error, \"Failed to get archive stats\");\n    }\n  });\n\n  app.get(\"/api/archive/filters\", async (req: Request, res: Response) => {\n    try {\n      const taskId = req.query.taskId ? parseInt(req.query.taskId as string) : undefined;\n      const options = await storage.getArchiveFilterOptions(taskId);\n      res.json(options);\n    } catch (error) {\n      handleError(res, error, \"Failed to get filter options\");\n    }\n  });\n\n  app.get(\"/api/archive/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const message = await storage.getArchiveMessage(id);\n      if (!message) {\n        return res.status(404).json({ error: \"Archive message not found\" });\n      }\n      res.json(message);\n    } catch (error) {\n      handleError(res, error, \"Failed to get archive message\");\n    }\n  });\n\n  app.put(\"/api/archive/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const message = await storage.updateArchiveMessage(id, req.body);\n      res.json(message);\n    } catch (error) {\n      handleError(res, error, \"Failed to update archive message\");\n    }\n  });\n\n  app.delete(\"/api/archive/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteArchiveMessage(id);\n      res.json({ message: \"Archive message deleted\" });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete archive message\");\n    }\n  });\n\n  app.post(\"/api/archive/:id/toggle-pin\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const message = await storage.toggleArchivePin(id);\n      res.json(message);\n    } catch (error) {\n      handleError(res, error, \"Failed to toggle pin\");\n    }\n  });\n\n  app.post(\"/api/archive/:id/toggle-flag\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { reason } = req.body;\n      const message = await storage.toggleArchiveFlag(id, reason);\n      res.json(message);\n    } catch (error) {\n      handleError(res, error, \"Failed to toggle flag\");\n    }\n  });\n\n  app.get(\"/api/tasks/:taskId/archive/serial\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const serial = await storage.getCurrentSerialNumber(taskId);\n      res.json({ taskId, currentSerial: serial });\n    } catch (error) {\n      handleError(res, error, \"Failed to get serial number\");\n    }\n  });\n\n  app.post(\"/api/tasks/:taskId/archive/reset-serial\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      await storage.resetSerialCounter(taskId);\n      res.json({ message: \"Serial counter reset\", taskId });\n    } catch (error) {\n      handleError(res, error, \"Failed to reset serial counter\");\n    }\n  });\n\n  app.delete(\"/api/tasks/:taskId/archive\", async (req: Request, res: Response) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const count = await storage.deleteArchiveMessagesByTask(taskId);\n      res.json({ message: `Deleted ${count} archive messages`, count });\n    } catch (error) {\n      handleError(res, error, \"Failed to delete task archive\");\n    }\n  });\n\n  // ============ Text-to-Speech (Groq PlayAI) ============\n  \n  // Get available TTS voices\n  app.get(\"/api/tts/voices\", async (req: Request, res: Response) => {\n    try {\n      const voices = [\n        // Arabic voices (playai-tts-arabic model)\n        { id: \"Nasser-PlayAI\", name: \"ŸÜÿßÿµÿ±\", language: \"ar\", gender: \"male\", description: \"ÿµŸàÿ™ ÿπÿ±ÿ®Ÿä ÿ±ÿ¨ÿßŸÑŸä\", model: \"playai-tts-arabic\" },\n        { id: \"Salma-PlayAI\", name: \"ÿ≥ŸÑŸÖŸâ\", language: \"ar\", gender: \"female\", description: \"ÿµŸàÿ™ ÿπÿ±ÿ®Ÿä ŸÜÿ≥ÿßÿ¶Ÿä\", model: \"playai-tts-arabic\" },\n        { id: \"Shakir-PlayAI\", name: \"ÿ¥ÿßŸÉÿ±\", language: \"ar\", gender: \"male\", description: \"ÿµŸàÿ™ ÿπÿ±ÿ®Ÿä ÿ±ÿ¨ÿßŸÑŸä\", model: \"playai-tts-arabic\" },\n        { id: \"Amina-PlayAI\", name: \"ÿ£ŸÖŸäŸÜÿ©\", language: \"ar\", gender: \"female\", description: \"ÿµŸàÿ™ ÿπÿ±ÿ®Ÿä ŸÜÿ≥ÿßÿ¶Ÿä\", model: \"playai-tts-arabic\" },\n        \n        // English voices (playai-tts model)\n        { id: \"Aaliyah-PlayAI\", name: \"Aaliyah\", language: \"en\", gender: \"female\", description: \"American female voice\", model: \"playai-tts\" },\n        { id: \"Adelaide-PlayAI\", name: \"Adelaide\", language: \"en\", gender: \"female\", description: \"Australian female voice\", model: \"playai-tts\" },\n        { id: \"Angelo-PlayAI\", name: \"Angelo\", language: \"en\", gender: \"male\", description: \"American male voice\", model: \"playai-tts\" },\n        { id: \"Atlas-PlayAI\", name: \"Atlas\", language: \"en\", gender: \"male\", description: \"American male voice\", model: \"playai-tts\" },\n        { id: \"Basil-PlayAI\", name: \"Basil\", language: \"en\", gender: \"male\", description: \"British male voice\", model: \"playai-tts\" },\n        { id: \"Celeste-PlayAI\", name: \"Celeste\", language: \"en\", gender: \"female\", description: \"British female voice\", model: \"playai-tts\" },\n      ];\n      res.json(voices);\n    } catch (error) {\n      handleError(res, error, \"Failed to get TTS voices\");\n    }\n  });\n\n  // Check if Groq API key is configured\n  app.get(\"/api/tts/status\", async (req: Request, res: Response) => {\n    try {\n      // Check environment first, then database\n      let hasApiKey = !!process.env.GROQ_API_KEY;\n      \n      if (!hasApiKey) {\n        const providers = await storage.getAiProviders();\n        const groqProvider = providers.find((p: any) => p.name.toLowerCase() === \"groq\");\n        hasApiKey = !!(groqProvider && groqProvider.apiKey && groqProvider.isActive);\n      }\n      \n      res.json({ \n        configured: hasApiKey,\n        message: hasApiKey ? \"Groq TTS is ready\" : \"GROQ_API_KEY not configured\"\n      });\n    } catch (error) {\n      handleError(res, error, \"Failed to check TTS status\");\n    }\n  });\n\n  // Convert text to speech using Groq PlayAI\n  app.post(\"/api/tts/speak\", async (req: Request, res: Response) => {\n    try {\n      const { text, voice = \"Nasser-PlayAI\" } = req.body;\n      \n      if (!text || text.trim().length === 0) {\n        return res.status(400).json({ error: \"Text is required\" });\n      }\n\n      // Try to get API key from environment first, then from database\n      let apiKey = process.env.GROQ_API_KEY;\n      \n      if (!apiKey) {\n        const providers = await storage.getAiProviders();\n        const groqProvider = providers.find((p: any) => p.name.toLowerCase() === \"groq\");\n        \n        if (groqProvider && groqProvider.apiKey && groqProvider.isActive) {\n          apiKey = groqProvider.apiKey;\n        }\n      }\n      \n      if (!apiKey) {\n        return res.status(400).json({ \n          error: \"GROQ_API_KEY not configured\",\n          needsApiKey: true\n        });\n      }\n\n      // Limit text length to prevent abuse\n      const maxLength = 4000;\n      const trimmedText = text.slice(0, maxLength);\n\n      // Determine model based on voice\n      const isArabicVoice = voice.includes(\"Nasser\") || voice.includes(\"Salma\") || \n                           voice.includes(\"Shakir\") || voice.includes(\"Amina\");\n      const model = isArabicVoice ? \"playai-tts-arabic\" : \"playai-tts\";\n\n      const response = await fetch(\"https://api.groq.com/openai/v1/audio/speech\", {\n        method: \"POST\",\n        headers: {\n          \"Authorization\": `Bearer ${apiKey}`,\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          model: model,\n          input: trimmedText,\n          voice: voice,\n          response_format: \"mp3\"\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        console.error(\"Groq TTS Error:\", errorData);\n        return res.status(response.status).json({ \n          error: \"TTS conversion failed\", \n          details: errorData \n        });\n      }\n\n      // Get audio buffer\n      const audioBuffer = await response.arrayBuffer();\n      \n      // Return as base64 for easy client handling\n      const base64Audio = Buffer.from(audioBuffer).toString('base64');\n      \n      res.json({\n        audio: base64Audio,\n        format: \"mp3\",\n        voice: voice,\n        model: model,\n        textLength: trimmedText.length\n      });\n    } catch (error) {\n      handleError(res, error, \"Failed to convert text to speech\");\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":48876,"size_tokens":null},"client/src/components/layout.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { cn } from \"@/lib/utils\";\nimport { useTranslation } from \"react-i18next\";\nimport { useTheme } from \"next-themes\";\nimport { \n  LayoutDashboard, \n  Workflow, \n  Bot, \n  Radio, \n  Settings, \n  LogOut,\n  Shield,\n  Sun,\n  Moon,\n  Languages,\n  Menu,\n  X,\n  Github,\n  Archive\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { EagleLogo } from \"@/components/eagle-logo\";\n\nexport default function Layout({ children }: { children: React.ReactNode }) {\n  const [location] = useLocation();\n  const { t, i18n } = useTranslation();\n  const { theme, setTheme } = useTheme();\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n\n  useEffect(() => {\n    document.documentElement.dir = i18n.language === 'ar' ? 'rtl' : 'ltr';\n    document.documentElement.lang = i18n.language;\n  }, [i18n.language]);\n\n  // Close sidebar when route changes on mobile\n  useEffect(() => {\n    setSidebarOpen(false);\n  }, [location]);\n\n  const navItems = [\n    { icon: LayoutDashboard, label: t('nav.overview'), path: \"/\" },\n    { icon: Workflow, label: t('nav.tasks'), path: \"/tasks\" },\n    { icon: Radio, label: t('nav.channels'), path: \"/channels\" },\n    { icon: Bot, label: t('nav.ai'), path: \"/ai-config\" },\n    { icon: Archive, label: \"ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ\", path: \"/archive\" },\n    { icon: Github, label: \"GitHub\", path: \"/github\" },\n    { icon: Settings, label: t('nav.settings'), path: \"/settings\" },\n  ];\n\n  return (\n    <div className=\"flex h-screen w-full overflow-hidden bg-background text-foreground font-sans selection:bg-primary/20\">\n      {/* Mobile Overlay */}\n      {sidebarOpen && (\n        <div \n          className=\"fixed inset-0 bg-black/50 z-40 lg:hidden\"\n          onClick={() => setSidebarOpen(false)}\n        />\n      )}\n\n      {/* Sidebar */}\n      <aside \n        className={cn(\n          \"fixed lg:static inset-y-0 z-50 w-64 flex-shrink-0 text-foreground backdrop-blur-sm flex flex-col transition-transform duration-300 bg-white/90 dark:bg-black/80\",\n          i18n.language === 'ar' ? \"border-l border-border\" : \"border-r border-border\"\n        )}\n        style={i18n.language === 'ar' \n          ? { right: sidebarOpen ? '0' : '100%' } \n          : { left: sidebarOpen ? '0' : '-100%' }\n        }\n      >\n        <div className=\"p-6 border-b border-border flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center border border-primary/20 shadow-[0_0_15px_hsl(var(--primary)/0.2)]\">\n              <EagleLogo size={24} flip={i18n.language === 'ar'} className=\"text-black dark:text-white\" />\n            </div>\n            <div>\n              <h1 className=\"font-display font-bold text-lg tracking-wider text-foreground\">{t('app.name')}</h1>\n              <p className=\"text-xs text-muted-foreground font-mono\">v2.4.0-BETA</p>\n            </div>\n          </div>\n          {/* Close button for mobile */}\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            className=\"lg:hidden\"\n            onClick={() => setSidebarOpen(false)}\n          >\n            <X className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        <nav className=\"flex-1 p-4 space-y-2 overflow-y-auto\">\n          {navItems.map((item) => {\n            const isActive = location === item.path;\n            return (\n              <Link key={item.path} href={item.path}>\n                <div\n                  className={cn(\n                    \"flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 group cursor-pointer\",\n                    isActive \n                      ? \"bg-primary/10 text-primary border border-primary/20 shadow-[0_0_10px_hsl(var(--primary)/0.1)]\" \n                      : \"text-muted-foreground hover:text-foreground hover:bg-accent\"\n                  )}\n                >\n                  <item.icon className={cn(\"h-5 w-5\", isActive && \"animate-pulse\")} />\n                  <span className=\"font-medium tracking-wide\">{item.label}</span>\n                </div>\n              </Link>\n            );\n          })}\n        </nav>\n\n        <div className=\"p-4 border-t border-border space-y-4\">\n          <div className=\"bg-muted/50 rounded-xl p-4 border border-border\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-xs text-muted-foreground\">{t('nav.system_load')}</span>\n              <span className=\"text-xs text-primary font-mono\">24%</span>\n            </div>\n            <div className=\"h-1 w-full bg-muted rounded-full overflow-hidden\">\n              <div className=\"h-full bg-primary w-[24%] shadow-[0_0_10px_currentColor]\" />\n            </div>\n          </div>\n          \n          <button \n            onClick={() => {\n              localStorage.removeItem(\"isAdmin\");\n              localStorage.removeItem(\"adminToken\");\n              localStorage.removeItem(\"adminUser\");\n              window.location.href = \"/auth\";\n            }}\n            className=\"flex w-full items-center gap-3 px-4 py-3 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition-colors\"\n          >\n            <LogOut className=\"h-5 w-5\" />\n            <span>{t('nav.disconnect')}</span>\n          </button>\n        </div>\n      </aside>\n\n      {/* Main Content */}\n      <main className=\"flex-1 flex flex-col overflow-hidden relative\">\n        {/* Top Bar */}\n        <header className=\"h-16 border-b border-border bg-background/50 backdrop-blur-sm flex items-center justify-between px-4 md:px-8 z-10\">\n          <div className=\"flex items-center gap-4\">\n            {/* Mobile menu button */}\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              className=\"lg:hidden\"\n              onClick={() => setSidebarOpen(true)}\n              data-testid=\"button-toggle-sidebar\"\n            >\n              <Menu className=\"h-5 w-5\" />\n            </Button>\n\n            <div className=\"flex items-center gap-2 px-3 py-1 rounded-full bg-green-500/10 border border-green-500/20\">\n              <div className=\"h-2 w-2 rounded-full bg-green-500 animate-pulse\" />\n              <span className=\"text-xs font-medium text-green-600 dark:text-green-500 uppercase tracking-wider hidden sm:inline\">{t('common.system_online')}</span>\n            </div>\n            <div className=\"h-4 w-px bg-border hidden sm:block\" />\n            <span className=\"text-sm text-muted-foreground font-mono hidden sm:inline\">{t('common.latency')}: 42ms</span>\n          </div>\n\n          <div className=\"flex items-center gap-2 md:gap-4\">\n            {/* Theme Toggle */}\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setTheme(theme === \"dark\" ? \"light\" : \"dark\")}\n              className=\"text-muted-foreground hover:text-foreground\"\n              data-testid=\"button-toggle-theme\"\n            >\n              <Sun className=\"h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n              <Moon className=\"absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n              <span className=\"sr-only\">Toggle theme</span>\n            </Button>\n\n            {/* Language Toggle */}\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground hover:text-foreground\">\n                  <Languages className=\"h-5 w-5\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem onClick={() => i18n.changeLanguage('en')}>\n                  English\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => i18n.changeLanguage('ar')}>\n                  ÿßŸÑÿπÿ±ÿ®Ÿäÿ©\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n\n            <div className=\"flex items-center gap-3 pl-2 md:pl-4 border-l border-border\">\n              <div className=\"text-right hidden md:block\">\n                <p className=\"text-sm font-medium text-foreground\">{t('common.admin_user')}</p>\n                <p className=\"text-xs text-muted-foreground\">{t('common.level_access')}</p>\n              </div>\n              <div className=\"h-10 w-10 rounded-full bg-secondary/20 border border-secondary/50 flex items-center justify-center\">\n                <Shield className=\"h-5 w-5 text-secondary\" />\n              </div>\n            </div>\n          </div>\n        </header>\n\n        {/* Page Content */}\n        <div className=\"flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth\">\n          {children}\n        </div>\n        \n        {/* Background Grid/Effects */}\n        <div className=\"absolute inset-0 pointer-events-none z-[-1] opacity-10 dark:opacity-20\" \n             style={{ \n               backgroundImage: 'linear-gradient(hsl(var(--muted-foreground)/0.1) 1px, transparent 1px), linear-gradient(90deg, hsl(var(--muted-foreground)/0.1) 1px, transparent 1px)', \n               backgroundSize: '40px 40px' \n             }} \n        />\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":9427,"size_tokens":null},"telegram_bot/utils/channel_utils.py":{"content":"\"\"\"Channel utilities for ID normalization\"\"\"\n\ndef normalize_channel_id(channel_id: str | int) -> int | str:\n    \"\"\"\n    Convert channel ID to proper Pyrogram format.\n    Telegram private channel IDs must start with -100.\n    Works with both bot mode and userbot mode.\n    \"\"\"\n    try:\n        # Try to convert to int\n        id_int = int(channel_id)\n        \n        # If it's a small positive number (1-999), it's likely a database ID\n        # Convert to proper Telegram private channel ID format: -100XXXXX\n        if 0 < id_int < 10000:\n            return -100 * 1000000 + id_int\n        \n        # If it's already a large negative number, return as is\n        if id_int < 0:\n            return id_int\n        \n        # If it's a large positive number, assume it's already correct\n        return id_int\n    except (ValueError, TypeError):\n        # Return as string (username or link)\n        return str(channel_id)\n","path":null,"size_bytes":921,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\nimport { \n  Activity, \n  MessageSquare, \n  Zap, \n  Users, \n  TrendingUp,\n  Clock,\n  Loader\n} from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Area, AreaChart, CartesianGrid, ResponsiveContainer, Tooltip, XAxis, YAxis } from \"recharts\";\n\nconst chartData = [\n  { time: \"00:00\", messages: 120, ai: 45 },\n  { time: \"04:00\", messages: 80, ai: 20 },\n  { time: \"08:00\", messages: 450, ai: 180 },\n  { time: \"12:00\", messages: 980, ai: 420 },\n  { time: \"16:00\", messages: 850, ai: 380 },\n  { time: \"20:00\", messages: 600, ai: 250 },\n  { time: \"23:59\", messages: 300, ai: 100 },\n];\n\nexport default function Dashboard() {\n  const { t, i18n } = useTranslation();\n\n  const { data: stats, isLoading } = useQuery({\n    queryKey: [\"dashboard-stats\"],\n    queryFn: () => api.getDashboardStats(),\n    refetchInterval: 5000,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <Loader className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  const statCards = [\n    { \n      title: t('dashboard.total_messages'), \n      value: stats?.totalForwarded || \"0\", \n      icon: MessageSquare, \n      change: \"+12%\", \n      color: \"text-blue-600 dark:text-blue-400\" \n    },\n    { \n      title: t('dashboard.active_tasks'), \n      value: stats?.activeTasks || \"0\", \n      icon: Zap, \n      change: stats?.inactiveTasks ? `+${stats.inactiveTasks}` : \"0\", \n      color: \"text-yellow-600 dark:text-yellow-400\" \n    },\n    { \n      title: t('dashboard.ai_operations'), \n      value: stats?.aiEnabledTasks || \"0\", \n      icon: Activity, \n      change: \"+24%\", \n      color: \"text-purple-600 dark:text-purple-400\" \n    },\n    { \n      title: t('dashboard.monitored_channels'), \n      value: stats?.totalChannels || \"0\", \n      icon: Users, \n      change: \"+3\", \n      color: \"text-green-600 dark:text-green-400\" \n    },\n  ];\n\n  return (\n    <div className=\"space-y-6 md:space-y-8\" dir={i18n.language === 'ar' ? 'rtl' : 'ltr'}>\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-end justify-between gap-4\">\n        <div className={i18n.language === 'ar' ? 'text-right' : 'text-left'}>\n          <h2 className=\"text-2xl md:text-3xl font-display font-bold text-foreground tracking-wide\">{t('dashboard.title')}</h2>\n          <p className=\"text-muted-foreground mt-1 text-sm md:text-base\">{t('dashboard.subtitle')}</p>\n        </div>\n        <div className=\"flex gap-2\">\n          <span className=\"px-3 py-1 bg-card border border-border rounded text-xs font-mono text-muted-foreground\">\n            {t('dashboard.uptime')}: ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ\n          </span>\n        </div>\n      </div>\n\n      {/* Stats Grid */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6\">\n        {statCards.map((stat, i) => (\n          <motion.div\n            key={i}\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: i * 0.1 }}\n          >\n            <Card className=\"border shadow-sm hover:shadow-md transition-shadow\" data-testid={`card-stat-${i}`}>\n              <CardContent className=\"p-4 md:p-6\">\n                <div className=\"flex justify-between items-start mb-4\">\n                  <div className={`p-2 md:p-3 rounded-xl bg-muted ${stat.color}`}>\n                    <stat.icon className=\"h-5 w-5 md:h-6 md:w-6\" />\n                  </div>\n                  <span className=\"text-xs font-medium text-green-600 dark:text-green-500 flex items-center gap-1 bg-green-500/10 px-2 py-1 rounded-full\">\n                    {stat.change} <TrendingUp className=\"h-3 w-3\" />\n                  </span>\n                </div>\n                <div>\n                  <p className=\"text-xs md:text-sm text-muted-foreground font-medium uppercase tracking-wider\">{stat.title}</p>\n                  <h3 className=\"text-2xl md:text-3xl font-bold text-foreground mt-1\" data-testid={`text-stat-value-${i}`}>{stat.value}</h3>\n                </div>\n              </CardContent>\n            </Card>\n          </motion.div>\n        ))}\n      </div>\n\n      {/* Main Chart Section */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6\">\n        <Card className=\"border shadow-sm lg:col-span-2\">\n          <CardHeader>\n            <CardTitle className=\"text-base md:text-lg font-medium text-foreground flex items-center gap-2\">\n              <Activity className=\"h-5 w-5 text-primary\" /> {t('dashboard.throughput')}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"h-[250px] md:h-[300px]\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <AreaChart data={chartData}>\n                <defs>\n                  <linearGradient id=\"colorMessages\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                    <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3}/>\n                    <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0}/>\n                  </linearGradient>\n                  <linearGradient id=\"colorAi\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                    <stop offset=\"5%\" stopColor=\"hsl(var(--secondary))\" stopOpacity={0.3}/>\n                    <stop offset=\"95%\" stopColor=\"hsl(var(--secondary))\" stopOpacity={0}/>\n                  </linearGradient>\n                </defs>\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" vertical={false} />\n                <XAxis dataKey=\"time\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                <Tooltip \n                  contentStyle={{ backgroundColor: 'hsl(var(--card))', borderColor: 'hsl(var(--border))', borderRadius: '8px' }}\n                  itemStyle={{ color: 'hsl(var(--foreground))' }}\n                />\n                <Area type=\"monotone\" dataKey=\"messages\" stroke=\"hsl(var(--primary))\" strokeWidth={2} fillOpacity={1} fill=\"url(#colorMessages)\" />\n                <Area type=\"monotone\" dataKey=\"ai\" stroke=\"hsl(var(--secondary))\" strokeWidth={2} fillOpacity={1} fill=\"url(#colorAi)\" />\n              </AreaChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n\n        {/* Live Logs Panel */}\n        <Card className=\"border shadow-sm flex flex-col\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-base md:text-lg font-medium text-foreground flex items-center justify-between\">\n              <span className=\"flex items-center gap-2\"><Clock className=\"h-5 w-5 text-primary\" /> {t('dashboard.live_logs')}</span>\n              <span className=\"h-2 w-2 rounded-full bg-green-500 animate-pulse\"></span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"flex-1 overflow-y-auto space-y-2\">\n            <div className=\"text-xs text-green-600 dark:text-green-500\">‚úì ŸÜÿ∏ÿßŸÖ ŸÇŸäÿØ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ</div>\n            <div className=\"text-xs text-muted-foreground\">‚àò ÿ¨ÿßÿ±Ÿä ÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</div>\n            <div className=\"text-xs text-muted-foreground\">‚àò ÿπÿØÿØ ÿßŸÑŸÖŸáÿßŸÖ: {stats?.totalTasks || 0}</div>\n            <div className=\"text-xs text-muted-foreground\">‚àò ÿßŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑŸÖÿ±ÿßŸÇÿ®ÿ©: {stats?.totalChannels || 0}</div>\n            <div className=\"text-xs text-purple-600 dark:text-purple-400\">‚óá ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä: ŸÜÿ¥ÿ∑</div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7775,"size_tokens":null},"docker-entrypoint.sh":{"content":"#!/bin/sh\nset -e\n\necho \"[INFO] Starting BotNexus container entrypoint...\"\n\n# Function to log with timestamp\nlog_info() {\n    echo \"[$(date -Iseconds)] [INFO] $1\"\n}\n\nlog_error() {\n    echo \"[$(date -Iseconds)] [ERROR] $1\" >&2\n}\n\n# Sanitize DATABASE_URL if it contains multiple hosts\n# Some providers (like Northflank) provide URLs with multiple hosts (primary,read)\n# which is not supported by standard URL parsers\nsanitize_database_url() {\n    if [ -n \"$DATABASE_URL\" ]; then\n        # Check if URL contains comma (multiple hosts)\n        if echo \"$DATABASE_URL\" | grep -q \",\"; then\n            log_info \"Detected multi-host DATABASE_URL, extracting primary host...\"\n            \n            # Extract parts of the URL\n            # Format: postgresql://user:pass@host1:port,host2:port/dbname?params\n            \n            # Get the protocol and credentials part (before @)\n            PROTO_CREDS=$(echo \"$DATABASE_URL\" | sed -E 's/^([^@]+@).*/\\1/')\n            \n            # Get the hosts part (between @ and /)\n            HOSTS_PART=$(echo \"$DATABASE_URL\" | sed -E 's/^[^@]+@([^\\/]+)\\/.*/\\1/')\n            \n            # Get the database and params part (after hosts)\n            DB_PARAMS=$(echo \"$DATABASE_URL\" | sed -E 's/^[^@]+@[^\\/]+\\/(.*)/\\1/')\n            \n            # Extract only the first host (primary)\n            PRIMARY_HOST=$(echo \"$HOSTS_PART\" | cut -d',' -f1)\n            \n            # Reconstruct the URL with only the primary host\n            export DATABASE_URL=\"${PROTO_CREDS}${PRIMARY_HOST}/${DB_PARAMS}\"\n            \n            log_info \"Using primary host: $PRIMARY_HOST\"\n        fi\n    fi\n}\n\n# Wait for PostgreSQL to be ready\nwait_for_postgres() {\n    if [ -n \"$DATABASE_URL\" ]; then\n        log_info \"Waiting for PostgreSQL to be ready...\"\n        max_attempts=30\n        attempt=0\n        \n        while [ $attempt -lt $max_attempts ]; do\n            if pg_isready -d \"$DATABASE_URL\" > /dev/null 2>&1; then\n                log_info \"PostgreSQL is ready!\"\n                return 0\n            fi\n            attempt=$((attempt + 1))\n            log_info \"Waiting for PostgreSQL... (attempt $attempt/$max_attempts)\"\n            sleep 2\n        done\n        \n        log_error \"PostgreSQL did not become ready in time\"\n        return 1\n    fi\n}\n\n# Run database migrations\nrun_migrations() {\n    log_info \"Running database migrations...\"\n    if npm run db:push; then\n        log_info \"Database migrations completed successfully\"\n    else\n        log_error \"Database migrations failed, but continuing...\"\n    fi\n}\n\n# Main execution\nmain() {\n    # Sanitize DATABASE_URL first (handle multi-host URLs)\n    sanitize_database_url\n    \n    # Wait for database if configured\n    if [ -n \"$DATABASE_URL\" ]; then\n        wait_for_postgres\n        run_migrations\n    fi\n    \n    log_info \"Starting application...\"\n    \n    # Execute the main command\n    exec \"$@\"\n}\n\nmain \"$@\"\n","path":null,"size_bytes":2901,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"anthropic>=0.75.0\",\n    \"asyncpg>=0.31.0\",\n    \"fastapi>=0.123.0\",\n    \"ffmpeg-python>=0.2.0\",\n    \"groq>=0.36.0\",\n    \"openai>=2.8.1\",\n    \"pillow>=12.0.0\",\n    \"pyrofork>=2.3.68\",\n    \"pyrogram>=2.0.106\",\n    \"python-dotenv>=1.2.1\",\n    \"telegraph>=2.2.0\",\n    \"tgcrypto>=1.2.5\",\n    \"uvicorn>=0.38.0\",\n]\n\n[[tool.uv.index]]\nexplicit = true\nname = \"pytorch-cpu\"\nurl = \"https://download.pytorch.org/whl/cpu\"\n\n[tool.uv.sources]\nAA-module = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nABlooper = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nAnalysisG = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nAutoRAG = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nBERTeam = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nBxTorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nByaldi = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nCALM-Pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nCOPEX-high-rate-compression-quality-metrics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nCityLearn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nCoCa-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nCoLT5-attention = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nComfyUI-EasyNodes = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nCrawl4AI = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nDALL-E = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nDI-toolkit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nDatasetRising = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nDeepCache = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nDeepMatter = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nDraugr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nESRNN = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nEn-transformer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nExpoSeq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nFLAML = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nFSRS-Optimizer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nGANDLF = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nGQLAlchemy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nGhostScan = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nGraKeL = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nHEBO = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nIOPaint = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nISLP = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nInvokeAI = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nJAEN = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nKapoorLabs-Lightning = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nLightAutoML = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nLingerGRN = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nMMEdu = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nMRzeroCore = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nModeva = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nNeuralFoil = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nNiMARE = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nNinjaTools = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nOpenHosta = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nOpenNMT-py = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nPOT = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nPVNet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nPaLM-rlhf-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nPepperPepper = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nPiML = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nPoutyne = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nQNCP = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nRAGatouille = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nRareGO = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nRealtimeSTT = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nRelevanceAI-Workflows-Core = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nResemblyzer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nScandEval = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nSimba-UW-tf-dev = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nSwissArmyTransformer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nTPOT = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nTTS = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nTorchCRF = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nTotalSegmentator = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nUtilsRL = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nWhisperSpeech = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nXAISuite = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\na-unet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\na5dev = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naccelerate = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naccelerated-scan = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naccern-xyme = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nachatbot = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nacids-rave = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nactorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nacvl-utils = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nadabelief-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nadam-atan2-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nadan-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nadapters = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nadmin-torch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nadtoolbox = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nadversarial-robustness-toolbox = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naeiou = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naeon = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nafricanwhisper = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nag-llama-api = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nagentdojo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nagilerl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nai-edge-torch-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nai-parrot = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nai-python = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nai-transform = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nai2-olmo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nai2-olmo-core = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nai2-tango = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naicmder = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naider-chat = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naider-chat-x = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naif360 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naihwkit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naimodelshare = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nairllm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nairtestProject = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nairunner = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naisak = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naislib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naisquared = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naistore = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naithree = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nakasha-terminal = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nalibi = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nalibi-detect = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nalignn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nall-clip = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nallennlp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nallennlp-models = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nallennlp-pvt-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nallophant = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nallosaurus = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naloy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nalpaca-eval = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nalphafold2-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nalphafold3-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nalphamed-federated = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nalphawave = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\namazon-braket-pennylane-plugin = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\namazon-photos = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nanemoi-graphs = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nanemoi-models = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nanomalib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\napache-beam = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\napache-tvm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naperturedb = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naphrodite-engine = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naqlm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\narcAGI2024 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\narchisound = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nargbind = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\narize = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\narm-pytorch-utilities = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\narray-api-compat = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\narus = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nassert-llm-tools = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nasteroid = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nasteroid-filterbanks = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nastra-llm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nastrovision = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\natomate2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nattacut = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naudio-diffusion-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naudio-encoders-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naudio-separator = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naudiocraft = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naudiolm-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nauralis = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nauraloss = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nauto-gptq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nautoawq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nautoawq-kernels = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\n\"autogluon.multimodal\" = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\n\"autogluon.tabular\" = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\n\"autogluon.timeseries\" = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nautotrain-advanced = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\navdeepfake1m = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\naws-fortuna = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nax-platform = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nazureml-automl-dnn-vision = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nazureml-contrib-automl-dnn-forecasting = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nazureml-evaluate-mlflow = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nazureml-metrics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nazureml-train-automl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nb2bTools = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbackpack-for-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbalrog-nle = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbatch-face = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbatchalign = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbatchgeneratorsv2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbatchtensor = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbbrl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbenchpots = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbent = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbert-score = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbertopic = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbertviz = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbestOf = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbetty-ml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbig-sleep = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbigdl-core-cpp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbigdl-core-npu = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbigdl-llm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbigdl-nano = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\n\"bioimageio.core\" = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbitfount = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbitsandbytes = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbittensor = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbittensor-cli = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nblackboxopt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nblanc = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nblindai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbm25-pt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nboltz = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbotorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nboxmot = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbrainchain = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbraindecode = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbrevitas = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbriton = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbrowsergym-visualwebarena = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbuzz-captions = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbyotrack = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nbyzerllm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nc4v-py = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncalflops = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncame-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncamel-ai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncamel-tools = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncannai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncaptum = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncarte-ai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncarvekit-colab = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncatalyst = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncausalml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncausalnex = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncausy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncbrkit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncca-zoo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncdp-backend = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncellacdc = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncellfinder = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncellpose = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncellxgene-census = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nchattts = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nchemprop = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nchgnet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nchitra = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncircuitsvis = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncjm-yolox-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclarinpl-embeddings = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclass-resolver = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclassifier-free-guidance-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclassiq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclassy-core = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclean-fid = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncleanvision = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclip-anytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclip-benchmark = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclip-by-openai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclip-interrogator = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclip-retrieval = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncltk = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclu = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nclusterops = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncnocr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncnstd = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncoba = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncofi = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncolbert-ai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncolpali-engine = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncompel = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncomposabl-ray = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncomposabl-ray-dev = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncomposabl-train = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncomposabl-train-dev = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncomposer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncompressai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncompressed-tensors = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncompressed-tensors-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nconcrete-python = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nconfit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nconformer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncontextualSpellCheck = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncontinual-inference = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncontrolnet-aux = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nconvokit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncoola = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncoqui-tts = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncoqui-tts-trainer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncraft-text-detector = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncreme = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncrocodile = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncrowd-kit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncryoSPHERE = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncsle-common = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncsle-system-identification = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nctgan = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncurated-transformers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncut-cross-entropy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncvat-sdk = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ncybertask = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nd3rlpy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndalle-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndalle2-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndanila-lib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndanling = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndarts = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndarwin-py = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndata-gradients = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndatachain = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndataclass-array = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndataeval = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndatarobot-drum = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndatarobotx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndatasets = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndatumaro = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndctorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeep-utils = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepchecks = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepchem = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepctr-torch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepecho = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepepochs = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepforest = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeeplabcut = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepmd-kit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepmultilingualpunctuation = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepparse = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeeprobust = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepsparse = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepsparse-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndeepspeed = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndenoising-diffusion-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndescript-audio-codec = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndescript-audiotools = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndetecto = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndetoxify = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndgenerate = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndghs-imgutils = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndgl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndialogy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndice-ml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndiffgram = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndiffq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndiffusers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndistilabel = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndistrifuser = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndnikit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndocarray = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndoclayout-yolo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndocling-ibm-models = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndocquery = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndomino-code-assist = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndreamsim = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndropblock = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndruida = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ndvclive = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ne2-tts-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ne2cnn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ne3nn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\neasyocr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nebtorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\necallisto-ng = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nedsnlp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\neffdet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\neinx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\neir-dl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\neis1600 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\neland = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nema-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nembedchain = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nenformer-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nentmax = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nesm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nespaloma-charge = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nespnet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\netils = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\netna = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nevadb = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nevalscope = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nevaluate = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nexllamav2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nextractable = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nface-alignment = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfacenet-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfacexlib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfair-esm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfairseq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfairseq2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfairseq2n = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfaker-file = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfarm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfast-bert = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfast-pytorch-kmeans = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfastai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfastcore = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfastestimator-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfasttreeshap = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfedml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfelupe = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfemr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfft-conv-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfickling = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfireworks-ai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nflair = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nflashrag-dev = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nflax = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nflexgen = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nflgo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nflopth = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nflowcept = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nflytekitplugins-kfpytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nflytekitplugins-onnxpytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfmbench = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfocal-frequency-loss = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfoldedtensor = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfractal-tasks-core = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfreegenius = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfreqtrade = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfschat = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfunasr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfunctorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfunlbm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nfunsor = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngalore-torch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngarak = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngarf = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngateloop-transformer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngeffnet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngenutility = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngfpgan = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngigagan-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngin-config = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nglasflow = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngliner = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngluonts = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngmft = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngoogle-cloud-aiplatform = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngpforecaster = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngpt3discord = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngpytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngrad-cam = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngraph-weather = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngraphistry = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngravitorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngretel-synthetics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngsplat = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nguardrails-ai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nguidance = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ngymnasium = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhanlp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhappytransformer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhbutils = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nheavyball = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhezar = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhf-deepali = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhf-doc-builder = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhigher = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhjxdl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhkkang-utils = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhordelib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhpsv2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhuggingface-hub = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhummingbird-ml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhvae-backbone = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhya = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nhypothesis-torch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nibm-metrics-plugin = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nibm-watson-machine-learning = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nibm-watsonx-ai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nicetk = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nicevision = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\niden = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nidvpackage = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\niglovikov-helper-functions = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nimagededup = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nimagen-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nimaginAIry = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nimg2vec-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nincendio = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninference = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninference-gpu = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninfinity-emb = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninfo-nce-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninfoapps-mlops-sdk = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninstructlab = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninstructlab-dolomite = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninstructlab-eval = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninstructlab-sdg = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninstructlab-training = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ninvisible-watermark = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\niobm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nipex-llm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\niree-turbine = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nirisml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nirisml-tasks-azure-openai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nirisml-tasks-torchvision = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nirisml-tasks-training = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nitem-matching = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nivadomed = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\njaqpotpy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\njina = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\njudo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\njunky = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nk-diffusion = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nk1lib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nk2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkappadata = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkappamodules = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkarbonn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkats = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkbnf = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkedro-datasets = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkeybert = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkeytotext = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkhoj = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkiui = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkonfuzio-sdk = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkornia = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkornia-moons = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkraken = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkwarray = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nkwimage = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlabml-nn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlagent = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlaion-clap = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlale = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlama-cleaner = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlancedb = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlangcheck = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlangkit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlangroid = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlangtest = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlayoutparser = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nldp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nleafmap = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nleap-ie = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nleibniz = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nleptonai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nletmedoit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlhotse = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlib310 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlibpecos = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlibrec-auto = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlibretranslate = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nliger-kernel = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nliger-kernel-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlightning = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlightning-bolts = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlightning-fabric = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlightning-habana = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlightning-lite = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlightrag = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlightweight-gan = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlightwood = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlinear-attention-transformer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlinear-operator = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlinformer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlinformer-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nliom-toolkit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlion-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlit-nlp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlitdata = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlitelama = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlitgpt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllama-index-embeddings-adapter = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllama-index-embeddings-clip = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllama-index-embeddings-instructor = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllama-index-llms-huggingface = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllama-index-postprocessor-colbert-rerank = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllm-blender = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllm-foundry = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllm-guard = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllm-rs = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllm2vec = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllmcompressor = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllmlingua = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nllmvm-cli = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlm-eval = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlmdeploy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlmms-eval = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlocal-attention = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlovely-tensors = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlpips = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nlycoris-lora = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmace-torch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmagic-pdf = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmagicsoup = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmagvit2-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmaite = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmanga-ocr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmanifest-ml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmanipulation = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmarker-pdf = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmatgl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmed-imagetools = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmedaka = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmedcat = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmedmnist = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmegablocks = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmegatron-energon = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmemos = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmeshgpt-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmetatensor-torch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmflux = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmia-vgg = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmiditok = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nminari = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nminicons = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nml2rt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmlagents = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmlbench-core = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmlcroissant = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmlpfile = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmlx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmlx-whisper = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmmaction2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmmengine = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmmengine-lite = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmmocr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmmpose = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmmsegmentation = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmodeci-mdf = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmodel2vec = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmodelscope = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmodelspec = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmonai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmonai-weekly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmonotonic-alignment-search = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmonty = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmosaicml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmosaicml-streaming = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmoshi = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmteb = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmtmtrain = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmulti-quantization = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nmyhand = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnGPT-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnaeural-core = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnapari = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnapatrackmater = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnara-wpe = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnatten = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnbeats-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnebulae = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnemo-toolkit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nneptune = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nneptune-client = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnerfacc = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnerfstudio = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnessai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnetcal = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nneural-rag = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nneuralforecast = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nneuralnets = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nneuralprophet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nneuspell = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnevergrad = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnexfort = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnimblephysics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnirtorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnkululeko = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnlp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnlptooltest = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnnAudio = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnnodely = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnnsight = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnnunetv2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnoisereduce = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnonebot-plugin-nailongremove = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnowcasting-dataloader = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnowcasting-forecast = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnshtrainer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnuwa-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnvflare = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nnvidia-modelopt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nocf-datapipes = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nocnn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nogb = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nohmeow-blurr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nolive-ai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nomlt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nommlx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nonediff = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nonediffx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nonnx2pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nonnx2torch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopacus = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopen-clip-torch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopen-flamingo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopen-interpreter = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopenbb-terminal-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopenmim = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopenparse = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopenunmix = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopenvino-dev = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopenvino-tokenizers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopenvino-xai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopenwakeword = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nopt-einsum-fx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noptimum = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noptimum-habana = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noptimum-intel = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noptimum-neuron = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noptimum-quanto = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noptree = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noptuna = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noptuna-dashboard = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noptuna-integration = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noracle-ads = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\norbit-ml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\notx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noutetts = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noutlines = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\noutlines-core = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npaddlenlp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npai-easycv = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npandasai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npanns-inference = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npatchwork-cli = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npeft = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npegasuspy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npelutils = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npenn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nperforatedai-freemium = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nperformer-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npetastorm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npfio = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npgmpy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nphenolrs = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nphobos = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npi-zero-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npinecone-text = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npiq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npix2tex = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npix2text = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npnnx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npolicyengine-us-data = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npolyfuzz = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npomegranate = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npositional-encodings = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nprefigure = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nproduct-key-memory = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nptflops = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nptwt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npulser-core = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npunctuators = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npy2ls = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyabsa = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\n\"pyannote.audio\" = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyawd = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyclarity = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npycox = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyfemtet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyg-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npygrinder = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyhealth = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyhf = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyiqa = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npykeen = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npykeops = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npylance = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npylineaGT = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npymanopt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npymde = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npypots = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyqlib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyqtorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyro-ppl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npysentimiento = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyserini = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npysr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npythainlp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npython-doctr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-fid = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-forecasting = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-ignite = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-kinematics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-lightning = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-lightning-bolts = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-metric-learning = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-model-summary = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-msssim = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-pfn-extras = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-pretrained-bert = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-ranger = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-seed = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-tabnet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-tabular = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-toolbelt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-transformers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-transformers-pvt-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-triton-rocm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-warmup = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch-wavelets = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch_optimizer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorch_revgrad = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorchcv = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npytorchltr2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyvene = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\npyvespa = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nqianfan = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nqibo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nqiskit-machine-learning = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nqtorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nquanto = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nquick-anomaly-detector = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrastervision = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrastervision-pytorch-backend = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrastervision-pytorch-learner = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nray-lightning = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrclip = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrealesrgan = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrecbole = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrecommenders = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nredcat = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nreformer-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nregex-sampler = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nreplay-rec = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrerankers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nresearch-framework = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nresemble-enhance = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nresnest = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrf-clip = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrf-groundingdino = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrfconv = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrich-logger = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nring-attention-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrltrade-test = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrotary-embedding-torch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrsp-ml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nrust-circuit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ns2fft = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ns3prl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ns3torchconnector = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsaferx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsafetensors = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsagemaker-huggingface-inference-toolkit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsagemaker-ssh-helper = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsalesforce-lavis = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsalesforce-merlion = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsamv2 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nscib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nscib-metrics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nscvi-tools = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsdmetrics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsecretflow = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsegment-anything-hq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsegment-anything-py = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsegmentation-models-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nself-rewarding-lm-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsemantic-kernel = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsemantic-router = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsenselab = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsent2vec = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsentence-transformers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsequence-model-train = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nserotiny = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsevenn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsglang = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nshap = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsilero-api-server = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsilero-vad = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsilicondiff-npu = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsimclr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsimple-lama-inpainting = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsinabs = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsixdrepnet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nskforecast = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nskorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nskrl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nskt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsktime = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsktmls = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nslangtorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsmartnoise-synth = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsmashed = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsmplx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsmqtk-descriptors = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsmqtk-detection = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsnntorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsnorkel = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsnowflake-ml-python = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nso-vits-svc-fork = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsonusai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsony-custom-layers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsotopia = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspacr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspacy-curated-transformers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspacy-experimental = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspacy-huggingface-pipelines = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspacy-llm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspacy-transformers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspan-marker = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspandrel = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspandrel-extra-arches = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsparrow-python = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspatialdata = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspeechbrain = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspeechtokenizer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspikeinterface = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspikingjelly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspotiflow = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspotpython = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nspotriver = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsquirrel-core = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstable-baselines3 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstable-diffusion-sdkit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstable-ts = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstanford-stk = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstanfordnlp = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstanza = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstartorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstreamtasks = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstruct-eqtable = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nstylegan2-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsupar = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsuper-gradients = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsuper-image = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsuperlinked = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsupervisely = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsurya-ocr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsvdiff-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nswarm-models = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nswarmauri = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nswarms-memory = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nswebench = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsyft = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsympytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsyne-tune = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nsynthcity = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nt5 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntab-transformer-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntabpfn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntaming-transformers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntaming-transformers-rom1504 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntaskwiz = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntbparse = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntecton = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntensor-parallel = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntensorcircuit-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntensordict = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntensordict-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntensorizer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntensorrt-llm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntexify = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntext2text = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntextattack = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntfkit = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nthepipe-api = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nthinc = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nthingsvision = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nthirdai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nthop = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntianshou = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntidy3d = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntimesfm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntimm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntipo-kgen = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntmnt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntoad = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntomesd = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntop2vec = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-audiomentations = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-dct = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-delaunay = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-directml = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-ema = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-encoding = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-fidelity = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-geometric = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-geopooling = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-harmonics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-kmeans = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-lr-finder = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-max-mem = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-npu = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-optimi = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-optimizer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-ort = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-pitch-shift = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-ppr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-pruning = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-snippets = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-stoi = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-struct = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorch-tensorrt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchani = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchattacks = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchaudio = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchbiggraph = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchcam = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchcde = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchcfm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchcrepe = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchdata = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchdatasets-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchdiffeq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchdyn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchestra = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorcheval = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorcheval-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchextractor = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchfcpe = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchfun = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchfunc-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchgeo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchgeometry = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchio = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchjpeg = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchlayers-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchmeta = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchmetrics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchmocks = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchpack = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchpippy = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchpq = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchprofile = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchquantlib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchrec = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchrec-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchrec-nightly-cpu = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchrl = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchrl-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchscale = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchsde = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchseg = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchserve = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchserve-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchsnapshot-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchsr = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchstain = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchsummaryX = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchtext = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchtnt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchtnt-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchtyping = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchutil = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchvinecopulib = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchvision = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchviz = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchx-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntorchxrayvision = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntotalspineseg = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntracebloc-package-dev = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntrainer = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntransformer-engine = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntransformer-lens = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntransformer-smaller-training-vocab = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntransformers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntransformers-domain-adaptation = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntransfusion-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntransparent-background = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntreescope = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntrolo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntsai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntslearn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nttspod = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntxtai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\ntyro = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nu8darts = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nuhg = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nuitestrunner-syberos = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nultimate-rvc = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nultralytics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nultralytics-thop = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunav = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunbabel-comet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunderthesea = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunfoldNd = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunimernet = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunitorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunitxt = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunsloth = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunsloth-zoo = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunstructured = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nunstructured-inference = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nutilsd = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nv-diffusion-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvIQA = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvectice = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvector-quantize-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvectorhub-nightly = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nversatile-audio-upscaler = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvertexai = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvesin = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvgg-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvideo-representations-extractor = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nviser = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvision-datasets = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvisionmetrics = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvisu3d = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvit-pytorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nviturka-nn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvllm = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvllm-flash-attn = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvocos = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvollseg = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nvtorch = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nwavmark = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nwdoc = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nwhisper-live = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nwhisper-timestamped = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nwhisperx = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nwilds = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nwordllama = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nworker-automate-hub = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nwxbtool = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nx-clip = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nx-transformers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nxaitk_saliency = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nxformers = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nxgrammar = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nxinference = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nxtts-api-server = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nyolo-poser = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nyolov5 = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nyolov7-package = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nyta-general-utils = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nzensvi = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nzetascale = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\nzuko = [{ index = \"pytorch-cpu\", marker = \"platform_system == 'Linux'\" }]\n","path":null,"size_bytes":90834,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"server/auth-service-manager.ts":{"content":"/**\n * Manages the persistent Userbot Auth Service subprocess\n * Keeps the service running and provides HTTP client access\n */\nimport { spawn, ChildProcess } from \"child_process\";\nimport axios, { AxiosInstance } from \"axios\";\n\nconst AUTH_SERVICE_PORT = 8765;\nconst AUTH_SERVICE_URL = `http://127.0.0.1:${AUTH_SERVICE_PORT}`;\n\nclass AuthServiceManager {\n  private process: ChildProcess | null = null;\n  private client: AxiosInstance;\n  private maxRetries = 30;\n  private retryDelay = 1000;\n\n  constructor() {\n    this.client = axios.create({\n      baseURL: AUTH_SERVICE_URL,\n      timeout: 30000,\n    });\n  }\n\n  async start() {\n    if (this.process) {\n      console.log(\"[auth-service] Service already running\");\n      return;\n    }\n\n    console.log(\"[auth-service] Starting auth service...\");\n    \n    const command = process.env.NODE_ENV === \"production\" ? \"python\" : \"uv\";\n    const args = process.env.NODE_ENV === \"production\"\n      ? [\"-m\", \"uvicorn\", \"telegram_bot.auth_service:app\", \"--host\", \"127.0.0.1\", \"--port\", \"8765\"]\n      : [\"run\", \"python\", \"-m\", \"uvicorn\", \"telegram_bot.auth_service:app\", \"--host\", \"127.0.0.1\", \"--port\", \"8765\"];\n\n    this.process = spawn(command, args, {\n      cwd: process.cwd(),\n      stdio: [\"ignore\", \"pipe\", \"pipe\"],\n      env: { ...process.env, PYTHONPATH: process.cwd(), UV_PROJECT_ENVIRONMENT: \"venv\" },\n    });\n\n    this.process.stdout?.on(\"data\", (data) => {\n      console.log(`[auth-service] ${data.toString().trim()}`);\n    });\n\n    this.process.stderr?.on(\"data\", (data) => {\n      console.error(`[auth-service-err] ${data.toString().trim()}`);\n    });\n\n    this.process.on(\"exit\", (code) => {\n      console.warn(`[auth-service] Process exited with code ${code}`);\n      this.process = null;\n    });\n\n    await this.waitForReady();\n  }\n\n  private async waitForReady() {\n    for (let i = 0; i < this.maxRetries; i++) {\n      try {\n        await this.client.get(\"/health\");\n        console.log(\"[auth-service] Service is ready!\");\n        return;\n      } catch (error) {\n        if (i < this.maxRetries - 1) {\n          await new Promise((resolve) => setTimeout(resolve, this.retryDelay));\n        } else {\n          throw new Error(\"Failed to start auth service after multiple retries\");\n        }\n      }\n    }\n  }\n\n  async stop() {\n    if (this.process) {\n      console.log(\"[auth-service] Stopping auth service...\");\n      this.process.kill();\n      this.process = null;\n    }\n  }\n\n  async startLogin(phoneNumber: string) {\n    return await this.client.post(\"/start-login\", { phone_number: phoneNumber });\n  }\n\n  async verifyCode(phoneNumber: string, code: string) {\n    return await this.client.post(\"/verify-code\", { phone_number: phoneNumber, code });\n  }\n\n  async verify2FA(phoneNumber: string, password: string) {\n    return await this.client.post(\"/verify-2fa\", { phone_number: phoneNumber, password });\n  }\n\n  async cancelLogin(phoneNumber: string) {\n    return await this.client.post(\"/cancel-login\", { phone_number: phoneNumber });\n  }\n\n  async logout(phoneNumber?: string) {\n    return await this.client.post(\"/logout\", { phone_number: phoneNumber || null });\n  }\n\n  async getLoginStatus(phoneNumber: string) {\n    return await this.client.get(`/login-status/${encodeURIComponent(phoneNumber)}`);\n  }\n}\n\nexport const authServiceManager = new AuthServiceManager();\n","path":null,"size_bytes":3325,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"telegram_bot/handlers/admin.py":{"content":"\"\"\"\nAdmin Handlers\nHandle admin-only commands for bot management\n\"\"\"\nfrom pyrogram.client import Client\nfrom pyrogram import filters\nfrom pyrogram.types import Message\nfrom utils.database import db\nfrom utils.error_handler import handle_errors, ErrorLogger\nfrom config.settings import settings\n\nerror_logger = ErrorLogger(\"admin_handler\")\n\n# Admin filter\nasync def admin_filter(_, __, message: Message) -> bool:\n    \"\"\"Filter to check if user is admin\"\"\"\n    if not message.from_user:\n        return False\n    \n    return await db.is_admin(message.from_user.id)\n\nadmin_only = filters.create(admin_filter)\n\ndef register_admin_handlers(app: Client):\n    \"\"\"Register admin command handlers\"\"\"\n    \n    @app.on_message(filters.command(\"start\") & filters.private & admin_only)\n    @handle_errors(\"admin_handler\", \"start_command\")\n    async def start_command(client: Client, message: Message):\n        \"\"\"Start command - welcome message\"\"\"\n        welcome_text = \"\"\"\nü§ñ **ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿ®Ÿàÿ™ ÿßŸÑÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ∞ŸÉŸä**\n\nÿ£ŸàÿßŸÖÿ± ŸÖÿ™ÿßÿ≠ÿ©:\nüìã /tasks - ÿ•ÿØÿßÿ±ÿ© ŸÖŸáÿßŸÖ ÿßŸÑÿ™Ÿàÿ¨ŸäŸá\nüì° /channels - ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÇŸÜŸàÿßÿ™ ŸàÿßŸÑŸÖÿµÿßÿØÿ±\nü§ñ /ai - ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä\nüë• /admins - ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ\nüìä /stats - ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ\n‚öôÔ∏è /settings - ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\n\nÿßÿ≥ÿ™ÿÆÿØŸÖ /help ŸÑŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™\n\"\"\"\n        await message.reply_text(welcome_text)\n\n    @app.on_message(filters.command(\"help\") & filters.private & admin_only)\n    @handle_errors(\"admin_handler\", \"help_command\")\n    async def help_command(client: Client, message: Message):\n        \"\"\"Help command - detailed instructions\"\"\"\n        help_text = \"\"\"\nüìñ **ÿØŸÑŸäŸÑ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®Ÿàÿ™**\n\n**ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸáÿßŸÖ:**\n‚Ä¢ /create_task - ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ© ÿ™Ÿàÿ¨ŸäŸá ÿ¨ÿØŸäÿØÿ©\n‚Ä¢ /list_tasks - ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸáÿßŸÖ\n‚Ä¢ /toggle_task [id] - ÿ™ŸÅÿπŸäŸÑ/ÿ™ÿπÿ∑ŸäŸÑ ŸÖŸáŸÖÿ©\n‚Ä¢ /delete_task [id] - ÿ≠ÿ∞ŸÅ ŸÖŸáŸÖÿ©\n‚Ä¢ /task_stats [id] - ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÖŸáŸÖÿ©\n\n**ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÇŸÜŸàÿßÿ™:**\n‚Ä¢ /add_channel - ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸÜÿßÿ©/ŸÖÿ¨ŸÖŸàÿπÿ©\n‚Ä¢ /add_website - ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸàŸÇÿπ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä\n‚Ä¢ /list_channels - ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿµÿßÿØÿ±\n\n**ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä:**\n‚Ä¢ /add_rule [task_id] - ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© AI ŸÑŸÖŸáŸÖÿ©\n‚Ä¢ /list_rules [task_id] - ÿπÿ±ÿ∂ ŸÇŸàÿßÿπÿØ ŸÖŸáŸÖÿ©\n‚Ä¢ /toggle_ai [task_id] - ÿ™ŸÅÿπŸäŸÑ/ÿ™ÿπÿ∑ŸäŸÑ AI ŸÑŸÖŸáŸÖÿ©\n\n**ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ:**\n‚Ä¢ /add_admin [user_id] - ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ¥ÿ±ŸÅ ÿ¨ÿØŸäÿØ\n‚Ä¢ /list_admins - ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ\n\n**ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™:**\n‚Ä¢ /stats - ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿπÿßŸÖÿ©\n‚Ä¢ /queue_stats - ÿ≠ÿßŸÑÿ© ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ∑Ÿàÿßÿ®Ÿäÿ±\n\"\"\"\n        await message.reply_text(help_text)\n\n    @app.on_message(filters.command(\"add_admin\") & filters.private & admin_only)\n    @handle_errors(\"admin_handler\", \"add_admin_command\")\n    async def add_admin_command(client: Client, message: Message):\n        \"\"\"Add new admin\"\"\"\n        try:\n            # Extract user ID from command\n            parts = message.text.split()\n            if len(parts) < 2:\n                await message.reply_text(\n                    \"‚ùå ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ: `/add_admin [user_id]`\\n\"\n                    \"ŸÖÿ´ÿßŸÑ: `/add_admin 123456789`\"\n                )\n                return\n            \n            new_admin_id = int(parts[1])\n            \n            # Check if already admin\n            if await db.is_admin(new_admin_id):\n                await message.reply_text(\"‚ö†Ô∏è Ÿáÿ∞ÿß ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ¥ÿ±ŸÅ ÿ®ÿßŸÑŸÅÿπŸÑ\")\n                return\n            \n            # Add admin\n            await db.add_admin(\n                telegram_id=new_admin_id,\n                added_by=message.from_user.id if message.from_user else None\n            )\n            \n            await message.reply_text(\n                f\"‚úÖ ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ¥ÿ±ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠!\\n\"\n                f\"User ID: `{new_admin_id}`\"\n            )\n            \n            error_logger.log_info(\n                f\"Admin {message.from_user.id if message.from_user else 'unknown'} added new admin {new_admin_id}\"\n            )\n            \n        except ValueError:\n            await message.reply_text(\"‚ùå User ID ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\")\n        except Exception as e:\n            await message.reply_text(f\"‚ùå ÿÆÿ∑ÿ£: {str(e)}\")\n\n    @app.on_message(filters.command(\"list_admins\") & filters.private & admin_only)\n    @handle_errors(\"admin_handler\", \"list_admins_command\")\n    async def list_admins_command(client: Client, message: Message):\n        \"\"\"List all admins\"\"\"\n        admins = await db.get_admins()\n        \n        if not admins:\n            await message.reply_text(\"üìã ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ¥ÿ±ŸÅŸäŸÜ ÿ≠ÿßŸÑŸäÿßŸã\")\n            return\n        \n        text = \"üë• **ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ:**\\n\\n\"\n        for admin in admins:\n            username = f\"@{admin['username']}\" if admin['username'] else \"N/A\"\n            text += f\"‚Ä¢ ID: `{admin['telegram_id']}` - {username}\\n\"\n        \n        await message.reply_text(text)\n\n    @app.on_message(filters.command(\"stats\") & filters.private & admin_only)\n    @handle_errors(\"admin_handler\", \"stats_command\")\n    async def stats_command(client: Client, message: Message):\n        \"\"\"Show system statistics\"\"\"\n        # Get statistics\n        tasks = await db.get_active_tasks()\n        channels = await db.get_channels()\n        \n        # Get queue stats\n        from services.queue_system import queue_manager\n        queue_stats = queue_manager.get_stats()\n        \n        text = f\"\"\"\nüìä **ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ**\n\n**ÿßŸÑŸÖŸáÿßŸÖ:**\n‚Ä¢ ŸÜÿ¥ÿ∑ÿ©: {len([t for t in tasks if t['is_active']])}\n‚Ä¢ ŸÖÿπÿ∑ŸÑÿ©: {len([t for t in tasks if not t['is_active']])}\n‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä: {len(tasks)}\n\n**ÿßŸÑŸÖÿµÿßÿØÿ±:**\n‚Ä¢ ÿßŸÑŸÇŸÜŸàÿßÿ™: {len([c for c in channels if c['type'] in ['telegram_channel', 'telegram_group']])}\n‚Ä¢ ÿßŸÑŸÖŸàÿßŸÇÿπ: {len([c for c in channels if c['type'] == 'website'])}\n‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä: {len(channels)}\n\n**ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ∑Ÿàÿßÿ®Ÿäÿ±:**\n‚Ä¢ Workers ŸÜÿ¥ÿ∑ÿ©: {queue_stats['active_workers']}/{queue_stats['max_workers']}\n‚Ä¢ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ: {'üü¢ ŸäÿπŸÖŸÑ' if queue_stats['is_running'] else 'üî¥ ŸÖÿ™ŸàŸÇŸÅ'}\n\nüåê **ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ Web ŸÑŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ**\n\"\"\"\n        \n        await message.reply_text(text)\n\n    @app.on_message(filters.command(\"queue_stats\") & filters.private & admin_only)\n    @handle_errors(\"admin_handler\", \"queue_stats_command\")\n    async def queue_stats_command(client: Client, message: Message):\n        \"\"\"Show queue system statistics\"\"\"\n        from services.queue_system import queue_manager\n        \n        stats = queue_manager.get_stats()\n        \n        # Get pending jobs count\n        pending_jobs = await db.get_pending_jobs(limit=1000)\n        \n        text = f\"\"\"\n‚öôÔ∏è **ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ∑Ÿàÿßÿ®Ÿäÿ±**\n\n**Workers:**\n‚Ä¢ ŸÜÿ¥ÿ∑ÿ©: {stats['active_workers']}\n‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä: {stats['total_workers']}\n‚Ä¢ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ: {stats['max_workers']}\n\n**ÿßŸÑŸÖŸáÿßŸÖ ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±:**\n‚Ä¢ ÿπÿØÿØ ÿßŸÑŸÖŸáÿßŸÖ: {len(pending_jobs)}\n\n**ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ:**\n‚Ä¢ {' üü¢ ŸäÿπŸÖŸÑ ÿ®ŸÉŸÅÿßÿ°ÿ©' if stats['is_running'] else 'üî¥ ŸÖÿ™ŸàŸÇŸÅ'}\n\"\"\"\n        \n        await message.reply_text(text)\n\n    # Unauthorized access handler\n    @app.on_message(filters.command([\"start\", \"help\", \"tasks\", \"admins\", \"stats\"]) & filters.private & ~admin_only)\n    @handle_errors(\"admin_handler\", \"unauthorized_access\")\n    async def unauthorized_access(client: Client, message: Message):\n        \"\"\"Handle unauthorized access attempts\"\"\"\n        user_id = message.from_user.id if message.from_user else \"unknown\"\n        await message.reply_text(\n            \"‚õîÔ∏è **ÿßŸÑŸàÿµŸàŸÑ ŸÖÿ≠ÿ∏Ÿàÿ±**\\n\\n\"\n            \"Ÿáÿ∞ÿß ÿßŸÑÿ®Ÿàÿ™ ŸÖÿÆÿµÿµ ŸÑŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ ŸÅŸÇÿ∑.\\n\"\n            f\"User ID ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ: `{user_id}`\"\n        )\n        \n        error_logger.log_warning(\n            f\"Unauthorized access attempt by {user_id}\"\n        )\n","path":null,"size_bytes":8068,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"telegram_bot/utils/error_logger_db.py":{"content":"\"\"\"\nDatabase error logging for telegram bot\nLogs errors to PostgreSQL for visibility in web dashboard\n\"\"\"\nimport asyncpg\nfrom typing import Optional, Dict, Any\nfrom config.settings import settings\nimport json\nfrom datetime import datetime\n\nclass DatabaseErrorLogger:\n    \"\"\"Log errors to PostgreSQL database\"\"\"\n    \n    def __init__(self):\n        self.pool: Optional[asyncpg.Pool] = None\n    \n    async def connect(self):\n        \"\"\"Connect to database\"\"\"\n        try:\n            self.pool = await asyncpg.create_pool(\n                settings.DATABASE_URL,\n                min_size=2,\n                max_size=5,\n                command_timeout=10\n            )\n        except Exception as e:\n            print(f\"Failed to connect to database for error logging: {e}\")\n    \n    async def log_error(\n        self,\n        component: str,\n        function: str,\n        error_type: str,\n        error_message: str,\n        stack_trace: Optional[str] = None,\n        metadata: Optional[Dict[str, Any]] = None\n    ):\n        \"\"\"Log error to database\"\"\"\n        if not self.pool:\n            return\n        \n        try:\n            async with self.pool.acquire() as conn:\n                await conn.execute(\"\"\"\n                    INSERT INTO error_logs (component, function, error_type, error_message, stack_trace, metadata, timestamp)\n                    VALUES ($1, $2, $3, $4, $5, $6, $7)\n                \"\"\",\n                    component,\n                    function,\n                    error_type,\n                    error_message,\n                    stack_trace,\n                    json.dumps(metadata) if metadata else None,\n                    datetime.utcnow()\n                )\n        except Exception as e:\n            print(f\"Failed to log error to database: {e}\")\n    \n    async def disconnect(self):\n        \"\"\"Close database connection\"\"\"\n        if self.pool:\n            await self.pool.close()\n\ndb_error_logger = DatabaseErrorLogger()\n","path":null,"size_bytes":1959,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"client/src/pages/channels.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { api } from \"@/lib/api\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogTrigger } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, Plus, Globe, Hash, Users, Trash2, Loader, Edit, Send } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { motion } from \"framer-motion\";\n\nexport default function ChannelsPage() {\n  const { i18n, t } = useTranslation();\n  const queryClient = useQueryClient();\n  const [isOpen, setIsOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedType, setSelectedType] = useState(\"all\");\n  const [editingId, setEditingId] = useState<number | null>(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [channelToDelete, setChannelToDelete] = useState<{ id: number; title: string } | null>(null);\n  const [formData, setFormData] = useState({\n    type: \"telegram_channel\",\n    identifier: \"\",\n    title: \"\",\n    description: \"\",\n  });\n\n  const { data: channels = [], isLoading } = useQuery({\n    queryKey: [\"channels\"],\n    queryFn: () => api.getChannels(),\n  });\n\n  const { data: tasks = [] } = useQuery({\n    queryKey: [\"tasks\"],\n    queryFn: () => api.getTasks(),\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: any) => editingId ? api.updateChannel(editingId, data) : api.createChannel(data),\n    onSuccess: () => {\n      toast.success(editingId ? \"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿµÿØÿ± ÿ®ŸÜÿ¨ÿßÿ≠\" : \"ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿµÿØÿ± ÿ®ŸÜÿ¨ÿßÿ≠\");\n      queryClient.invalidateQueries({ queryKey: [\"channels\"] });\n      queryClient.invalidateQueries({ queryKey: [\"dashboard-stats\"] });\n      setIsOpen(false);\n      setEditingId(null);\n      setFormData({\n        type: \"telegram_channel\",\n        identifier: \"\",\n        title: \"\",\n        description: \"\",\n      });\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"ŸÅÿ¥ŸÑ ÿßŸÑÿπŸÖŸÑŸäÿ©\");\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => api.deleteChannel(id),\n    onMutate: async (deletedId) => {\n      await queryClient.cancelQueries({ queryKey: [\"channels\"] });\n      const previousChannels = queryClient.getQueryData([\"channels\"]);\n      queryClient.setQueryData([\"channels\"], (old: any) => \n        old?.filter((channel: any) => channel.id !== deletedId) || []\n      );\n      return { previousChannels };\n    },\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿµÿØÿ± ÿ®ŸÜÿ¨ÿßÿ≠\");\n      queryClient.invalidateQueries({ queryKey: [\"channels\"] });\n      queryClient.invalidateQueries({ queryKey: [\"dashboard-stats\"] });\n    },\n    onError: (error: any, _, context) => {\n      queryClient.setQueryData([\"channels\"], context?.previousChannels);\n      toast.error(error.message || \"ŸÅÿ¥ŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿµÿØÿ±\");\n    },\n  });\n\n  const handleCreate = async () => {\n    if (!formData.title || !formData.identifier) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ\");\n      return;\n    }\n    createMutation.mutate(formData);\n  };\n\n  const handleEdit = (channel: any) => {\n    setEditingId(channel.id);\n    setFormData({\n      type: channel.type,\n      identifier: channel.identifier,\n      title: channel.title,\n      description: channel.description || \"\",\n    });\n    setIsOpen(true);\n  };\n\n  const handleCloseDialog = () => {\n    setIsOpen(false);\n    setEditingId(null);\n    setFormData({\n      type: \"telegram_channel\",\n      identifier: \"\",\n      title: \"\",\n      description: \"\",\n    });\n  };\n\n  const handleDeleteClick = (channel: any) => {\n    setChannelToDelete({ id: channel.id, title: channel.title });\n    setDeleteDialogOpen(true);\n  };\n\n  const handleConfirmDelete = () => {\n    if (channelToDelete) {\n      deleteMutation.mutate(channelToDelete.id);\n      setDeleteDialogOpen(false);\n      setChannelToDelete(null);\n    }\n  };\n\n  const getTaskCount = (channelId: number) => {\n    return tasks.filter((t: any) => \n      t.sourceChannels?.includes(channelId) || t.targetChannels?.includes(channelId)\n    ).length;\n  };\n\n  const filteredChannels = channels.filter(c => {\n    const matchesSearch = \n      c.title?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      c.identifier?.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesType = selectedType === \"all\" || c.type === selectedType;\n    return matchesSearch && matchesType;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <Loader className=\"h-6 w-6 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  const typeConfig = {\n    \"telegram_channel\": { \n      icon: Hash, \n      color: \"from-blue-500 to-blue-600\", \n      bgColor: \"bg-blue-500/10\",\n      label: \"ŸÇŸÜÿßÿ© ÿ™ŸÑÿ∫ÿ±ÿßŸÖ\",\n      shortLabel: \"ŸÇŸÜÿßÿ©\"\n    },\n    \"telegram_group\": { \n      icon: Users, \n      color: \"from-purple-500 to-purple-600\", \n      bgColor: \"bg-purple-500/10\",\n      label: \"ŸÖÿ¨ŸÖŸàÿπÿ© ÿ™ŸÑÿ∫ÿ±ÿßŸÖ\",\n      shortLabel: \"ŸÖÿ¨ŸÖŸàÿπÿ©\"\n    },\n    \"website\": { \n      icon: Globe, \n      color: \"from-green-500 to-green-600\", \n      bgColor: \"bg-green-500/10\",\n      label: \"ŸÖŸàŸÇÿπ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä\",\n      shortLabel: \"ŸÖŸàŸÇÿπ\"\n    },\n  };\n\n  const types = [\n    { value: \"all\", label: \"ÿßŸÑŸÉŸÑ\" },\n    { value: \"telegram_channel\", label: \"ÿßŸÑŸÇŸÜŸàÿßÿ™\" },\n    { value: \"telegram_group\", label: \"ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™\" },\n    { value: \"website\", label: \"ÿßŸÑŸÖŸàÿßŸÇÿπ\" },\n  ];\n\n  return (\n    <div className=\"space-y-6\" dir={i18n.language === 'ar' ? 'rtl' : 'ltr'}>\n      <div className=\"flex flex-col sm:flex-row sm:items-end justify-between gap-4\">\n        <div className={i18n.language === 'ar' ? 'text-right' : 'text-left'}>\n          <h2 className=\"text-2xl md:text-3xl font-display font-bold text-foreground tracking-wide\">ÿßŸÑŸÖÿµÿßÿØÿ± ŸàÿßŸÑŸÇŸÜŸàÿßÿ™</h2>\n          <p className=\"text-muted-foreground mt-1 text-sm md:text-base\">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÇŸÜŸàÿßÿ™ ŸàÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ŸàÿßŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿ© - {channels.length} ŸÖÿµÿßÿØÿ±</p>\n        </div>\n        <Dialog open={isOpen} onOpenChange={(open) => { if (!open) handleCloseDialog(); else setIsOpen(true); }}>\n          <DialogTrigger asChild>\n            <Button className=\"bg-primary text-primary-foreground font-bold hover:bg-primary/90 w-full sm:w-auto\" data-testid=\"button-add-channel\">\n              <Plus className=\"h-4 w-4 mr-2\" /> ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿµÿØÿ±\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>{editingId ? \"ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖÿµÿØÿ±\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿµÿØÿ± ÿ¨ÿØŸäÿØ\"}</DialogTitle>\n              <DialogDescription>{editingId ? \"ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿµÿØÿ±\" : \"ÿ£ÿØÿÆŸÑ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿµÿØÿ± ÿßŸÑÿ¨ÿØŸäÿØ\"}</DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"type\">ŸÜŸàÿπ ÿßŸÑŸÖÿµÿØÿ±</Label>\n                <Select value={formData.type} onValueChange={(value) => setFormData({...formData, type: value})}>\n                  <SelectTrigger id=\"type\" className=\"mt-1\" data-testid=\"select-channel-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"telegram_channel\">ŸÇŸÜÿßÿ© ÿ™ŸÑÿ∫ÿ±ÿßŸÖ</SelectItem>\n                    <SelectItem value=\"telegram_group\">ŸÖÿ¨ŸÖŸàÿπÿ© ÿ™ŸÑÿ∫ÿ±ÿßŸÖ</SelectItem>\n                    <SelectItem value=\"website\">ŸÖŸàŸÇÿπ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label htmlFor=\"identifier\">ÿßŸÑŸÖÿπÿ±ŸÅ ÿ£Ÿà ÿßŸÑÿ±ÿßÿ®ÿ∑</Label>\n                <Input\n                  id=\"identifier\"\n                  value={formData.identifier}\n                  onChange={(e) => setFormData({...formData, identifier: e.target.value})}\n                  placeholder={formData.type === \"website\" ? \"https://example.com\" : \"@channelname or -1001234567890\"}\n                  className=\"mt-1\"\n                  data-testid=\"input-channel-identifier\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"title\">ÿßŸÑÿßÿ≥ŸÖ</Label>\n                <Input\n                  id=\"title\"\n                  value={formData.title}\n                  onChange={(e) => setFormData({...formData, title: e.target.value})}\n                  placeholder=\"ÿßÿ≥ŸÖ ÿßŸÑŸÖÿµÿØÿ±\"\n                  className=\"mt-1\"\n                  data-testid=\"input-channel-title\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"description\">ÿßŸÑŸàÿµŸÅ</Label>\n                <Input\n                  id=\"description\"\n                  value={formData.description}\n                  onChange={(e) => setFormData({...formData, description: e.target.value})}\n                  placeholder=\"ŸàÿµŸÅ ÿßŸÑŸÖÿµÿØÿ±\"\n                  className=\"mt-1\"\n                  data-testid=\"input-channel-description\"\n                />\n              </div>\n\n              <Button \n                onClick={handleCreate}\n                className=\"w-full\"\n                disabled={createMutation.isPending}\n                data-testid=\"button-submit-channel\"\n              >\n                {createMutation.isPending && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n                {editingId ? \"ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿµÿØÿ±\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿµÿØÿ±\"}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"flex flex-col gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className={`absolute top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground ${i18n.language === 'ar' ? 'right-3' : 'left-3'}`} />\n          <Input \n            placeholder=\"ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿµÿßÿØÿ±...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className={i18n.language === 'ar' ? 'pr-10' : 'pl-10'}\n            data-testid=\"input-search-channels\"\n          />\n        </div>\n\n        <div className=\"flex gap-2 flex-wrap\">\n          {types.map((type) => (\n            <Button\n              key={type.value}\n              variant={selectedType === type.value ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setSelectedType(type.value)}\n              className=\"text-xs\"\n              data-testid={`button-filter-${type.value}`}\n            >\n              {type.label}\n            </Button>\n          ))}\n        </div>\n      </div>\n\n      {filteredChannels.length === 0 ? (\n        <Card className=\"border-dashed text-center py-12\">\n          <div className=\"space-y-2\">\n            <p className=\"text-muted-foreground\">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿµÿßÿØÿ± ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ®ÿ≠ÿ´</p>\n            <p className=\"text-xs text-muted-foreground\">ÿ¨ÿ±Ÿëÿ® ÿ™ÿ∫ŸäŸäÿ± ŸÖÿπÿßŸäŸäÿ± ÿßŸÑÿ®ÿ≠ÿ´ ÿ£Ÿà ÿßŸÑŸÅŸÑÿßÿ™ÿ±</p>\n          </div>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filteredChannels.map((channel: any, index) => {\n            const config = typeConfig[channel.type as keyof typeof typeConfig] || typeConfig[\"telegram_channel\"];\n            const IconComponent = config.icon;\n            const taskCount = getTaskCount(channel.id);\n\n            return (\n              <motion.div\n                key={channel.id}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: index * 0.05 }}\n              >\n                <Card className={`border shadow-sm group hover:shadow-lg transition-all overflow-hidden`} data-testid={`card-channel-${channel.id}`}>\n                  <div className={`h-1 bg-gradient-to-r ${config.color}`} />\n                  <CardContent className=\"p-5\">\n                    <div className=\"flex justify-between items-start mb-4\">\n                      <div className=\"flex items-center gap-3 flex-1\">\n                        <div className={`h-10 w-10 rounded-full ${config.bgColor} flex items-center justify-center border border-primary/20`}>\n                          <IconComponent className=\"h-5 w-5 text-primary\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center gap-2\">\n                            <h3 className=\"font-bold text-foreground truncate\">{channel.title}</h3>\n                            <Badge variant=\"secondary\" className=\"text-xs flex-shrink-0\">{config.shortLabel}</Badge>\n                          </div>\n                          <p className=\"text-xs text-muted-foreground\">{config.label}</p>\n                        </div>\n                      </div>\n                      <div className=\"h-2 w-2 rounded-full bg-green-500 animate-pulse flex-shrink-0\" />\n                    </div>\n                    \n                    <div className=\"space-y-3\">\n                      <div className=\"text-xs text-muted-foreground break-all font-mono bg-muted/50 p-2 rounded border border-border\">\n                        {channel.identifier}\n                      </div>\n                      {channel.description && (\n                        <p className=\"text-xs text-muted-foreground line-clamp-2\">{channel.description}</p>\n                      )}\n                    </div>\n\n                    <div className=\"mt-4 pt-4 border-t border-border flex items-center justify-between gap-2\">\n                      <div className=\"flex items-center gap-1\">\n                        <Send className=\"h-3 w-3 text-muted-foreground\" />\n                        <span className=\"text-xs font-semibold text-muted-foreground\">{taskCount}</span>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button \n                          size=\"sm\" \n                          variant=\"ghost\"\n                          onClick={() => handleEdit(channel)}\n                          className=\"h-8 text-xs text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 hover:bg-blue-500/10\"\n                          data-testid={`button-edit-channel-${channel.id}`}\n                        >\n                          <Edit className=\"h-3 w-3\" />\n                        </Button>\n                        <Button \n                          size=\"sm\" \n                          variant=\"ghost\"\n                          onClick={() => handleDeleteClick(channel)}\n                          className=\"h-8 text-xs text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-500/10\"\n                          data-testid={`button-delete-channel-${channel.id}`}\n                          disabled={deleteMutation.isPending}\n                        >\n                          {deleteMutation.isPending ? <Loader className=\"h-3 w-3 animate-spin\" /> : <Trash2 className=\"h-3 w-3\" />}\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n            );\n          })}\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent className=\"max-w-md\" dir={i18n.language === 'ar' ? 'rtl' : 'ltr'}>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"text-lg font-bold\">ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅ</AlertDialogTitle>\n            <AlertDialogDescription className=\"text-sm text-muted-foreground\">\n              ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿµÿØÿ± <span className=\"font-semibold text-foreground\">\"{channelToDelete?.title}\"</span>ÿü \n              <br />\n              ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"gap-2\">\n            <AlertDialogCancel className=\"m-0\">ÿ•ŸÑÿ∫ÿßÿ°</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={handleConfirmDelete}\n              className=\"bg-red-600 hover:bg-red-700 text-white\"\n            >\n              ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿµÿØÿ±\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":17059,"size_tokens":null},"client/src/lib/i18n.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\ni18n\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    resources: {\n      en: {\n        translation: {\n          \"app\": {\n            \"name\": \"Eagle\",\n            \"subtitle\": \"Multi-Task Bot\"\n          },\n          \"nav\": {\n            \"overview\": \"Overview\",\n            \"tasks\": \"Forwarding Tasks\",\n            \"channels\": \"Channels & Sources\",\n            \"ai\": \"AI Neural Core\",\n            \"settings\": \"System Settings\",\n            \"disconnect\": \"Disconnect\",\n            \"system_load\": \"System Load\"\n          },\n          \"dashboard\": {\n            \"title\": \"System Overview\",\n            \"subtitle\": \"Real-time metrics and operational status\",\n            \"uptime\": \"UPTIME\",\n            \"total_messages\": \"Total Messages\",\n            \"active_tasks\": \"Active Tasks\",\n            \"ai_operations\": \"AI Operations\",\n            \"monitored_channels\": \"Monitored Channels\",\n            \"throughput\": \"Throughput Analysis\",\n            \"live_logs\": \"Live Logs\"\n          },\n          \"auth\": {\n            \"admin_username\": \"Admin Username\",\n            \"admin_password\": \"Admin Password\",\n            \"username_placeholder\": \"Enter admin username\",\n            \"initialize_session\": \"Initialize Session\",\n            \"authenticating\": \"Authenticating...\"\n          },\n          \"common\": {\n            \"latency\": \"LATENCY\",\n            \"system_online\": \"System Online\",\n            \"admin_user\": \"Admin User\",\n            \"level_access\": \"Level 5 Access\"\n          }\n        }\n      },\n      ar: {\n        translation: {\n          \"app\": {\n            \"name\": \"ÿµŸÇÿ±\",\n            \"subtitle\": \"ÿ®Ÿàÿ™ ŸÖÿ™ÿπÿØÿØ ÿßŸÑŸÖŸáÿßŸÖ\"\n          },\n          \"nav\": {\n            \"overview\": \"ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ©\",\n            \"tasks\": \"ŸÖŸáÿßŸÖ ÿßŸÑÿ™Ÿàÿ¨ŸäŸá\",\n            \"channels\": \"ÿßŸÑŸÇŸÜŸàÿßÿ™ ŸàÿßŸÑŸÖÿµÿßÿØÿ±\",\n            \"ai\": \"ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä\",\n            \"settings\": \"ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ\",\n            \"disconnect\": \"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨\",\n            \"system_load\": \"ÿ≠ŸÖŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ\"\n          },\n          \"auth\": {\n            \"admin_username\": \"ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\",\n            \"admin_password\": \"ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±\",\n            \"username_placeholder\": \"ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\",\n            \"initialize_session\": \"ÿ®ÿØÿ° ÿßŸÑÿ¨ŸÑÿ≥ÿ©\",\n            \"authenticating\": \"ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÇŸÇ...\"\n          },\n          \"dashboard\": {\n            \"title\": \"ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ©\",\n            \"subtitle\": \"ÿßŸÑŸÖŸÇÿßŸäŸäÿ≥ ÿßŸÑÿ≠Ÿäÿ© Ÿàÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ\",\n            \"uptime\": \"ŸàŸÇÿ™ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ\",\n            \"total_messages\": \"ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ\",\n            \"active_tasks\": \"ÿßŸÑŸÖŸáÿßŸÖ ÿßŸÑŸÜÿ¥ÿ∑ÿ©\",\n            \"ai_operations\": \"ÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä\",\n            \"monitored_channels\": \"ÿßŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑŸÖÿ±ÿßŸÇÿ®ÿ©\",\n            \"throughput\": \"ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\",\n            \"live_logs\": \"ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ≠Ÿä\"\n          },\n          \"common\": {\n            \"latency\": \"ÿßŸÑÿ™ÿ£ÿÆŸäÿ±\",\n            \"system_online\": \"ÿßŸÑŸÜÿ∏ÿßŸÖ ŸÖÿ™ÿµŸÑ\",\n            \"admin_user\": \"ÿßŸÑŸÖÿ¥ÿ±ŸÅ\",\n            \"level_access\": \"ÿµŸÑÿßÿ≠Ÿäÿ© ŸÖÿ≥ÿ™ŸàŸâ 5\"\n          }\n        }\n      }\n    },\n    lng: \"ar\", \n    fallbackLng: \"ar\",\n    interpolation: {\n      escapeValue: false \n    }\n  });\n\nexport default i18n;\n","path":null,"size_bytes":3491,"size_tokens":null},"client/src/components/ui/toggle-switch.tsx":{"content":"import React from \"react\";\n\ninterface ToggleSwitchProps {\n  id?: string;\n  checked: boolean;\n  onCheckedChange: (checked: boolean) => void;\n  label?: string;\n  activeColor?: \"purple\" | \"blue\" | \"emerald\";\n  disabled?: boolean;\n  className?: string;\n  \"data-testid\"?: string;\n  size?: \"sm\" | \"md\";\n}\n\nexport function ToggleSwitch({\n  id,\n  checked,\n  onCheckedChange,\n  label,\n  activeColor = \"purple\",\n  disabled = false,\n  className = \"\",\n  \"data-testid\": dataTestId,\n  size = \"md\",\n}: ToggleSwitchProps) {\n  const colorMap = {\n    purple: {\n      active: \"bg-purple-600 dark:bg-purple-500\",\n      icon: \"üé®\",\n    },\n    blue: {\n      active: \"bg-blue-600 dark:bg-blue-500\",\n      icon: \"üé¨\",\n    },\n    emerald: {\n      active: \"bg-emerald-600 dark:bg-emerald-500\",\n      icon: \"üìù\",\n    },\n  };\n\n  const colors = colorMap[activeColor] || colorMap.purple;\n\n  const sizeClasses = {\n    sm: {\n      container: \"h-5 w-9\",\n      thumb: \"h-4 w-4\",\n      checkedPos: { left: \"auto\", right: \"2px\" },\n      uncheckedPos: { left: \"2px\", right: \"auto\" }\n    },\n    md: {\n      container: \"h-7 w-14\",\n      thumb: \"h-6 w-6\",\n      checkedPos: { left: \"auto\", right: \"2px\" },\n      uncheckedPos: { left: \"2px\", right: \"auto\" }\n    }\n  };\n\n  const sizeConfig = sizeClasses[size] || sizeClasses.md;\n\n  return (\n    <div className=\"flex items-center gap-3\">\n      <button\n        id={id}\n        type=\"button\"\n        onClick={() => !disabled && onCheckedChange(!checked)}\n        disabled={disabled}\n        className={`\n          relative inline-flex items-center rounded-full\n          transition-all duration-300 ease-in-out\n          focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\n          disabled:opacity-50 disabled:cursor-not-allowed\n          ${sizeConfig?.container || \"h-7 w-14\"}\n          ${\n            checked\n              ? colors?.active || \"bg-purple-600 dark:bg-purple-500\"\n              : \"bg-gray-400 dark:bg-gray-500\"\n          }\n          ${className}\n        `}\n        data-testid={dataTestId}\n      >\n        {/* Thumb */}\n        <div\n          className={`\n            absolute rounded-full\n            bg-white dark:bg-white shadow-md\n            transition-all duration-300 ease-in-out\n            ${sizeConfig?.thumb || \"h-6 w-6\"}\n          `}\n          style={checked ? sizeConfig.checkedPos : sizeConfig.uncheckedPos}\n        />\n      </button>\n\n      {label && (\n        <label\n          htmlFor={id}\n          className=\"text-sm font-medium cursor-pointer select-none\"\n        >\n          {label}\n        </label>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":2624,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"telegram_bot/services/userbot_auth.py":{"content":"\"\"\"\nUserbot Authentication Service\nHandles phone login flow for Pyrogram/Pyrofork MTProto sessions\nUses database to store login state across process restarts\n\nFeatures:\n- Phone number validation and formatting\n- OTP code sending and verification via database persistence\n- 2FA password verification\n- Session string export and management\n- Proper cleanup on success/failure/logout\n- Handles restart scenarios gracefully\n\"\"\"\nimport asyncio\nimport logging\nimport re\nimport json\nfrom typing import Optional, Dict, Any\nfrom pyrogram import Client\nfrom pyrogram.errors import (\n    PhoneCodeInvalid, \n    PhoneCodeExpired, \n    SessionPasswordNeeded,\n    PasswordHashInvalid,\n    FloodWait,\n    PhoneNumberInvalid,\n    ApiIdInvalid,\n    PhoneNumberBanned,\n    PhoneNumberFlood,\n    AuthKeyUnregistered\n)\nfrom config.settings import settings\nfrom utils.database import db\n\nlogger = logging.getLogger(__name__)\n\nclass UserbotAuthService:\n    \"\"\"Service for managing userbot authentication with database persistence\"\"\"\n    \n    def __init__(self):\n        self.active_clients: Dict[str, Client] = {}\n        self._db_connected = False\n        self._connection_lock = asyncio.Lock()\n    \n    def _normalize_phone(self, phone_number: str) -> str:\n        \"\"\"Normalize phone number format\"\"\"\n        phone_number = phone_number.strip().replace(\" \", \"\").replace(\"-\", \"\")\n        if not phone_number.startswith(\"+\"):\n            phone_number = \"+\" + phone_number\n        return phone_number\n    \n    async def _ensure_db_connected(self):\n        \"\"\"Ensure database connection is established (thread-safe)\"\"\"\n        if self._db_connected and db.pool is not None:\n            return\n        \n        async with self._connection_lock:\n            if not self._db_connected or db.pool is None:\n                await db.connect()\n                self._db_connected = True\n    \n    async def _cleanup_existing_client(self, phone_number: str):\n        \"\"\"Clean up any existing client for the phone number\"\"\"\n        if phone_number in self.active_clients:\n            try:\n                client = self.active_clients[phone_number]\n                if client.is_connected:\n                    await client.disconnect()\n                logger.info(f\"Cleaned up existing client for {phone_number[:5]}***\")\n            except Exception as e:\n                logger.warning(f\"Error cleaning up client: {str(e)}\")\n            finally:\n                del self.active_clients[phone_number]\n    \n    async def _cleanup_all_clients(self):\n        \"\"\"Clean up all active clients\"\"\"\n        for phone_number in list(self.active_clients.keys()):\n            await self._cleanup_existing_client(phone_number)\n    \n    async def _clear_old_sessions_for_phone(self, phone_number: str):\n        \"\"\"Clear any old/stale session data for a phone number\"\"\"\n        await self._ensure_db_connected()\n        await db.execute(\n            \"\"\"UPDATE userbot_sessions \n               SET login_state = NULL, status = 'cancelled', updated_at = NOW()\n               WHERE phone_number = $1 AND status IN ('awaiting_code', 'awaiting_password')\"\"\",\n            phone_number\n        )\n    \n    async def start_login(self, phone_number: str) -> Dict[str, Any]:\n        \"\"\"\n        Start the login flow by sending OTP code to phone\n        Stores phone_code_hash in database for later retrieval\n        Returns: {'status': 'code_sent', 'phone_code_hash': '...'}\n        \"\"\"\n        try:\n            phone_number = self._normalize_phone(phone_number)\n            \n            logger.info(f\"Starting login for phone: {phone_number[:5]}***\")\n            \n            await self._cleanup_existing_client(phone_number)\n            \n            await self._ensure_db_connected()\n            await self._clear_old_sessions_for_phone(phone_number)\n            \n            client = Client(\n                name=f\"userbot_session_{phone_number[-4:]}\",\n                api_id=settings.API_ID,\n                api_hash=settings.API_HASH,\n                in_memory=True\n            )\n            \n            await client.connect()\n            sent_code = await client.send_code(phone_number)\n            \n            self.active_clients[phone_number] = client\n            \n            login_state = {\n                \"phone_code_hash\": sent_code.phone_code_hash,\n                \"status\": \"awaiting_code\",\n                \"api_id\": settings.API_ID,\n                \"api_hash\": settings.API_HASH\n            }\n            \n            existing = await db.fetchrow(\n                \"SELECT id FROM userbot_sessions WHERE phone_number = $1\",\n                phone_number\n            )\n            \n            if existing:\n                await db.execute(\n                    \"\"\"UPDATE userbot_sessions \n                       SET login_state = $1, status = $2, \n                           session_string = NULL, is_active = false, \n                           error_message = NULL, updated_at = NOW()\n                       WHERE phone_number = $3\"\"\",\n                    json.dumps(login_state),\n                    \"awaiting_code\",\n                    phone_number\n                )\n            else:\n                await db.execute(\n                    \"\"\"INSERT INTO userbot_sessions \n                       (phone_number, login_state, status, is_active, is_primary)\n                       VALUES ($1, $2, $3, false, false)\"\"\",\n                    phone_number,\n                    json.dumps(login_state),\n                    \"awaiting_code\"\n                )\n            \n            logger.info(f\"OTP sent successfully to {phone_number[:5]}***\")\n            \n            return {\n                \"status\": \"code_sent\",\n                \"phone_number\": phone_number,\n                \"phone_code_hash\": sent_code.phone_code_hash,\n                \"message\": \"ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ•ŸÑŸâ Ÿáÿßÿ™ŸÅŸÉ\"\n            }\n            \n        except PhoneNumberInvalid:\n            logger.error(f\"Invalid phone number: {phone_number[:5]}***\")\n            return {\n                \"status\": \"error\",\n                \"error\": \"phone_invalid\",\n                \"message\": \"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\"\n            }\n        except PhoneNumberBanned:\n            logger.error(f\"Phone number banned: {phone_number[:5]}***\")\n            return {\n                \"status\": \"error\",\n                \"error\": \"phone_banned\",\n                \"message\": \"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ŸÖÿ≠ÿ∏Ÿàÿ± ŸÖŸÜ ÿ™ŸÑÿ∫ÿ±ÿßŸÖ\"\n            }\n        except PhoneNumberFlood:\n            logger.error(f\"Phone number flood: {phone_number[:5]}***\")\n            return {\n                \"status\": \"error\",\n                \"error\": \"phone_flood\",\n                \"message\": \"ÿ™ŸÖ ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑÿ≠ÿØ ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠ ÿ®Ÿá ŸÑŸÑŸÖÿ≠ÿßŸàŸÑÿßÿ™ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ÿ≥ÿßÿπÿ© ŸÇÿ®ŸÑ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ\"\n            }\n        except ApiIdInvalid:\n            logger.error(\"Invalid API ID or API Hash\")\n            return {\n                \"status\": \"error\", \n                \"error\": \"api_invalid\",\n                \"message\": \"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿØÿßÿØÿßÿ™ API - ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ API_ID Ÿà API_HASH\"\n            }\n        except FloodWait as e:\n            wait_seconds = int(e.value) if isinstance(e.value, (int, float, str)) else 60\n            logger.error(f\"Flood wait: {wait_seconds} seconds\")\n            minutes = wait_seconds // 60\n            if minutes > 0:\n                return {\n                    \"status\": \"error\",\n                    \"error\": \"flood_wait\",\n                    \"message\": f\"Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± {minutes} ÿØŸÇŸäŸÇÿ© ŸÇÿ®ŸÑ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ\"\n                }\n            return {\n                \"status\": \"error\",\n                \"error\": \"flood_wait\",\n                \"message\": f\"Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± {wait_seconds} ÿ´ÿßŸÜŸäÿ© ŸÇÿ®ŸÑ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ\"\n            }\n        except Exception as e:\n            logger.error(f\"Login start error: {str(e)}\")\n            await self._cleanup_existing_client(phone_number)\n            return {\n                \"status\": \"error\",\n                \"error\": \"unknown\",\n                \"message\": f\"ÿÆÿ∑ÿ£: {str(e)}\"\n            }\n    \n    async def verify_code(self, phone_number: str, code: str) -> Dict[str, Any]:\n        \"\"\"\n        Verify the OTP code\n        Retrieves phone_code_hash from database\n        Returns: {'status': 'success', 'session_string': '...'} or {'status': '2fa_required'}\n        \"\"\"\n        try:\n            phone_number = self._normalize_phone(phone_number)\n            code = code.strip().replace(\" \", \"\").replace(\"-\", \"\")\n            \n            await self._ensure_db_connected()\n            session_row = await db.fetchrow(\n                \"SELECT login_state, status FROM userbot_sessions WHERE phone_number = $1\",\n                phone_number\n            )\n            \n            logger.info(f\"Database lookup for {phone_number[:5]}***: found={session_row is not None}\")\n            \n            if not session_row:\n                logger.error(f\"No session found for {phone_number[:5]}***\")\n                return {\n                    \"status\": \"error\",\n                    \"error\": \"session_expired\",\n                    \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n                }\n            \n            if session_row.get('status') not in ['awaiting_code', 'awaiting_password']:\n                logger.error(f\"Invalid session status: {session_row.get('status')}\")\n                return {\n                    \"status\": \"error\",\n                    \"error\": \"session_expired\",\n                    \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n                }\n            \n            login_state = session_row.get('login_state')\n            \n            if not login_state:\n                logger.error(f\"No login state for {phone_number[:5]}***\")\n                return {\n                    \"status\": \"error\",\n                    \"error\": \"session_expired\",\n                    \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n                }\n            \n            try:\n                if isinstance(login_state, str):\n                    login_state = json.loads(login_state)\n                elif not isinstance(login_state, dict):\n                    logger.error(f\"Unexpected login_state type: {type(login_state)}\")\n                    login_state = {}\n            except json.JSONDecodeError as e:\n                logger.error(f\"Failed to parse login_state JSON: {str(e)}\")\n                return {\n                    \"status\": \"error\",\n                    \"error\": \"session_expired\",\n                    \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n                }\n            \n            phone_code_hash = login_state.get(\"phone_code_hash\")\n            if not phone_code_hash:\n                logger.error(f\"No phone_code_hash in login_state\")\n                return {\n                    \"status\": \"error\",\n                    \"error\": \"session_expired\",\n                    \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n                }\n            \n            logger.info(f\"Verifying code for {phone_number[:5]}***\")\n            \n            client = self.active_clients.get(phone_number)\n            \n            if not client:\n                logger.info(f\"No active client found for {phone_number[:5]}***, creating new one...\")\n                client = Client(\n                    name=f\"userbot_session_{phone_number[-4:]}\",\n                    api_id=settings.API_ID,\n                    api_hash=settings.API_HASH,\n                    in_memory=True\n                )\n                await client.connect()\n                self.active_clients[phone_number] = client\n            elif not client.is_connected:\n                logger.info(f\"Client disconnected, reconnecting...\")\n                try:\n                    await client.connect()\n                except Exception as e:\n                    logger.warning(f\"Reconnect failed, creating new client: {str(e)}\")\n                    client = Client(\n                        name=f\"userbot_session_{phone_number[-4:]}\",\n                        api_id=settings.API_ID,\n                        api_hash=settings.API_HASH,\n                        in_memory=True\n                    )\n                    await client.connect()\n                    self.active_clients[phone_number] = client\n            \n            try:\n                await client.sign_in(\n                    phone_number=phone_number,\n                    phone_code_hash=phone_code_hash,\n                    phone_code=code\n                )\n                \n                session_string = await client.export_session_string()\n                me = await client.get_me()\n                \n                await db.execute(\n                    \"\"\"UPDATE userbot_sessions \n                       SET status = 'active', login_state = NULL, \n                           session_string = $1, is_active = true, is_primary = true,\n                           last_login_at = NOW(), updated_at = NOW()\n                       WHERE phone_number = $2\"\"\",\n                    session_string,\n                    phone_number\n                )\n                \n                await db.execute(\n                    \"\"\"UPDATE userbot_sessions \n                       SET is_active = false, is_primary = false, updated_at = NOW()\n                       WHERE phone_number != $1 AND is_active = true\"\"\",\n                    phone_number\n                )\n                \n                await self._cleanup_existing_client(phone_number)\n                \n                logger.info(f\"Login successful for {me.first_name} (@{me.username})\")\n                \n                return {\n                    \"status\": \"success\",\n                    \"session_string\": session_string,\n                    \"user_id\": me.id,\n                    \"first_name\": me.first_name,\n                    \"username\": me.username,\n                    \"message\": f\"ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠ ŸÉŸÄ {me.first_name}\"\n                }\n                \n            except SessionPasswordNeeded:\n                logger.info(f\"2FA required for {phone_number[:5]}***\")\n                login_state[\"status\"] = \"awaiting_password\"\n                await db.execute(\n                    \"\"\"UPDATE userbot_sessions \n                       SET status = 'awaiting_password', login_state = $1, updated_at = NOW()\n                       WHERE phone_number = $2\"\"\",\n                    json.dumps(login_state),\n                    phone_number\n                )\n                return {\n                    \"status\": \"2fa_required\",\n                    \"message\": \"Ÿäÿ™ÿ∑ŸÑÿ® Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ® ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ®ÿÆÿ∑Ÿàÿ™ŸäŸÜ\"\n                }\n                \n        except PhoneCodeInvalid:\n            logger.error(\"Invalid phone code\")\n            return {\n                \"status\": \"error\",\n                \"error\": \"code_invalid\",\n                \"message\": \"ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\"\n            }\n        except PhoneCodeExpired:\n            logger.error(\"Phone code expired\")\n            await self._cleanup_existing_client(phone_number)\n            await db.execute(\n                \"\"\"UPDATE userbot_sessions \n                   SET status = 'error', login_state = NULL, \n                       error_message = 'code_expired', updated_at = NOW()\n                   WHERE phone_number = $1\"\"\",\n                phone_number\n            )\n            return {\n                \"status\": \"error\",\n                \"error\": \"code_expired\",\n                \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇÿå Ÿäÿ±ÿ¨Ÿâ ÿ∑ŸÑÿ® ÿ±ŸÖÿ≤ ÿ¨ÿØŸäÿØ\"\n            }\n        except AuthKeyUnregistered:\n            logger.error(\"Auth key unregistered - session expired\")\n            await self._cleanup_existing_client(phone_number)\n            await db.execute(\n                \"\"\"UPDATE userbot_sessions \n                   SET status = 'error', login_state = NULL, \n                       error_message = 'auth_key_unregistered', updated_at = NOW()\n                   WHERE phone_number = $1\"\"\",\n                phone_number\n            )\n            return {\n                \"status\": \"error\",\n                \"error\": \"session_expired\",\n                \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n            }\n        except Exception as e:\n            logger.error(f\"Code verification error: {str(e)}\")\n            return {\n                \"status\": \"error\",\n                \"error\": \"unknown\",\n                \"message\": f\"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÇŸÇ: {str(e)}\"\n            }\n    \n    async def verify_2fa(self, phone_number: str, password: str) -> Dict[str, Any]:\n        \"\"\"\n        Verify 2FA password\n        Returns: {'status': 'success', 'session_string': '...'}\n        \"\"\"\n        try:\n            phone_number = self._normalize_phone(phone_number)\n            \n            await self._ensure_db_connected()\n            \n            session_row = await db.fetchrow(\n                \"SELECT login_state, status FROM userbot_sessions WHERE phone_number = $1\",\n                phone_number\n            )\n            \n            if not session_row or session_row.get('status') != 'awaiting_password':\n                return {\n                    \"status\": \"error\",\n                    \"error\": \"session_expired\",\n                    \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n                }\n            \n            client = self.active_clients.get(phone_number)\n            if not client:\n                logger.warning(f\"No active client for 2FA, cannot proceed\")\n                return {\n                    \"status\": \"error\",\n                    \"error\": \"session_expired\",\n                    \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n                }\n            \n            if not client.is_connected:\n                logger.info(f\"Client disconnected during 2FA, reconnecting...\")\n                try:\n                    await client.connect()\n                except Exception as e:\n                    logger.error(f\"Failed to reconnect for 2FA: {str(e)}\")\n                    return {\n                        \"status\": \"error\",\n                        \"error\": \"session_expired\",\n                        \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n                    }\n            \n            logger.info(f\"Verifying 2FA for {phone_number[:5]}***\")\n            \n            await client.check_password(password)\n            \n            session_string = await client.export_session_string()\n            me = await client.get_me()\n            \n            await db.execute(\n                \"\"\"UPDATE userbot_sessions \n                   SET status = 'active', login_state = NULL,\n                       session_string = $1, is_active = true, is_primary = true,\n                       last_login_at = NOW(), updated_at = NOW()\n                   WHERE phone_number = $2\"\"\",\n                session_string,\n                phone_number\n            )\n            \n            await db.execute(\n                \"\"\"UPDATE userbot_sessions \n                   SET is_active = false, is_primary = false, updated_at = NOW()\n                   WHERE phone_number != $1 AND is_active = true\"\"\",\n                phone_number\n            )\n            \n            await self._cleanup_existing_client(phone_number)\n            \n            logger.info(f\"2FA login successful for {me.first_name}\")\n            \n            return {\n                \"status\": \"success\",\n                \"session_string\": session_string,\n                \"user_id\": me.id,\n                \"first_name\": me.first_name,\n                \"username\": me.username,\n                \"message\": f\"ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠ ŸÉŸÄ {me.first_name}\"\n            }\n            \n        except PasswordHashInvalid:\n            logger.error(\"Invalid 2FA password\")\n            return {\n                \"status\": \"error\",\n                \"error\": \"password_invalid\",\n                \"message\": \"ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©\"\n            }\n        except AuthKeyUnregistered:\n            logger.error(\"Auth key unregistered during 2FA\")\n            await self._cleanup_existing_client(phone_number)\n            return {\n                \"status\": \"error\",\n                \"error\": \"session_expired\",\n                \"message\": \"ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ\"\n            }\n        except Exception as e:\n            logger.error(f\"2FA verification error: {str(e)}\")\n            return {\n                \"status\": \"error\",\n                \"error\": \"unknown\",\n                \"message\": f\"ÿÆÿ∑ÿ£: {str(e)}\"\n            }\n    \n    async def cancel_login(self, phone_number: str) -> Dict[str, Any]:\n        \"\"\"Cancel ongoing login process and cleanup\"\"\"\n        try:\n            phone_number = self._normalize_phone(phone_number)\n            \n            await self._cleanup_existing_client(phone_number)\n            \n            await self._ensure_db_connected()\n            await db.execute(\n                \"\"\"UPDATE userbot_sessions \n                   SET status = 'cancelled', login_state = NULL, updated_at = NOW()\n                   WHERE phone_number = $1 AND status IN ('awaiting_code', 'awaiting_password')\"\"\",\n                phone_number\n            )\n            \n            logger.info(f\"Login cancelled for {phone_number[:5]}***\")\n            \n            return {\"status\": \"cancelled\", \"message\": \"ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿπŸÖŸÑŸäÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ\"}\n            \n        except Exception as e:\n            logger.error(f\"Cancel login error: {str(e)}\")\n            return {\"status\": \"error\", \"message\": str(e)}\n    \n    async def logout(self, phone_number: Optional[str] = None) -> Dict[str, Any]:\n        \"\"\"\n        Logout and cleanup session\n        If phone_number is None, logs out the active session\n        \"\"\"\n        try:\n            await self._ensure_db_connected()\n            \n            if not phone_number:\n                session_row = await db.fetchrow(\n                    \"SELECT phone_number FROM userbot_sessions WHERE is_active = true AND is_primary = true LIMIT 1\"\n                )\n                if session_row:\n                    phone_number = session_row['phone_number']\n            \n            if phone_number:\n                phone_number = self._normalize_phone(phone_number)\n                await self._cleanup_existing_client(phone_number)\n            else:\n                await self._cleanup_all_clients()\n            \n            await db.execute(\n                \"\"\"UPDATE userbot_sessions \n                   SET is_active = false, is_primary = false, \n                       session_string = NULL, status = 'expired',\n                       login_state = NULL, updated_at = NOW()\n                   WHERE is_active = true\"\"\"\n            )\n            \n            logger.info(f\"Logout successful\")\n            \n            return {\"status\": \"success\", \"message\": \"ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠\"}\n            \n        except Exception as e:\n            logger.error(f\"Logout error: {str(e)}\")\n            return {\"status\": \"error\", \"message\": str(e)}\n    \n    async def validate_session(self, session_string: str) -> Dict[str, Any]:\n        \"\"\"Validate an existing session string\"\"\"\n        client = None\n        try:\n            client = Client(\n                name=\"session_validator\",\n                api_id=settings.API_ID,\n                api_hash=settings.API_HASH,\n                session_string=session_string,\n                in_memory=True\n            )\n            \n            await client.connect()\n            me = await client.get_me()\n            await client.disconnect()\n            \n            return {\n                \"status\": \"valid\",\n                \"user_id\": me.id,\n                \"first_name\": me.first_name,\n                \"username\": me.username\n            }\n            \n        except AuthKeyUnregistered:\n            logger.error(\"Session validation failed: auth key unregistered\")\n            return {\n                \"status\": \"invalid\",\n                \"error\": \"auth_key_unregistered\"\n            }\n        except Exception as e:\n            logger.error(f\"Session validation error: {str(e)}\")\n            return {\n                \"status\": \"invalid\",\n                \"error\": str(e)\n            }\n        finally:\n            if client and client.is_connected:\n                try:\n                    await client.disconnect()\n                except:\n                    pass\n    \n    async def get_login_status(self, phone_number: str) -> Dict[str, Any]:\n        \"\"\"Get current login status for a phone number\"\"\"\n        try:\n            phone_number = self._normalize_phone(phone_number)\n            \n            await self._ensure_db_connected()\n            session_row = await db.fetchrow(\n                \"\"\"SELECT status, is_active, error_message \n                   FROM userbot_sessions WHERE phone_number = $1\"\"\",\n                phone_number\n            )\n            \n            if not session_row:\n                return {\"status\": \"not_found\"}\n            \n            return {\n                \"status\": session_row['status'],\n                \"is_active\": session_row['is_active'],\n                \"error_message\": session_row.get('error_message')\n            }\n            \n        except Exception as e:\n            logger.error(f\"Get login status error: {str(e)}\")\n            return {\"status\": \"error\", \"message\": str(e)}\n\nuserbot_auth = UserbotAuthService()\n","path":null,"size_bytes":25915,"size_tokens":null},"telegram_bot/services/link_processor.py":{"content":"\"\"\"\nLink Processing Service\nDownload videos from social media links and process them\nSupports YouTube, Twitter/X, Instagram, TikTok, Facebook, and more via yt-dlp\nEnhanced with better format handling, retry mechanisms, and URL extraction\n\"\"\"\nimport os\nimport re\nimport asyncio\nimport subprocess\nfrom typing import Dict, Any, Optional, Tuple, List\nfrom utils.error_handler import handle_errors, ErrorLogger, TaskLogger\nfrom utils.database import db\nfrom services.ai_providers import ai_manager\nfrom services.ai_pipeline import ai_pipeline\nfrom services.telegraph_service import telegraph_manager\n\nerror_logger = ErrorLogger(\"link_processor\")\n\nURL_PATTERNS = [\n    r'https?://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+',\n    r'https?://(?:www\\.)?youtube\\.com/shorts/[\\w-]+',\n    r'https?://youtu\\.be/[\\w-]+',\n    r'https?://(?:www\\.)?twitter\\.com/\\w+/status/\\d+',\n    r'https?://(?:www\\.)?x\\.com/\\w+/status/\\d+',\n    r'https?://(?:www\\.)?instagram\\.com/(?:p|reel|reels|tv)/[\\w-]+',\n    r'https?://(?:www\\.)?tiktok\\.com/@[\\w.-]+/video/\\d+',\n    r'https?://(?:vm\\.)?tiktok\\.com/[\\w-]+',\n    r'https?://(?:www\\.)?tiktok\\.com/t/[\\w-]+',\n    r'https?://(?:www\\.)?facebook\\.com/share/v/[\\w-]+',\n    r'https?://(?:www\\.)?facebook\\.com/[\\w.]+/videos/\\d+',\n    r'https?://(?:www\\.)?facebook\\.com/watch/?\\?v=\\d+',\n    r'https?://fb\\.watch/[\\w-]+',\n    r'https?://(?:www\\.)?vimeo\\.com/\\d+',\n    r'https?://(?:www\\.)?dailymotion\\.com/video/[\\w-]+',\n    r'https?://(?:www\\.)?reddit\\.com/r/\\w+/comments/[\\w/]+',\n    r'https?://(?:www\\.)?linkedin\\.com/posts/[\\w-]+',\n    r'https?://(?:www\\.)?twitch\\.tv/videos/\\d+',\n    r'https?://(?:www\\.)?streamable\\.com/[\\w-]+',\n    r'https?://(?:www\\.)?rumble\\.com/[\\w-]+\\.html',\n]\n\nGENERIC_URL_PATTERN = r'https?://[^\\s<>\"\\']+(?:video|watch|clip|reel|shorts?)[\\w/\\?=&-]*'\n\nMAX_VIDEO_SIZE_MB = 50\nDOWNLOAD_TIMEOUT = 90\nMAX_RETRIES = 2\n\nclass LinkProcessor:\n    \"\"\"Process video links from social media with enhanced error handling\"\"\"\n    \n    def __init__(self, temp_dir: str = \"telegram_bot/temp\"):\n        self.temp_dir = temp_dir\n        os.makedirs(temp_dir, exist_ok=True)\n        error_logger.log_info(\"LinkProcessor initialized\")\n    \n    def is_video_link(self, text: str) -> bool:\n        \"\"\"Check if text contains only a video link (no other text)\"\"\"\n        if not text:\n            return False\n        \n        text = text.strip()\n        \n        for pattern in URL_PATTERNS:\n            if re.match(pattern, text):\n                return len(text.split()) == 1\n        \n        if re.match(r'^https?://[^\\s]+$', text) and len(text.split()) == 1:\n            return True\n        \n        return False\n    \n    def extract_url(self, text: str) -> Optional[str]:\n        \"\"\"Extract URL from text\"\"\"\n        if not text:\n            return None\n        \n        text = text.strip()\n        \n        url_match = re.match(r'^(https?://[^\\s]+)$', text)\n        if url_match:\n            return url_match.group(1)\n        \n        return None\n    \n    def _get_format_options(self, quality: str) -> List[str]:\n        \"\"\"Get list of format options to try in order of preference\n        Simplified formats for better compatibility across platforms\"\"\"\n        formats = {\n            \"best\": [\n                \"bestvideo[ext=mp4]+bestaudio[ext=m4a]/bestvideo+bestaudio/best\",\n                \"best[ext=mp4]/best\",\n            ],\n            \"high\": [\n                \"bestvideo[ext=mp4]+bestaudio[ext=m4a]/bestvideo+bestaudio/best\",\n                \"best[ext=mp4]/best\",\n            ],\n            \"medium\": [\n                \"bestvideo[ext=mp4]+bestaudio[ext=m4a]/bestvideo+bestaudio/best\",\n                \"best[ext=mp4]/best\",\n            ],\n            \"low\": [\n                \"bestvideo[ext=mp4]+bestaudio[ext=m4a]/bestvideo+bestaudio/best\",\n                \"best[ext=mp4]/best\",\n            ],\n        }\n        return formats.get(quality, formats[\"high\"])\n    \n    async def get_video_info(self, url: str) -> Dict[str, Any]:\n        \"\"\"Get comprehensive video info using yt-dlp --dump-json\n        Extracts: title, description, uploader, channel, platform, duration, thumbnail\"\"\"\n        try:\n            import json\n            \n            cmd = [\n                \"yt-dlp\",\n                \"--no-warnings\",\n                \"--no-playlist\",\n                \"--dump-json\",\n                \"--socket-timeout\", \"15\",\n                url\n            ]\n            \n            process = await asyncio.create_subprocess_exec(\n                *cmd,\n                stdout=asyncio.subprocess.PIPE,\n                stderr=asyncio.subprocess.PIPE\n            )\n            \n            stdout, stderr = await asyncio.wait_for(\n                process.communicate(),\n                timeout=45\n            )\n            \n            if process.returncode == 0 and stdout:\n                info = json.loads(stdout.decode('utf-8', errors='ignore'))\n                \n                title = info.get('title', '') or ''\n                description = info.get('description', '') or ''\n                if len(description) > 1000:\n                    description = description[:1000] + \"...\"\n                \n                uploader = info.get('uploader', '') or info.get('creator', '') or info.get('channel', '') or ''\n                channel = info.get('channel', '') or info.get('uploader', '') or ''\n                uploader_id = info.get('uploader_id', '') or info.get('channel_id', '') or ''\n                \n                platform = info.get('extractor_key', '') or info.get('extractor', '') or ''\n                if not platform:\n                    if 'youtube' in url.lower():\n                        platform = 'YouTube'\n                    elif 'facebook' in url.lower() or 'fb.watch' in url.lower():\n                        platform = 'Facebook'\n                    elif 'instagram' in url.lower():\n                        platform = 'Instagram'\n                    elif 'twitter' in url.lower() or 'x.com' in url.lower():\n                        platform = 'Twitter/X'\n                    elif 'tiktok' in url.lower():\n                        platform = 'TikTok'\n                \n                thumbnail_url = info.get('thumbnail', '') or ''\n                duration = int(info.get('duration', 0) or 0)\n                \n                upload_date = info.get('upload_date', '') or ''\n                view_count = info.get('view_count', 0) or 0\n                like_count = info.get('like_count', 0) or 0\n                \n                result = {\n                    'title': title,\n                    'description': description,\n                    'uploader': uploader,\n                    'channel': channel,\n                    'uploader_id': uploader_id,\n                    'platform': platform,\n                    'thumbnail_url': thumbnail_url,\n                    'duration': duration,\n                    'upload_date': upload_date,\n                    'view_count': view_count,\n                    'like_count': like_count,\n                    'original_url': url\n                }\n                \n                error_logger.log_info(f\"[VIDEO_INFO] title={title[:50]}, uploader={uploader}, platform={platform}, duration={duration}s\")\n                \n                return result\n                \n        except Exception as e:\n            error_logger.log_info(f\"[VIDEO_INFO] Failed to get info: {str(e)}\")\n        \n        return {\n            'title': '', 'description': '', 'uploader': '', 'channel': '',\n            'uploader_id': '', 'platform': '', 'thumbnail_url': '', 'duration': 0,\n            'upload_date': '', 'view_count': 0, 'like_count': 0, 'original_url': url\n        }\n\n    @handle_errors(\"link_processor\", \"download_video\")\n    async def download_video(self, url: str, task_id: int, quality: str = \"high\") -> Optional[str]:\n        \"\"\"Download video from URL using yt-dlp with specified quality and format fallbacks\n        Falls back to any available format and converts to MP4 if needed\"\"\"\n        task_logger = TaskLogger(task_id)\n        \n        try:\n            await task_logger.log_info(f\"üîó DOWNLOADING VIDEO:\")\n            await task_logger.log_info(f\"   URL: {url}\")\n            await task_logger.log_info(f\"   Quality: {quality}\")\n            error_logger.log_info(f\"[LINK_DOWNLOAD] URL={url}, Quality={quality}\")\n            \n            output_template = os.path.join(\n                self.temp_dir,\n                f\"link_video_{task_id}_{int(asyncio.get_event_loop().time())}\"\n            )\n            output_path = f\"{output_template}.mp4\"\n            \n            format_options = self._get_format_options(quality)\n            # Add fallback formats that convert anything to MP4\n            format_options.extend([\n                \"best\",  # Just get the best available\n            ])\n            \n            last_error = None\n            for attempt, format_str in enumerate(format_options):\n                await task_logger.log_info(f\"   Attempt {attempt + 1}/{len(format_options)}: format={format_str[:50]}...\")\n                \n                cmd = [\n                    \"yt-dlp\",\n                    \"--no-warnings\",\n                    \"--no-playlist\",\n                    \"--format\", format_str,\n                    \"--merge-output-format\", \"mp4\",\n                    \"--recode-video\", \"mp4\",\n                    \"--audio-quality\", \"0\",\n                    \"--max-filesize\", f\"{MAX_VIDEO_SIZE_MB}M\",\n                    \"--restrict-filenames\",\n                    \"--socket-timeout\", \"20\",\n                    \"--retries\", \"2\",\n                    \"--fragment-retries\", \"3\",\n                    \"--output\", output_path,\n                    url\n                ]\n                \n                try:\n                    process = await asyncio.create_subprocess_exec(\n                        *cmd,\n                        stdout=asyncio.subprocess.PIPE,\n                        stderr=asyncio.subprocess.PIPE\n                    )\n                    \n                    stdout, stderr = await asyncio.wait_for(\n                        process.communicate(),\n                        timeout=DOWNLOAD_TIMEOUT\n                    )\n                    \n                    if process.returncode == 0:\n                        found_path = self._find_downloaded_file(task_id, output_path)\n                        if found_path:\n                            size_mb = os.path.getsize(found_path) / (1024 * 1024)\n                            await task_logger.log_success(f\"‚úì Video downloaded: {size_mb:.2f}MB\")\n                            error_logger.log_info(f\"[LINK_DOWNLOAD] SUCCESS - size={size_mb:.2f}MB, format={format_str[:30]}\")\n                            return found_path\n                    \n                    stderr_str = stderr.decode('utf-8', errors='ignore') if stderr else \"\"\n                    \n                    if not stderr_str and process.returncode != 0:\n                        last_error = f\"Return code {process.returncode}\"\n                        await task_logger.log_warning(f\"Download failed: {last_error}\")\n                        continue\n                    \n                    if \"Requested format is not available\" in stderr_str or \"does not have a format\" in stderr_str:\n                        await task_logger.log_warning(f\"Format not available, trying next...\")\n                        last_error = \"Format not available\"\n                        continue\n                    elif \"Video unavailable\" in stderr_str or \"Private video\" in stderr_str:\n                        await task_logger.log_error(\"‚ùå Video is private or unavailable\")\n                        return None\n                    elif \"HTTP Error 403\" in stderr_str or \"403 Forbidden\" in stderr_str:\n                        await task_logger.log_warning(f\"Video is geo-blocked, trying next...\")\n                        last_error = \"Geo-blocked\"\n                        continue\n                    elif stderr_str:\n                        last_error = stderr_str[:150]\n                        await task_logger.log_warning(f\"Attempt {attempt + 1} failed, trying next...\")\n                        continue\n                    else:\n                        continue\n                        \n                except asyncio.TimeoutError:\n                    await task_logger.log_warning(f\"Timeout on attempt {attempt + 1}, trying next format...\")\n                    last_error = \"Timeout\"\n                    continue\n            \n            await task_logger.log_error(f\"‚ùå All download attempts failed. Last error: {last_error}\")\n            error_logger.log_info(f\"[LINK_DOWNLOAD] FAILED - all formats failed, last_error={last_error}\")\n            return None\n                \n        except asyncio.TimeoutError:\n            await task_logger.log_error(f\"‚ùå Video download timeout ({DOWNLOAD_TIMEOUT}s)\")\n            error_logger.log_info(f\"[LINK_DOWNLOAD] TIMEOUT - url={url}\")\n            return None\n        except Exception as e:\n            await task_logger.log_error(f\"‚ùå Download error: {str(e)}\")\n            error_logger.log_info(f\"[LINK_DOWNLOAD] EXCEPTION - error={str(e)}\")\n            raise\n    \n    def _find_downloaded_file(self, task_id: int, expected_path: str) -> Optional[str]:\n        \"\"\"Find downloaded file, checking expected path and alternatives\"\"\"\n        if os.path.exists(expected_path):\n            return expected_path\n        \n        for ext in ['.mp4', '.mkv', '.webm', '.mov']:\n            alt_path = expected_path.rsplit('.', 1)[0] + ext\n            if os.path.exists(alt_path):\n                return alt_path\n        \n        for f in os.listdir(self.temp_dir):\n            if f.startswith(f\"link_video_{task_id}_\"):\n                found_path = os.path.join(self.temp_dir, f)\n                if os.path.exists(found_path) and os.path.getsize(found_path) > 1000:\n                    return found_path\n        \n        return None\n    \n    @handle_errors(\"link_processor\", \"extract_audio\")\n    async def extract_audio(self, video_path: str) -> Optional[str]:\n        \"\"\"Extract audio from video file\"\"\"\n        try:\n            import ffmpeg\n            \n            audio_path = video_path.rsplit(\".\", 1)[0] + \".mp3\"\n            \n            stream = ffmpeg.input(video_path)\n            stream = ffmpeg.output(stream, audio_path, acodec='libmp3lame', ar='16000')\n            ffmpeg.run(stream, overwrite_output=True, quiet=True)\n            \n            if os.path.exists(audio_path):\n                error_logger.log_info(f\"Audio extracted: {audio_path}\")\n                return audio_path\n            return None\n            \n        except Exception as e:\n            error_logger.log_info(f\"Audio extraction error: {str(e)}\")\n            return None\n    \n    @handle_errors(\"link_processor\", \"generate_thumbnail\")\n    async def generate_thumbnail(self, video_path: str) -> Optional[str]:\n        \"\"\"Generate thumbnail from video - tries multiple positions for best result\"\"\"\n        try:\n            import ffmpeg\n            \n            thumb_path = video_path.rsplit(\".\", 1)[0] + \"_thumb.jpg\"\n            \n            for ss_time in [2, 5, 10, 1]:\n                try:\n                    stream = ffmpeg.input(video_path, ss=ss_time)\n                    stream = ffmpeg.output(stream, thumb_path, vframes=1, vf='scale=320:-2', format='image2', vcodec='mjpeg')\n                    ffmpeg.run(stream, overwrite_output=True, quiet=True, capture_stdout=True, capture_stderr=True)\n                    \n                    if os.path.exists(thumb_path) and os.path.getsize(thumb_path) > 500:\n                        error_logger.log_info(f\"Thumbnail generated at {ss_time}s: {thumb_path}\")\n                        return thumb_path\n                except:\n                    continue\n            \n            error_logger.log_warning(\"Could not generate thumbnail from video\")\n            return None\n            \n        except Exception as e:\n            error_logger.log_info(f\"Thumbnail generation error: {str(e)}\")\n            return None\n    \n    def get_video_metadata(self, video_path: str) -> Dict[str, Any]:\n        \"\"\"Get video duration, width, height using ffprobe\"\"\"\n        try:\n            import ffmpeg\n            \n            probe = ffmpeg.probe(video_path)\n            video_stream = next(\n                (stream for stream in probe['streams'] if stream['codec_type'] == 'video'),\n                None\n            )\n            \n            if video_stream:\n                duration = int(float(probe.get('format', {}).get('duration', 0)))\n                width = int(video_stream.get('width', 0))\n                height = int(video_stream.get('height', 0))\n                \n                error_logger.log_info(f\"Video metadata: duration={duration}s, {width}x{height}\")\n                return {\n                    'duration': duration,\n                    'width': width,\n                    'height': height\n                }\n        except Exception as e:\n            error_logger.log_info(f\"Failed to get video metadata: {str(e)}\")\n        \n        return {'duration': 0, 'width': 0, 'height': 0}\n    \n    def ensure_mp4_extension(self, video_path: str) -> str:\n        \"\"\"Ensure video file has .mp4 extension, rename if needed\"\"\"\n        if not video_path:\n            return video_path\n            \n        if video_path.lower().endswith('.mp4'):\n            return video_path\n        \n        new_path = video_path.rsplit('.', 1)[0] + '.mp4'\n        try:\n            if os.path.exists(video_path):\n                os.rename(video_path, new_path)\n                error_logger.log_info(f\"Renamed video to mp4: {new_path}\")\n                return new_path\n        except Exception as e:\n            error_logger.log_info(f\"Failed to rename video: {str(e)}\")\n        \n        return video_path\n    \n    def _cleanup_temp_files(self, file_paths: list):\n        \"\"\"Safely cleanup temporary files\"\"\"\n        for file_path in file_paths:\n            if file_path and os.path.exists(file_path):\n                try:\n                    os.remove(file_path)\n                    error_logger.log_info(f\"Cleaned up temp file: {file_path}\")\n                except Exception as e:\n                    error_logger.log_warning(f\"Failed to cleanup {file_path}: {str(e)}\")\n    \n    @handle_errors(\"link_processor\", \"process_link\")\n    async def process_link(\n        self,\n        url: str,\n        task_id: int,\n        task_config: Dict[str, Any]\n    ) -> Optional[Tuple[str, Optional[str], Optional[str], Optional[Dict[str, Any]]]]:\n        \"\"\"\n        Full link processing pipeline:\n        1. Get video info (title, description)\n        2. Download video from URL\n        3. Extract audio\n        4. Transcribe with Whisper\n        5. Summarize with AI\n        6. Create Telegraph page with transcript\n        7. Return video only if download is enabled\n        \n        Returns tuple of (summary, video_path, telegraph_url, video_info)\n        - video_path is returned ONLY if linkVideoDownloadEnabled is True\n        - video_path is NOT returned if download is disabled (file is deleted)\n        - video_info contains title, description, duration\n        \"\"\"\n        task_logger = TaskLogger(task_id)\n        video_path = None\n        audio_path = None\n        downloaded_video_path = None\n        result_video_path = None\n        thumb_path = None\n        video_info = {'title': '', 'description': '', 'duration': 0}\n        \n        try:\n            await task_logger.log_info(f\"Processing link: {url[:50]}...\")\n            \n            # Step 0: Get video info (title, description)\n            await task_logger.log_info(\"Step 0: Getting video info...\")\n            video_info = await self.get_video_info(url)\n            if video_info.get('title'):\n                await task_logger.log_success(f\"‚úì Video title: {video_info['title'][:50]}...\")\n            \n            # Step 1: Download video\n            quality = task_config.get(\"linkVideoQuality\", \"high\")\n            await task_logger.log_info(f\"Step 1: Downloading video (quality: {quality})...\")\n            downloaded_video_path = await self.download_video(url, task_id, quality)\n            \n            if not downloaded_video_path:\n                error_msg = f\"‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖŸÜ ÿßŸÑÿ±ÿßÿ®ÿ∑. ŸÇÿØ ŸäŸÉŸàŸÜ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖÿ≠ÿ∞ŸàŸÅÿßŸã ÿ£Ÿà ŸÖÿ≠ŸÖŸäÿßŸã ÿ£Ÿà ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠ ŸÅŸä ŸÖŸÜÿ∑ŸÇÿ™ŸÉ. ÿßŸÑÿ±ÿßÿ®ÿ∑: {url}\"\n                await task_logger.log_error(error_msg)\n                error_logger.log_info(f\"[LINK_PROCESS] Video download failed for URL: {url}\")\n                # Return error message instead of None for proper handling upstream\n                return (error_msg, None, None, video_info)\n            \n            await task_logger.log_success(f\"‚úì Video downloaded: {downloaded_video_path}\")\n            video_path = downloaded_video_path\n            \n            # Track video for potential cleanup\n            if video_path is None:\n                await task_logger.log_error(\"Failed to set video path\")\n                return None\n            \n            # Step 2: Extract audio from video\n            await task_logger.log_info(\"Step 2: Extracting audio from video...\")\n            audio_path = await self.extract_audio(video_path)\n            \n            if not audio_path:\n                error_msg = \"‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿµŸàÿ™ ŸÖŸÜ ÿßŸÑŸÅŸäÿØŸäŸà\"\n                await task_logger.log_error(error_msg)\n                error_logger.log_info(\"[LINK_PROCESS] Audio extraction failed\")\n                return (error_msg, None, None, video_info)\n            \n            await task_logger.log_success(f\"‚úì Audio extracted: {audio_path}\")\n            \n            # Step 3: Transcribe with Whisper\n            await task_logger.log_info(\"Step 3: Transcribing audio with Whisper...\")\n            transcript = await ai_manager.transcribe_audio(audio_path)\n            \n            if not transcript:\n                error_msg = \"‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ™ ÿ•ŸÑŸâ ŸÜÿµ (Whisper). ÿßŸÑŸÖŸÑŸÅ ŸÇÿØ ŸäŸÉŸàŸÜ ÿ∑ŸàŸäŸÑÿßŸã ÿ¨ÿØÿßŸã ÿ£Ÿà ŸÖÿπÿ∑Ÿàÿ®ÿßŸã\"\n                await task_logger.log_error(error_msg)\n                error_logger.log_info(\"[LINK_PROCESS] Transcription failed\")\n                return (error_msg, None, None, video_info)\n            \n            await task_logger.log_success(f\"‚úì Transcription completed: {len(transcript)} chars\")\n            \n            # Step 4: Summarize with AI\n            await task_logger.log_info(\"Step 4: Summarizing transcript with AI...\")\n            provider_id = task_config.get(\"video_ai_provider_id\") or task_config.get(\"summarization_provider_id\")\n            model_id = task_config.get(\"video_ai_model_id\") or task_config.get(\"summarization_model_id\")\n            \n            # Get video rules specifically (not text summarization rules)\n            rules = await db.get_task_rules(task_id)\n            video_rule = next((r for r in rules if r[\"type\"] == \"video\" and r[\"is_active\"]), None)\n            await task_logger.log_info(f\"Found video rules: {len([r for r in rules if r['type'] == 'video'])}, active: {video_rule is not None}\")\n            \n            provider_name = \"groq\"\n            model_name = \"mixtral-8x7b-32768\"\n            \n            if provider_id:\n                provider_info = await db.get_ai_provider(provider_id)\n                if provider_info:\n                    provider_name = provider_info[\"name\"]\n            \n            if model_id:\n                model_info = await db.get_ai_model(model_id)\n                if model_info:\n                    model_name = model_info[\"model_name\"]\n            \n            custom_rule = video_rule[\"prompt\"] if video_rule else None\n            if video_rule:\n                await task_logger.log_info(f\"Using video rule: {video_rule.get('name', 'unnamed')}\")\n            \n            await task_logger.log_info(f\"Processing transcript with AI Pipeline ({provider_name}/{model_name})...\")\n            # Apply BOTH video rules AND summarize rules\n            video_rules = [r for r in rules if r[\"type\"] == \"video\" and r[\"is_active\"]]\n            summarize_rules = [r for r in rules if r[\"type\"] == \"summarize\" and r[\"is_active\"]]\n            all_applicable_rules = video_rules + summarize_rules\n            \n            # Prepare video source info for pipeline\n            video_source_info = {\n                'uploader': video_info.get('uploader', ''),\n                'channel': video_info.get('channel', '') or video_info.get('uploader', ''),\n                'platform': video_info.get('platform', ''),\n                'title': video_info.get('title', '')\n            }\n            await task_logger.log_info(f\"Using video source info: uploader={video_source_info['uploader']}, platform={video_source_info['platform']}\")\n            \n            pipeline_result = await ai_pipeline.process(\n                text=transcript,\n                task_id=task_id,\n                provider=provider_name,\n                model=model_name,\n                system_prompt=custom_rule,\n                custom_rules=all_applicable_rules,\n                video_source_info=video_source_info\n            )\n            summary = pipeline_result.final_text\n            await task_logger.log_info(f\"Pipeline processing complete: {len(summary)} chars (quality: {pipeline_result.quality_score:.2f})\")\n            \n            await task_logger.log_success(f\"‚úì Summary generated: {len(summary)} chars\")\n            \n            # Step 5: Create Telegraph page\n            await task_logger.log_info(\"Step 5: Creating Telegraph page...\")\n            telegraph_url = None\n            try:\n                telegraph_url = await telegraph_manager.create_text_page(\n                    title=\"ŸÜÿµ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖŸÜ ÿßŸÑÿ±ÿßÿ®ÿ∑\",\n                    content=transcript,\n                    description=\"ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÖŸÜ ŸÅŸäÿØŸäŸà ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Whisper\"\n                )\n                await task_logger.log_success(f\"‚úì Telegraph page created: {telegraph_url}\")\n            except Exception as telegraph_err:\n                await task_logger.log_warning(f\"Telegraph creation failed: {str(telegraph_err)}\")\n            \n            # Step 6: Handle video based on download enabled flag\n            await task_logger.log_info(\"Step 6: Checking if video should be sent...\")\n            download_enabled = task_config.get(\"link_video_download_enabled\", True)\n            await task_logger.log_info(f\"Download enabled flag: {download_enabled}\")\n            \n            if download_enabled:\n                if video_path and os.path.exists(video_path):\n                    result_video_path = video_path\n                    await task_logger.log_success(f\"‚úì Video WILL be sent to target: {video_path}\")\n                else:\n                    await task_logger.log_warning(f\"Video path invalid or doesn't exist: {video_path}\")\n            else:\n                await task_logger.log_info(\"Download disabled - video will NOT be sent, deleting temporary file...\")\n                if video_path and os.path.exists(video_path):\n                    try:\n                        os.remove(video_path)\n                        await task_logger.log_success(f\"‚úì Temporary video deleted\")\n                    except Exception as e:\n                        await task_logger.log_warning(f\"Failed to delete temp video: {str(e)}\")\n                result_video_path = None\n            \n            # Final summary\n            await task_logger.log_success(\n                f\"‚úì Link processing completed: \"\n                f\"summary={len(summary)} chars, \"\n                f\"video_sent={result_video_path is not None}, \"\n                f\"telegraph={telegraph_url is not None}, \"\n                f\"title={video_info.get('title', '')[:30]}\"\n            )\n            await db.update_task_stats(task_id, \"video\")\n            \n            # ‚úÖ ADD TRANSCRIPT TO VIDEO_INFO for field extraction\n            video_info['transcript'] = transcript\n            \n            return (summary, result_video_path, telegraph_url, video_info)\n            \n        except Exception as e:\n            await task_logger.log_error(f\"Link processing error: {str(e)}\")\n            await db.update_task_stats(task_id, \"error\")\n            raise\n        finally:\n            # Comprehensive cleanup of all temporary files\n            # Don't delete result_video_path if it will be sent to user\n            files_to_cleanup = []\n            \n            # Always cleanup audio (transcription done)\n            if audio_path and os.path.exists(audio_path):\n                files_to_cleanup.append(audio_path)\n            \n            # Cleanup thumbnail\n            if thumb_path and os.path.exists(thumb_path):\n                files_to_cleanup.append(thumb_path)\n            \n            # Cleanup video only if it's NOT going to be sent (result_video_path is None or different)\n            if video_path and os.path.exists(video_path) and video_path != result_video_path:\n                files_to_cleanup.append(video_path)\n            \n            if files_to_cleanup:\n                self._cleanup_temp_files(files_to_cleanup)\n\nlink_processor = LinkProcessor()\n","path":null,"size_bytes":29203,"size_tokens":null},"telegram_bot/auth_service.py":{"content":"\"\"\"\nFastAPI Micro-service for Userbot Authentication\nRuns as a persistent subprocess to maintain Pyrogram client state\n\"\"\"\nimport asyncio\nimport logging\nimport sys\nfrom pathlib import Path\nfrom fastapi import FastAPI, HTTPException\nfrom pydantic import BaseModel\nfrom typing import Optional\n\nsys.path.insert(0, str(Path(__file__).parent))\nfrom services.userbot_auth import userbot_auth\n\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\napp = FastAPI()\n\nclass LoginRequest(BaseModel):\n    phone_number: str\n\nclass VerifyCodeRequest(BaseModel):\n    phone_number: str\n    code: str\n\nclass Verify2FARequest(BaseModel):\n    phone_number: str\n    password: str\n\nclass CancelRequest(BaseModel):\n    phone_number: str\n\nclass LogoutRequest(BaseModel):\n    phone_number: Optional[str] = None\n\n@app.post(\"/start-login\")\nasync def start_login(req: LoginRequest):\n    result = await userbot_auth.start_login(req.phone_number)\n    return result\n\n@app.post(\"/verify-code\")\nasync def verify_code(req: VerifyCodeRequest):\n    result = await userbot_auth.verify_code(req.phone_number, req.code)\n    return result\n\n@app.post(\"/verify-2fa\")\nasync def verify_2fa(req: Verify2FARequest):\n    result = await userbot_auth.verify_2fa(req.phone_number, req.password)\n    return result\n\n@app.post(\"/cancel-login\")\nasync def cancel_login(req: CancelRequest):\n    result = await userbot_auth.cancel_login(req.phone_number)\n    return result\n\n@app.post(\"/logout\")\nasync def logout(req: LogoutRequest):\n    result = await userbot_auth.logout(req.phone_number)\n    return result\n\n@app.get(\"/login-status/{phone_number}\")\nasync def get_login_status(phone_number: str):\n    result = await userbot_auth.get_login_status(phone_number)\n    return result\n\n@app.get(\"/health\")\nasync def health():\n    return {\"status\": \"ok\"}\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"127.0.0.1\", port=8765, log_level=\"info\")\n","path":null,"size_bytes":1930,"size_tokens":null},"server/seed.ts":{"content":"import { database } from \"./storage\";\nimport * as schema from \"@shared/schema\";\n\nasync function seed() {\n  console.log(\"üå± Seeding database...\");\n\n  try {\n    // Seed AI Providers\n    const providers = [\n      {\n        name: \"openai\",\n        isActive: true,\n        config: { baseUrl: \"https://api.openai.com/v1\" },\n      },\n      {\n        name: \"groq\",\n        isActive: true,\n        config: { baseUrl: \"https://api.groq.com/openai/v1\" },\n      },\n      {\n        name: \"claude\",\n        isActive: true,\n        config: { baseUrl: \"https://api.anthropic.com/v1\" },\n      },\n      {\n        name: \"huggingface\",\n        isActive: true,\n        config: { baseUrl: \"https://api-inference.huggingface.co\" },\n      },\n    ];\n\n    console.log(\"Adding AI providers...\");\n    const insertedProviders = await database\n      .insert(schema.aiProviders)\n      .values(providers)\n      .onConflictDoUpdate({\n        target: schema.aiProviders.name,\n        set: { isActive: true },\n      })\n      .returning();\n\n    console.log(`‚úÖ Added ${insertedProviders.length} AI providers`);\n\n    // Seed AI Models\n    const models = [\n      // OpenAI - GPT-5 Series (Latest)\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-5.1\",\n        displayName: \"GPT-5.1 (ÿßŸÑÿ£ŸÅÿ∂ŸÑ ŸÑŸÑÿ®ÿ±ŸÖÿ¨ÿ© Ÿàÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÉŸàÿØ)\",\n        tpmLimit: 500000,\n        rpmLimit: 500,\n        tpdLimit: 900000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-5\",\n        displayName: \"GPT-5 (ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑŸÖÿ™ŸÇÿØŸÖ)\",\n        tpmLimit: 500000,\n        rpmLimit: 500,\n        tpdLimit: 5000000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-5-mini\",\n        displayName: \"GPT-5 mini (ÿ≥ÿ±Ÿäÿπ ŸàŸÅÿπÿßŸÑ)\",\n        tpmLimit: 500000,\n        rpmLimit: 500,\n        tpdLimit: 5000000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-5-nano\",\n        displayName: \"GPT-5 nano (ÿßŸÑÿ£ÿ≥ÿ±ÿπ)\",\n        tpmLimit: 200000,\n        rpmLimit: 500,\n        tpdLimit: 2000000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-5-pro\",\n        displayName: \"GPT-5 Pro (ÿßŸÑÿ£ÿ∞ŸÉŸâ ŸàÿßŸÑÿ£ÿØŸÇ)\",\n        tpmLimit: 500000,\n        rpmLimit: 500,\n        tpdLimit: 5000000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-5.1-codex\",\n        displayName: \"GPT-5.1 Codex (ŸÖÿ™ÿÆÿµÿµ ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ©)\",\n        tpmLimit: 500000,\n        rpmLimit: 500,\n        tpdLimit: 900000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-5.1-codex-max\",\n        displayName: \"GPT-5.1 Codex Max (ÿ£ŸÇŸàŸâ ŸÑŸÖŸáÿßŸÖ ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ©)\",\n        tpmLimit: 500000,\n        rpmLimit: 500,\n        tpdLimit: 900000,\n        isActive: true,\n      },\n      // OpenAI - GPT-4 Series\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-4.1\",\n        displayName: \"GPT-4.1 (ÿßŸÑÿ£ÿ∞ŸÉŸâ ÿ®ÿØŸàŸÜ ÿ™ŸÅŸÉŸäÿ± ŸÖÿπŸÖŸÇ)\",\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 900000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-4.1-mini\",\n        displayName: \"GPT-4.1 mini\",\n        tpmLimit: 200000,\n        rpmLimit: 500,\n        tpdLimit: 2000000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-4.1-nano\",\n        displayName: \"GPT-4.1 nano (ÿßŸÑÿ£ÿ≥ÿ±ÿπ)\",\n        tpmLimit: 200000,\n        rpmLimit: 500,\n        tpdLimit: 2000000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-4-turbo\",\n        displayName: \"GPT-4 Turbo (ÿßŸÑÿ•ÿµÿØÿßÿ± ÿßŸÑÿ£ÿÆŸäÿ±)\",\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 900000,\n        isActive: true,\n      },\n      // OpenAI - o-series (Reasoning Models)\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"o3\",\n        displayName: \"o3 (ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÖŸäŸÇ)\",\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"o3-pro\",\n        displayName: \"o3 Pro (ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ŸÖÿπ ÿ≠ÿ≥ÿßÿ® ÿ•ÿ∂ÿßŸÅŸä)\",\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"o3-mini\",\n        displayName: \"o3 mini (ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿÆŸÅŸäŸÅ)\",\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"o3-deep-research\",\n        displayName: \"o3 Deep Research (ÿ®ÿ≠ÿ´ ÿπŸÖŸäŸÇ)\",\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"o4-mini\",\n        displayName: \"o4 mini (ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿ≥ÿ±Ÿäÿπ)\",\n        tpmLimit: 200000,\n        rpmLimit: 500,\n        tpdLimit: 2000000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"o4-mini-deep-research\",\n        displayName: \"o4 mini Deep Research\",\n        tpmLimit: 200000,\n        rpmLimit: 500,\n        tpdLimit: 2000000,\n        isActive: true,\n      },\n      // OpenAI - Audio & Multimodal\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-audio\",\n        displayName: \"GPT Audio (ŸÖÿØÿÆŸÑÿßÿ™ ŸàŸÖÿÆÿ±ÿ¨ÿßÿ™ ÿµŸàÿ™Ÿäÿ©)\",\n        capabilities: [\"audio\"],\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-realtime\",\n        displayName: \"GPT Realtime (ŸàŸÇÿ™ ŸÅÿπŸÑŸä)\",\n        capabilities: [\"audio\"],\n        tpmLimit: 40000,\n        rpmLimit: 200,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-realtime-mini\",\n        displayName: \"GPT Realtime mini\",\n        capabilities: [\"audio\"],\n        tpmLimit: 40000,\n        rpmLimit: 200,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-audio-mini\",\n        displayName: \"GPT Audio mini\",\n        capabilities: [\"audio\"],\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      // OpenAI - Vision/Image\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-image-1\",\n        displayName: \"GPT Image 1 (ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿµŸàÿ±)\",\n        capabilities: [\"image\"],\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-image-1-mini\",\n        displayName: \"GPT Image 1 mini\",\n        capabilities: [\"image\"],\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      // OpenAI - Video\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"sora-2\",\n        displayName: \"Sora 2 (ÿ™ŸàŸÑŸäÿØ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖÿπ ÿßŸÑÿµŸàÿ™)\",\n        capabilities: [\"video\"],\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"sora-2-pro\",\n        displayName: \"Sora 2 Pro (ÿßŸÑÿ£ŸÅÿ∂ŸÑ ŸÑÿ™ŸàŸÑŸäÿØ ÿßŸÑŸÅŸäÿØŸäŸà)\",\n        capabilities: [\"video\"],\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      // OpenAI - Specialized\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"omni-moderation\",\n        displayName: \"Omni Moderation (ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ)\",\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-4o-mini-tts\",\n        displayName: \"GPT-4o mini TTS (ÿ™ÿ≠ŸàŸäŸÑ ŸÜÿµ ŸÑÿµŸàÿ™)\",\n        capabilities: [\"audio\"],\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-4o-transcribe\",\n        displayName: \"GPT-4o Transcribe (ÿ™ÿ≠ŸàŸäŸÑ ÿµŸàÿ™ ŸÑŸÜÿµ)\",\n        capabilities: [\"audio\"],\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-4o-mini-transcribe\",\n        displayName: \"GPT-4o mini Transcribe\",\n        capabilities: [\"audio\"],\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      // OpenAI - Search Models\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-4o-search-preview\",\n        displayName: \"GPT-4o Search (ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÑŸâ ÿßŸÑŸàŸäÿ®)\",\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"openai\")!.id,\n        modelName: \"gpt-4o-mini-search-preview\",\n        displayName: \"GPT-4o mini Search\",\n        tpmLimit: 30000,\n        rpmLimit: 500,\n        tpdLimit: 90000,\n        isActive: true,\n      },\n      // Groq Production Models\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"llama-3.1-8b-instant\",\n        displayName: \"LLaMA 3.1 8B Instant\",\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"llama-3.3-70b-versatile\",\n        displayName: \"LLaMA 3.3 70B Versatile\",\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"meta-llama/llama-guard-4-12b\",\n        displayName: \"LLaMA Guard 4 12B\",\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"openai/gpt-oss-120b\",\n        displayName: \"GPT OSS 120B\",\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"openai/gpt-oss-20b\",\n        displayName: \"GPT OSS 20B\",\n        isActive: true,\n      },\n      // Groq Preview Models\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"meta-llama/llama-4-maverick-17b-128e-instruct\",\n        displayName: \"Llama 4 Maverick 17B 128E\",\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"meta-llama/llama-4-scout-17b-16e-instruct\",\n        displayName: \"Llama 4 Scout 17B 16E\",\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"moonshotai/kimi-k2-instruct-0905\",\n        displayName: \"Kimi K2\",\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"openai/gpt-oss-safeguard-20b\",\n        displayName: \"Safety GPT OSS 20B\",\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"playai-tts\",\n        displayName: \"PlayAI TTS\",\n        capabilities: [\"tts\"],\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"playai-tts-arabic\",\n        displayName: \"PlayAI TTS Arabic\",\n        capabilities: [\"tts\"],\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"qwen/qwen3-32b\",\n        displayName: \"Qwen 3 32B\",\n        isActive: true,\n      },\n      // Groq Legacy Models\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"mixtral-8x7b-32768\",\n        displayName: \"Mixtral 8x7B\",\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"gemma-7b-it\",\n        displayName: \"Gemma 7B\",\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"llama-3.3-70b-specdec\",\n        displayName: \"LLaMA 3.3 70B SpecDec\",\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"llama-guard-3-8b\",\n        displayName: \"LLaMA Guard 3 8B\",\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"llama3-groq-70b-8192-tool-use-preview\",\n        displayName: \"LLaMA 3 Groq 70B Tool Use\",\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"llama3-groq-8b-8192-tool-use-preview\",\n        displayName: \"LLaMA 3 Groq 8B Tool Use\",\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"whisper-large-v3\",\n        displayName: \"Whisper Large v3\",\n        capabilities: [\"audio\"],\n        isActive: false,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"groq\")!.id,\n        modelName: \"whisper-large-v3-turbo\",\n        displayName: \"Whisper Large v3 Turbo\",\n        capabilities: [\"audio\"],\n        isActive: false,\n      },\n      // Claude Models\n      {\n        providerId: insertedProviders.find(p => p.name === \"claude\")!.id,\n        modelName: \"claude-3-opus-20240229\",\n        displayName: \"Claude 3 Opus\",\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"claude\")!.id,\n        modelName: \"claude-3-sonnet-20240229\",\n        displayName: \"Claude 3 Sonnet\",\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"claude\")!.id,\n        modelName: \"claude-3-haiku-20240307\",\n        displayName: \"Claude 3 Haiku\",\n        isActive: true,\n      },\n      // HuggingFace Models\n      {\n        providerId: insertedProviders.find(p => p.name === \"huggingface\")!.id,\n        modelName: \"meta-llama/Llama-2-70b-chat-hf\",\n        displayName: \"LLaMA 2 70B Chat\",\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"huggingface\")!.id,\n        modelName: \"mistralai/Mixtral-8x7B-Instruct-v0.1\",\n        displayName: \"Mixtral 8x7B Instruct\",\n        isActive: true,\n      },\n      {\n        providerId: insertedProviders.find(p => p.name === \"huggingface\")!.id,\n        modelName: \"google/flan-t5-xxl\",\n        displayName: \"FLAN-T5 XXL\",\n        isActive: true,\n      },\n    ];\n\n    console.log(\"Adding AI models...\");\n    const insertedModels = await database\n      .insert(schema.aiModels)\n      .values(models)\n      .onConflictDoNothing()\n      .returning();\n\n    console.log(`‚úÖ Added ${insertedModels.length} AI models`);\n\n    console.log(\"‚úÖ Database seeding completed successfully!\");\n    process.exit(0);\n  } catch (error) {\n    console.error(\"‚ùå Seeding failed:\", error);\n    process.exit(1);\n  }\n}\n\nseed();\n","path":null,"size_bytes":16643,"size_tokens":null},"client/src/pages/tasks.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\nimport { useTranslation } from \"react-i18next\";\nimport { motion } from \"framer-motion\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { ToggleSwitch } from \"@/components/ui/toggle-switch\";\nimport { \n  Play, \n  Pause, \n  Edit, \n  Trash2, \n  Plus, \n  Loader,\n  Sparkles,\n  Bot,\n  ArrowRight,\n  ExternalLink,\n  Zap,\n  FileText,\n  Settings2,\n  Video,\n  Link2,\n  ChevronDown,\n  ChevronUp\n} from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { toast } from \"sonner\";\nimport {\n  EntityReplacement,\n  ContextRule,\n  ContentFilter,\n  PublishingTemplate,\n  EntityDialog,\n  ContextDialog,\n  FilterDialog,\n  TemplateDialog,\n  ProviderModelSelector,\n} from \"@/components/ai-rules\";\n\ninterface TaskFormData {\n  id?: number;\n  name: string;\n  description: string;\n  sourceChannels: number[];\n  targetChannels: number[];\n  aiEnabled: boolean;\n  summarizationEnabled: boolean;\n  summarizationProviderId: number | null;\n  summarizationModelId: number | null;\n  videoProcessingEnabled: boolean;\n  videoAiProviderId: number | null;\n  videoAiModelId: number | null;\n  linkProcessingEnabled: boolean;\n  linkVideoDownloadEnabled: boolean;\n  linkVideoQuality: string;\n}\n\ninterface RuleFormData {\n  id?: number;\n  name: string;\n  type: string;\n  prompt: string;\n  priority: number;\n  isActive: boolean;\n}\n\nconst initialFormData: TaskFormData = {\n  name: \"\",\n  description: \"\",\n  sourceChannels: [],\n  targetChannels: [],\n  aiEnabled: false,\n  summarizationEnabled: false,\n  summarizationProviderId: null,\n  summarizationModelId: null,\n  videoProcessingEnabled: false,\n  videoAiProviderId: null,\n  videoAiModelId: null,\n  linkProcessingEnabled: false,\n  linkVideoDownloadEnabled: true,\n  linkVideoQuality: \"high\",\n};\n\nconst initialRuleFormData: RuleFormData = {\n  name: \"\",\n  type: \"summarize\",\n  prompt: \"\",\n  priority: 0,\n  isActive: true,\n};\n\nexport default function TasksPage() {\n  const { t, i18n } = useTranslation();\n  const queryClient = useQueryClient();\n  const [isOpen, setIsOpen] = useState(false);\n  const [isRulesOpen, setIsRulesOpen] = useState(false);\n  const [editMode, setEditMode] = useState(false);\n  const [ruleEditMode, setRuleEditMode] = useState(false);\n  const [formData, setFormData] = useState<TaskFormData>(initialFormData);\n  const [ruleFormData, setRuleFormData] = useState<RuleFormData>(initialRuleFormData);\n  const [selectedTaskId, setSelectedTaskId] = useState<number | null>(null);\n  const [selectedRuleType, setSelectedRuleType] = useState<string>(\"summarize\");\n  const [advancedTab, setAdvancedTab] = useState<string>(\"entities\");\n  \n  // Collapsible states for advanced rules sections\n  const [entitiesEnabled, setEntitiesEnabled] = useState(false);\n  const [contextEnabled, setContextEnabled] = useState(false);\n  const [filtersEnabled, setFiltersEnabled] = useState(false);\n  const [templatesEnabled, setTemplatesEnabled] = useState(false);\n  \n  // Dialog states for advanced rules\n  const [entityDialogOpen, setEntityDialogOpen] = useState(false);\n  const [contextDialogOpen, setContextDialogOpen] = useState(false);\n  const [filterDialogOpen, setFilterDialogOpen] = useState(false);\n  const [templateDialogOpen, setTemplateDialogOpen] = useState(false);\n  \n  const [editingEntity, setEditingEntity] = useState<EntityReplacement | null>(null);\n  const [editingContext, setEditingContext] = useState<ContextRule | null>(null);\n  const [editingFilter, setEditingFilter] = useState<ContentFilter | null>(null);\n  const [editingTemplate, setEditingTemplate] = useState<PublishingTemplate | null>(null);\n\n  const { data: tasks = [], isLoading } = useQuery({\n    queryKey: [\"tasks\"],\n    queryFn: () => api.getTasks(),\n  });\n\n  const { data: channels = [] } = useQuery({\n    queryKey: [\"channels\"],\n    queryFn: () => api.getChannels(),\n  });\n\n  const { data: providers = [] } = useQuery({\n    queryKey: [\"ai-providers\"],\n    queryFn: () => api.getAiProviders(),\n  });\n\n  const { data: models = [] } = useQuery({\n    queryKey: [\"ai-models\"],\n    queryFn: () => api.getAiModels(),\n  });\n\n  const { data: taskRules = [], refetch: refetchRules } = useQuery({\n    queryKey: [\"task-rules\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getTaskRules(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: entityReplacements = [] } = useQuery({\n    queryKey: [\"entity-replacements\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getEntityReplacements(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: contextRules = [] } = useQuery({\n    queryKey: [\"context-rules\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getContextRules(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: contentFilters = [] } = useQuery({\n    queryKey: [\"content-filters\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getContentFilters(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: publishingTemplates = [] } = useQuery({\n    queryKey: [\"publishing-templates\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getPublishingTemplates(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: summarizationRules = [], refetch: refetchSummarizationRules } = useQuery({\n    queryKey: [\"summarization-rules\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getSummarizationRules(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: videoProcessingRules = [], refetch: refetchVideoRules } = useQuery({\n    queryKey: [\"video-processing-rules\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getVideoProcessingRules(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const summarizationModels = models.filter(m => \n    formData.summarizationProviderId ? m.providerId === formData.summarizationProviderId : true\n  );\n\n  const videoModels = models.filter(m => \n    formData.videoAiProviderId ? m.providerId === formData.videoAiProviderId : true\n  );\n\n  const createMutation = useMutation({\n    mutationFn: (data: TaskFormData) => api.createTask(data),\n    onSuccess: (newTask: any) => {\n      toast.success(\"ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸáŸÖÿ© ÿ®ŸÜÿ¨ÿßÿ≠!\");\n      setIsOpen(false);\n      setSelectedTaskId(null);\n      setFormData(initialFormData);\n      setEditMode(false);\n      queryClient.invalidateQueries({ queryKey: [\"tasks\"] });\n      queryClient.invalidateQueries({ queryKey: [\"dashboard-stats\"] });\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸáŸÖÿ©\");\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: Partial<TaskFormData> }) => api.updateTask(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸáŸÖÿ© ÿ®ŸÜÿ¨ÿßÿ≠!\");\n      setIsOpen(false);\n      setSelectedTaskId(null);\n      setFormData(initialFormData);\n      setEditMode(false);\n      queryClient.invalidateQueries({ queryKey: [\"tasks\"] });\n      queryClient.invalidateQueries({ queryKey: [\"dashboard-stats\"] });\n      refetchRules();\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸáŸÖÿ©\");\n    },\n  });\n\n  const toggleMutation = useMutation({\n    mutationFn: (id: number) => api.toggleTask(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖŸáŸÖÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"tasks\"] });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => api.deleteTask(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸáŸÖÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"tasks\"] });\n      queryClient.invalidateQueries({ queryKey: [\"dashboard-stats\"] });\n    },\n  });\n\n  const createRuleMutation = useMutation({\n    mutationFn: ({ taskId, data }: { taskId: number; data: any }) => api.createRule(taskId, data),\n    onMutate: async ({ taskId, data }) => {\n      await queryClient.cancelQueries({ queryKey: [\"task-rules\", taskId] });\n      const prev = queryClient.getQueryData([\"task-rules\", taskId]);\n      queryClient.setQueryData([\"task-rules\", taskId], (old: any) => [\n        ...(old || []),\n        { ...data, id: Date.now() }\n      ]);\n      return { prev };\n    },\n    onSuccess: () => {\n      toast.success(\"‚úÖ ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÇÿßÿπÿØÿ© ÿ®ŸÜÿ¨ÿßÿ≠\");\n      refetchRules();\n      setRuleFormData(initialRuleFormData);\n      setRuleEditMode(false);\n    },\n    onError: (error, _, context) => {\n      queryClient.setQueryData([\"task-rules\", selectedTaskId], context?.prev);\n      toast.error(error.message || \"ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÇÿßÿπÿØÿ©\");\n    },\n  });\n\n  const updateRuleMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateRule(id, data),\n    onMutate: async ({ id, data }) => {\n      await queryClient.cancelQueries({ queryKey: [\"task-rules\", selectedTaskId] });\n      const prev = queryClient.getQueryData([\"task-rules\", selectedTaskId]);\n      queryClient.setQueryData([\"task-rules\", selectedTaskId], (old: any) =>\n        old?.map((r: any) => r.id === id ? { ...r, ...data } : r) || []\n      );\n      return { prev };\n    },\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ© ÿ®ŸÜÿ¨ÿßÿ≠\");\n      refetchRules();\n      setRuleFormData(initialRuleFormData);\n      setRuleEditMode(false);\n    },\n    onError: (error, _, context) => {\n      queryClient.setQueryData([\"task-rules\", selectedTaskId], context?.prev);\n      toast.error(error.message || \"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n    },\n  });\n\n  const toggleRuleMutation = useMutation({\n    mutationFn: (id: number) => api.toggleRule(id),\n    onMutate: async (id) => {\n      await queryClient.cancelQueries({ queryKey: [\"task-rules\", selectedTaskId] });\n      const prev = queryClient.getQueryData([\"task-rules\", selectedTaskId]);\n      queryClient.setQueryData([\"task-rules\", selectedTaskId], (old: any) =>\n        old?.map((r: any) => r.id === id ? { ...r, isActive: !r.isActive } : r) || []\n      );\n      return { prev };\n    },\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      refetchRules();\n    },\n    onError: (_, __, context) => {\n      queryClient.setQueryData([\"task-rules\", selectedTaskId], context?.prev);\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\");\n    },\n  });\n\n  const deleteRuleMutation = useMutation({\n    mutationFn: (id: number) => api.deleteRule(id),\n    onMutate: async (id) => {\n      await queryClient.cancelQueries({ queryKey: [\"task-rules\", selectedTaskId] });\n      const prev = queryClient.getQueryData([\"task-rules\", selectedTaskId]);\n      queryClient.setQueryData([\"task-rules\", selectedTaskId], (old: any) =>\n        old?.filter((r: any) => r.id !== id) || []\n      );\n      return { prev };\n    },\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      refetchRules();\n    },\n    onError: (_, __, context) => {\n      queryClient.setQueryData([\"task-rules\", selectedTaskId], context?.prev);\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n    },\n  });\n\n  const createEntityMutation = useMutation({\n    mutationFn: (data: any) => api.createEntityReplacement(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ\");\n      queryClient.invalidateQueries({ queryKey: [\"entity-replacements\", selectedTaskId] });\n      setEntityDialogOpen(false);\n      setEditingEntity(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const createContextMutation = useMutation({\n    mutationFn: (data: any) => api.createContextRule(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿßŸÑÿ≥ŸäÿßŸÇ\");\n      queryClient.invalidateQueries({ queryKey: [\"context-rules\", selectedTaskId] });\n      setContextDialogOpen(false);\n      setEditingContext(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const createFilterMutation = useMutation({\n    mutationFn: (data: any) => api.createContentFilter(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅŸÑÿ™ÿ±\");\n      queryClient.invalidateQueries({ queryKey: [\"content-filters\", selectedTaskId] });\n      setFilterDialogOpen(false);\n      setEditingFilter(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅŸÑÿ™ÿ±\"),\n  });\n\n  const createTemplateMutation = useMutation({\n    mutationFn: (data: any) => api.createPublishingTemplate(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßŸÑÿ®\");\n      queryClient.invalidateQueries({ queryKey: [\"publishing-templates\", selectedTaskId] });\n      setTemplateDialogOpen(false);\n      setEditingTemplate(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßŸÑÿ®\"),\n  });\n\n  const deleteEntityMutation = useMutation({\n    mutationFn: (id: number) => api.deleteEntityReplacement(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"entity-replacements\", selectedTaskId] });\n    },\n  });\n\n  const deleteContextMutation = useMutation({\n    mutationFn: (id: number) => api.deleteContextRule(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"context-rules\", selectedTaskId] });\n    },\n  });\n\n  const deleteFilterMutation = useMutation({\n    mutationFn: (id: number) => api.deleteContentFilter(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÅŸÑÿ™ÿ±\");\n      queryClient.invalidateQueries({ queryKey: [\"content-filters\", selectedTaskId] });\n    },\n  });\n\n  const deleteTemplateMutation = useMutation({\n    mutationFn: (id: number) => api.deletePublishingTemplate(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßŸÑÿ®\");\n      queryClient.invalidateQueries({ queryKey: [\"publishing-templates\", selectedTaskId] });\n    },\n  });\n\n  const createSummarizationMutation = useMutation({\n    mutationFn: (data: any) => api.createSummarizationRule(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿßŸÑÿ™ŸÑÿÆŸäÿµ\");\n      refetchSummarizationRules();\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const updateSummarizationMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateSummarizationRule(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ™ŸÑÿÆŸäÿµ\");\n      refetchSummarizationRules();\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const deleteSummarizationMutation = useMutation({\n    mutationFn: (id: number) => api.deleteSummarizationRule(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ™ŸÑÿÆŸäÿµ\");\n      refetchSummarizationRules();\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const toggleSummarizationMutation = useMutation({\n    mutationFn: ({ id, isActive }: { id: number; isActive: boolean }) => api.updateSummarizationRule(id, { isActive }),\n    onSuccess: () => {\n      refetchSummarizationRules();\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ©\"),\n  });\n\n  // Update mutations for advanced rules (for dialog edits)\n  const updateEntityMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateEntityReplacement(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿπÿØÿ© ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ\");\n      queryClient.invalidateQueries({ queryKey: [\"entity-replacements\", selectedTaskId] });\n      setEntityDialogOpen(false);\n      setEditingEntity(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const updateContextMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateContextRule(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ≥ŸäÿßŸÇ\");\n      queryClient.invalidateQueries({ queryKey: [\"context-rules\", selectedTaskId] });\n      setContextDialogOpen(false);\n      setEditingContext(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const updateFilterMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateContentFilter(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅŸÑÿ™ÿ±\");\n      queryClient.invalidateQueries({ queryKey: [\"content-filters\", selectedTaskId] });\n      setFilterDialogOpen(false);\n      setEditingFilter(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅŸÑÿ™ÿ±\"),\n  });\n\n  const updateTemplateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updatePublishingTemplate(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßŸÑÿ®\");\n      queryClient.invalidateQueries({ queryKey: [\"publishing-templates\", selectedTaskId] });\n      setTemplateDialogOpen(false);\n      setEditingTemplate(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßŸÑÿ®\"),\n  });\n\n  // Toggle mutations (don't affect dialog state)\n  const toggleEntityMutation = useMutation({\n    mutationFn: ({ id, isActive }: { id: number; isActive: boolean }) => api.updateEntityReplacement(id, { isActive }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"entity-replacements\", selectedTaskId] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ©\"),\n  });\n\n  const toggleContextMutation = useMutation({\n    mutationFn: ({ id, isActive }: { id: number; isActive: boolean }) => api.updateContextRule(id, { isActive }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"context-rules\", selectedTaskId] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ©\"),\n  });\n\n  const toggleFilterMutation = useMutation({\n    mutationFn: ({ id, isActive }: { id: number; isActive: boolean }) => api.updateContentFilter(id, { isActive }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"content-filters\", selectedTaskId] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ©\"),\n  });\n\n  const handleCloseDialog = () => {\n    setIsOpen(false);\n    setEditMode(false);\n    setFormData(initialFormData);\n    setSelectedTaskId(null);\n    setRuleFormData(initialRuleFormData);\n    setRuleEditMode(false);\n  };\n\n  const handleOpenCreate = () => {\n    setEditMode(false);\n    setFormData(initialFormData);\n    setSelectedTaskId(null);\n    setIsOpen(true);\n  };\n\n  const handleOpenEdit = (task: any) => {\n    setEditMode(true);\n    setSelectedTaskId(task.id);\n    setFormData({\n      id: task.id,\n      name: task.name || \"\",\n      description: task.description || \"\",\n      sourceChannels: task.sourceChannels || [],\n      targetChannels: task.targetChannels || [],\n      aiEnabled: task.aiEnabled || false,\n      summarizationEnabled: task.summarizationEnabled || false,\n      summarizationProviderId: task.summarizationProviderId || null,\n      summarizationModelId: task.summarizationModelId || null,\n      videoProcessingEnabled: task.videoProcessingEnabled || false,\n      videoAiProviderId: task.videoAiProviderId || null,\n      videoAiModelId: task.videoAiModelId || null,\n      linkProcessingEnabled: task.linkProcessingEnabled || false,\n      linkVideoDownloadEnabled: task.linkVideoDownloadEnabled !== false,\n      linkVideoQuality: task.linkVideoQuality || \"high\",\n    });\n    setIsOpen(true);\n  };\n\n  const handleOpenRules = (task: any) => {\n    setSelectedTaskId(task.id);\n    setIsRulesOpen(true);\n    setRuleFormData(initialRuleFormData);\n    setRuleEditMode(false);\n  };\n\n  const handleEditRule = (rule: any) => {\n    setRuleEditMode(true);\n    setRuleFormData({\n      id: rule.id,\n      name: rule.name,\n      type: rule.type,\n      prompt: rule.prompt,\n      priority: rule.priority,\n      isActive: rule.isActive,\n    });\n    setSelectedRuleType(rule.type);\n  };\n\n  const handleSubmit = async () => {\n    if (!formData.name || formData.sourceChannels.length === 0 || formData.targetChannels.length === 0) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©\");\n      return;\n    }\n    \n    if (editMode && formData.id) {\n      const { id, ...data } = formData;\n      updateMutation.mutate({ id, data });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleSubmitRule = async () => {\n    if (!ruleFormData.name || !ruleFormData.prompt) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿßÿ≥ŸÖ ÿßŸÑŸÇÿßÿπÿØÿ© ŸàÿßŸÑŸÄ Prompt\");\n      return;\n    }\n    \n    if (ruleEditMode && ruleFormData.id) {\n      const { id, ...data } = ruleFormData;\n      updateRuleMutation.mutate({ id, data });\n    } else if (selectedTaskId) {\n      createRuleMutation.mutate({ \n        taskId: selectedTaskId, \n        data: { ...ruleFormData, type: selectedRuleType }\n      });\n    } else {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸáŸÖÿ© ÿ£ŸàŸÑÿßŸã ŸÇÿ®ŸÑ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇŸàÿßÿπÿ≥\");\n    }\n  };\n\n  const updateRulePriority = async (ruleId: number, newPriority: number) => {\n    updateRuleMutation.mutate({ id: ruleId, data: { priority: newPriority } });\n  };\n\n  // Handlers for advanced rules dialogs\n  const handleEntitySubmit = (data: Partial<EntityReplacement>) => {\n    if (editingEntity?.id) {\n      updateEntityMutation.mutate({ id: editingEntity.id, data });\n    } else if (selectedTaskId) {\n      createEntityMutation.mutate({ ...data, taskId: selectedTaskId });\n    }\n  };\n\n  const handleContextSubmit = (data: Partial<ContextRule>) => {\n    if (editingContext?.id) {\n      updateContextMutation.mutate({ id: editingContext.id, data });\n    } else if (selectedTaskId) {\n      createContextMutation.mutate({ ...data, taskId: selectedTaskId });\n    }\n  };\n\n  const handleFilterSubmit = (data: Partial<ContentFilter>) => {\n    if (editingFilter?.id) {\n      updateFilterMutation.mutate({ id: editingFilter.id, data });\n    } else if (selectedTaskId) {\n      createFilterMutation.mutate({ ...data, taskId: selectedTaskId });\n    }\n  };\n\n  const handleTemplateSubmit = (data: Partial<PublishingTemplate>) => {\n    if (editingTemplate?.id) {\n      updateTemplateMutation.mutate({ id: editingTemplate.id, data });\n    } else if (selectedTaskId) {\n      createTemplateMutation.mutate({ ...data, taskId: selectedTaskId });\n    }\n  };\n\n  const handleToggleEntity = (entity: any) => {\n    toggleEntityMutation.mutate({ id: entity.id, isActive: !entity.isActive });\n  };\n\n  const handleToggleContext = (rule: any) => {\n    toggleContextMutation.mutate({ id: rule.id, isActive: !rule.isActive });\n  };\n\n  const handleToggleFilter = (filter: any) => {\n    toggleFilterMutation.mutate({ id: filter.id, isActive: !filter.isActive });\n  };\n\n  const filteredRules = taskRules.filter((r: any) => r.type === selectedRuleType);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <Loader className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\" dir={i18n.language === 'ar' ? 'rtl' : 'ltr'}>\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div className={i18n.language === 'ar' ? 'text-right' : 'text-left'}>\n          <h2 className=\"text-2xl md:text-3xl font-display font-bold text-foreground tracking-wide\">{t('nav.tasks')}</h2>\n          <p className=\"text-muted-foreground mt-1 text-sm md:text-base\">ÿ•ÿØÿßÿ±ÿ© ŸÇŸàÿßÿπÿØ ÿßŸÑÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ŸàŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ</p>\n        </div>\n        <Dialog open={isOpen} onOpenChange={(open) => { if (!open) handleCloseDialog(); else setIsOpen(true); }}>\n          <DialogTrigger asChild>\n            <Button onClick={handleOpenCreate} className=\"bg-primary text-primary-foreground font-bold hover:bg-primary/90 w-full sm:w-auto\" data-testid=\"button-create-task\">\n              <Plus className=\"h-4 w-4 mr-2\" /> ŸÖŸáŸÖÿ© ÿ¨ÿØŸäÿØÿ©\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>{editMode ? \"ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸáŸÖÿ©\" : \"ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ© ÿ™Ÿàÿ¨ŸäŸá ÿ¨ÿØŸäÿØÿ©\"}</DialogTitle>\n              <DialogDescription>ÿ£ÿØÿÆŸÑ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸáŸÖÿ© ŸàÿßÿÆÿ™ÿ± ÿßŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑŸÖÿµÿØÿ± ŸàÿßŸÑŸáÿØŸÅ</DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"task-name\">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸáŸÖÿ©</Label>\n                <Input\n                  id=\"task-name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({...formData, name: e.target.value})}\n                  placeholder=\"ŸÖÿ´ŸÑ: ÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ÿßŸÑÿ™ŸÇŸÜŸäÿ©\"\n                  className=\"mt-1\"\n                  data-testid=\"input-task-name\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"task-desc\">ÿßŸÑŸàÿµŸÅ</Label>\n                <Textarea\n                  id=\"task-desc\"\n                  value={formData.description}\n                  onChange={(e) => setFormData({...formData, description: e.target.value})}\n                  placeholder=\"ŸàÿµŸÅ ÿßŸÑŸÖŸáŸÖÿ©\"\n                  className=\"mt-1 resize-none\"\n                  data-testid=\"textarea-task-desc\"\n                />\n              </div>\n\n              <div>\n                <Label>ÿßŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑŸÖÿµÿØÿ±</Label>\n                <div className=\"space-y-2 mt-2 max-h-40 overflow-y-auto p-2 bg-muted/50 rounded-lg border border-border\">\n                  {channels.filter((c: any) => c.type !== \"website\").map((channel: any) => (\n                    <label key={channel.id} className=\"flex items-center gap-2 cursor-pointer text-sm\">\n                      <input\n                        type=\"checkbox\"\n                        checked={formData.sourceChannels.includes(channel.id)}\n                        onChange={(e) => {\n                          if (e.target.checked) {\n                            setFormData({...formData, sourceChannels: [...formData.sourceChannels, channel.id]});\n                          } else {\n                            setFormData({...formData, sourceChannels: formData.sourceChannels.filter(id => id !== channel.id)});\n                          }\n                        }}\n                        className=\"accent-primary\"\n                        data-testid={`checkbox-source-${channel.id}`}\n                      />\n                      <span className=\"text-foreground\">{channel.title}</span>\n                    </label>\n                  ))}\n                </div>\n              </div>\n\n              <div>\n                <Label>ÿßŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑŸáÿØŸÅ</Label>\n                <div className=\"space-y-2 mt-2 max-h-40 overflow-y-auto p-2 bg-muted/50 rounded-lg border border-border\">\n                  {channels.filter((c: any) => c.type !== \"website\").map((channel: any) => (\n                    <label key={channel.id} className=\"flex items-center gap-2 cursor-pointer text-sm\">\n                      <input\n                        type=\"checkbox\"\n                        checked={formData.targetChannels.includes(channel.id)}\n                        onChange={(e) => {\n                          if (e.target.checked) {\n                            setFormData({...formData, targetChannels: [...formData.targetChannels, channel.id]});\n                          } else {\n                            setFormData({...formData, targetChannels: formData.targetChannels.filter(id => id !== channel.id)});\n                          }\n                        }}\n                        className=\"accent-primary\"\n                        data-testid={`checkbox-target-${channel.id}`}\n                      />\n                      <span className=\"text-foreground\">{channel.title}</span>\n                    </label>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-between p-3 rounded-lg border border-purple-500/20 bg-gradient-to-r from-purple-500/5 to-transparent\">\n                <div className=\"flex items-center gap-2\">\n                  <Bot className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\n                  <Label htmlFor=\"ai-enabled\" className=\"text-purple-600 dark:text-purple-400 font-medium\">ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä</Label>\n                </div>\n                <ToggleSwitch\n                  id=\"ai-enabled\"\n                  checked={formData.aiEnabled}\n                  onCheckedChange={(checked) => setFormData({...formData, aiEnabled: checked})}\n                  activeColor=\"purple\"\n                  size=\"sm\"\n                  data-testid=\"switch-ai-enabled\"\n                />\n              </div>\n\n              {formData.aiEnabled && (\n                <div className=\"p-3 rounded-lg bg-gradient-to-r from-primary/5 to-transparent border border-primary/20\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    <Sparkles className=\"h-4 w-4 inline-block ml-1 text-primary\" />\n                    ŸÑŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© (ÿßŸÑÿ™ŸÑÿÆŸäÿµÿå ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸàÿå ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑÿßÿ™)ÿå ÿßÿ∞Ÿáÿ® ÿ•ŸÑŸâ{\" \"}\n                    <a href={`/ai-rules?taskId=${selectedTaskId}`} className=\"underline text-primary font-medium\">\n                      ÿµŸÅÿ≠ÿ© ŸÇŸàÿßÿπÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä\n                    </a>\n                  </p>\n                </div>\n              )}\n            </div>\n\n\n            <Button \n              onClick={handleSubmit}\n              className=\"w-full mt-4\"\n              disabled={createMutation.isPending || updateMutation.isPending}\n              data-testid=\"button-submit-task\"\n            >\n              {(createMutation.isPending || updateMutation.isPending) && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n              {editMode ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸáŸÖÿ©\"}\n            </Button>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {tasks.length === 0 ? (\n          <div className=\"col-span-full p-8 text-center text-muted-foreground\">\n            ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸáÿßŸÖ ÿ≠ÿßŸÑŸäÿßŸã. ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ \"ŸÖŸáŸÖÿ© ÿ¨ÿØŸäÿØÿ©\" ŸÑŸÑÿ®ÿØÿ°\n          </div>\n        ) : (\n          tasks.map((task: any, idx: number) => (\n            <motion.div\n              key={task.id}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: idx * 0.1 }}\n              data-testid={`card-task-${task.id}`}\n            >\n              <Card className=\"border shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden group cursor-pointer\">\n                {/* Header with gradient */}\n                <div className={`h-1 bg-gradient-to-r ${\n                  task.isActive \n                    ? 'from-green-500 to-emerald-500' \n                    : 'from-yellow-500 to-orange-500'\n                }`} />\n                \n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1\">\n                      <CardTitle className=\"text-base font-bold text-foreground line-clamp-2\">\n                        {task.name}\n                      </CardTitle>\n                      <p className=\"text-xs text-muted-foreground mt-1 line-clamp-1\">\n                        {task.description || \"ÿ®ÿØŸàŸÜ ŸàÿµŸÅ\"}\n                      </p>\n                    </div>\n                    <Badge \n                      className={task.isActive \n                        ? \"bg-green-500/20 text-green-600 dark:text-green-400 border-green-500/30 whitespace-nowrap\" \n                        : \"bg-yellow-500/20 text-yellow-600 dark:text-yellow-400 border-yellow-500/30 whitespace-nowrap\"}\n                      variant=\"outline\"\n                      data-testid={`badge-status-${task.id}`}\n                    >\n                      {task.isActive ? \"üü¢ ŸÜÿ¥ÿ∑ÿ©\" : \"üü° ŸÖÿπÿ∑ŸÑÿ©\"}\n                    </Badge>\n                  </div>\n                </CardHeader>\n\n                <CardContent className=\"space-y-3\">\n                  {/* Channels */}\n                  <div className=\"flex items-center gap-2 text-xs\">\n                    <div className=\"flex items-center gap-1 px-2 py-1 rounded bg-muted/50\">\n                      <span className=\"text-muted-foreground\">ÿßŸÑŸÖÿµÿßÿØÿ±:</span>\n                      <span className=\"font-bold text-foreground\">{task.sourceChannels?.length || 0}</span>\n                    </div>\n                    <ArrowRight className=\"h-3 w-3 text-muted-foreground\" />\n                    <div className=\"flex items-center gap-1 px-2 py-1 rounded bg-muted/50\">\n                      <span className=\"text-muted-foreground\">ÿßŸÑÿ£ŸáÿØÿßŸÅ:</span>\n                      <span className=\"font-bold text-foreground\">{task.targetChannels?.length || 0}</span>\n                    </div>\n                  </div>\n\n                  {/* Features indicators */}\n                  <div className=\"flex flex-wrap gap-2\">\n                    {task.aiEnabled && (\n                      <motion.div\n                        initial={{ scale: 0 }}\n                        animate={{ scale: 1 }}\n                        className=\"flex items-center gap-1 px-2 py-1 rounded-full bg-purple-500/10 border border-purple-500/20\"\n                      >\n                        <Sparkles className=\"h-3 w-3 text-purple-600 dark:text-purple-400\" />\n                        <span className=\"text-xs text-purple-600 dark:text-purple-400\">AI</span>\n                      </motion.div>\n                    )}\n                    {task.summarizationEnabled && (\n                      <motion.div\n                        initial={{ scale: 0 }}\n                        animate={{ scale: 1 }}\n                        transition={{ delay: 0.05 }}\n                        className=\"flex items-center gap-1 px-2 py-1 rounded-full bg-emerald-500/10 border border-emerald-500/20\"\n                      >\n                        <FileText className=\"h-3 w-3 text-emerald-600 dark:text-emerald-400\" />\n                        <span className=\"text-xs text-emerald-600 dark:text-emerald-400\">ÿ™ŸÑÿÆŸäÿµ</span>\n                      </motion.div>\n                    )}\n                    {task.videoProcessingEnabled && (\n                      <motion.div\n                        initial={{ scale: 0 }}\n                        animate={{ scale: 1 }}\n                        transition={{ delay: 0.1 }}\n                        className=\"flex items-center gap-1 px-2 py-1 rounded-full bg-blue-500/10 border border-blue-500/20\"\n                      >\n                        <Video className=\"h-3 w-3 text-blue-600 dark:text-blue-400\" />\n                        <span className=\"text-xs text-blue-600 dark:text-blue-400\">ŸÅŸäÿØŸäŸà</span>\n                      </motion.div>\n                    )}\n                    {task.linkProcessingEnabled && (\n                      <motion.div\n                        initial={{ scale: 0 }}\n                        animate={{ scale: 1 }}\n                        transition={{ delay: 0.15 }}\n                        className=\"flex items-center gap-1 px-2 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/20\"\n                      >\n                        <Link2 className=\"h-3 w-3 text-cyan-600 dark:text-cyan-400\" />\n                        <span className=\"text-xs text-cyan-600 dark:text-cyan-400\">ÿ±Ÿàÿßÿ®ÿ∑</span>\n                      </motion.div>\n                    )}\n                  </div>\n\n                  {/* Stats */}\n                  <div className=\"flex items-center justify-between text-xs border-t border-border pt-2\">\n                    <span className=\"text-muted-foreground\">ÿßŸÑŸÖŸàÿ¨Ÿáÿ©:</span>\n                    <span className=\"font-mono font-bold text-foreground\">{task.totalForwarded} ÿ±ÿ≥ÿßŸÑÿ©</span>\n                  </div>\n                </CardContent>\n\n                {/* Actions */}\n                <div className=\"px-4 pb-3 flex gap-2 justify-end border-t border-border pt-3\">\n                  <Button \n                    size=\"sm\" \n                    variant=\"ghost\" \n                    className=\"h-8 text-xs text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-500/10\"\n                    onClick={() => deleteMutation.mutate(task.id)}\n                    data-testid={`button-delete-${task.id}`}\n                    title=\"ÿ≠ÿ∞ŸÅ\"\n                  >\n                    <Trash2 className=\"h-3 w-3 ml-1\" />\n                    ÿ≠ÿ∞ŸÅ\n                  </Button>\n                  <Button \n                    size=\"sm\" \n                    variant=\"outline\"\n                    className=\"h-8 text-xs\"\n                    onClick={() => handleOpenEdit(task)}\n                    data-testid={`button-edit-${task.id}`}\n                    title=\"ÿ™ÿπÿØŸäŸÑ\"\n                  >\n                    <Edit className=\"h-3 w-3 ml-1\" />\n                    ÿ™ÿπÿØŸäŸÑ\n                  </Button>\n                  <Link href={`/ai-rules?taskId=${task.id}`}>\n                    <Button \n                      size=\"sm\" \n                      variant=\"outline\"\n                      className=\"h-8 text-xs bg-gradient-to-r from-purple-500/10 to-pink-500/10 border-purple-500/30 hover:bg-purple-500/20\"\n                      data-testid={`button-customize-${task.id}`}\n                      title=\"ÿ™ÿÆÿµŸäÿµ ÿßŸÑŸÇŸàÿßÿπÿØ\"\n                    >\n                      <Settings2 className=\"h-3 w-3 ml-1 text-purple-600\" />\n                      ÿ™ÿÆÿµŸäÿµ\n                    </Button>\n                  </Link>\n                  <Button \n                    size=\"sm\" \n                    className=\"h-8 text-xs bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary\"\n                    onClick={() => toggleMutation.mutate(task.id)}\n                    data-testid={`button-toggle-${task.id}`}\n                    title={task.isActive ? \"ÿ•ŸäŸÇÿßŸÅ\" : \"ÿ™ÿ¥ÿ∫ŸäŸÑ\"}\n                  >\n                    {task.isActive ? (\n                      <><Pause className=\"h-3 w-3 ml-1\" /> ÿ•ŸäŸÇÿßŸÅ</>\n                    ) : (\n                      <><Play className=\"h-3 w-3 ml-1\" /> ÿ™ÿ¥ÿ∫ŸäŸÑ</>\n                    )}\n                  </Button>\n                </div>\n              </Card>\n            </motion.div>\n          ))\n        )}\n      </div>\n\n      <Dialog open={isRulesOpen} onOpenChange={setIsRulesOpen}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Settings2 className=\"h-5 w-5\" />\n              ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÇŸàÿßÿπÿØ\n            </DialogTitle>\n            <DialogDescription>ÿ•ÿ∂ÿßŸÅÿ© Ÿàÿ™ÿπÿØŸäŸÑ Ÿàÿ≠ÿ∞ŸÅ ÿßŸÑŸÇŸàÿßÿπÿØ ŸÑŸÑŸÖŸáŸÖÿ©</DialogDescription>\n          </DialogHeader>\n\n          <Tabs value={selectedRuleType} onValueChange={(value) => {\n            setSelectedRuleType(value);\n            setRuleFormData(initialRuleFormData);\n            setRuleEditMode(false);\n          }} className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"summarize\" className=\"flex items-center gap-2\">\n                <FileText className=\"h-4 w-4\" />\n                ŸÇŸàÿßÿπÿØ ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n              </TabsTrigger>\n              <TabsTrigger value=\"video\" className=\"flex items-center gap-2\">\n                <Video className=\"h-4 w-4\" />\n                ŸÇŸàÿßÿπÿØ ÿßŸÑŸÅŸäÿØŸäŸà\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"summarize\" className=\"space-y-4 mt-4\">\n              <Card className=\"border-dashed\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-sm font-medium\">\n                    {ruleEditMode ? \"ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÇÿßÿπÿØÿ©\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ©\"}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div>\n                      <Label>ÿßÿ≥ŸÖ ÿßŸÑŸÇÿßÿπÿØÿ©</Label>\n                      <Input\n                        value={ruleFormData.name}\n                        onChange={(e) => setRuleFormData({...ruleFormData, name: e.target.value})}\n                        placeholder=\"ŸÖÿ´ŸÑ: ÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±\"\n                        className=\"mt-1\"\n                        data-testid=\"input-rule-name\"\n                      />\n                    </div>\n                    <div>\n                      <Label>ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©</Label>\n                      <Input\n                        type=\"number\"\n                        value={ruleFormData.priority}\n                        onChange={(e) => setRuleFormData({...ruleFormData, priority: parseInt(e.target.value) || 0})}\n                        className=\"mt-1\"\n                        data-testid=\"input-rule-priority\"\n                      />\n                    </div>\n                  </div>\n                  <div>\n                    <Label>Prompt ÿßŸÑÿ™ŸÑÿÆŸäÿµ</Label>\n                    <Textarea\n                      value={ruleFormData.prompt}\n                      onChange={(e) => setRuleFormData({...ruleFormData, prompt: e.target.value})}\n                      placeholder=\"ŸÖÿ´ŸÑ: ŸÇŸÖ ÿ®ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµ ÿßŸÑÿ™ÿßŸÑŸä ÿ®ÿ¥ŸÉŸÑ ŸÖŸàÿ¨ÿ≤ ŸÖÿπ ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©...\"\n                      className=\"mt-1 min-h-[100px]\"\n                      data-testid=\"textarea-rule-prompt\"\n                    />\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button \n                      onClick={handleSubmitRule}\n                      disabled={createRuleMutation.isPending || updateRuleMutation.isPending}\n                      data-testid=\"button-submit-rule\"\n                    >\n                      {(createRuleMutation.isPending || updateRuleMutation.isPending) && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n                      {ruleEditMode ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"}\n                    </Button>\n                    {ruleEditMode && (\n                      <Button \n                        variant=\"outline\"\n                        onClick={() => {\n                          setRuleEditMode(false);\n                          setRuleFormData(initialRuleFormData);\n                        }}\n                      >\n                        ÿ•ŸÑÿ∫ÿßÿ°\n                      </Button>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <div className=\"space-y-2\">\n                <h4 className=\"text-sm font-medium text-muted-foreground\">ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑÿ≠ÿßŸÑŸäÿ©</h4>\n                {filteredRules.length === 0 ? (\n                  <div className=\"text-center py-6 text-muted-foreground border rounded-lg border-dashed\">\n                    ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸàÿßÿπÿØ ÿ™ŸÑÿÆŸäÿµ. ÿ£ÿ∂ŸÅ ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÑÿ®ÿØÿ°.\n                  </div>\n                ) : (\n                  filteredRules.map((rule: any) => (\n                    <Card key={rule.id} className={`border ${!rule.isActive ? 'opacity-50' : ''}`}>\n                      <CardContent className=\"p-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"flex flex-col gap-1\">\n                              <Button \n                                size=\"icon\" \n                                variant=\"ghost\" \n                                className=\"h-5 w-5\"\n                                onClick={() => updateRulePriority(rule.id, rule.priority + 1)}\n                              >\n                                <ChevronUp className=\"h-3 w-3\" />\n                              </Button>\n                              <span className=\"text-xs text-center text-muted-foreground\">{rule.priority}</span>\n                              <Button \n                                size=\"icon\" \n                                variant=\"ghost\" \n                                className=\"h-5 w-5\"\n                                onClick={() => updateRulePriority(rule.id, Math.max(0, rule.priority - 1))}\n                              >\n                                <ChevronDown className=\"h-3 w-3\" />\n                              </Button>\n                            </div>\n                            <div>\n                              <p className=\"font-medium\">{rule.name}</p>\n                              <p className=\"text-sm text-muted-foreground line-clamp-2 break-words max-w-lg\">{rule.prompt}</p>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <ToggleSwitch\n                              checked={rule.isActive}\n                              onCheckedChange={() => toggleRuleMutation.mutate(rule.id)}\n                              size=\"sm\"\n                              data-testid={`toggle-rule-${rule.id}`}\n                            />\n                            <Button \n                              size=\"icon\" \n                              variant=\"ghost\"\n                              className=\"h-7 w-7\"\n                              onClick={() => handleEditRule(rule)}\n                              data-testid={`button-edit-rule-${rule.id}`}\n                            >\n                              <Edit className=\"h-3 w-3\" />\n                            </Button>\n                            <Button \n                              size=\"icon\" \n                              variant=\"ghost\"\n                              className=\"h-7 w-7 text-red-600\"\n                              onClick={() => deleteRuleMutation.mutate(rule.id)}\n                              data-testid={`button-delete-rule-${rule.id}`}\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))\n                )}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"video\" className=\"space-y-4 mt-4\">\n              <Card className=\"border-dashed\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-sm font-medium\">\n                    {ruleEditMode ? \"ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÇÿßÿπÿØÿ©\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ©\"}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div>\n                      <Label>ÿßÿ≥ŸÖ ÿßŸÑŸÇÿßÿπÿØÿ©</Label>\n                      <Input\n                        value={ruleFormData.name}\n                        onChange={(e) => setRuleFormData({...ruleFormData, name: e.target.value})}\n                        placeholder=\"ŸÖÿ´ŸÑ: ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà\"\n                        className=\"mt-1\"\n                        data-testid=\"input-video-rule-name\"\n                      />\n                    </div>\n                    <div>\n                      <Label>ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©</Label>\n                      <Input\n                        type=\"number\"\n                        value={ruleFormData.priority}\n                        onChange={(e) => setRuleFormData({...ruleFormData, priority: parseInt(e.target.value) || 0})}\n                        className=\"mt-1\"\n                        data-testid=\"input-video-rule-priority\"\n                      />\n                    </div>\n                  </div>\n                  <div>\n                    <Label>Prompt ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà</Label>\n                    <Textarea\n                      value={ruleFormData.prompt}\n                      onChange={(e) => setRuleFormData({...ruleFormData, prompt: e.target.value})}\n                      placeholder=\"ŸÖÿ´ŸÑ: ŸÇŸÖ ÿ®ÿ™ŸÑÿÆŸäÿµ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÅŸäÿØŸäŸà...\"\n                      className=\"mt-1 min-h-[100px]\"\n                      data-testid=\"textarea-video-rule-prompt\"\n                    />\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button \n                      onClick={handleSubmitRule}\n                      disabled={createRuleMutation.isPending || updateRuleMutation.isPending}\n                      data-testid=\"button-submit-video-rule\"\n                    >\n                      {(createRuleMutation.isPending || updateRuleMutation.isPending) && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n                      {ruleEditMode ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"}\n                    </Button>\n                    {ruleEditMode && (\n                      <Button \n                        variant=\"outline\"\n                        onClick={() => {\n                          setRuleEditMode(false);\n                          setRuleFormData(initialRuleFormData);\n                        }}\n                      >\n                        ÿ•ŸÑÿ∫ÿßÿ°\n                      </Button>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <div className=\"space-y-2\">\n                <h4 className=\"text-sm font-medium text-muted-foreground\">ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑÿ≠ÿßŸÑŸäÿ©</h4>\n                {filteredRules.length === 0 ? (\n                  <div className=\"text-center py-6 text-muted-foreground border rounded-lg border-dashed\">\n                    ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸàÿßÿπÿØ ŸÅŸäÿØŸäŸà. ÿ£ÿ∂ŸÅ ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÑÿ®ÿØÿ°.\n                  </div>\n                ) : (\n                  filteredRules.map((rule: any) => (\n                    <Card key={rule.id} className={`border ${!rule.isActive ? 'opacity-50' : ''}`}>\n                      <CardContent className=\"p-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"flex flex-col gap-1\">\n                              <Button \n                                size=\"icon\" \n                                variant=\"ghost\" \n                                className=\"h-5 w-5\"\n                                onClick={() => updateRulePriority(rule.id, rule.priority + 1)}\n                              >\n                                <ChevronUp className=\"h-3 w-3\" />\n                              </Button>\n                              <span className=\"text-xs text-center text-muted-foreground\">{rule.priority}</span>\n                              <Button \n                                size=\"icon\" \n                                variant=\"ghost\" \n                                className=\"h-5 w-5\"\n                                onClick={() => updateRulePriority(rule.id, Math.max(0, rule.priority - 1))}\n                              >\n                                <ChevronDown className=\"h-3 w-3\" />\n                              </Button>\n                            </div>\n                            <div>\n                              <p className=\"font-medium\">{rule.name}</p>\n                              <p className=\"text-sm text-muted-foreground line-clamp-2 break-words max-w-lg\">{rule.prompt}</p>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <ToggleSwitch\n                              checked={rule.isActive}\n                              onCheckedChange={() => toggleRuleMutation.mutate(rule.id)}\n                              size=\"sm\"\n                              data-testid={`toggle-video-rule-${rule.id}`}\n                            />\n                            <Button \n                              size=\"icon\" \n                              variant=\"ghost\"\n                              className=\"h-7 w-7\"\n                              onClick={() => handleEditRule(rule)}\n                              data-testid={`button-edit-video-rule-${rule.id}`}\n                            >\n                              <Edit className=\"h-3 w-3\" />\n                            </Button>\n                            <Button \n                              size=\"icon\" \n                              variant=\"ghost\"\n                              className=\"h-7 w-7 text-red-600\"\n                              onClick={() => deleteRuleMutation.mutate(rule.id)}\n                              data-testid={`button-delete-video-rule-${rule.id}`}\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))\n                )}\n              </div>\n            </TabsContent>\n          </Tabs>\n        </DialogContent>\n      </Dialog>\n\n      {/* Advanced Rules Dialogs */}\n      <EntityDialog\n        open={entityDialogOpen}\n        onOpenChange={setEntityDialogOpen}\n        onSubmit={handleEntitySubmit}\n        editingData={editingEntity}\n        isLoading={createEntityMutation.isPending || updateEntityMutation.isPending}\n      />\n      \n      <ContextDialog\n        open={contextDialogOpen}\n        onOpenChange={setContextDialogOpen}\n        onSubmit={handleContextSubmit}\n        editingData={editingContext}\n        isLoading={createContextMutation.isPending || updateContextMutation.isPending}\n      />\n      \n      <FilterDialog\n        open={filterDialogOpen}\n        onOpenChange={setFilterDialogOpen}\n        onSubmit={handleFilterSubmit}\n        editingData={editingFilter}\n        isLoading={createFilterMutation.isPending || updateFilterMutation.isPending}\n      />\n      \n      <TemplateDialog\n        open={templateDialogOpen}\n        onOpenChange={setTemplateDialogOpen}\n        onSubmit={handleTemplateSubmit}\n        editingData={editingTemplate}\n        isLoading={createTemplateMutation.isPending || updateTemplateMutation.isPending}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":55734,"size_tokens":null},"DEPLOYMENT_PLAN.md":{"content":"# BotNexus - Comprehensive Deployment Plan\n\n## Overview\nThis document outlines the complete deployment strategy for BotNexus across different platforms including Docker, Procfile-based hosting (Heroku, Railway), and Northflanks.\n\n## System Architecture\n\n### Components\n1. **Frontend** - React/TypeScript + Vite (Port 5000)\n2. **Backend** - Express/TypeScript + Node.js (Port 3000)\n3. **Telegram Bot** - Python/Pyrogram (background process)\n4. **Database** - PostgreSQL\n5. **AI Services** - OpenAI, Anthropic, Groq, HuggingFace\n\n---\n\n## Phase 1: Dependency Preparation\n\n### 1.1 Node.js Dependencies\n- **Status**: All installed via package.json\n- **Package Manager**: npm/bun\n- **Installation**: `npm install`\n\n### 1.2 Python Dependencies\n- **Source**: pyproject.toml\n- **Python Version**: 3.11+\n- **Installation**: `pip install -r requirements.txt`\n\n### 1.3 System Dependencies\n- **FFmpeg**: Required for video processing\n- **PostgreSQL Client**: For database migrations\n- **Python Development Headers**: For compiling Python packages\n\n### 1.4 Database Requirements\n- **Type**: PostgreSQL 13+\n- **Migrations**: Handled by Drizzle ORM\n- **Setup**: Automatic via `npm run db:push`\n\n---\n\n## Phase 2: Environment Configuration\n\n### 2.1 Required Environment Variables\n\n#### Database\n- `DATABASE_URL` - PostgreSQL connection string\n\n#### Telegram Bot\n- `BOT_TOKEN` - Telegram bot token from @BotFather\n- `API_ID` - Telegram API ID from my.telegram.org\n- `API_HASH` - Telegram API hash from my.telegram.org\n\n#### AI Providers\n- `OPENAI_API_KEY` - OpenAI API key\n- `ANTHROPIC_API_KEY` - Anthropic (Claude) API key\n- `GROQ_API_KEY` - Groq API key\n- `HUGGINGFACE_API_KEY` - HuggingFace API key (optional)\n\n#### Application\n- `NODE_ENV` - environment (development/production)\n- `SESSION_SECRET` - Session encryption secret\n- `ADMIN_PASSWORD_HASH` - bcrypt hash of admin password\n\n### 2.2 Optional Configuration\n- `LOG_LEVEL` - Log verbosity (debug/info/warn/error)\n- `MAX_RESTART_ATTEMPTS` - Bot restart retry limit\n- `RESTART_DELAY` - Delay between restart attempts (ms)\n\n---\n\n## Phase 3: Build Process\n\n### 3.1 Development Build\n```bash\nnpm run dev                  # Frontend dev server\nnpm run dev:client          # Frontend only\nNODE_ENV=development tsx server/index.ts  # Backend server\npython telegram_bot/main.py # Telegram bot\n```\n\n### 3.2 Production Build\n```bash\nnpm run build               # Compile frontend + backend\nnpm run db:push            # Apply database migrations\nnpm run start              # Start production server\n```\n\n### 3.3 Build Output\n- **Client Bundle**: `dist/client/`\n- **Server Bundle**: `dist/index.cjs`\n- **Assets**: Static files in `dist/client/`\n\n---\n\n## Phase 4: Database Setup\n\n### 4.1 Automatic Initialization\n1. Database URL provided via environment\n2. Run migrations: `npm run db:push`\n3. Creates all necessary tables\n4. No manual SQL required\n\n### 4.2 Database Schema\nLocation: `shared/schema.ts`\nTables include:\n- users, admins, channels\n- forwarding_tasks, ai_providers\n- ai_models, ai_rules\n- task_logs, task_stats\n\n### 4.3 Backup & Recovery\n- PostgreSQL native backups\n- Consider pg_dump for automated backups\n- Point-in-time recovery supported\n\n---\n\n## Phase 5: Docker Deployment\n\n### 5.1 Docker Image Build\n```bash\ndocker build -t botnexus:latest .\ndocker build -t botnexus:production -f Dockerfile.prod .\n```\n\n### 5.2 Docker Compose (Local Development)\n```bash\ndocker-compose up                 # Start all services\ndocker-compose down              # Stop services\ndocker-compose logs -f app       # View logs\n```\n\n### 5.3 Production Docker\n- Multi-stage build for optimization\n- Node.js 20 Alpine base image\n- Minimal final image size\n- Health checks configured\n\n---\n\n## Phase 6: Procfile Deployment (Heroku/Railway)\n\n### 6.1 Process Types\n```procfile\nrelease: npm run db:push\nweb: npm run start\nbot: python telegram_bot/main.py\nworker: node dist/index.cjs\n```\n\n### 6.2 Deployment Steps\n1. Connect Git repository\n2. Set environment variables in platform UI\n3. Push to main branch\n4. Automatic build & deploy\n5. Bot process runs alongside web\n\n### 6.3 Platform-Specific Setup\n\n#### Heroku\n```bash\nheroku create botnexus\nheroku config:set DATABASE_URL=postgresql://...\nheroku config:set BOT_TOKEN=xxx\ngit push heroku main\n```\n\n#### Railway\n- GitHub OAuth integration\n- Automatic deployment on push\n- PostgreSQL plugin for database\n- Environment variables in .railway.json\n\n---\n\n## Phase 7: Northflanks Deployment\n\n### 7.1 Configuration Files\n- `.northflanks/services.yml` - Service definitions\n- `.northflanks/volumes.yml` - Storage configuration\n- `.northflanks/env.yml` - Environment variables\n\n### 7.2 Service Setup\n1. **Frontend Service**\n   - Build command: `npm run build`\n   - Start command: `npm run start`\n   - Port: 5000\n   - Health check: `GET /health`\n\n2. **Telegram Bot Service**\n   - Build command: `pip install -r requirements.txt && npm install`\n   - Start command: `python telegram_bot/main.py`\n   - No port exposure\n   - Restart policy: always\n\n3. **Database Service**\n   - PostgreSQL addon\n   - Automatic backups\n   - Connection pooling\n\n### 7.3 Northflanks Deployment Steps\n1. Connect GitHub repository\n2. Select Node.js builder\n3. Configure environment variables\n4. Deploy database\n5. Deploy services\n6. Configure networking\n\n---\n\n## Phase 8: Health Checks & Monitoring\n\n### 8.1 Application Health Endpoints\n```\nGET /health - Server status\nGET /api/health - API status\nGET /metrics - Performance metrics (optional)\n```\n\n### 8.2 Process Monitoring\n- Docker health checks\n- Procfile restart policies\n- Northflanks auto-restart\n- Logging aggregation\n\n### 8.3 Database Health\n- Connection pool monitoring\n- Query performance tracking\n- Backup verification\n\n---\n\n## Phase 9: Post-Deployment\n\n### 9.1 Verification Steps\n- [ ] Frontend loads successfully\n- [ ] API endpoints respond\n- [ ] Database migrations applied\n- [ ] Bot process running\n- [ ] Environment variables set\n- [ ] Logs accessible\n\n### 9.2 Performance Optimization\n- CDN for static assets\n- Database query optimization\n- Connection pooling tuning\n- Cache warming\n\n### 9.3 Security Hardening\n- HTTPS enforcement\n- CORS configuration\n- Rate limiting\n- Input validation\n- Secret rotation\n\n---\n\n## Phase 10: Scaling & Maintenance\n\n### 10.1 Horizontal Scaling\n- Load balancing for API servers\n- Database read replicas\n- Message queue for bot tasks\n- Session store (Redis/Memcached)\n\n### 10.2 Monitoring & Logging\n- Application performance monitoring\n- Error tracking (Sentry)\n- Log aggregation (ELK stack)\n- Uptime monitoring\n\n### 10.3 Update Strategy\n- Blue-green deployments\n- Database migration safety\n- Rollback procedures\n- Canary releases\n\n---\n\n## Scripts & Automation\n\n### Quick Start\n```bash\n# Clone repository\ngit clone <repo-url>\ncd botnexus\n\n# Setup environment\ncp .env.example .env\n# Edit .env with your values\n\n# Install dependencies\nnpm install\npip install -r requirements.txt\n\n# Setup database\nnpm run db:push\n\n# Development\nnpm run dev\n```\n\n### Docker Quick Start\n```bash\n# Build image\ndocker build -t botnexus .\n\n# Run container\ndocker run -e DATABASE_URL=... \\\n           -e BOT_TOKEN=... \\\n           -p 5000:5000 \\\n           botnexus\n```\n\n### Deployment Helper Scripts\n- `scripts/setup.sh` - Initial setup\n- `scripts/deploy.sh` - Deployment automation\n- `scripts/migrate-db.sh` - Database migration\n- `scripts/health-check.sh` - Service verification\n\n---\n\n## Troubleshooting\n\n### Common Issues\n\n#### Database Connection Failures\n- Verify DATABASE_URL format\n- Check network access\n- Verify credentials\n- Review connection limits\n\n#### Bot Process Crashes\n- Check Telegram credentials\n- Verify BOT_TOKEN validity\n- Review error logs\n- Check system resources\n\n#### Memory Issues\n- Reduce worker pool size\n- Optimize database queries\n- Implement caching\n- Monitor process memory\n\n---\n\n## Timeline\n\n- **Phase 1-2**: Day 1 (Setup & Configuration)\n- **Phase 3-4**: Day 2 (Build & Database)\n- **Phase 5**: Day 3 (Docker)\n- **Phase 6**: Day 4 (Procfile)\n- **Phase 7**: Day 5 (Northflanks)\n- **Phase 8-10**: Ongoing (Monitoring & Optimization)\n\n---\n\n## Support & Resources\n\n- Docker Documentation: https://docs.docker.com\n- Heroku Documentation: https://devcenter.heroku.com\n- Railway Documentation: https://docs.railway.app\n- Northflanks Documentation: https://northflank.com/docs\n- PostgreSQL Documentation: https://www.postgresql.org/docs/\n\n","path":null,"size_bytes":8369,"size_tokens":null},"telegram_bot/main.py":{"content":"\"\"\"\nMain Bot Application\nTelegram Userbot with Pyrofork - Full Logging Support\nRuns in userbot mode to receive channel messages (bot_token cannot receive channel_post)\n\"\"\"\nimport asyncio\nimport signal\nimport sys\nimport traceback\nfrom datetime import datetime\nfrom typing import Dict, Any\n\n# Use Pyrofork (maintained Pyrogram fork)\nfrom pyrogram.client import Client\nfrom pyrogram.types import Message\nfrom pyrogram import filters\nfrom pyrogram.errors import FloodWait, RPCError, AuthKeyUnregistered\nfrom config.settings import settings\nfrom utils.database import db\nfrom utils.error_handler import ErrorLogger\nfrom utils.channel_utils import normalize_channel_id\nfrom utils.error_logger_db import db_error_logger\nfrom services.queue_system import queue_manager\nfrom services.forwarding_engine import ForwardingEngine\nfrom services.video_processor import video_processor\nfrom services.ai_providers import ai_manager\nfrom handlers import admin, task\n\nerror_logger = ErrorLogger(\"main\")\n\ndef log_detailed(level: str, component: str, function: str, message: str, data: dict | None = None):\n    \"\"\"Log with full details\"\"\"\n    timestamp = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S.%f\")[:-3]\n    log_msg = f\"[{timestamp}] [{level.upper()}] [{component}::{function}] {message}\"\n    if data:\n        log_msg += f\" | Data: {data}\"\n    print(log_msg)\n    if level == \"error\":\n        error_logger.log_warning(log_msg)\n    else:\n        error_logger.log_info(log_msg)\n\n# Global client - will be initialized with session from database\napp: Client | None = None\nsession_string: str | None = None\n\nasync def get_active_session() -> str | None:\n    \"\"\"Load active session string from database\"\"\"\n    try:\n        await db.connect()\n        assert db.pool is not None, \"Database pool not initialized\"\n        result = await db.pool.fetchrow(\"\"\"\n            SELECT session_string FROM userbot_sessions \n            WHERE is_active = true AND is_primary = true AND session_string IS NOT NULL\n            ORDER BY updated_at DESC LIMIT 1\n        \"\"\")\n        if result and result['session_string']:\n            log_detailed(\"info\", \"session\", \"load\", \"Found active session in database\")\n            return result['session_string']\n        log_detailed(\"info\", \"session\", \"load\", \"No active session found - userbot login required\")\n        return None\n    except Exception as e:\n        log_detailed(\"error\", \"session\", \"load\", f\"Failed to load session: {str(e)}\")\n        return None\n\ndef create_client(session: str | None = None) -> Client:\n    \"\"\"Create Pyrogram client with optional session\"\"\"\n    log_detailed(\"info\", \"main\", \"init\", \"Creating Pyrofork client\", {\n        \"api_id\": settings.API_ID,\n        \"has_session\": bool(session),\n        \"api_hash_set\": bool(settings.API_HASH)\n    })\n    \n    if session:\n        return Client(\n            name=\"userbot_forwarder\",\n            api_id=settings.API_ID,\n            api_hash=settings.API_HASH,\n            session_string=session,\n            in_memory=True\n        )\n    else:\n        return Client(\n            name=\"userbot_forwarder\",\n            api_id=settings.API_ID,\n            api_hash=settings.API_HASH,\n            in_memory=True\n        )\n\n# Global forwarding engine instance\nforwarding_engine: ForwardingEngine | None = None\nis_running = True\n\ndef normalize_task_config(task: Dict[str, Any]) -> Dict[str, Any]:\n    \"\"\"Convert API camelCase field names to Python snake_case for forwarding engine\"\"\"\n    config = dict(task)\n    \n    # Map camelCase field names from API to snake_case for Python\n    field_mappings = {\n        'summarizationProviderId': 'summarization_provider_id',\n        'summarizationModelId': 'summarization_model_id',\n        'aiProviderId': 'ai_provider_id',\n        'aiModelId': 'ai_model_id',\n        'videoAiProviderId': 'video_ai_provider_id',\n        'videoAiModelId': 'video_ai_model_id',\n        'videoProcessingEnabled': 'video_processing_enabled',\n        'audioProcessingEnabled': 'audio_processing_enabled',\n        'linkProcessingEnabled': 'link_processing_enabled',\n        'aiEnabled': 'ai_enabled',\n        'summarizationEnabled': 'summarization_enabled',\n    }\n    \n    # Apply mappings\n    for camel_name, snake_name in field_mappings.items():\n        if camel_name in config:\n            config[snake_name] = config[camel_name]\n    \n    return config\n\ndef register_handlers(client: Client):\n    \"\"\"Register all message handlers on the client dynamically\"\"\"\n    log_detailed(\"info\", \"handlers\", \"register\", \"Registering message handlers...\")\n    \n    @client.on_message(filters.channel | filters.group)\n    async def handle_channel_message(c: Client, message: Message):\n        \"\"\"Handle incoming messages from monitored channels\"\"\"\n        global forwarding_engine\n        \n        chat_id = str(message.chat.id)\n        chat_title = message.chat.title or \"Unknown\"\n        message_id = message.id\n        message_type = \"text\" if message.text else \"media\" if message.media else \"other\"\n        \n        log_detailed(\"info\", \"message_handler\", \"receive\", f\"üì© New message received\", {\n            \"chat_id\": chat_id,\n            \"chat_title\": chat_title,\n            \"message_id\": message_id,\n            \"message_type\": message_type,\n            \"has_text\": bool(message.text),\n            \"has_caption\": bool(message.caption),\n            \"media_type\": str(message.media) if message.media else None,\n            \"media_group_id\": message.media_group_id\n        })\n        \n        try:\n            # Find tasks with this chat as source\n            log_detailed(\"info\", \"message_handler\", \"process\", \"Fetching active tasks...\")\n            tasks = await db.get_active_tasks()\n            log_detailed(\"info\", \"message_handler\", \"process\", f\"Found {len(tasks)} tasks to check\")\n            \n            matched_task = None\n            for task_item in tasks:\n                if not task_item['is_active']:\n                    continue\n                \n                source_channels = task_item.get('source_channels', [])\n                log_detailed(\"debug\", \"message_handler\", \"match\", f\"Checking task: {task_item['name']}\", {\n                    \"task_id\": task_item['id'],\n                    \"source_channels\": source_channels\n                })\n                \n                # Check if this channel is in task sources\n                for source_id in source_channels:\n                    source_channel = await db.get_channel(source_id)\n                    \n                    if source_channel:\n                        log_detailed(\"debug\", \"message_handler\", \"match\", \"Comparing channel\", {\n                            \"source_id\": source_id,\n                            \"source_identifier\": source_channel['identifier'],\n                            \"incoming_chat_id\": chat_id,\n                            \"match\": source_channel['identifier'] == chat_id\n                        })\n                        \n                        if source_channel['identifier'] == chat_id:\n                            matched_task = task_item\n                            log_detailed(\"info\", \"message_handler\", \"match\", f\"‚úÖ Task matched!\", {\n                                \"task_name\": task_item['name'],\n                                \"task_id\": task_item['id']\n                            })\n                            break\n                \n                if matched_task:\n                    break\n            \n            if matched_task:\n                if forwarding_engine:\n                    log_detailed(\"info\", \"message_handler\", \"forward\", \"Starting message forwarding...\", {\n                        \"task_id\": matched_task['id'],\n                        \"target_channels\": matched_task.get('target_channels', [])\n                    })\n                    \n                    await forwarding_engine.forward_message(\n                        message=message,\n                        task_id=matched_task['id'],\n                        task_config=normalize_task_config(matched_task)\n                    )\n                    \n                    log_detailed(\"info\", \"message_handler\", \"forward\", \"‚úÖ Message forwarded successfully\")\n                else:\n                    log_detailed(\"error\", \"message_handler\", \"forward\", \"Forwarding engine not initialized!\")\n            else:\n                log_detailed(\"info\", \"message_handler\", \"skip\", f\"No matching task for chat: {chat_title}\", {\n                    \"chat_id\": chat_id\n                })\n            \n        except Exception as e:\n            error_msg = str(e)\n            trace = traceback.format_exc()\n            log_detailed(\"error\", \"message_handler\", \"error\", f\"Message handling error: {error_msg}\", {\n                \"chat_id\": chat_id,\n                \"message_id\": message_id,\n                \"traceback\": trace\n            })\n            # Log to database\n            await db_error_logger.log_error(\n                component=\"bot\",\n                function=\"handle_channel_message\",\n                error_type=type(e).__name__,\n                error_message=error_msg,\n                stack_trace=trace,\n                metadata={\"chat_id\": chat_id, \"message_id\": message_id}\n            )\n    \n    @client.on_message(filters.command(\"status\") & filters.private)\n    async def check_status_cmd(c: Client, message: Message):\n        \"\"\"Check bot status\"\"\"\n        user_id = message.from_user.id\n        log_detailed(\"info\", \"command\", \"status\", f\"Status check requested\", {\"user_id\": user_id})\n        \n        try:\n            tasks = await db.get_active_tasks()\n            active_tasks = [t for t in tasks if t['is_active']]\n            channels = await db.get_channels()\n            \n            status_msg = f\"\"\"\nüë§ **ÿ≠ÿßŸÑÿ© ÿßŸÑŸäŸàÿ≤ÿ±ÿ®Ÿàÿ™**\n\n‚úÖ ÿßŸÑŸäŸàÿ≤ÿ±ÿ®Ÿàÿ™ ŸäÿπŸÖŸÑ ÿ®ŸÜÿ¨ÿßÿ≠\nüìä ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™:\n- ÿßŸÑŸÖŸáÿßŸÖ ÿßŸÑŸÜÿ¥ÿ∑ÿ©: {len(active_tasks)}\n- ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÇŸÜŸàÿßÿ™: {len(channels)}\n- ŸÜÿ∏ÿßŸÖ ÿßŸÑÿπŸÖÿßŸÑ: ŸäÿπŸÖŸÑ\n\n‚è∞ ÿßŸÑŸàŸÇÿ™: {datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")}\n\"\"\"\n            await message.reply(status_msg)\n            \n        except Exception as e:\n            log_detailed(\"error\", \"command\", \"status\", f\"Status check error: {str(e)}\")\n            await message.reply(f\"‚ùå ÿÆÿ∑ÿ£: {str(e)}\")\n    \n    log_detailed(\"info\", \"handlers\", \"register\", \"‚úÖ All handlers registered successfully\")\n\nasync def initialize_bot():\n    \"\"\"Initialize all bot components\"\"\"\n    global forwarding_engine\n    \n    # Connect to database error logger\n    await db_error_logger.connect()\n    \n    log_detailed(\"info\", \"main\", \"initialize_bot\", \"Starting bot initialization...\")\n    \n    try:\n        # Connect to database\n        log_detailed(\"info\", \"database\", \"connect\", \"Connecting to database...\")\n        await db.connect()\n        log_detailed(\"info\", \"database\", \"connect\", \"Database connected successfully\")\n        \n        # Initialize AI providers from database\n        log_detailed(\"info\", \"ai_manager\", \"init\", \"Loading AI providers from database...\")\n        await ai_manager.initialize_from_database()\n        log_detailed(\"info\", \"ai_manager\", \"init\", \"AI providers loaded successfully\")\n        \n        # Initialize admin if not exists\n        if settings.BOT_ADMIN_ID:\n            log_detailed(\"info\", \"admin\", \"check\", f\"Checking admin status for ID: {settings.BOT_ADMIN_ID}\")\n            if not await db.is_admin(settings.BOT_ADMIN_ID):\n                await db.add_admin(settings.BOT_ADMIN_ID, \"Main Admin\")\n                log_detailed(\"info\", \"admin\", \"add\", f\"Main admin added: {settings.BOT_ADMIN_ID}\")\n            else:\n                log_detailed(\"info\", \"admin\", \"check\", f\"Admin already exists: {settings.BOT_ADMIN_ID}\")\n        \n        # Initialize forwarding engine\n        log_detailed(\"info\", \"forwarding_engine\", \"init\", \"Initializing forwarding engine...\")\n        assert app is not None, \"Pyrogram client not initialized\"\n        forwarding_engine = ForwardingEngine(app)\n        \n        # Make it accessible globally\n        import services.forwarding_engine as fe_module\n        fe_module.forwarding_engine = forwarding_engine\n        log_detailed(\"info\", \"forwarding_engine\", \"init\", \"Forwarding engine initialized successfully\")\n        \n        # Register queue job handlers\n        log_detailed(\"info\", \"queue_manager\", \"register\", \"Registering job handlers...\")\n        queue_manager.register_handler(\"forward\", handle_forward_job)\n        queue_manager.register_handler(\"ai_process\", handle_ai_job)\n        queue_manager.register_handler(\"video_process\", handle_video_job)\n        log_detailed(\"info\", \"queue_manager\", \"register\", \"All handlers registered: forward, ai_process, video_process\")\n        \n        # Start queue manager\n        log_detailed(\"info\", \"queue_manager\", \"start\", \"Starting queue manager...\")\n        await queue_manager.start()\n        log_detailed(\"info\", \"queue_manager\", \"start\", \"Queue manager started with 10 workers\")\n        \n        # Load and monitor active tasks\n        await load_active_tasks()\n        \n        log_detailed(\"info\", \"main\", \"initialize_bot\", \"‚úÖ Bot initialization completed successfully\")\n        \n    except Exception as e:\n        log_detailed(\"error\", \"main\", \"initialize_bot\", f\"Initialization error: {str(e)}\", {\n            \"traceback\": traceback.format_exc()\n        })\n        raise\n\nasync def warmup_channel_peers():\n    \"\"\"\n    Warm up channel peers by loading all dialogs first, then verifying channels.\n    This populates Pyrogram's peer cache to resolve PEER_ID_INVALID errors.\n    NOTE: Failures here don't block bot startup - they're non-critical.\n    \"\"\"\n    log_detailed(\"info\", \"warmup\", \"start\", \"Starting channel peer warmup...\")\n    \n    try:\n        assert app is not None, \"Pyrogram client not initialized\"\n        \n        # Step 1: Load ALL dialogs to populate the peer cache\n        log_detailed(\"info\", \"warmup\", \"dialogs\", \"Loading all dialogs to populate peer cache...\")\n        dialog_count = 0\n        cached_ids = set()\n        \n        async for dialog in app.get_dialogs():\n            dialog_count += 1\n            cached_ids.add(dialog.chat.id)\n            if dialog_count % 50 == 0:\n                log_detailed(\"debug\", \"warmup\", \"dialogs\", f\"Loaded {dialog_count} dialogs...\")\n        \n        log_detailed(\"info\", \"warmup\", \"dialogs\", f\"‚úÖ Cached {dialog_count} dialogs in peer cache\")\n        \n        # Step 2: Verify channels from database are accessible\n        channels = await db.get_channels()\n        log_detailed(\"info\", \"warmup\", \"channels\", f\"Found {len(channels)} channels to verify\")\n        \n        if not channels:\n            log_detailed(\"info\", \"warmup\", \"skip\", \"No channels to verify - skipping\")\n            return\n        \n        warmed_up = 0\n        failed = 0\n        \n        for channel in channels:\n            channel_id = channel.get('identifier', '')\n            channel_title = channel.get('title', 'Unknown')\n            \n            if not channel_id:\n                log_detailed(\"debug\", \"warmup\", \"skip\", f\"Channel {channel_title} has no identifier - skipping\")\n                continue\n            \n            try:\n                chat_id = int(channel_id)\n                \n                # Check if already in cache from dialogs\n                if chat_id in cached_ids:\n                    log_detailed(\"info\", \"warmup\", \"cached\", f\"‚úÖ {channel_title} already in peer cache\")\n                    warmed_up += 1\n                    continue\n                \n                # Try to get the chat to add it to cache\n                chat = await app.get_chat(chat_id)\n                chat_title = getattr(chat, 'title', 'Unknown')\n                log_detailed(\"info\", \"warmup\", \"success\", f\"‚úÖ Warmed up: {chat_title} ({chat_id})\")\n                warmed_up += 1\n                \n            except Exception as e:\n                error_msg = str(e)\n                if 'CHANNEL_INVALID' in error_msg or 'PEER_ID_INVALID' in error_msg:\n                    log_detailed(\"warning\", \"warmup\", \"failed\", f\"‚ùå Failed to warm up {channel_title}: {error_msg[:80]}\")\n                elif 'CHANNEL_PRIVATE' in error_msg or 'private' in error_msg.lower():\n                    log_detailed(\"debug\", \"warmup\", \"private\", f\"‚è≠ Channel {channel_title} is private/inaccessible\")\n                else:\n                    log_detailed(\"warning\", \"warmup\", \"failed\", f\"‚ùå Failed to warm up {channel_title}: {error_msg[:80]}\")\n                failed += 1\n        \n        log_detailed(\"info\", \"warmup\", \"complete\", f\"‚úÖ Warmup complete: {warmed_up} success, {failed} failed\")\n        \n    except Exception as e:\n        # Don't let warmup errors crash the bot\n        log_detailed(\"warning\", \"warmup\", \"error\", f\"Warmup encountered error but bot will continue: {str(e)[:100]}\")\n\nasync def load_active_tasks():\n    \"\"\"Load and start monitoring active tasks\"\"\"\n    global forwarding_engine\n    \n    log_detailed(\"info\", \"tasks\", \"load\", \"Loading active tasks from database...\")\n    \n    try:\n        tasks = await db.get_active_tasks()\n        log_detailed(\"info\", \"tasks\", \"load\", f\"Found {len(tasks)} tasks in database\")\n        \n        active_count = 0\n        for task_item in tasks:\n            task_id = task_item['id']\n            task_name = task_item['name']\n            is_active = task_item['is_active']\n            source_channels = task_item.get('source_channels', [])\n            target_channels = task_item.get('target_channels', [])\n            \n            log_detailed(\"info\", \"tasks\", \"check\", f\"Checking task: {task_name}\", {\n                \"task_id\": task_id,\n                \"is_active\": is_active,\n                \"source_channels\": source_channels,\n                \"target_channels\": target_channels\n            })\n            \n            if is_active and forwarding_engine:\n                await forwarding_engine.start_task_monitoring(task_id)\n                active_count += 1\n                log_detailed(\"info\", \"tasks\", \"monitor\", f\"Started monitoring task: {task_name}\", {\n                    \"task_id\": task_id\n                })\n        \n        log_detailed(\"info\", \"tasks\", \"load\", f\"Loaded {active_count} active tasks for monitoring\")\n        \n    except Exception as e:\n        log_detailed(\"error\", \"tasks\", \"load\", f\"Error loading tasks: {str(e)}\", {\n            \"traceback\": traceback.format_exc()\n        })\n\n# Queue job handlers\nasync def handle_forward_job(job: dict) -> dict:\n    \"\"\"Handle message forwarding job\"\"\"\n    job_id = job.get('id', 'unknown')\n    log_detailed(\"info\", \"job_handler\", \"forward\", f\"Processing forward job\", {\"job_id\": job_id})\n    \n    try:\n        payload = job['payload']\n        task_id = job.get('task_id')\n        \n        log_detailed(\"info\", \"job_handler\", \"forward\", \"Job payload received\", {\n            \"task_id\": task_id,\n            \"payload_keys\": list(payload.keys()) if payload else []\n        })\n        \n        if task_id is None:\n            log_detailed(\"error\", \"job_handler\", \"forward\", \"Task ID is missing\")\n            return {\"status\": \"error\", \"message\": \"Task ID is required\"}\n        \n        task_config = await db.get_task(task_id)\n        \n        if not task_config:\n            log_detailed(\"error\", \"job_handler\", \"forward\", f\"Task not found: {task_id}\")\n            return {\"status\": \"error\", \"message\": \"Task not found\"}\n        \n        log_detailed(\"info\", \"job_handler\", \"forward\", f\"Forward job completed\", {\"task_id\": task_id})\n        return {\"status\": \"success\", \"task_id\": task_id}\n        \n    except Exception as e:\n        log_detailed(\"error\", \"job_handler\", \"forward\", f\"Forward job error: {str(e)}\", {\n            \"traceback\": traceback.format_exc()\n        })\n        raise\n\nasync def handle_ai_job(job: dict) -> dict:\n    \"\"\"Handle AI processing job\"\"\"\n    import json\n    job_id = job.get('id', 'unknown')\n    log_detailed(\"info\", \"job_handler\", \"ai_process\", f\"Processing AI job\", {\"job_id\": job_id})\n    \n    try:\n        payload = job['payload']\n        # Parse JSON payload if it's a string\n        if isinstance(payload, str):\n            payload = json.loads(payload)\n        \n        log_detailed(\"info\", \"job_handler\", \"ai_process\", \"AI job completed\", {\n            \"payload_keys\": list(payload.keys()) if isinstance(payload, dict) else []\n        })\n        return {\"status\": \"success\"}\n    except Exception as e:\n        log_detailed(\"error\", \"job_handler\", \"ai_process\", f\"AI job error: {str(e)}\", {\n            \"traceback\": traceback.format_exc()\n        })\n        raise\n\nasync def handle_video_job(job: dict) -> dict:\n    \"\"\"Handle video processing job\"\"\"\n    import json\n    job_id = job.get('id', 'unknown')\n    log_detailed(\"info\", \"job_handler\", \"video_process\", f\"Processing video job\", {\"job_id\": job_id})\n    \n    try:\n        payload = job['payload']\n        \n        # Parse JSON payload if it's a string (payload is stored as JSON string in database)\n        if isinstance(payload, str):\n            log_detailed(\"info\", \"job_handler\", \"video_process\", \"Parsing JSON payload from database\")\n            payload = json.loads(payload)\n        \n        if not isinstance(payload, dict):\n            raise ValueError(f\"Payload must be dict, got {type(payload).__name__}\")\n        \n        task_id = job.get('task_id')\n        \n        if task_id is None:\n            log_detailed(\"error\", \"job_handler\", \"video_process\", \"Task ID is missing\")\n            return {\"status\": \"error\", \"message\": \"Task ID is required\"}\n        \n        task_config = await db.get_task(task_id)\n        \n        if not task_config:\n            log_detailed(\"error\", \"job_handler\", \"video_process\", f\"Task not found: {task_id}\")\n            return {\"status\": \"error\", \"message\": \"Task not found\"}\n        \n        message_id = payload.get('message_id')\n        chat_id = payload.get('chat_id')\n        \n        if not message_id or not chat_id:\n            log_detailed(\"error\", \"job_handler\", \"video_process\", \"Missing message_id or chat_id in payload\", {\n                \"message_id\": message_id,\n                \"chat_id\": chat_id,\n                \"payload_keys\": list(payload.keys())\n            })\n            return {\"status\": \"error\", \"message\": \"message_id and chat_id are required\"}\n        \n        log_detailed(\"info\", \"job_handler\", \"video_process\", \"Starting video processing\", {\n            \"message_id\": message_id,\n            \"chat_id\": chat_id,\n            \"task_id\": task_id\n        })\n        \n        result = await video_processor.process_video(\n            client=app,\n            message_id=message_id,\n            chat_id=chat_id,\n            task_id=task_id,\n            task_config=task_config\n        )\n        \n        log_detailed(\"info\", \"job_handler\", \"video_process\", \"Video job completed successfully\", {\n            \"result_length\": len(result) if result else 0\n        })\n        return {\"status\": \"success\", \"result\": result}\n        \n    except Exception as e:\n        log_detailed(\"error\", \"job_handler\", \"video_process\", f\"Video job error: {str(e)}\", {\n            \"traceback\": traceback.format_exc()\n        })\n        raise\n\nasync def shutdown():\n    \"\"\"Gracefully shutdown bot\"\"\"\n    global is_running\n    is_running = False\n    \n    log_detailed(\"info\", \"main\", \"shutdown\", \"Starting graceful shutdown...\")\n    \n    try:\n        # Stop queue manager\n        log_detailed(\"info\", \"queue_manager\", \"stop\", \"Stopping queue manager...\")\n        await queue_manager.stop()\n        log_detailed(\"info\", \"queue_manager\", \"stop\", \"Queue manager stopped\")\n        \n        # Disconnect database\n        log_detailed(\"info\", \"database\", \"disconnect\", \"Disconnecting database...\")\n        await db.disconnect()\n        log_detailed(\"info\", \"database\", \"disconnect\", \"Database disconnected\")\n        \n        log_detailed(\"info\", \"main\", \"shutdown\", \"‚úÖ Bot shutdown completed\")\n        \n    except Exception as e:\n        log_detailed(\"error\", \"main\", \"shutdown\", f\"Shutdown error: {str(e)}\", {\n            \"traceback\": traceback.format_exc()\n        })\n\nasync def main():\n    \"\"\"Main entry point for userbot mode\"\"\"\n    global is_running, app, session_string\n    \n    try:\n        # Validate settings\n        log_detailed(\"info\", \"main\", \"startup\", \"Validating settings...\")\n        if not settings.validate():\n            log_detailed(\"error\", \"main\", \"startup\", \"‚ùå Invalid configuration. Check your environment variables\")\n            return\n        \n        log_detailed(\"info\", \"main\", \"startup\", \"ü§ñ Starting Telegram Forwarding Userbot...\", {\n            \"bot_admin\": settings.BOT_ADMIN_ID,\n            \"api_id\": settings.API_ID\n        })\n        \n        # Load session from database\n        log_detailed(\"info\", \"session\", \"check\", \"Checking for active userbot session...\")\n        session_string = await get_active_session()\n        \n        if not session_string:\n            log_detailed(\"warning\", \"session\", \"missing\", \"‚ö†Ô∏è No active session found! Please login via the web interface.\")\n            print(\"\\n\" + \"=\"*60)\n            print(\"‚ö†Ô∏è  USERBOT LOGIN REQUIRED\")\n            print(\"=\"*60)\n            print(\"No active userbot session found.\")\n            print(\"Please go to the web interface Settings page to login\")\n            print(\"with your phone number to enable message forwarding.\")\n            print(\"=\"*60 + \"\\n\")\n            \n            # Still start the database and queue for API access\n            await db.connect()\n            \n            # Wait for session to be added via API\n            while is_running:\n                await asyncio.sleep(10)\n                session_string = await get_active_session()\n                if session_string:\n                    log_detailed(\"info\", \"session\", \"detected\", \"Session detected! Starting userbot...\")\n                    break\n            \n            if not session_string:\n                return\n        \n        # Create client with session\n        app = create_client(session_string)\n        \n        # Initialize components\n        await initialize_bot()\n        \n        # Start the userbot\n        log_detailed(\"info\", \"pyrogram\", \"start\", \"Starting Pyrofork userbot client...\")\n        await app.start()\n        \n        # Get user info\n        me = await app.get_me()\n        log_detailed(\"info\", \"pyrogram\", \"connected\", \"‚úÖ Userbot connected to Telegram\", {\n            \"user_id\": me.id,\n            \"username\": me.username,\n            \"first_name\": me.first_name\n        })\n        \n        # Register message handlers on the client\n        register_handlers(app)\n        \n        # Warm up channel peers AFTER Pyrogram is connected\n        log_detailed(\"info\", \"warmup\", \"post_connect\", \"Starting post-connection warmup...\")\n        await warmup_channel_peers()\n        \n        print(f\"\\n{'='*50}\")\n        print(f\"üë§ Userbot started: {me.first_name} (@{me.username or 'N/A'})\")\n        print(f\"üìä User ID: {me.id}\")\n        print(f\"‚úÖ Ready to forward messages from channels\")\n        print(f\"{'='*50}\\n\")\n        \n        # Keep userbot running using Pyrogram's idle\n        log_detailed(\"info\", \"main\", \"idle\", \"Userbot is now running and waiting for messages...\")\n        \n        # Use Pyrogram's idle() for proper event handling\n        from pyrogram import idle\n        await idle()\n        \n    except AuthKeyUnregistered:\n        log_detailed(\"error\", \"main\", \"auth_error\", \"Session expired or invalid. Please login again via the web interface.\")\n        # Mark session as expired in database\n        try:\n            if db.pool is not None:\n                await db.pool.execute(\"\"\"\n                    UPDATE userbot_sessions SET is_active = false, status = 'expired' \n                    WHERE is_primary = true\n                \"\"\")\n        except:\n            pass\n    except FloodWait as e:\n        log_detailed(\"error\", \"main\", \"flood\", f\"Flood wait: {e.value} seconds\")\n        wait_time = int(e.value) if isinstance(e.value, (int, float)) else 5\n        await asyncio.sleep(wait_time)\n    except RPCError as e:\n        error_code = e.CODE if hasattr(e, 'CODE') else None\n        error_msg = str(e)\n        \n        # Handle AUTH_KEY_DUPLICATED specifically\n        if error_code == 406 or 'AUTH_KEY_DUPLICATED' in error_msg:\n            log_detailed(\"error\", \"main\", \"auth_duplicated\", \"Session is being used elsewhere. Marking as expired...\")\n            try:\n                if db.pool is not None:\n                    await db.pool.execute(\"\"\"\n                        UPDATE userbot_sessions SET is_active = false, status = 'duplicated' \n                        WHERE is_primary = true\n                    \"\"\")\n                    log_detailed(\"info\", \"main\", \"auth_duplicated\", \"Session marked as expired. Please login again via Settings.\")\n            except Exception as db_error:\n                log_detailed(\"error\", \"main\", \"db_error\", f\"Failed to mark session as expired: {str(db_error)}\")\n        else:\n            log_detailed(\"error\", \"main\", \"rpc_error\", f\"RPC Error: {error_msg}\", {\n                \"error_code\": error_code\n            })\n    except KeyboardInterrupt:\n        log_detailed(\"info\", \"main\", \"interrupt\", \"Userbot stopped by user (Ctrl+C)\")\n    except Exception as e:\n        log_detailed(\"error\", \"main\", \"fatal\", f\"Fatal error: {str(e)}\", {\n            \"traceback\": traceback.format_exc()\n        })\n    finally:\n        log_detailed(\"info\", \"main\", \"cleanup\", \"Cleaning up...\")\n        await shutdown()\n        if app:\n            try:\n                await app.stop()\n                log_detailed(\"info\", \"pyrogram\", \"stop\", \"Pyrofork client stopped\")\n            except Exception as e:\n                log_detailed(\"error\", \"pyrogram\", \"stop\", f\"Error stopping client: {str(e)}\")\n\ndef signal_handler(signum, frame):\n    \"\"\"Handle termination signals\"\"\"\n    global is_running\n    log_detailed(\"info\", \"main\", \"signal\", f\"Received signal {signum}, shutting down...\")\n    is_running = False\n\nif __name__ == \"__main__\":\n    # Register signal handlers\n    signal.signal(signal.SIGINT, signal_handler)\n    signal.signal(signal.SIGTERM, signal_handler)\n    \n    log_detailed(\"info\", \"main\", \"entry\", \"Bot script started\")\n    asyncio.run(main())\n","path":null,"size_bytes":30172,"size_tokens":null},"client/src/components/eagle-logo.tsx":{"content":"import { useTheme } from \"next-themes\";\nimport { useEffect, useState } from \"react\";\n\nexport function EagleLogo({ \n  size = 40, \n  flip = false,\n  className = \"\" \n}: { \n  size?: number\n  flip?: boolean\n  className?: string \n}) {\n  const { theme, resolvedTheme } = useTheme();\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // Use resolvedTheme to prevent hydration mismatch\n  const isDark = mounted && (resolvedTheme === \"dark\" || theme === \"dark\");\n  \n  const logoSrc = isDark \n    ? \"/attached_assets/generated_images/eagle-logo-dark.png\"\n    : \"/attached_assets/generated_images/eagle-logo-futuristic.png\";\n\n  return (\n    <img \n      key={logoSrc}\n      src={logoSrc}\n      alt=\"Eagle Logo\"\n      style={{ \n        width: `${size}px`, \n        height: `${size}px`,\n        transform: flip ? 'scaleX(-1)' : 'scaleX(1)',\n        opacity: mounted ? 1 : 0,\n        transition: 'opacity 300ms ease-in-out'\n      }}\n      className={className}\n    />\n  );\n}\n","path":null,"size_bytes":1014,"size_tokens":null},"client/src/pages/settings.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Shield, \n  UserPlus, \n  Bell, \n  Database,\n  Save,\n  Trash2,\n  Loader,\n  Phone,\n  Key,\n  LogOut,\n  CheckCircle,\n  AlertCircle,\n  Smartphone,\n  XCircle,\n  RefreshCw,\n  ScrollText,\n  Copy,\n  Download,\n  Filter,\n  X,\n  ChevronDown,\n  Clock,\n  AlertTriangle,\n  Info\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\ninterface Admin {\n  id: number;\n  telegramId: string;\n  username: string | null;\n  addedBy: number | null;\n  createdAt: string;\n}\n\nexport default function SettingsPage() {\n  const queryClient = useQueryClient();\n  const [newAdminId, setNewAdminId] = useState(\"\");\n  const [newAdminUsername, setNewAdminUsername] = useState(\"\");\n  const [addAdminDialogOpen, setAddAdminDialogOpen] = useState(false);\n  const [notificationSettings, setNotificationSettings] = useState({\n    errorAlerts: true,\n    taskCompletion: false,\n    autoBackup: true\n  });\n  \n  const [phoneNumber, setPhoneNumber] = useState(\"\");\n  const [otpCode, setOtpCode] = useState(\"\");\n  const [twoFaPassword, setTwoFaPassword] = useState(\"\");\n  const [loginStep, setLoginStep] = useState<\"phone\" | \"otp\" | \"2fa\">(\"phone\");\n  const [isLoggingIn, setIsLoggingIn] = useState(false);\n  const [phoneError, setPhoneError] = useState(\"\");\n\n  // Event Logs State\n  const [logFilter, setLogFilter] = useState<string>(\"\");\n  const [logLevelFilter, setLogLevelFilter] = useState<string>(\"all\");\n  const [autoRefresh, setAutoRefresh] = useState(true);\n  const [expandedLog, setExpandedLog] = useState<number | null>(null);\n  const logsEndRef = useRef<HTMLDivElement>(null);\n  const logsContainerRef = useRef<HTMLDivElement>(null);\n\n  const { data: admins = [], isLoading: loadingAdmins } = useQuery({\n    queryKey: [\"admins\"],\n    queryFn: () => api.getAdmins(),\n  });\n\n  const { data: settings = [] } = useQuery({\n    queryKey: [\"settings\"],\n    queryFn: () => api.getSettings(),\n  });\n\n  const { data: userbotStatus, isLoading: loadingUserbot, refetch: refetchUserbot } = useQuery({\n    queryKey: [\"userbot-status\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/userbot/status\");\n      return res.json();\n    },\n    refetchInterval: 10000,\n  });\n\n  const { data: eventLogs = [], isLoading: loadingLogs, refetch: refetchLogs } = useQuery({\n    queryKey: [\"error-logs\"],\n    queryFn: () => api.getErrorLogs(500),\n    refetchInterval: autoRefresh ? 5000 : false,\n  });\n\n  const createAdminMutation = useMutation({\n    mutationFn: (data: { telegramId: string; username?: string }) => api.createAdmin(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠\");\n      queryClient.invalidateQueries({ queryKey: [\"admins\"] });\n      setAddAdminDialogOpen(false);\n      setNewAdminId(\"\");\n      setNewAdminUsername(\"\");\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"ŸÅÿ¥ŸÑ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ\");\n    },\n  });\n\n  const deleteAdminMutation = useMutation({\n    mutationFn: (id: number) => api.deleteAdmin(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ\");\n      queryClient.invalidateQueries({ queryKey: [\"admins\"] });\n    },\n    onError: () => {\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ\");\n    },\n  });\n\n  const saveSettingMutation = useMutation({\n    mutationFn: ({ key, value }: { key: string; value: string }) => api.saveSetting(key, value),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\");\n      queryClient.invalidateQueries({ queryKey: [\"settings\"] });\n    },\n  });\n\n  const handleAddAdmin = () => {\n    if (!newAdminId) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÖÿπÿ±ŸÅ ÿ™ŸÑÿ∫ÿ±ÿßŸÖ\");\n      return;\n    }\n    createAdminMutation.mutate({\n      telegramId: newAdminId,\n      username: newAdminUsername || undefined\n    });\n  };\n\n  const handleSaveSettings = async () => {\n    try {\n      await saveSettingMutation.mutateAsync({ key: \"error_alerts\", value: notificationSettings.errorAlerts.toString() });\n      await saveSettingMutation.mutateAsync({ key: \"task_completion\", value: notificationSettings.taskCompletion.toString() });\n      await saveSettingMutation.mutateAsync({ key: \"auto_backup\", value: notificationSettings.autoBackup.toString() });\n      toast.success(\"ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\");\n    } catch (error) {\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ≠ŸÅÿ∏ ÿ®ÿπÿ∂ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\");\n    }\n  };\n\n  const validatePhoneNumber = (phone: string): boolean => {\n    const cleanPhone = phone.replace(/[\\s\\-\\(\\)]/g, '');\n    const phoneRegex = /^\\+?[1-9]\\d{6,14}$/;\n    return phoneRegex.test(cleanPhone);\n  };\n\n  const resetLoginForm = () => {\n    setPhoneNumber(\"\");\n    setOtpCode(\"\");\n    setTwoFaPassword(\"\");\n    setLoginStep(\"phone\");\n    setPhoneError(\"\");\n  };\n\n  const handleStartLogin = async () => {\n    setPhoneError(\"\");\n    \n    if (!phoneNumber) {\n      setPhoneError(\"Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ\");\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ\");\n      return;\n    }\n    \n    if (!validatePhoneNumber(phoneNumber)) {\n      setPhoneError(\"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ - ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿ±ŸÖÿ≤ ÿßŸÑÿØŸàŸÑÿ©\");\n      toast.error(\"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠\");\n      return;\n    }\n    \n    setIsLoggingIn(true);\n    try {\n      const res = await fetch(\"/api/userbot/login/start\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ phoneNumber }),\n      });\n      const data = await res.json();\n      \n      if (data.status === \"code_sent\") {\n        toast.success(data.message || \"ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ\");\n        setLoginStep(\"otp\");\n      } else if (data.status === \"error\") {\n        toast.error(data.message || \"ŸÅÿ¥ŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ŸÖÿ≤\");\n        if (data.error === \"phone_invalid\") {\n          setPhoneError(\"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\");\n        }\n      }\n    } catch (error) {\n      toast.error(\"ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ\");\n    } finally {\n      setIsLoggingIn(false);\n    }\n  };\n\n  const handleVerifyCode = async () => {\n    if (!otpCode) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ\");\n      return;\n    }\n    \n    setIsLoggingIn(true);\n    try {\n      const res = await fetch(\"/api/userbot/login/verify\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ phoneNumber, code: otpCode }),\n      });\n      const data = await res.json();\n      \n      if (data.status === \"success\") {\n        toast.success(data.message || \"ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠\");\n        resetLoginForm();\n        refetchUserbot();\n      } else if (data.status === \"2fa_required\") {\n        toast.info(data.message || \"Ÿäÿ™ÿ∑ŸÑÿ® ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ®ÿÆÿ∑Ÿàÿ™ŸäŸÜ\");\n        setLoginStep(\"2fa\");\n      } else if (data.status === \"error\") {\n        toast.error(data.message || \"ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠\");\n        if (data.error === \"session_expired\" || data.error === \"code_expired\") {\n          resetLoginForm();\n        }\n      }\n    } catch (error) {\n      toast.error(\"ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ\");\n    } finally {\n      setIsLoggingIn(false);\n    }\n  };\n\n  const handleVerify2FA = async () => {\n    if (!twoFaPassword) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±\");\n      return;\n    }\n    \n    setIsLoggingIn(true);\n    try {\n      const res = await fetch(\"/api/userbot/login/2fa\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ phoneNumber, password: twoFaPassword }),\n      });\n      const data = await res.json();\n      \n      if (data.status === \"success\") {\n        toast.success(data.message || \"ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠\");\n        resetLoginForm();\n        refetchUserbot();\n      } else if (data.status === \"error\") {\n        toast.error(data.message || \"ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©\");\n        if (data.error === \"session_expired\") {\n          resetLoginForm();\n        }\n      }\n    } catch (error) {\n      toast.error(\"ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ\");\n    } finally {\n      setIsLoggingIn(false);\n    }\n  };\n\n  const handleCancelLogin = async () => {\n    if (!phoneNumber) {\n      resetLoginForm();\n      return;\n    }\n    \n    setIsLoggingIn(true);\n    try {\n      await fetch(\"/api/userbot/login/cancel\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ phoneNumber }),\n      });\n      toast.info(\"ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿπŸÖŸÑŸäÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ\");\n    } catch (error) {\n      console.error(\"Cancel error:\", error);\n    } finally {\n      resetLoginForm();\n      setIsLoggingIn(false);\n    }\n  };\n\n  const handleLogout = async () => {\n    setIsLoggingIn(true);\n    try {\n      const res = await fetch(\"/api/userbot/logout\", { method: \"POST\" });\n      const data = await res.json();\n      \n      if (data.status === \"success\") {\n        toast.success(data.message || \"ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨\");\n        refetchUserbot();\n      }\n    } catch (error) {\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨\");\n    } finally {\n      setIsLoggingIn(false);\n    }\n  };\n\n  const getInitial = (username: string | null) => {\n    if (!username) return \"?\";\n    return username.replace(\"@\", \"\").charAt(0).toUpperCase();\n  };\n\n  const isConnected = userbotStatus?.status === \"connected\" || userbotStatus?.status === \"active\";\n\n  // Event Logs Helpers\n  const getLogLevelColor = (level: string) => {\n    if (level?.includes(\"ERROR\")) return \"bg-red-500/10 text-red-700 dark:text-red-400 border-red-200 dark:border-red-900\";\n    if (level?.includes(\"WARN\")) return \"bg-yellow-500/10 text-yellow-700 dark:text-yellow-400 border-yellow-200 dark:border-yellow-900\";\n    if (level?.includes(\"INFO\")) return \"bg-blue-500/10 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-900\";\n    return \"bg-gray-500/10 text-gray-700 dark:text-gray-400 border-gray-200 dark:border-gray-900\";\n  };\n\n  const getLogLevelIcon = (level: string) => {\n    if (level?.includes(\"ERROR\")) return <AlertTriangle className=\"h-4 w-4\" />;\n    if (level?.includes(\"WARN\")) return <AlertCircle className=\"h-4 w-4\" />;\n    if (level?.includes(\"INFO\")) return <Info className=\"h-4 w-4\" />;\n    return <Clock className=\"h-4 w-4\" />;\n  };\n\n  const filteredLogs = eventLogs.filter((log: any) => {\n    const matchesSearch = !logFilter || \n      log.component?.toLowerCase().includes(logFilter.toLowerCase()) ||\n      log.errorMessage?.toLowerCase().includes(logFilter.toLowerCase()) ||\n      log.function?.toLowerCase().includes(logFilter.toLowerCase());\n    \n    const matchesLevel = logLevelFilter === \"all\" || log.errorType?.includes(logLevelFilter.toUpperCase());\n    \n    return matchesSearch && matchesLevel;\n  });\n\n  // Deduplicate logs by component + function + message\n  const deduplicatedLogs = filteredLogs.reduce((acc: any[], log: any) => {\n    const key = `${log.component}|${log.function}|${log.errorMessage}`;\n    const exists = acc.some((l: any) => `${l.component}|${l.function}|${l.errorMessage}` === key);\n    if (!exists) acc.push(log);\n    return acc;\n  }, []);\n\n  // Auto-scroll to bottom when new logs arrive\n  useEffect(() => {\n    if (logsEndRef.current && logsContainerRef.current) {\n      setTimeout(() => {\n        logsEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n      }, 100);\n    }\n  }, [filteredLogs]);\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast.success(\"ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿ•ŸÑŸâ ÿßŸÑÿ≠ÿßŸÅÿ∏ÿ©\");\n  };\n\n  const downloadLogs = () => {\n    const logsText = filteredLogs.map((log: any) => \n      `[${log.timestamp}] ${log.errorType} - ${log.component} - ${log.errorMessage}`\n    ).join(\"\\n\");\n    \n    const element = document.createElement(\"a\");\n    element.setAttribute(\"href\", \"data:text/plain;charset=utf-8,\" + encodeURIComponent(logsText));\n    element.setAttribute(\"download\", `event-logs-${new Date().toISOString()}.txt`);\n    element.style.display = \"none\";\n    document.body.appendChild(element);\n    element.click();\n    document.body.removeChild(element);\n    toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™\");\n  };\n\n  return (\n    <div className=\"space-y-6 md:space-y-8 max-w-6xl mx-auto\">\n      <div className=\"flex flex-col sm:flex-row sm:items-end justify-between gap-4\">\n        <div>\n          <h2 className=\"text-2xl md:text-3xl font-display font-bold text-foreground tracking-wide\">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ</h2>\n          <p className=\"text-muted-foreground mt-1 text-sm md:text-base\">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿ®ÿßŸÑŸàÿµŸàŸÑ ŸàÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ Ÿàÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ</p>\n        </div>\n        <Button \n          onClick={handleSaveSettings}\n          className=\"bg-primary text-primary-foreground font-bold hover:bg-primary/90 w-full sm:w-auto\"\n          disabled={saveSettingMutation.isPending}\n          data-testid=\"button-save-settings\"\n        >\n          {saveSettingMutation.isPending ? (\n            <Loader className=\"h-3 w-3 mr-2 animate-spin\" />\n          ) : (\n            <Save className=\"h-3 w-3 mr-2\" />\n          )}\n          ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™\n        </Button>\n      </div>\n\n      <Tabs defaultValue=\"general\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3 lg:w-fit\">\n          <TabsTrigger value=\"general\" className=\"flex items-center gap-2\">\n            <Shield className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">ÿπÿßŸÖ</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"admins\" className=\"flex items-center gap-2\">\n            <UserPlus className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">ŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"logs\" className=\"flex items-center gap-2\">\n            <ScrollText className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">ÿ≥ÿ¨ŸÑÿßÿ™</span>\n          </TabsTrigger>\n        </TabsList>\n\n        {/* General Tab */}\n        <TabsContent value=\"general\" className=\"space-y-6\">\n          <Card className=\"border shadow-sm border-primary/30\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-foreground\">\n                <Smartphone className=\"h-4 w-4 text-primary\" /> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑŸäŸàÿ≤ÿ±ÿ®Ÿàÿ™\n              </CardTitle>\n              <CardDescription>\n                ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿ≠ÿ≥ÿßÿ® ÿ™ŸÑÿ∫ÿ±ÿßŸÖ ŸÑÿ™ŸÅÿπŸäŸÑ ÿ•ÿπÿßÿØÿ© ÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ŸÖŸÜ ÿßŸÑŸÇŸÜŸàÿßÿ™\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {loadingUserbot ? (\n                <div className=\"flex justify-center p-4\">\n                  <Loader className=\"h-6 w-6 animate-spin text-primary\" />\n                </div>\n              ) : isConnected ? (\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-3 p-4 bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/20 rounded-lg\">\n                    <CheckCircle className=\"h-6 w-6 text-green-500 flex-shrink-0\" />\n                    <div className=\"flex-1\">\n                      <p className=\"font-medium text-green-600 dark:text-green-400\">ŸÖÿ™ÿµŸÑ ŸàŸäÿπŸÖŸÑ</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ: {userbotStatus.phoneNumber}\n                      </p>\n                      {userbotStatus.lastLoginAt && (\n                        <p className=\"text-xs text-muted-foreground\">\n                          ÿ¢ÿÆÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ: {new Date(userbotStatus.lastLoginAt).toLocaleString('ar')}\n                        </p>\n                      )}\n                    </div>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={handleLogout}\n                      disabled={isLoggingIn}\n                      className=\"text-red-600 border-red-500/30 hover:bg-red-500/10\"\n                      data-testid=\"button-userbot-logout\"\n                    >\n                      {isLoggingIn ? (\n                        <Loader className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <>\n                          <LogOut className=\"h-4 w-4 mr-1\" /> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg\">\n                    <AlertCircle className=\"h-5 w-5 text-yellow-500 flex-shrink-0\" />\n                    <p className=\"text-sm text-yellow-600 dark:text-yellow-400\">\n                      Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ™ŸÅÿπŸäŸÑ ÿ•ÿπÿßÿØÿ© ÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ\n                    </p>\n                  </div>\n\n                  {loginStep === \"phone\" && (\n                    <div className=\"space-y-3\">\n                      <div>\n                        <Label htmlFor=\"phone\">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ (ŸÖÿπ ÿ±ŸÖÿ≤ ÿßŸÑÿØŸàŸÑÿ©)</Label>\n                        <div className=\"relative mt-1\">\n                          <Phone className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                          <Input\n                            id=\"phone\"\n                            type=\"tel\"\n                            value={phoneNumber}\n                            onChange={(e) => {\n                              setPhoneNumber(e.target.value);\n                              setPhoneError(\"\");\n                            }}\n                            placeholder=\"+966512345678\"\n                            className={`pl-10 ${phoneError ? 'border-red-500' : ''}`}\n                            dir=\"ltr\"\n                            data-testid=\"input-phone-number\"\n                          />\n                        </div>\n                        {phoneError ? (\n                          <p className=\"text-xs text-red-500 mt-1\">{phoneError}</p>\n                        ) : (\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            ŸÖÿ´ÿßŸÑ: +966512345678 ÿ£Ÿà +201012345678\n                          </p>\n                        )}\n                      </div>\n                      <Button \n                        onClick={handleStartLogin}\n                        className=\"w-full\"\n                        disabled={isLoggingIn}\n                        data-testid=\"button-send-code\"\n                      >\n                        {isLoggingIn ? (\n                          <Loader className=\"h-4 w-4 mr-2 animate-spin\" />\n                        ) : (\n                          <Key className=\"h-4 w-4 mr-2\" />\n                        )}\n                        ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ\n                      </Button>\n                    </div>\n                  )}\n\n                  {loginStep === \"otp\" && (\n                    <div className=\"space-y-3\">\n                      <div className=\"text-center p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg\">\n                        <p className=\"text-sm text-blue-600 dark:text-blue-400\">\n                          ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ•ŸÑŸâ ÿ™ŸÑÿ∫ÿ±ÿßŸÖ ÿ£Ÿà ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜÿµŸäÿ©\n                        </p>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ: {phoneNumber}\n                        </p>\n                      </div>\n                      <div>\n                        <Label htmlFor=\"otp\">ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ</Label>\n                        <Input\n                          id=\"otp\"\n                          type=\"text\"\n                          value={otpCode}\n                          onChange={(e) => setOtpCode(e.target.value.replace(/\\D/g, ''))}\n                          placeholder=\"12345\"\n                          className=\"mt-1 text-center text-2xl tracking-widest\"\n                          maxLength={6}\n                          dir=\"ltr\"\n                          data-testid=\"input-otp-code\"\n                        />\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button \n                          variant=\"outline\"\n                          onClick={handleCancelLogin}\n                          className=\"flex-1\"\n                          disabled={isLoggingIn}\n                        >\n                          <XCircle className=\"h-4 w-4 mr-1\" />\n                          ÿ•ŸÑÿ∫ÿßÿ°\n                        </Button>\n                        <Button \n                          onClick={handleVerifyCode}\n                          className=\"flex-1\"\n                          disabled={isLoggingIn || !otpCode}\n                          data-testid=\"button-verify-code\"\n                        >\n                          {isLoggingIn && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n                          ÿ™ÿ≠ŸÇŸÇ\n                        </Button>\n                      </div>\n                      <Button \n                        variant=\"ghost\"\n                        onClick={handleStartLogin}\n                        className=\"w-full text-sm\"\n                        disabled={isLoggingIn}\n                      >\n                        <RefreshCw className=\"h-3 w-3 mr-1\" />\n                        ÿ•ÿπÿßÿØÿ© ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ŸÖÿ≤\n                      </Button>\n                    </div>\n                  )}\n\n                  {loginStep === \"2fa\" && (\n                    <div className=\"space-y-3\">\n                      <div className=\"text-center p-3 bg-purple-500/10 border border-purple-500/20 rounded-lg\">\n                        <p className=\"text-sm text-purple-600 dark:text-purple-400\">\n                          ÿ≠ÿ≥ÿßÿ®ŸÉ ŸÖÿ≠ŸÖŸä ÿ®ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ®ÿÆÿ∑Ÿàÿ™ŸäŸÜ - ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±\n                        </p>\n                      </div>\n                      <div>\n                        <Label htmlFor=\"2fa\">ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ®ÿÆÿ∑Ÿàÿ™ŸäŸÜ</Label>\n                        <Input\n                          id=\"2fa\"\n                          type=\"password\"\n                          value={twoFaPassword}\n                          onChange={(e) => setTwoFaPassword(e.target.value)}\n                          placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                          className=\"mt-1\"\n                          data-testid=\"input-2fa-password\"\n                        />\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button \n                          variant=\"outline\"\n                          onClick={handleCancelLogin}\n                          className=\"flex-1\"\n                          disabled={isLoggingIn}\n                        >\n                          <XCircle className=\"h-4 w-4 mr-1\" />\n                          ÿ•ŸÑÿ∫ÿßÿ°\n                        </Button>\n                        <Button \n                          onClick={handleVerify2FA}\n                          className=\"flex-1\"\n                          disabled={isLoggingIn || !twoFaPassword}\n                          data-testid=\"button-verify-2fa\"\n                        >\n                          {isLoggingIn && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n                          ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ\n                        </Button>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card className=\"border shadow-sm\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-foreground\">\n                <Bell className=\"h-4 w-4 text-primary\" /> ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ Ÿàÿ™ŸÜÿ®ŸäŸáÿßÿ™\n              </CardTitle>\n              <CardDescription>ÿ™ÿÆÿµŸäÿµ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸàÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-4\">\n                {[\n                  { key: \"errorAlerts\", label: \"ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°\", desc: \"ÿ™ŸÑŸÇŸä ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ®ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑŸÅŸàÿ±Ÿäÿ©\" },\n                  { key: \"taskCompletion\", label: \"ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑŸÖŸáÿßŸÖ\", desc: \"ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿπŸÜÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸÖŸáÿßŸÖ\" },\n                  { key: \"autoBackup\", label: \"ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿäÿ©\", desc: \"ÿ≠ŸÅÿ∏ ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ™ŸÑŸÇÿßÿ¶Ÿäÿ© ŸäŸàŸÖŸäÿ©\" }\n                ].map(({ key, label, desc }) => (\n                  <div key={key} className=\"flex items-center justify-between p-3 rounded-lg border border-border hover:bg-muted/50 transition-colors\">\n                    <div className=\"flex-1\">\n                      <Label className=\"font-medium cursor-pointer\">{label}</Label>\n                      <p className=\"text-xs text-muted-foreground\">{desc}</p>\n                    </div>\n                    <Switch\n                      checked={notificationSettings[key as keyof typeof notificationSettings]}\n                      onCheckedChange={(checked) =>\n                        setNotificationSettings({\n                          ...notificationSettings,\n                          [key]: checked\n                        })\n                      }\n                    />\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Admins Tab */}\n        <TabsContent value=\"admins\">\n          <Card className=\"border shadow-sm\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-foreground\">\n                <Shield className=\"h-4 w-4 text-primary\" /> ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ\n              </CardTitle>\n              <CardDescription>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿßŸÑŸÖÿµÿ±ÿ≠ ŸÑŸáŸÖ ŸàŸÖÿ≥ÿ§ŸàŸÑŸä ÿßŸÑÿ®Ÿàÿ™</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <Dialog open={addAdminDialogOpen} onOpenChange={setAddAdminDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button variant=\"outline\" data-testid=\"button-add-admin\">\n                    <UserPlus className=\"h-3 w-3 mr-2\" /> ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ§ŸàŸÑ\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ§ŸàŸÑ ÿ¨ÿØŸäÿØ</DialogTitle>\n                    <DialogDescription>ÿ£ÿØÿÆŸÑ ŸÖÿπÿ±ŸÅ ÿ™ŸÑÿ∫ÿ±ÿßŸÖ Ÿàÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿßŸÑÿ¨ÿØŸäÿØ</DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"telegram-id\">ŸÖÿπÿ±ŸÅ ÿ™ŸÑÿ∫ÿ±ÿßŸÖ</Label>\n                      <Input\n                        id=\"telegram-id\"\n                        value={newAdminId}\n                        onChange={(e) => setNewAdminId(e.target.value)}\n                        placeholder=\"123456789\"\n                        className=\"mt-1\"\n                        data-testid=\"input-admin-telegram-id\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"username\">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</Label>\n                      <Input\n                        id=\"username\"\n                        value={newAdminUsername}\n                        onChange={(e) => setNewAdminUsername(e.target.value)}\n                        placeholder=\"@username\"\n                        className=\"mt-1\"\n                        data-testid=\"input-admin-username\"\n                      />\n                    </div>\n                    <Button \n                      onClick={handleAddAdmin}\n                      className=\"w-full\"\n                      disabled={createAdminMutation.isPending}\n                      data-testid=\"button-submit-admin\"\n                    >\n                      {createAdminMutation.isPending && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n                      ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ\n                    </Button>\n                  </div>\n                </DialogContent>\n              </Dialog>\n              \n              <div className=\"space-y-2\">\n                {loadingAdmins ? (\n                  <div className=\"flex justify-center p-4\">\n                    <Loader className=\"h-6 w-6 animate-spin text-primary\" />\n                  </div>\n                ) : admins.length === 0 ? (\n                  <div className=\"text-center p-4 text-muted-foreground\">\n                    ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≥ÿ§ŸàŸÑŸàŸÜ ÿ≠ÿßŸÑŸäÿßŸã\n                  </div>\n                ) : (\n                  admins.map((admin: Admin) => (\n                    <div \n                      key={admin.id} \n                      className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-3 rounded bg-muted/50 border border-border hover:border-primary/50 transition-colors\"\n                      data-testid={`admin-row-${admin.id}`}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-primary/40 to-primary/20 flex items-center justify-center text-primary font-bold\">\n                          {getInitial(admin.username)}\n                        </div>\n                        <div>\n                          <p className=\"text-sm font-medium text-foreground\">{admin.username || \"ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ\"}</p>\n                          <p className=\"text-xs text-muted-foreground font-mono\">ID: {admin.telegramId}</p>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => deleteAdminMutation.mutate(admin.id)}\n                        disabled={deleteAdminMutation.isPending}\n                        className=\"text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20\"\n                        data-testid={`button-delete-admin-${admin.id}`}\n                      >\n                        {deleteAdminMutation.isPending ? (\n                          <Loader className=\"h-4 w-4 animate-spin\" />\n                        ) : (\n                          <>\n                            <Trash2 className=\"h-4 w-4 mr-1\" /> ÿ≠ÿ∞ŸÅ\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  ))\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Logs Tab */}\n        <TabsContent value=\"logs\" className=\"space-y-4\">\n          <Card className=\"border shadow-sm\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2 text-foreground\">\n                    <ScrollText className=\"h-4 w-4 text-primary\" /> ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ŸàÿßŸÑŸÉŸàŸÜÿ≥ŸàŸÑ\n                  </CardTitle>\n                  <CardDescription>ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑŸÜÿ∏ÿßŸÖ ŸàÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸäÿ©</CardDescription>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    size=\"sm\"\n                    variant={autoRefresh ? \"default\" : \"outline\"}\n                    onClick={() => setAutoRefresh(!autoRefresh)}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <RefreshCw className={`h-3 w-3 ${autoRefresh ? 'animate-spin' : ''}`} />\n                    ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÑŸÇÿßÿ¶Ÿä\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => refetchLogs()}\n                    disabled={loadingLogs}\n                  >\n                    {loadingLogs ? <Loader className=\"h-3 w-3 animate-spin mr-1\" /> : <RefreshCw className=\"h-3 w-3 mr-1\" />}\n                    ÿ™ÿ≠ÿØŸäÿ´\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={downloadLogs}\n                    className=\"flex items-center gap-1\"\n                  >\n                    <Download className=\"h-3 w-3\" />\n                    ÿ™ÿ≠ŸÖŸäŸÑ\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex flex-col sm:flex-row gap-3 items-stretch sm:items-center\">\n                <div className=\"flex-1 relative\">\n                  <Filter className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"ÿßÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´...\"\n                    value={logFilter}\n                    onChange={(e) => setLogFilter(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n                <select\n                  value={logLevelFilter}\n                  onChange={(e) => setLogLevelFilter(e.target.value)}\n                  className=\"px-3 py-2 rounded-md border border-input bg-background text-sm font-medium\"\n                >\n                  <option value=\"all\">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ŸàŸäÿßÿ™</option>\n                  <option value=\"error\">ÿ£ÿÆÿ∑ÿßÿ°</option>\n                  <option value=\"warn\">ÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™</option>\n                  <option value=\"info\">ŸÖÿπŸÑŸàŸÖÿßÿ™</option>\n                </select>\n                {(logFilter || logLevelFilter !== \"all\") && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    onClick={() => {\n                      setLogFilter(\"\");\n                      setLogLevelFilter(\"all\");\n                    }}\n                    className=\"text-xs\"\n                  >\n                    <X className=\"h-3 w-3 mr-1\" /> ŸÖÿ≥ÿ≠ ÿßŸÑŸÅŸÑÿßÿ™ÿ±\n                  </Button>\n                )}\n              </div>\n\n              <div className=\"text-sm text-muted-foreground flex justify-between\">\n                <span>ÿπÿ±ÿ∂ <span className=\"font-semibold text-foreground\">{deduplicatedLogs.length}</span> ŸÖŸÜ <span className=\"font-semibold text-foreground\">{eventLogs.length}</span> ÿ≥ÿ¨ŸÑ</span>\n                {autoRefresh && <span className=\"flex items-center gap-1\"><span className=\"h-2 w-2 bg-green-500 rounded-full animate-pulse\"></span> ÿ®ÿ´ ŸÖÿ®ÿßÿ¥ÿ±</span>}\n              </div>\n\n              <div ref={logsContainerRef} className=\"bg-slate-950 dark:bg-slate-950 border border-slate-700 dark:border-slate-700 rounded-lg font-mono text-xs overflow-y-auto max-h-[600px] md:max-h-[700px] p-4 space-y-1 shadow-lg\" style={{ backgroundColor: '#0f1729' }}>\n                {loadingLogs && eventLogs.length === 0 ? (\n                  <div className=\"flex justify-center p-8\">\n                    <Loader className=\"h-6 w-6 animate-spin text-blue-400\" />\n                  </div>\n                ) : deduplicatedLogs.length === 0 ? (\n                  <div className=\"text-center text-slate-500 py-8\">\n                    <ScrollText className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                    ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿ≠ÿØÿßÿ´ ÿ≠ÿßŸÑŸäÿßŸã\n                  </div>\n                ) : (\n                  <>\n                    {deduplicatedLogs.map((log: any, idx: number) => {\n                      const isError = log.errorType?.includes(\"ERROR\");\n                      const isWarn = log.errorType?.includes(\"WARN\");\n                      const isInfo = log.errorType?.includes(\"INFO\");\n                      return (\n                        <div\n                          key={`${log.component}-${log.function}-${idx}`}\n                          className=\"py-2 px-3 rounded transition-colors cursor-pointer hover:bg-slate-800/40 animate-in fade-in slide-in-from-bottom-1 duration-300 border border-transparent hover:border-slate-600/30 group\"\n                          onClick={() => setExpandedLog(expandedLog === idx ? null : idx)}\n                        >\n                          <div className=\"flex items-start gap-2 flex-wrap text-xs leading-relaxed\">\n                            <span className=\"text-slate-500 flex-shrink-0 select-none\">{new Date(log.timestamp).toLocaleTimeString('ar')}</span>\n                            <span className={`flex-shrink-0 font-semibold ${\n                              isError ? 'text-red-500' : isWarn ? 'text-yellow-500' : isInfo ? 'text-blue-400' : 'text-green-400'\n                            }`}>\n                              [{log.errorType}]\n                            </span>\n                            <span className=\"text-cyan-400 font-medium\">{log.component}</span>\n                            <span className=\"text-slate-500\">::</span>\n                            <span className=\"text-blue-300\">{log.function}</span>\n                            <span className={`flex-1 ${\n                              isError ? 'text-red-300' : isWarn ? 'text-yellow-300' : 'text-slate-300'\n                            } break-words`}>{log.errorMessage}</span>\n                          </div>\n                          \n                          {expandedLog === idx && (\n                            <div className=\"mt-3 ml-6 pl-3 border-l border-slate-700 space-y-2 text-xs animate-in fade-in duration-200\">\n                              {log.stackTrace && (\n                                <div>\n                                  <p className=\"font-semibold text-slate-300 mb-2\">Stack Trace:</p>\n                                  <pre className=\"bg-slate-900/60 border border-slate-700 p-3 rounded overflow-x-auto max-h-40 overflow-y-auto text-slate-400 leading-relaxed text-xs\" style={{ backgroundColor: '#0d1527' }}>\n                                    {log.stackTrace}\n                                  </pre>\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    className=\"mt-2 h-7 text-xs text-blue-400 hover:text-blue-300 hover:bg-slate-700/40 font-mono\"\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      copyToClipboard(log.stackTrace);\n                                    }}\n                                  >\n                                    <Copy className=\"h-3 w-3 mr-1\" /> ŸÜÿ≥ÿÆ\n                                  </Button>\n                                </div>\n                              )}\n                              {log.metadata && (\n                                <div>\n                                  <p className=\"font-semibold text-slate-300 mb-2\">ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:</p>\n                                  <pre className=\"bg-slate-900/60 border border-slate-700 p-3 rounded overflow-x-auto max-h-40 overflow-y-auto text-slate-400 leading-relaxed text-xs\" style={{ backgroundColor: '#0d1527' }}>\n                                    {JSON.stringify(log.metadata, null, 2)}\n                                  </pre>\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      );\n                    })}\n                    <div ref={logsEndRef} className=\"h-0\" />\n                  </>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":40886,"size_tokens":null},"README.md":{"content":"# Telegram Auto-Forward Bot ü§ñ\n\nŸÜÿ∏ÿßŸÖ ŸÖÿ™ŸÉÿßŸÖŸÑ ŸÑÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ Telegram ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä ŸàŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà.\n\n## ÿßŸÑŸÖŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ‚ú®\n\n### üöÄ ÿßŸÑÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä\n- ÿØÿπŸÖ ÿπÿØÿ© ŸÖÿµÿßÿØÿ± ŸàÿπÿØÿ© ÿ£ŸáÿØÿßŸÅ ŸÅŸä ŸÖŸáŸÖÿ© Ÿàÿßÿ≠ÿØÿ©\n- ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ŸÉÿ±ÿßÿ±\n- ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÖÿ™Ÿàÿßÿ≤Ÿä ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸáÿßŸÖ\n- ŸÜÿ∏ÿßŸÖ Workers Ÿà Queues ŸÖÿ™ŸÇÿØŸÖ\n\n### ü§ñ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä\n- ÿØÿπŸÖ ŸÖÿ™ÿπÿØÿØ ŸÑŸÑŸÖÿ≤ŸàÿØŸäŸÜ:\n  - OpenAI (GPT-4, GPT-3.5)\n  - Groq (Mixtral, LLaMA 2)\n  - Claude (Opus, Sonnet, Haiku)\n  - HuggingFace (LLaMA 2, Mixtral)\n- ŸÇŸàÿßÿπÿØ AI ŸÖŸÜŸÅÿµŸÑÿ© ŸÑŸÉŸÑ ŸÖŸáŸÖÿ©\n- ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµŸàÿµ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã\n- ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿ•ŸÑŸâ ŸÜÿµ + ÿ™ŸÑÿÆŸäÿµ\n\n### üé• ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà\n- ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿ•ŸÑŸâ ÿµŸàÿ™\n- ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÜÿµ ÿ®Ÿàÿßÿ≥ÿ∑ÿ© Whisper\n- ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä\n- ŸÖÿπÿßŸÑÿ¨ÿ© ŸÖÿ™Ÿàÿßÿ≤Ÿäÿ© ÿ®ÿØŸàŸÜ ÿ™ÿ£ÿÆŸäÿ±\n\n### üìä ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸàÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™\n- ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÖŸÅÿµŸÑÿ© ŸÑŸÉŸÑ ŸÖŸáŸÖÿ©\n- ÿ≥ÿ¨ŸÑ ÿ£ÿ≠ÿØÿßÿ´ ÿ¥ÿßŸÖŸÑ\n- ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑŸÖÿ™ŸÇÿØŸÖ\n- ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ŸàŸäÿ® ÿ≠ÿØŸäÿ´ÿ©\n\n### üîí ÿßŸÑÿ£ŸÖÿßŸÜ ŸàÿßŸÑÿ•ÿØÿßÿ±ÿ©\n- ŸÜÿ∏ÿßŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿ¢ŸÖŸÜ\n- ÿ•ÿØÿßÿ±ÿ© ŸÖÿ™ÿπÿØÿØÿ© ŸÑŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ\n- ŸäÿπŸÖŸÑ ŸÅŸÇÿ∑ ŸÅŸä ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™ ÿßŸÑÿÆÿßÿµÿ©\n- ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ\n\n## ÿßŸÑÿ®ŸÜŸäÿ© ÿßŸÑŸÖÿπŸÖÿßÿ±Ÿäÿ© üèóÔ∏è\n\n```\n‚îú‚îÄ‚îÄ telegram_bot/           # ÿ®Ÿàÿ™ Python ŸÖÿπ Pyrogram\n‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑÿ£ŸàÿßŸÖÿ±\n‚îÇ   ‚îú‚îÄ‚îÄ services/          # ÿÆÿØŸÖÿßÿ™ ÿßŸÑÿ®Ÿàÿ™\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_providers.py    # ŸÖÿ≤ŸàÿØŸä ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forwarding_engine.py # ŸÖÿ≠ÿ±ŸÉ ÿßŸÑÿ™Ÿàÿ¨ŸäŸá\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ video_processor.py   # ŸÖÿπÿßŸÑÿ¨ ÿßŸÑŸÅŸäÿØŸäŸà\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ queue_system.py     # ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ∑Ÿàÿßÿ®Ÿäÿ±\n‚îÇ   ‚îú‚îÄ‚îÄ utils/             # ÿ£ÿØŸàÿßÿ™ ŸÖÿ≥ÿßÿπÿØÿ©\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py        # ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ error_handler.py   # ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°\n‚îÇ   ‚îî‚îÄ‚îÄ main.py           # ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä\n‚îÇ\n‚îú‚îÄ‚îÄ server/                # API Backend ÿ®ŸÄ Node.js\n‚îÇ   ‚îú‚îÄ‚îÄ routes.ts         # API endpoints\n‚îÇ   ‚îî‚îÄ‚îÄ storage.ts        # ÿ•ÿØÿßÿ±ÿ© ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n‚îÇ\n‚îú‚îÄ‚îÄ client/                # Ÿàÿßÿ¨Ÿáÿ© ŸàŸäÿ® React\n‚îÇ   ‚îî‚îÄ‚îÄ src/\n‚îÇ       ‚îú‚îÄ‚îÄ pages/        # ÿµŸÅÿ≠ÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ\n‚îÇ       ‚îî‚îÄ‚îÄ components/   # ŸÖŸÉŸàŸÜÿßÿ™ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\n‚îÇ\n‚îî‚îÄ‚îÄ shared/               # ÿ£ŸÜŸàÿßÿπ ŸÖÿ¥ÿ™ÿ±ŸÉÿ©\n    ‚îî‚îÄ‚îÄ schema.ts         # Drizzle ORM schemas\n```\n\n## ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ŸàÿßŸÑÿ•ÿπÿØÿßÿØ üõ†Ô∏è\n\n### ÿßŸÑÿÆŸäÿßÿ± 1: Docker (ŸÖŸàÿµŸâ ÿ®Ÿá ŸÑŸÑÿ•ŸÜÿ™ÿßÿ¨) üê≥\n\n#### ÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™\n- Docker 20+\n- Docker Compose v2+\n\n#### ÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™\n\n1. **ÿßÿ≥ÿ™ŸÜÿ≥ÿßÿÆ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ**\n```bash\ngit clone <repository-url>\ncd botnexus\n```\n\n2. **ÿ•ÿπÿØÿßÿØ ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ©**\n```bash\ncp .env.example .env\n# ŸÇŸÖ ÿ®ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸÑŸÅ .env Ÿàÿ£ÿ∂ŸÅ ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿÆÿßÿµÿ© ÿ®ŸÉ\n```\n\n3. **ÿ®ŸÜÿßÿ° Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ**\n```bash\n# ÿ®ŸÜÿßÿ° Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Docker Compose\ndocker-compose up -d\n\n# ÿ£Ÿà ÿ®ŸÜÿßÿ° ÿßŸÑÿµŸàÿ±ÿ© ŸäÿØŸàŸäÿßŸã\ndocker build -t botnexus .\ndocker run -p 5000:5000 --env-file .env botnexus\n```\n\n4. **ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ**\n```bash\n# ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™\ndocker-compose logs -f app\n\n# ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµÿ≠ÿ©\ncurl http://localhost:5000/health\n```\n\n#### ÿßŸÑŸÜÿ¥ÿ± ÿπŸÑŸâ Northflank / Railway / Render\n\n1. ÿ£ŸÜÿ¥ÿ¶ ŸÖÿ¥ÿ±Ÿàÿπ ÿ¨ÿØŸäÿØ\n2. ÿßÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿ®ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ\n3. ÿ£ÿ∂ŸÅ ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ©:\n   - `DATABASE_URL`\n   - `BOT_TOKEN`\n   - `API_ID`\n   - `API_HASH`\n   - `SESSION_SECRET`\n   - ŸÖŸÅÿßÿ™Ÿäÿ≠ API ŸÑŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä (ÿ≠ÿ≥ÿ® ÿßŸÑÿ≠ÿßÿ¨ÿ©)\n4. ÿßŸÑŸÜÿ¥ÿ± ÿ≥Ÿäÿ™ŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Dockerfile\n\n---\n\n### ÿßŸÑÿÆŸäÿßÿ± 2: ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑŸÖÿ≠ŸÑŸä\n\n#### ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ\n\n- Node.js 20+ Ÿà npm\n- Python 3.11+\n- PostgreSQL\n- ffmpeg (ŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà)\n\n#### ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™\n\n**Node.js**\n```bash\nnpm install\n```\n\n**Python**\n```bash\ncd telegram_bot\npip install -r requirements.txt\n```\n\n### 3. ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ®Ÿäÿ¶ÿ©\n\nÿ£ŸÜÿ¥ÿ¶ ŸÖŸÑŸÅ `.env` ŸÅŸä ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä:\n\n```env\n# Database\nDATABASE_URL=postgresql://user:pass@localhost:5432/dbname\n\n# Telegram Bot (ŸÅŸä telegram_bot/.env)\nBOT_TOKEN=your_bot_token\nAPI_ID=your_api_id\nAPI_HASH=your_api_hash\nBOT_ADMIN_ID=your_telegram_id\n\n# AI Providers\nOPENAI_API_KEY=sk-...\nGROQ_API_KEY=gsk_...\nANTHROPIC_API_KEY=sk-ant-...\nHUGGINGFACE_API_KEY=hf_...\n```\n\n### 4. ÿ•ÿπÿØÿßÿØ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n\n```bash\n# ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¨ÿØÿßŸàŸÑ\nnpm run db:push\n\n# ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©\nnpm run db:seed\n```\n\n### 5. ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ\n\n#### ÿßŸÑŸàÿßÿ¨Ÿáÿ© Web Ÿà API\n```bash\nnpm run dev\n```\n\n#### ÿßŸÑÿ®Ÿàÿ™ Telegram\n```bash\ncd telegram_bot\npython main.py\n```\n\n## ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ üì±\n\n### ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ© ÿ™Ÿàÿ¨ŸäŸá\n\n1. ÿßŸÅÿ™ÿ≠ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ Web\n2. ÿßÿ∞Ÿáÿ® ÿ•ŸÑŸâ \"ÿßŸÑŸÖŸáÿßŸÖ\"\n3. ÿßŸÜŸÇÿ± \"ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ© ÿ¨ÿØŸäÿØÿ©\"\n4. ÿ≠ÿØÿØ ÿßŸÑŸÖÿµÿßÿØÿ± ŸàÿßŸÑÿ£ŸáÿØÿßŸÅ\n5. (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) ŸÅÿπŸëŸÑ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä\n6. (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) ŸÅÿπŸëŸÑ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà\n7. ÿßÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸáŸÖÿ©\n\n### ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸÜŸàÿßÿ™/ŸÖÿ¨ŸÖŸàÿπÿßÿ™\n\n1. ÿßÿ∞Ÿáÿ® ÿ•ŸÑŸâ \"ÿßŸÑŸÇŸÜŸàÿßÿ™\"\n2. ÿßŸÜŸÇÿ± \"ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸÜÿßÿ©\"\n3. ÿ£ÿØÿÆŸÑ ŸÖÿπÿ±ŸÅ ÿßŸÑŸÇŸÜÿßÿ© ÿ£Ÿà ÿ±ÿßÿ®ÿ∑Ÿáÿß\n4. ÿ≠ÿØÿØ ŸÜŸàÿπ ÿßŸÑŸÖÿµÿØÿ± (ŸÇŸÜÿßÿ©/ŸÖÿ¨ŸÖŸàÿπÿ©/ŸÖŸàŸÇÿπ)\n5. ÿßÿ≠ŸÅÿ∏\n\n### ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸàÿßÿπÿØ AI\n\n1. ÿßŸÅÿ™ÿ≠ ÿßŸÑŸÖŸáŸÖÿ©\n2. ÿßÿ∞Ÿáÿ® ÿ•ŸÑŸâ \"ŸÇŸàÿßÿπÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä\"\n3. ÿßŸÜŸÇÿ± \"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ©\"\n4. ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑŸÇÿßÿπÿØÿ© (ÿ™ŸÑÿÆŸäÿµ/ÿ™ÿ≠ŸàŸäŸÑ)\n5. ÿßŸÉÿ™ÿ® ÿßŸÑŸÄ prompt\n6. ÿßÿ≠ŸÅÿ∏\n\n## ÿ£ŸàÿßŸÖÿ± ÿßŸÑÿ®Ÿàÿ™ üéØ\n\n### ÿßŸÑÿ£ŸàÿßŸÖÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©\n- `/start` - ÿ®ÿØÿ° ÿßŸÑÿ®Ÿàÿ™\n- `/help` - ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©\n- `/stats` - ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™\n\n### ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸáÿßŸÖ\n- `/list_tasks` - ÿπÿ±ÿ∂ ÿßŸÑŸÖŸáÿßŸÖ\n- `/toggle_task [id]` - ÿ™ŸÅÿπŸäŸÑ/ÿ™ÿπÿ∑ŸäŸÑ ŸÖŸáŸÖÿ©\n- `/task_stats [id]` - ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÖŸáŸÖÿ©\n- `/delete_task [id]` - ÿ≠ÿ∞ŸÅ ŸÖŸáŸÖÿ©\n\n### ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ\n- `/add_admin [user_id]` - ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ¥ÿ±ŸÅ\n- `/list_admins` - ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ\n\n## API Endpoints üåê\n\n### Authentication\n- `POST /api/auth/login` - ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ\n- `POST /api/auth/register` - ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®\n\n### Tasks\n- `GET /api/tasks` - ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸáÿßŸÖ\n- `POST /api/tasks` - ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ©\n- `PATCH /api/tasks/:id` - ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸáŸÖÿ©\n- `DELETE /api/tasks/:id` - ÿ≠ÿ∞ŸÅ ŸÖŸáŸÖÿ©\n- `POST /api/tasks/:id/toggle` - ÿ™ŸÅÿπŸäŸÑ/ÿ™ÿπÿ∑ŸäŸÑ\n- `GET /api/tasks/:id/stats` - ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™\n- `GET /api/tasks/:id/logs` - ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™\n\n### Channels\n- `GET /api/channels` - ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸÜŸàÿßÿ™\n- `POST /api/channels` - ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸÜÿßÿ©\n- `PATCH /api/channels/:id` - ÿ™ÿ≠ÿØŸäÿ´ ŸÇŸÜÿßÿ©\n- `DELETE /api/channels/:id` - ÿ≠ÿ∞ŸÅ ŸÇŸÜÿßÿ©\n\n### AI\n- `GET /api/ai/providers` - ŸÖÿ≤ŸàÿØŸä AI\n- `GET /api/ai/models` - ŸÖŸàÿØŸäŸÑÿßÿ™ AI\n- `GET /api/tasks/:id/rules` - ŸÇŸàÿßÿπÿØ AI ŸÑŸÑŸÖŸáŸÖÿ©\n- `POST /api/tasks/:id/rules` - ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ©\n- `PATCH /api/rules/:id` - ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿπÿØÿ©\n- `DELETE /api/rules/:id` - ÿ≠ÿ∞ŸÅ ŸÇÿßÿπÿØÿ©\n\n## ÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸàÿßŸÑÿ£ÿØÿßÿ° ‚ö°\n\n### ŸÜÿ∏ÿßŸÖ Workers\n- ŸÖÿπÿßŸÑÿ¨ÿ© ŸÖÿ™Ÿàÿßÿ≤Ÿäÿ© ÿ®ŸÄ 10 workers\n- ŸÜÿ∏ÿßŸÖ ÿ£ŸàŸÑŸàŸäÿßÿ™ ŸÑŸÑŸÖŸáÿßŸÖ\n- ÿ•ÿπÿßÿØÿ© ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ŸÑŸÇÿßÿ¶Ÿäÿ© ÿπŸÜÿØ ÿßŸÑŸÅÿ¥ŸÑ\n\n### ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™\n- ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©\n- ÿ™ÿ¨ŸÜÿ® ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©\n- ÿ™ÿ≠ÿØŸäÿØ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ©\n\n### ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°\n- ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ¥ÿßŸÖŸÑ ŸÑŸÑÿ£ÿÆÿ∑ÿßÿ°\n- ÿ™ÿ™ÿ®ÿπ ŸÖŸÅÿµŸÑ ŸÑŸÉŸÑ Ÿàÿ∏ŸäŸÅÿ©\n- ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ™ŸÑŸÇÿßÿ¶Ÿäÿ©\n\n## ÿßŸÑŸÖÿ≥ÿßŸáŸÖÿ© ü§ù\n\nŸÜÿ±ÿ≠ÿ® ÿ®ÿßŸÑŸÖÿ≥ÿßŸáŸÖÿßÿ™! Ÿäÿ±ÿ¨Ÿâ:\n1. Fork ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ\n2. ÿ•ŸÜÿ¥ÿßÿ° branch ŸÑŸÑŸÖŸäÿ≤ÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©\n3. Commit ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™\n4. Push ÿ•ŸÑŸâ branch\n5. ŸÅÿ™ÿ≠ Pull Request\n\n## ÿßŸÑÿ™ÿ±ÿÆŸäÿµ üìÑ\n\nMIT License\n\n## ÿßŸÑÿØÿπŸÖ ÿßŸÑŸÅŸÜŸä üí¨\n\nŸÑŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸàÿßŸÑÿØÿπŸÖÿå Ÿäÿ±ÿ¨Ÿâ ŸÅÿ™ÿ≠ Issue ÿπŸÑŸâ GitHub.\n\n---\n\nÿµŸèŸÜÿπ ÿ®ŸÄ ‚ù§Ô∏è ŸÑŸÑŸÖÿ¨ÿ™ŸÖÿπ ÿßŸÑÿπÿ±ÿ®Ÿä\n","path":null,"size_bytes":8445,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-[9999] max-h-[min(var(--radix-select-content-available-height),400px)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-xl border-2 border-border bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 shadow-2xl data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      sideOffset={4}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1.5\",\n          position === \"popper\" &&\n            \"w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-pointer select-none items-center rounded-lg py-3 pl-2 pr-9 text-sm font-medium outline-none transition-all duration-150 text-zinc-800 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-800 focus:bg-zinc-100 dark:focus:bg-zinc-800 data-[state=checked]:bg-zinc-200 dark:data-[state=checked]:bg-zinc-700 data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2.5 flex h-4 w-4 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4 text-primary\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5980,"size_tokens":null},"replit.md":{"content":"# Overview\n\nBotNexus is an advanced Telegram bot automation system with AI integration. The application provides a comprehensive control panel for managing message forwarding tasks across multiple Telegram channels and sources. It features intelligent message processing using multiple AI providers (OpenAI, Anthropic Claude, Groq, HuggingFace), video-to-text transcription with summarization, and a modern web-based dashboard for system monitoring and configuration.\n\nThe system is built as a full-stack application with a Python-based Telegram bot backend (using Pyrogram) and a React/TypeScript web frontend, connected via a Node.js/Express API server with PostgreSQL database storage.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# System Architecture\n\n## Frontend Architecture\n\nThe client application is built using modern React with TypeScript and follows a component-based architecture:\n\n- **UI Framework**: React 18+ with Vite as the build tool and development server\n- **Styling**: Tailwind CSS with custom design system, featuring a dark theme with glassmorphic UI elements\n- **Component Library**: Radix UI primitives wrapped in custom components using shadcn/ui pattern\n- **Routing**: Wouter for lightweight client-side routing\n- **State Management**: TanStack Query (React Query) for server state management and caching\n- **Internationalization**: i18next with support for English and Arabic (RTL)\n- **Type Safety**: Full TypeScript coverage with path aliases for clean imports\n\n**Design Pattern**: The frontend follows a component-driven architecture with separation between UI components (`/components/ui`), page components (`/pages`), and shared utilities (`/lib`). The application uses a centralized API client pattern for backend communication.\n\n## Backend Architecture\n\n### Node.js API Server\n\n- **Framework**: Express.js with TypeScript\n- **ORM**: Drizzle ORM for type-safe database operations\n- **Database**: PostgreSQL with connection pooling via `@neondatabase/serverless`\n- **Authentication**: Session-based auth with bcrypt for password hashing\n- **API Design**: RESTful endpoints organized by resource type\n\n**Storage Layer**: The application uses a centralized storage module (`server/storage.ts`) that provides a clean interface for all database operations, abstracting Drizzle queries behind a typed API.\n\n### Python Telegram Bot\n\n- **Framework**: Pyrogram for Telegram Bot API interaction\n- **Architecture**: Event-driven with handler-based command processing\n- **Concurrency**: Async/await pattern with asyncio for parallel task execution\n- **Queue System**: Custom worker pool implementation for parallel message processing\n- **Error Handling**: Comprehensive error logging system with component-level tracking\n\n**Key Services**:\n- **Forwarding Engine**: Core message routing with deduplication and caching\n- **AI Providers**: Unified interface for multiple LLM providers with model-specific implementations\n- **Video Processor**: FFmpeg-based video-to-audio extraction with Whisper transcription\n- **Queue Manager**: Worker pool system for parallel job processing\n\n**Design Pattern**: The bot uses a modular service-oriented architecture where each major feature (AI, video processing, forwarding) is encapsulated in its own service module with clear interfaces.\n\n## Data Architecture\n\n### Database Schema\n\nThe PostgreSQL schema (defined in `shared/schema.ts`) uses Drizzle ORM with the following core tables:\n\n- **users**: Web dashboard authentication and authorization\n- **admins**: Telegram bot administrator management (linked by telegram_id)\n- **channels**: Source and target channel definitions with type and metadata\n- **forwarding_tasks**: Task configurations with source/target mappings\n- **ai_providers**: AI service provider configurations and API keys\n- **ai_models**: Available models per provider\n- **ai_rules**: Per-task AI processing rules and prompts\n- **task_logs**: Execution history and event tracking\n- **task_stats**: Aggregated performance metrics\n\n**Design Decisions**:\n- JSONB columns for flexible metadata and configuration storage\n- Separate tables for AI providers and models to support multi-provider architecture\n- Task-to-channel relationships stored as integer arrays for simplicity\n- Timestamp tracking on all major entities for auditing\n\n## Integration Architecture\n\n### Frontend-Backend Communication\n\nThe system uses a typed API client (`client/src/lib/api.ts`) that wraps fetch calls with:\n- Centralized error handling\n- Type-safe request/response interfaces\n- Automatic JSON serialization\n- Cookie-based session management\n\n### Bot-Database Communication\n\nThe Python bot connects directly to PostgreSQL using asyncpg for:\n- High-performance async database operations\n- Connection pooling for concurrent task execution\n- Direct SQL queries for complex analytics\n\n**Trade-off**: Direct database access from the bot provides better performance but creates tight coupling. An alternative would be routing bot database operations through the Node.js API, which would improve separation of concerns at the cost of added latency.\n\n## AI Integration\n\nThe system supports multiple AI providers through a unified interface pattern:\n\n- **Provider Abstraction**: Base `AIProvider` class with provider-specific implementations\n- **Model Configuration**: Database-driven model availability and configuration\n- **Prompt Management**: Task-specific AI rules with customizable prompts and parameters\n- **Fallback Strategy**: Provider selection allows for failover between services\n\n**Design Choice**: Each AI provider has its own implementation class inheriting from a common base, allowing for provider-specific features while maintaining a consistent interface for the forwarding engine.\n\n## Video Processing Pipeline\n\nVideo messages flow through a multi-stage pipeline:\n\n1. Download from Telegram\n2. Audio extraction using FFmpeg\n3. Transcription via Whisper API\n4. Text summarization using configured AI provider\n5. Result forwarding to target channels\n\n**Architecture Decision**: Video processing runs asynchronously in the queue system to avoid blocking message forwarding, with temporary file cleanup after processing.\n\n## Bug Fixes (Dec 2024)\n\n### Text Summarization Function Fixed\n- **Issue**: The text summarization feature was not working even when enabled in the control panel\n- **Root Cause**: The `apply_summarization_rule` method was missing from the AIRuleEngine class\n- **Solution**: Implemented the missing `apply_summarization_rule` method that truncates text to specified max length while preserving word boundaries\n- **Date Fixed**: 2025-12-07\n- **File Modified**: `telegram_bot/services/ai_rule_engine.py`\n\n### Audio Processing Not Working (MP3/Voice Files)\n- **Issue**: MP3 and voice audio files were:\n  1. Not being summarized (full transcript was used instead)\n  2. Telegraph links weren't showing in captions\n  3. AI was not applying summarization rules\n- **Root Causes**: \n  1. **CRITICAL BUG**: Audio processor used `result.text` but `PipelineResult` has `final_text` - AI summary was never used!\n  2. Pre-truncation summarization rule was just truncating, not summarizing\n  3. Summarization rules lacked 'prompt' field so they weren't included in AI prompt instructions\n  4. Telegraph HTML formatting had extra whitespace causing creation to fail\n  5. Audio processor wasn't using Groq fallback when no provider configured\n- **Solution Applied**:\n  1. **CRITICAL FIX** in `telegram_bot/services/audio_processor.py`:\n     - Changed `result.text` to `result.final_text` (line 192-193) - AI summary now used!\n  2. Modified `telegram_bot/services/ai_pipeline.py` to:\n     - Skip pre-truncation summarization (let AI do full summarization)\n     - Build proper AI instructions from summarization rule configs\n     - Include rule maxLength and style in AI prompt\n  3. Modified `telegram_bot/services/audio_processor.py` to:\n     - Use Groq as fallback provider when none is configured\n     - Pass task_config for rule application\n     - Fix Telegraph HTML formatting\n  4. Changed `telegram_bot/services/forwarding_engine.py` to always process audio (removed flag dependency)\n- **Features Now Working**:\n  ‚úÖ Full AI-generated audio summaries (not just transcripts)\n  ‚úÖ Summarization rules applied via AI prompt\n  ‚úÖ Telegraph page with full transcript + summary\n  ‚úÖ Telegraph link in caption: \"ÿßŸÇÿ±ÿ£ ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ ÿßŸÑŸÖŸèŸÅÿ±Ÿëÿ∫\"\n  ‚úÖ Groq fallback when no provider configured\n  ‚úÖ Proper HTML formatting for Telegraph content\n- **Date Fixed**: 2025-12-07\n- **Files Modified**: \n  - `telegram_bot/services/audio_processor.py` (line 192: `result.text` ‚Üí `result.final_text`)\n  - `telegram_bot/services/ai_pipeline.py` (lines 144-145: skip truncation, 332-349: build proper prompts from rules)\n  - `telegram_bot/services/forwarding_engine.py` (line 365: removed `audio_processing and` check)\n\n## Link Processing Pipeline (Enhanced Dec 2024)\n\nLink processing for social media videos (YouTube, TikTok, Instagram, etc.):\n\n1. **Download**: yt-dlp with format fallback mechanism (4 quality levels)\n2. **Audio Extraction**: FFmpeg for MP3 extraction\n3. **Transcription**: Groq Whisper API (whisper-large-v3-turbo)\n4. **Summarization**: AI provider with video-specific rules\n5. **Telegraph**: Create page with full transcript\n6. **Video Send**: With thumbnail, duration, and metadata\n\n**Recent Improvements (Dec 2024)**:\n- Format fallback: Prioritizes single-file formats with embedded audio (`acodec!=none`)\n- Thumbnail generation: Auto-generate preview image from video\n- Video metadata: Duration, width, height properly extracted via ffprobe\n- Rule separation: Video rules are now separate from text summarization rules\n- Quality selection UI: Improved visual design with icons and size estimates\n\n# External Dependencies\n\n## Third-Party Services\n\n### AI Providers\n- **OpenAI**: GPT-4, GPT-3.5 models for text generation and summarization\n- **Anthropic (Claude)**: Opus, Sonnet, Haiku models as alternative LLM providers\n- **Groq**: Fast inference for Mixtral and LLaMA models\n- **HuggingFace**: Open-source model hosting and inference API\n\n### Media Processing\n- **FFmpeg**: Video-to-audio conversion and media manipulation (system dependency)\n- **OpenAI Whisper**: Speech-to-text transcription for video content\n\n### Telegram Integration\n- **Telegram Bot API**: Message sending, webhook handling\n- **Telegram MTProto API**: Advanced client features via Pyrogram\n- **Bot Token**: Required from @BotFather\n- **API ID/Hash**: Required from my.telegram.org for Pyrogram\n\n## Database & Infrastructure\n\n- **PostgreSQL**: Primary data store (version 13+)\n- **Neon Database**: Serverless PostgreSQL provider (via @neondatabase/serverless)\n\n**Database Choice Rationale**: PostgreSQL provides JSONB support for flexible schema elements, strong ACID guarantees for task coordination, and excellent performance for the query patterns used in dashboard analytics.\n\n## Frontend Libraries\n\n### UI Components\n- **Radix UI**: Accessible primitive components for complex UI patterns\n- **Tailwind CSS**: Utility-first CSS framework\n- **Framer Motion**: Animation library for smooth transitions\n- **Recharts**: Chart library for analytics visualization\n- **Lucide React**: Icon library\n\n### Development Tools\n- **Vite**: Fast development server and build tool\n- **TypeScript**: Type safety across the codebase\n- **Drizzle Kit**: Database migration and schema management\n\n## Build & Deployment\n\n- **esbuild**: Server bundle compilation for production\n- **tsx**: TypeScript execution for development\n- **Replit**: Hosting platform with environment variable management\n\n**Build Strategy**: The application uses a custom build script that separately bundles the client (via Vite) and server (via esbuild), with selective dependency bundling to optimize cold start performance.","path":null,"size_bytes":11882,"size_tokens":null},"telegram_bot/config/__init__.py":{"content":"# Config package\n","path":null,"size_bytes":17,"size_tokens":null},"telegram_bot/services/telegraph_service.py":{"content":"\"\"\"\nTelegraph Service - Creates Telegraph pages with comprehensive logging\n\"\"\"\nfrom typing import Optional, List, Dict, Any, Callable\nfrom telegraph import Telegraph\nimport os\nimport traceback\nimport asyncio\nfrom datetime import datetime\n\nclass TelegraphManager:\n    def __init__(self):\n        print(\"\\n\" + \"=\"*100)\n        print(\"[üì° TELEGRAPH] üöÄ Initializing Telegraph Service...\")\n        print(\"=\"*100)\n        self.telegraph = Telegraph()\n        try:\n            acc = self.telegraph.create_account(short_name=\"NewsBot\")\n            token = acc.get('access_token', 'unknown')[:20]\n            print(f\"[üì° TELEGRAPH] ‚úÖ Account ready: {token}...\")\n        except Exception as e:\n            print(f\"[üì° TELEGRAPH] ‚ö†Ô∏è  Account ready\")\n        print(\"=\"*100 + \"\\n\")\n    \n    def _extract_url_from_response(self, resp: Any) -> Optional[str]:\n        \"\"\"Helper function to safely extract URL/src from upload response\"\"\"\n        try:\n            # Log response details\n            print(f\"    [EXTRACT] resp type: {type(resp).__name__}\")\n            \n            # Handle string response (direct URL or path)\n            if isinstance(resp, str):\n                print(f\"    [EXTRACT] String response: {resp[:40]}\")\n                return resp if (resp.startswith('/') or resp.startswith('http')) else None\n            \n            # Handle list response - check type first!\n            if isinstance(resp, (list, tuple)):\n                print(f\"    [EXTRACT] List/tuple response, len={len(resp)}\")\n                if len(resp) == 0:\n                    return None\n                item = resp[0]\n                print(f\"    [EXTRACT] First item type: {type(item).__name__}\")\n                \n                # First check if it's a string\n                if isinstance(item, str):\n                    print(f\"    [EXTRACT] String item: {item[:40]}\")\n                    return item\n                \n                # Try to get 'src' using safe method\n                try:\n                    if hasattr(item, 'get') and callable(getattr(item, 'get')):\n                        src = item.get('src')\n                        print(f\"    [EXTRACT] Got src via .get(): {src}\")\n                        return src\n                except Exception as e:\n                    print(f\"    [EXTRACT] .get() failed: {type(e).__name__}: {str(e)[:40]}\")\n                \n                return None\n            \n            # Handle dict response\n            if isinstance(resp, dict):\n                print(f\"    [EXTRACT] Dict response, has src={('src' in resp)}\")\n                return resp.get('src')\n            \n            print(f\"    [EXTRACT] Unknown response type, returning None\")\n            return None\n        except Exception as e:\n            import traceback\n            print(f\"  [‚ö†Ô∏è] Response parse error ({type(e).__name__}): {str(e)}\")\n            print(f\"    Full traceback: {traceback.format_exc()[:200]}\")\n            return None\n    \n    async def _upload_media(self, file_path: str, media_type: str = \"photo\") -> Optional[str]:\n        \"\"\"Upload a media file to Telegraph and return the URL using direct HTTP request\"\"\"\n        import requests\n        \n        try:\n            print(f\"  [{media_type.upper()}] Uploading file: {file_path}\")\n            \n            if not os.path.exists(file_path):\n                print(f\"  [{media_type.upper()}] ‚ùå File does not exist\")\n                return None\n            \n            file_size = os.path.getsize(file_path)\n            print(f\"  [{media_type.upper()}] File size: {file_size} bytes\")\n            \n            # Use direct HTTP upload to Telegraph API\n            with open(file_path, 'rb') as f:\n                response = requests.post(\n                    'https://telegra.ph/upload',\n                    files={'file': ('file', f, 'image/jpeg')}\n                )\n            \n            print(f\"  [{media_type.upper()}] HTTP Status: {response.status_code}\")\n            print(f\"  [{media_type.upper()}] Response text: {response.text[:200]}\")\n            \n            if response.status_code != 200:\n                print(f\"  [{media_type.upper()}] ‚ùå HTTP error: {response.status_code}\")\n                return None\n            \n            # Parse JSON response\n            try:\n                resp = response.json()\n                print(f\"  [{media_type.upper()}] JSON response: {resp}\")\n            except Exception as json_err:\n                print(f\"  [{media_type.upper()}] ‚ùå JSON parse error: {json_err}\")\n                return None\n            \n            # Handle different response formats\n            src = None\n            \n            # Check for error\n            if isinstance(resp, dict) and 'error' in resp:\n                print(f\"  [{media_type.upper()}] ‚ùå API error: {resp['error']}\")\n                return None\n            \n            # If response is a list\n            if isinstance(resp, list) and len(resp) > 0:\n                first_item = resp[0]\n                print(f\"  [{media_type.upper()}] First item: {first_item}\")\n                \n                if isinstance(first_item, dict) and 'src' in first_item:\n                    src = first_item['src']\n                elif isinstance(first_item, str):\n                    src = first_item\n            elif isinstance(resp, dict) and 'src' in resp:\n                src = resp['src']\n            elif isinstance(resp, str):\n                src = resp\n            \n            print(f\"  [{media_type.upper()}] Extracted src: {src}\")\n            \n            if src and isinstance(src, str):\n                url = f\"https://telegra.ph{src}\" if src.startswith('/') else src\n                print(f\"  [{media_type.upper()}] ‚úÖ Final URL: {url}\")\n                return url\n            else:\n                print(f\"  [{media_type.upper()}] ‚ö†Ô∏è  No valid URL extracted\")\n                return None\n        except Exception as e:\n            import traceback\n            print(f\"  [{media_type.upper()}] ‚ùå Upload error: {type(e).__name__}: {str(e)}\")\n            print(f\"  [{media_type.upper()}] Full traceback:\\n{traceback.format_exc()}\")\n            return None\n    \n    async def create_original_content_page(\n        self,\n        original_text: str,\n        photos_file_ids: Optional[List[str]] = None,\n        videos_info: Optional[List[Dict[str, Any]]] = None,\n        page_title: str = \"ÿßŸÑÿÆÿ®ÿ± ÿßŸÑÿ£ÿµŸÑŸä\",\n        download_func: Optional[Callable] = None\n    ) -> Optional[str]:\n        \"\"\"Create Telegraph page with original content and try to attach media\"\"\"\n        timestamp = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n        print(\"\\n\" + \"=\"*100)\n        print(f\"[üì± TELEGRAPH-PAGE] [{timestamp}] Creating Telegraph page\")\n        print(f\"[üìã PARAMS] photos={len(photos_file_ids) if photos_file_ids else 0}, videos={len(videos_info) if videos_info else 0}, has_download_func={download_func is not None}\")\n        print(\"=\"*100)\n        \n        try:\n            # 1. Validate text\n            print(f\"\\n[üì± PAGE-1Ô∏è‚É£] TEXT VALIDATION\")\n            if not original_text or len(original_text) < 10:\n                print(f\"  ‚ùå Text invalid (length: {len(original_text)})\")\n                return None\n            print(f\"  ‚úÖ Text valid: {len(original_text)} chars\")\n            \n            # ‚úÖ CHECK IF TEXT NEEDS SPLITTING (Telegraph has 64KB limit)\n            text_bytes = len(original_text.encode('utf-8'))\n            if text_bytes > 40000:\n                print(f\"  ‚ö†Ô∏è Text is large ({text_bytes} bytes), will split into multiple pages\")\n                chunks = self._split_text_into_chunks(original_text, max_bytes=35000)\n                print(f\"  üìÑ Split into {len(chunks)} pages\")\n                \n                # Create first page with all chunks\n                all_urls = []\n                for i, chunk in enumerate(chunks):\n                    chunk_title = f\"{page_title} ({i+1}/{len(chunks)})\"\n                    chunk_url = await self._create_single_page(chunk, chunk_title, photos_file_ids if i == 0 else None, videos_info if i == 0 else None, download_func)\n                    if chunk_url:\n                        all_urls.append(chunk_url)\n                        # Add navigation to next page\n                        if i < len(chunks) - 1:\n                            print(f\"  ‚úÖ Page {i+1} created: {chunk_url}\")\n                \n                if all_urls:\n                    print(f\"  ‚úÖ All {len(all_urls)} pages created successfully\")\n                    return all_urls[0]  # Return first page URL\n                else:\n                    return None\n            \n            # Text is small enough, create single page\n            return await self._create_single_page(original_text, page_title, photos_file_ids, videos_info, download_func)\n        \n        except Exception as e:\n            print(f\"\\n[üì± PAGE-‚ùå] CRITICAL ERROR\")\n            print(f\"  Type: {type(e).__name__}\")\n            print(f\"  Message: {str(e)[:100]}\")\n            for line in traceback.format_exc().split('\\n')[:3]:\n                if line.strip():\n                    print(f\"  {line}\")\n            print(\"=\"*100 + \"\\n\")\n            return None\n    \n    async def _create_single_page(\n        self,\n        page_text: str,\n        page_title: str,\n        photos_file_ids: Optional[List[str]] = None,\n        videos_info: Optional[List[Dict[str, Any]]] = None,\n        download_func: Optional[Callable] = None\n    ) -> Optional[str]:\n        \"\"\"Create a single Telegraph page with text and optional media\"\"\"\n        try:\n            # 2. Build HTML with text only first\n            print(f\"\\n[üì± PAGE-2Ô∏è‚É£] BUILDING HTML\")\n            html_parts = []\n            html_parts.append(f\"<p><strong>{page_title}</strong></p>\")\n            text_html = self._text_to_html(page_text)\n            html_parts.append(text_html)\n            print(f\"  ‚úÖ HTML text added, current size: {len(''.join(html_parts))} bytes\")\n            \n            # 3. Try to add photos\n            print(f\"\\n[üì∑ PHOTOS-CHECK] photos_file_ids={photos_file_ids}, download_func={download_func is not None}\")\n            if photos_file_ids and download_func:\n                print(f\"\\n[üì∑ PHOTOS] Processing {len(photos_file_ids)} photo(s)\")\n                photos_added = 0\n                for idx, photo_id in enumerate(photos_file_ids, 1):\n                    try:\n                        print(f\"  [üì∑ {idx}] Downloading photo_id: {photo_id[:20] if isinstance(photo_id, str) else photo_id}...\")\n                        file_path = await asyncio.wait_for(download_func(photo_id), timeout=15)\n                        if file_path and os.path.exists(file_path):\n                            size = os.path.getsize(file_path)\n                            print(f\"  [üì∑ {idx}] ‚úÖ Downloaded {size} bytes ‚Üí {file_path}\")\n                            # Try direct upload\n                            try:\n                                url = await self._upload_media(file_path, \"photo\")\n                                if url:\n                                    html_parts.append(f'<p><img src=\"{url}\" style=\"max-width:100%\"></p>')\n                                    photos_added += 1\n                                    print(f\"  [üì∑ {idx}] ‚úÖ Uploaded to Telegraph, HTML size now: {len(''.join(html_parts))}\")\n                                else:\n                                    print(f\"  [üì∑ {idx}] ‚ö†Ô∏è  Upload returned None/empty URL\")\n                            except Exception as e:\n                                print(f\"  [üì∑ {idx}] ‚ùå Upload exception: {type(e).__name__}: {str(e)[:60]}\")\n                            # Cleanup\n                            try:\n                                os.remove(file_path)\n                            except:\n                                pass\n                        else:\n                            print(f\"  [üì∑ {idx}] ‚ùå Download failed or file not found: {file_path}\")\n                    except asyncio.TimeoutError:\n                        print(f\"  [üì∑ {idx}] ‚ùå Download timeout (15s)\")\n                    except Exception as e:\n                        print(f\"  [üì∑ {idx}] ‚ùå Error: {type(e).__name__}: {str(e)[:50]}\")\n                print(f\"  [üì∑ SUMMARY] Added {photos_added}/{len(photos_file_ids)} photos\")\n            elif not photos_file_ids:\n                print(f\"  [üì∑ SKIP] photos_file_ids is None/empty\")\n            elif not download_func:\n                print(f\"  [üì∑ SKIP] download_func is None\")\n            \n            # 4. Try to add videos\n            print(f\"\\n[üé• VIDEOS-CHECK] videos_info={len(videos_info) if videos_info else 0}, download_func={download_func is not None}\")\n            if videos_info and download_func:\n                print(f\"\\n[üé• VIDEOS] Processing {len(videos_info)} video(s)\")\n                videos_added = 0\n                for idx, vinfo in enumerate(videos_info, 1):\n                    try:\n                        if not isinstance(vinfo, dict):\n                            print(f\"  [üé• {idx}] ‚ö†Ô∏è  vinfo is not dict: {type(vinfo).__name__}\")\n                            continue\n                        video_id = vinfo.get('file_id')\n                        if not video_id:\n                            print(f\"  [üé• {idx}] ‚ö†Ô∏è  No file_id in vinfo\")\n                            continue\n                        print(f\"  [üé• {idx}] Downloading video_id: {video_id[:20] if isinstance(video_id, str) else video_id}...\")\n                        file_path = await asyncio.wait_for(download_func(video_id), timeout=30)\n                        if file_path and os.path.exists(file_path):\n                            size = os.path.getsize(file_path)\n                            print(f\"  [üé• {idx}] ‚úÖ Downloaded {size} bytes\")\n                            try:\n                                url = await self._upload_media(file_path, \"video\")\n                                if url:\n                                    title = vinfo.get('title', f'ŸÅŸäÿØŸäŸà {idx}')\n                                    html_parts.append(f'<p><a href=\"{url}\">‚ñ∂Ô∏è {title}</a></p>')\n                                    videos_added += 1\n                                    print(f\"  [üé• {idx}] ‚úÖ Uploaded to Telegraph, HTML size now: {len(''.join(html_parts))}\")\n                                else:\n                                    print(f\"  [üé• {idx}] ‚ö†Ô∏è  Upload returned None/empty URL\")\n                            except Exception as e:\n                                print(f\"  [üé• {idx}] ‚ùå Upload exception: {type(e).__name__}: {str(e)[:60]}\")\n                            try:\n                                os.remove(file_path)\n                            except:\n                                pass\n                        else:\n                            print(f\"  [üé• {idx}] ‚ùå Download failed: {file_path}\")\n                    except asyncio.TimeoutError:\n                        print(f\"  [üé• {idx}] ‚ùå Download timeout (30s)\")\n                    except Exception as e:\n                        print(f\"  [üé• {idx}] ‚ùå Error: {type(e).__name__}: {str(e)[:50]}\")\n                print(f\"  [üé• SUMMARY] Added {videos_added}/{len(videos_info)} videos\")\n            elif not videos_info:\n                print(f\"  [üé• SKIP] videos_info is None/empty\")\n            elif not download_func:\n                print(f\"  [üé• SKIP] download_func is None\")\n            \n            # 5. Add footer\n            html_parts.append(\"<hr><p><em>üì∞ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ∞ŸÉŸä</em></p>\")\n            html_content = \"\".join(html_parts)\n            \n            # 6. Create page\n            print(f\"\\n[üì± PAGE-3Ô∏è‚É£] CREATING ON TELEGRAPH\")\n            print(f\"  Title: {page_title}\")\n            print(f\"  Size: {len(html_content)} bytes\")\n            \n            response = self.telegraph.create_page(\n                title=page_title[:100],\n                html_content=html_content,\n                return_content=True\n            )\n            \n            # Safe response handling\n            path = None\n            if isinstance(response, dict):\n                path = response.get('path')\n            \n            if path:\n                page_url = f\"https://telegra.ph/{path}\"\n                print(f\"\\n[üì± PAGE-‚úÖ] SUCCESS\")\n                print(f\"  URL: {page_url}\")\n                media_info = \"\"\n                if photos_file_ids:\n                    media_info += f\"photos={len(photos_file_ids)} \"\n                if videos_info:\n                    media_info += f\"videos={len(videos_info)}\"\n                print(f\"  Content: {len(page_text)} chars + media ({media_info})\")\n                print(\"=\"*100 + \"\\n\")\n                return page_url\n            else:\n                print(f\"\\n[üì± PAGE-‚ùå] Response invalid\")\n                print(f\"  Response: {response}\")\n                return None\n        \n        except Exception as e:\n            print(f\"\\n[üì± PAGE-‚ùå] ERROR in _create_single_page\")\n            print(f\"  Type: {type(e).__name__}\")\n            print(f\"  Message: {str(e)[:100]}\")\n            for line in traceback.format_exc().split('\\n')[:3]:\n                if line.strip():\n                    print(f\"  {line}\")\n            print(\"=\"*100 + \"\\n\")\n            return None\n\n    async def create_page(\n        self,\n        title: str,\n        content: str,\n        description: str = \"\"\n    ) -> Optional[str]:\n        \"\"\"Create a Telegraph page with content (alias for create_text_page)\"\"\"\n        return await self.create_text_page(title, content, description)\n    \n    def _split_text_into_chunks(self, text: str, max_bytes: int = 50000) -> List[str]:\n        \"\"\"\n        Split text into chunks that fit within Telegraph's size limit.\n        Telegraph has a 64KB limit, but we use 50KB to be safe with HTML overhead.\n        For Arabic text (3 bytes per char in UTF-8), this is roughly 16,000 chars per chunk.\n        \"\"\"\n        chunks = []\n        current_chunk = \"\"\n        \n        paragraphs = text.split(\"\\n\")\n        \n        for para in paragraphs:\n            test_chunk = current_chunk + \"\\n\" + para if current_chunk else para\n            if len(test_chunk.encode('utf-8')) > max_bytes:\n                if current_chunk:\n                    chunks.append(current_chunk)\n                if len(para.encode('utf-8')) > max_bytes:\n                    words = para.split(\" \")\n                    current_chunk = \"\"\n                    for word in words:\n                        test_word = current_chunk + \" \" + word if current_chunk else word\n                        if len(test_word.encode('utf-8')) > max_bytes:\n                            if current_chunk:\n                                chunks.append(current_chunk)\n                            current_chunk = word\n                        else:\n                            current_chunk = test_word\n                else:\n                    current_chunk = para\n            else:\n                current_chunk = test_chunk\n        \n        if current_chunk:\n            chunks.append(current_chunk)\n        \n        return chunks if chunks else [text]\n\n    def _text_to_html(self, text: str) -> str:\n        \"\"\"Convert plain text to proper HTML with paragraph tags\"\"\"\n        if not text:\n            return \"\"\n        \n        # Split into paragraphs (by double newlines or paragraph breaks)\n        paragraphs = [p.strip() for p in text.split('\\n') if p.strip()]\n        \n        # Wrap each paragraph in <p> tags\n        html_parts = []\n        for para in paragraphs:\n            # Escape any special HTML characters in the text\n            para = para.replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;')\n            # Replace remaining single newlines with <br> if there are any\n            para_html = para.replace('\\n', '<br>')\n            html_parts.append(f\"<p>{para_html}</p>\")\n        \n        return \"\".join(html_parts)\n    \n    async def create_text_page(\n        self,\n        title: str,\n        content: str,\n        description: str = \"\"\n    ) -> Optional[str]:\n        \"\"\"Create a simple Telegraph page with text content, splitting into multiple pages if needed\"\"\"\n        try:\n            print(f\"\\n[üì± TELEGRAPH-TEXT] Creating text page: {title[:50]}\")\n            print(f\"  üìä Content size: {len(content)} chars, {len(content.encode('utf-8'))} bytes\")\n            \n            if not content or len(content) < 10:\n                print(f\"  ‚ùå Content too short: {len(content)} chars\")\n                return None\n            \n            content_bytes = len(content.encode('utf-8'))\n            max_safe_bytes = 50000\n            \n            if content_bytes <= max_safe_bytes:\n                html_content = self._text_to_html(content)\n                \n                if description:\n                    html_content = f\"<p><em>{description}</em></p><hr>\" + html_content\n                \n                response = self.telegraph.create_page(\n                    title=title[:100],\n                    html_content=html_content,\n                    author_name=\"ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ∞ŸÉŸä\"\n                )\n                \n                if response and 'url' in response:\n                    url = response['url']\n                    print(f\"  ‚úÖ Telegraph page created: {url}\")\n                    return url\n                else:\n                    print(f\"  ‚ùå No URL in response: {response}\")\n                    return None\n            \n            print(f\"  ‚ö†Ô∏è Content too large ({content_bytes} bytes), splitting into multiple pages...\")\n            chunks = self._split_text_into_chunks(content, max_safe_bytes - 5000)\n            print(f\"  üìÑ Split into {len(chunks)} parts\")\n            \n            page_urls = []\n            for i, chunk in enumerate(chunks):\n                part_num = i + 1\n                total_parts = len(chunks)\n                part_title = f\"{title} (ÿ¨ÿ≤ÿ° {part_num}/{total_parts})\"\n                \n                html_content = self._text_to_html(chunk)\n                \n                if i == 0 and description:\n                    html_content = f\"<p><em>{description}</em></p><hr>\" + html_content\n                \n                html_content = f\"<p><strong>üìÑ ÿßŸÑÿ¨ÿ≤ÿ° {part_num} ŸÖŸÜ {total_parts}</strong></p><hr>\" + html_content\n                \n                try:\n                    response = self.telegraph.create_page(\n                        title=part_title[:100],\n                        html_content=html_content,\n                        author_name=\"ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ∞ŸÉŸä\"\n                    )\n                    \n                    if response and 'url' in response:\n                        page_urls.append(response['url'])\n                        print(f\"  ‚úÖ Part {part_num}/{total_parts} created: {response['url']}\")\n                    else:\n                        print(f\"  ‚ùå Part {part_num} failed: no URL in response\")\n                except Exception as e:\n                    print(f\"  ‚ùå Part {part_num} error: {str(e)}\")\n            \n            if not page_urls:\n                print(f\"  ‚ùå Failed to create any pages\")\n                return None\n            \n            if len(page_urls) > 1:\n                print(f\"  üîó Creating index page with links to all parts...\")\n                index_html = f\"<p><strong>üìö ŸÅŸáÿ±ÿ≥ ÿßŸÑÿ£ÿ¨ÿ≤ÿßÿ° ({len(page_urls)} ÿ£ÿ¨ÿ≤ÿßÿ°)</strong></p><hr>\"\n                if description:\n                    index_html += f\"<p><em>{description}</em></p>\"\n                for i, url in enumerate(page_urls):\n                    index_html += f'<p>üìÑ <a href=\"{url}\">ÿßŸÑÿ¨ÿ≤ÿ° {i+1} ŸÖŸÜ {len(page_urls)}</a></p>'\n                \n                preview_text = self._text_to_html(content[:1000])\n                index_html += f\"<hr><p><strong>ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ:</strong></p>{preview_text}\"\n                \n                try:\n                    index_response = self.telegraph.create_page(\n                        title=f\"{title} - ÿßŸÑŸÅŸáÿ±ÿ≥\",\n                        html_content=index_html,\n                        author_name=\"ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ∞ŸÉŸä\"\n                    )\n                    \n                    if index_response and 'url' in index_response:\n                        index_url = index_response['url']\n                        print(f\"  ‚úÖ Index page created: {index_url}\")\n                        return index_url\n                except Exception as e:\n                    print(f\"  ‚ö†Ô∏è Index page error: {str(e)}, returning first page URL\")\n            \n            print(f\"  ‚úÖ Returning first page URL: {page_urls[0]}\")\n            return page_urls[0]\n                \n        except Exception as e:\n            print(f\"  ‚ùå Error creating Telegraph page: {str(e)}\")\n            import traceback\n            print(f\"  Traceback: {traceback.format_exc()[:500]}\")\n            return None\n\ntelegraph_manager = TelegraphManager()\n","path":null,"size_bytes":25037,"size_tokens":null},"INTEGRATION_GUIDE.md":{"content":"# ÿØŸÑŸäŸÑ ÿ™ŸÉÿßŸÖŸÑ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ŸÖÿπ API üîå\n\n## ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ©\n\nÿ™ŸÖ ÿ®ŸÜÿßÿ° API Backend ÿ®ÿßŸÑŸÉÿßŸÖŸÑ ŸàŸáŸà ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ. Ÿáÿ∞ÿß ÿßŸÑÿØŸÑŸäŸÑ ŸäŸàÿ∂ÿ≠ ŸÉŸäŸÅŸäÿ© ÿ±ÿ®ÿ∑ ÿßŸÑŸàÿßÿ¨Ÿáÿ© Web ŸÖÿπ ÿßŸÑŸÄ API.\n\n## API Client\n\nÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° `client/src/lib/api.ts` ÿßŸÑÿ∞Ÿä Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÄ methods ŸÑŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπ ÿßŸÑŸÄ API.\n\n### ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ API Client\n\n```typescript\nimport { api } from \"@/lib/api\";\n\n// ŸÖÿ´ÿßŸÑ: ÿ¨ŸÑÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™\nconst stats = await api.getDashboardStats();\n\n// ŸÖÿ´ÿßŸÑ: ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸáÿßŸÖ\nconst tasks = await api.getTasks();\n\n// ŸÖÿ´ÿßŸÑ: ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ© ÿ¨ÿØŸäÿØÿ©\nconst newTask = await api.createTask({\n  name: \"ŸÖŸáŸÖÿ© ÿßŸÑÿ™Ÿàÿ¨ŸäŸá 1\",\n  description: \"ÿ™Ÿàÿ¨ŸäŸá ŸÖŸÜ ŸÇŸÜÿßÿ© ÿ£ ÿ•ŸÑŸâ ŸÇŸÜÿßÿ© ÿ®\",\n  sourceChannels: [1, 2],\n  targetChannels: [3, 4],\n  isActive: true,\n  aiEnabled: false,\n  videoProcessingEnabled: false,\n});\n```\n\n## ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµŸÅÿ≠ÿßÿ™\n\n### 1. Dashboard (dashboard.tsx)\n\nÿßÿ≥ÿ™ÿ®ÿØŸÑ mock data ÿ®ŸÄ API calls:\n\n```typescript\nimport { useQuery } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\n\nexport default function Dashboard() {\n  // ÿ¨ŸÑÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™\n  const { data: stats, isLoading } = useQuery({\n    queryKey: [\"dashboard-stats\"],\n    queryFn: () => api.getDashboardStats(),\n  });\n\n  if (isLoading) return <div>Loading...</div>;\n\n  return (\n    <div>\n      {/* ÿßÿ≥ÿ™ÿÆÿØŸÖ stats.totalTasks ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ´ÿßÿ®ÿ™ÿ© */}\n      <h3>{stats.totalTasks} Tasks</h3>\n      {/* ... */}\n    </div>\n  );\n}\n```\n\n### 2. Tasks Page (tasks.tsx)\n\n```typescript\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\n\nexport default function TasksPage() {\n  const queryClient = useQueryClient();\n\n  // ÿ¨ŸÑÿ® ÿßŸÑŸÖŸáÿßŸÖ\n  const { data: tasks, isLoading } = useQuery({\n    queryKey: [\"tasks\"],\n    queryFn: () => api.getTasks(),\n  });\n\n  // ÿ≠ÿ∞ŸÅ ŸÖŸáŸÖÿ©\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => api.deleteTask(id),\n    onSuccess: () => {\n      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿπÿØ ÿßŸÑÿ≠ÿ∞ŸÅ\n      queryClient.invalidateQueries({ queryKey: [\"tasks\"] });\n    },\n  });\n\n  // ÿ™ŸÅÿπŸäŸÑ/ÿ™ÿπÿ∑ŸäŸÑ ŸÖŸáŸÖÿ©\n  const toggleMutation = useMutation({\n    mutationFn: (id: number) => api.toggleTask(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"tasks\"] });\n    },\n  });\n\n  return (\n    <div>\n      {tasks?.map((task) => (\n        <div key={task.id}>\n          <h3>{task.name}</h3>\n          <button onClick={() => toggleMutation.mutate(task.id)}>\n            {task.isActive ? \"ÿ™ÿπÿ∑ŸäŸÑ\" : \"ÿ™ŸÅÿπŸäŸÑ\"}\n          </button>\n          <button onClick={() => deleteMutation.mutate(task.id)}>\n            ÿ≠ÿ∞ŸÅ\n          </button>\n        </div>\n      ))}\n    </div>\n  );\n}\n```\n\n### 3. Channels Page (channels.tsx)\n\n```typescript\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\n\nexport default function ChannelsPage() {\n  const queryClient = useQueryClient();\n\n  // ÿ¨ŸÑÿ® ÿßŸÑŸÇŸÜŸàÿßÿ™\n  const { data: channels } = useQuery({\n    queryKey: [\"channels\"],\n    queryFn: () => api.getChannels(),\n  });\n\n  // ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸÜÿßÿ©\n  const addChannelMutation = useMutation({\n    mutationFn: (data: any) => api.createChannel(data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"channels\"] });\n    },\n  });\n\n  const handleAddChannel = async (formData: any) => {\n    await addChannelMutation.mutateAsync({\n      type: formData.type, // 'telegram_channel' | 'telegram_group' | 'website'\n      identifier: formData.identifier,\n      title: formData.title,\n      description: formData.description,\n    });\n  };\n\n  return (\n    <div>\n      {/* ÿπÿ±ÿ∂ ÿßŸÑŸÇŸÜŸàÿßÿ™ */}\n      {channels?.map((channel) => (\n        <div key={channel.id}>{channel.title}</div>\n      ))}\n    </div>\n  );\n}\n```\n\n### 4. AI Config Page (ai-config.tsx)\n\n```typescript\nimport { useQuery } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\n\nexport default function AIConfigPage() {\n  // ÿ¨ŸÑÿ® ŸÖÿ≤ŸàÿØŸä AI\n  const { data: providers } = useQuery({\n    queryKey: [\"ai-providers\"],\n    queryFn: () => api.getAiProviders(),\n  });\n\n  // ÿ¨ŸÑÿ® ÿßŸÑŸÖŸàÿØŸäŸÑÿßÿ™\n  const { data: models } = useQuery({\n    queryKey: [\"ai-models\"],\n    queryFn: () => api.getAiModels(),\n  });\n\n  return (\n    <div>\n      <h2>AI Providers</h2>\n      {providers?.map((provider) => (\n        <div key={provider.id}>\n          {provider.name} - {provider.isActive ? \"ŸÜÿ¥ÿ∑\" : \"ŸÖÿπÿ∑ŸÑ\"}\n        </div>\n      ))}\n\n      <h2>AI Models</h2>\n      {models?.map((model) => (\n        <div key={model.id}>\n          {model.displayName} ({model.modelName})\n        </div>\n      ))}\n    </div>\n  );\n}\n```\n\n### 5. Auth Page (auth-page.tsx)\n\n```typescript\nimport { useState } from \"react\";\nimport { api } from \"@/lib/api\";\nimport { useNavigate } from \"wouter\";\n\nexport default function AuthPage() {\n  const [, navigate] = useNavigate();\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    try {\n      const response = await api.login(username, password);\n      // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\n      localStorage.setItem(\"user\", JSON.stringify(response.user));\n      // ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑÿØÿßÿ¥ÿ®Ÿàÿ±ÿØ\n      navigate(\"/\");\n    } catch (error) {\n      alert(\"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ\");\n    }\n  };\n\n  return (\n    <form onSubmit={handleLogin}>\n      <input\n        type=\"text\"\n        value={username}\n        onChange={(e) => setUsername(e.target.value)}\n        placeholder=\"ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\"\n      />\n      <input\n        type=\"password\"\n        value={password}\n        onChange={(e) => setPassword(e.target.value)}\n        placeholder=\"ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±\"\n      />\n      <button type=\"submit\">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</button>\n    </form>\n  );\n}\n```\n\n## API Endpoints ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©\n\n### Authentication\n- `POST /api/auth/login` - ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ\n- `POST /api/auth/register` - ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®\n\n### Dashboard\n- `GET /api/dashboard/stats` - ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©\n\n### Tasks\n- `GET /api/tasks` - ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸáÿßŸÖ\n- `GET /api/tasks/:id` - ŸÖŸáŸÖÿ© ŸÖÿ≠ÿØÿØÿ©\n- `POST /api/tasks` - ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ©\n- `PATCH /api/tasks/:id` - ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸáŸÖÿ©\n- `POST /api/tasks/:id/toggle` - ÿ™ŸÅÿπŸäŸÑ/ÿ™ÿπÿ∑ŸäŸÑ\n- `DELETE /api/tasks/:id` - ÿ≠ÿ∞ŸÅ ŸÖŸáŸÖÿ©\n- `GET /api/tasks/:id/stats` - ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ©\n- `GET /api/tasks/:id/logs` - ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ©\n\n### Channels\n- `GET /api/channels` - ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸÜŸàÿßÿ™\n- `GET /api/channels/:id` - ŸÇŸÜÿßÿ© ŸÖÿ≠ÿØÿØÿ©\n- `POST /api/channels` - ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸÜÿßÿ©\n- `PATCH /api/channels/:id` - ÿ™ÿ≠ÿØŸäÿ´ ŸÇŸÜÿßÿ©\n- `DELETE /api/channels/:id` - ÿ≠ÿ∞ŸÅ ŸÇŸÜÿßÿ©\n\n### AI\n- `GET /api/ai/providers` - ÿ¨ŸÖŸäÿπ ŸÖÿ≤ŸàÿØŸä AI\n- `GET /api/ai/models` - ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿØŸäŸÑÿßÿ™\n- `GET /api/ai/providers/:id/models` - ŸÖŸàÿØŸäŸÑÿßÿ™ ŸÖÿ≤ŸàÿØ ŸÖÿπŸäŸÜ\n- `GET /api/tasks/:id/rules` - ŸÇŸàÿßÿπÿØ AI ŸÑŸÑŸÖŸáŸÖÿ©\n- `POST /api/tasks/:id/rules` - ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ©\n- `PATCH /api/rules/:id` - ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿπÿØÿ©\n- `DELETE /api/rules/:id` - ÿ≠ÿ∞ŸÅ ŸÇÿßÿπÿØÿ©\n\n### Admins\n- `GET /api/admins` - ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ\n\n## ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°\n\n```typescript\nimport { api } from \"@/lib/api\";\nimport { toast } from \"sonner\";\n\ntry {\n  const tasks = await api.getTasks();\n  // ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n} catch (error) {\n  // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿÆÿ∑ÿ£\n  toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\");\n  console.error(error);\n}\n```\n\n## ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä\n\nÿßÿ≥ÿ™ÿÆÿØŸÖ React Query ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã:\n\n```typescript\nconst { data } = useQuery({\n  queryKey: [\"tasks\"],\n  queryFn: () => api.getTasks(),\n  refetchInterval: 5000, // ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑ 5 ÿ´ŸàÿßŸÜŸä\n});\n```\n\n## ÿßŸÑÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑÿ™ÿßŸÑŸäÿ©\n\n1. ‚úÖ API Backend ÿ¨ÿßŸáÿ≤ ŸàŸäÿπŸÖŸÑ\n2. ‚úÖ API Client ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ§Ÿá (`client/src/lib/api.ts`)\n3. üî® ŸÇŸÖ ÿ®ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ API ÿ®ÿØŸÑÿßŸã ŸÖŸÜ mock data\n4. üî® ÿ£ÿ∂ŸÅ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ©\n5. üî® ÿ£ÿ∂ŸÅ loading states\n6. üî® ÿ£ÿ∂ŸÅ ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™\n\n## ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ŸÖŸáŸÖÿ©\n\n- ÿ¨ŸÖŸäÿπ ÿßŸÑŸÄ endpoints ÿ™ÿπŸÖŸÑ Ÿàÿ™ŸÖ ÿßÿÆÿ™ÿ®ÿßÿ±Ÿáÿß\n- ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ:\n  - 4 AI Providers (OpenAI, Groq, Claude, HuggingFace)\n  - 12 AI Models ÿ¨ÿßŸáÿ≤ÿ© ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ\n- ÿßÿ≥ÿ™ÿÆÿØŸÖ TypeScript types ŸÖŸÜ `@shared/schema` ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n- React Query ŸÖÿ´ÿ®ÿ™ ÿ®ÿßŸÑŸÅÿπŸÑ ŸàŸäŸÖŸÉŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖŸá ŸÖÿ®ÿßÿ¥ÿ±ÿ©\n\n---\n\n**ŸÜÿµŸäÿ≠ÿ©:** ÿßÿ®ÿØÿ£ ÿ®ÿ™ÿ≠ÿØŸäÿ´ ÿµŸÅÿ≠ÿ© Ÿàÿßÿ≠ÿØÿ© (ŸÖÿ´ŸÑ Tasks) ÿ´ŸÖ ÿ∑ÿ®ŸÇ ŸÜŸÅÿ≥ ÿßŸÑŸÜŸÖÿ∑ ÿπŸÑŸâ ÿ®ÿßŸÇŸä ÿßŸÑÿµŸÅÿ≠ÿßÿ™.\n","path":null,"size_bytes":8882,"size_tokens":null},"client/src/pages/auth-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { motion } from \"framer-motion\";\nimport { Lock, User, ArrowRight, ShieldCheck, AlertCircle, Sun, Moon, Languages } from \"lucide-react\";\nimport { useTheme } from \"next-themes\";\nimport { useTranslation } from \"react-i18next\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { toast } from \"sonner\";\nimport backgroundUrl from \"@/assets/background.png\";\nimport { EagleLogo } from \"@/components/eagle-logo\";\n\nexport default function AuthPage() {\n  const [, setLocation] = useLocation();\n  const { theme, setTheme } = useTheme();\n  const { t, i18n } = useTranslation();\n  const [isLoading, setIsLoading] = useState(false);\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [error, setError] = useState(\"\");\n\n  useEffect(() => {\n    document.documentElement.dir = i18n.language === 'ar' ? 'rtl' : 'ltr';\n    document.documentElement.lang = i18n.language;\n  }, [i18n.language]);\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setIsLoading(true);\n\n    try {\n      const res = await fetch(\"/api/auth/admin-login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ username, password }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        setError(data.error || \"Login failed\");\n        toast.error(data.error || \"Login failed\");\n        setIsLoading(false);\n        return;\n      }\n\n      // ÿ≠ŸÅÿ∏ ÿßŸÑŸÄ token ŸàÿßŸÑŸÄ admin status\n      localStorage.setItem(\"adminToken\", data.token);\n      localStorage.setItem(\"adminUser\", data.username);\n      localStorage.setItem(\"isAdmin\", \"true\");\n      \n      toast.success(\"‚úì Admin login successful!\");\n      \n      // ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ŸÇŸÑŸäŸÑÿßŸã ŸÇÿ®ŸÑ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ\n      setTimeout(() => {\n        setLocation(\"/\");\n      }, 500);\n    } catch (err) {\n      const message = err instanceof Error ? err.message : \"An error occurred\";\n      setError(message);\n      toast.error(message);\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen w-full flex flex-col items-center justify-center bg-white dark:bg-black relative overflow-hidden font-sans\">\n      {/* Dynamic Background */}\n      <div \n        className=\"absolute inset-0 z-0 opacity-30 dark:opacity-50\"\n        style={{\n          backgroundImage: `url(${backgroundUrl})`,\n          backgroundSize: 'cover',\n          backgroundPosition: 'center',\n        }}\n      />\n      \n      {/* Enhanced Overlay with Gradient */}\n      <div className=\"absolute inset-0 bg-gradient-to-b from-white/10 via-white/60 to-white dark:from-black/10 dark:via-black/60 dark:to-black z-0\" />\n      \n      {/* Decorative Elements */}\n      <div className=\"absolute top-0 left-0 w-96 h-96 bg-primary/5 rounded-full blur-3xl z-0\" />\n      <div className=\"absolute bottom-0 right-0 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl z-0\" />\n      \n      <div className=\"relative z-10 w-full max-w-lg px-4 pt-8\">\n        {/* Control Buttons - Positioned Absolutely for Better Layout */}\n        <div className={`flex ${i18n.language === 'ar' ? 'flex-row-reverse' : ''} justify-between items-center mb-6 gap-2`}>\n          {/* Language Toggle */}\n          <motion.button\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => i18n.changeLanguage(i18n.language === 'ar' ? 'en' : 'ar')}\n            className=\"p-3 rounded-xl bg-white/20 dark:bg-white/10 backdrop-blur-sm hover:bg-white/30 dark:hover:bg-white/20 transition-all duration-300 shadow-lg hover:shadow-xl\"\n            aria-label=\"Toggle language\"\n            data-testid=\"button-toggle-language\"\n            title={i18n.language === 'ar' ? 'English' : 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'}\n          >\n            <Languages className=\"h-5 w-5 text-primary\" />\n          </motion.button>\n\n          {/* Theme Toggle Button */}\n          <motion.button\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => setTheme(theme === \"dark\" ? \"light\" : \"dark\")}\n            className=\"p-3 rounded-xl bg-white/20 dark:bg-white/10 backdrop-blur-sm hover:bg-white/30 dark:hover:bg-white/20 transition-all duration-300 shadow-lg hover:shadow-xl\"\n            aria-label=\"Toggle theme\"\n            data-testid=\"button-toggle-theme\"\n          >\n            {theme === \"dark\" ? (\n              <Sun className=\"h-5 w-5 text-amber-400\" />\n            ) : (\n              <Moon className=\"h-5 w-5 text-blue-600\" />\n            )}\n          </motion.button>\n        </div>\n\n        {/* Logo Section */}\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          transition={{ duration: 0.6, type: \"spring\" }}\n          className=\"flex justify-center mb-12\"\n        >\n          <EagleLogo size={280} flip={i18n.language === 'ar'} className=\"text-black dark:text-white drop-shadow-2xl\" />\n        </motion.div>\n\n        {/* Form Card */}\n        <motion.div\n          initial={{ opacity: 0, y: 30 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.6, delay: 0.2 }}\n        >\n          <Card className=\"bg-white/50 dark:bg-black/50 backdrop-blur-2xl border border-white/20 dark:border-white/10 shadow-2xl rounded-2xl overflow-hidden\">\n            {/* Card Header Accent */}\n            <div className=\"h-1 bg-gradient-to-r from-primary via-cyan-400 to-primary\" />\n            \n            <CardContent className=\"p-10\">\n              {/* Error Alert */}\n              {error && (\n                <motion.div\n                  initial={{ opacity: 0, y: -10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                >\n                  <Alert className=\"mb-6 bg-red-500/15 border border-red-500/40 rounded-xl backdrop-blur-sm\">\n                    <AlertCircle className=\"h-5 w-5 text-red-500\" />\n                    <AlertDescription className=\"text-red-600 dark:text-red-400 font-medium\">{error}</AlertDescription>\n                  </Alert>\n                </motion.div>\n              )}\n\n              <form onSubmit={handleLogin} className={`space-y-5 ${i18n.language === 'ar' ? 'text-right' : 'text-left'}`}>\n                {/* Username Field */}\n                <div className=\"space-y-3\">\n                  <label className={`text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider flex items-center gap-2 ${i18n.language === 'ar' ? 'flex-row-reverse' : ''}`}>\n                    <User className=\"h-4 w-4 text-primary\" />\n                    {t('auth.admin_username')}\n                  </label>\n                  <motion.div\n                    whileFocus={{ scale: 1.02 }}\n                    className=\"relative group\"\n                  >\n                    <Input \n                      type=\"text\"\n                      value={username}\n                      onChange={(e) => setUsername(e.target.value)}\n                      disabled={isLoading}\n                      className={`${i18n.language === 'ar' ? 'pr-4 text-right' : 'pl-4'} w-full bg-white/60 dark:bg-white/5 border-2 border-gray-200 dark:border-white/10 text-black dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 focus:bg-white dark:focus:bg-white/10 h-12 rounded-xl disabled:opacity-50 placeholder:text-gray-400 dark:placeholder:text-gray-500 transition-all duration-300`} \n                      placeholder={t('auth.username_placeholder')}\n                      required\n                      data-testid=\"input-username\"\n                      autoComplete=\"username\"\n                    />\n                  </motion.div>\n                </div>\n                \n                {/* Password Field */}\n                <div className=\"space-y-3\">\n                  <label className={`text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider flex items-center gap-2 ${i18n.language === 'ar' ? 'flex-row-reverse' : ''}`}>\n                    <Lock className=\"h-4 w-4 text-primary\" />\n                    {t('auth.admin_password')}\n                  </label>\n                  <motion.div\n                    whileFocus={{ scale: 1.02 }}\n                    className=\"relative group\"\n                  >\n                    <Input \n                      type=\"password\"\n                      value={password}\n                      onChange={(e) => setPassword(e.target.value)}\n                      disabled={isLoading}\n                      className={`${i18n.language === 'ar' ? 'pr-4 text-right' : 'pl-4'} w-full bg-white/60 dark:bg-white/5 border-2 border-gray-200 dark:border-white/10 text-black dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 focus:bg-white dark:focus:bg-white/10 h-12 rounded-xl disabled:opacity-50 placeholder:text-gray-400 dark:placeholder:text-gray-500 transition-all duration-300`} \n                      placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                      required\n                      data-testid=\"input-password\"\n                      autoComplete=\"current-password\"\n                    />\n                  </motion.div>\n                </div>\n\n                {/* Submit Button */}\n                <motion.div\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  className=\"pt-2\"\n                >\n                  <Button \n                    type=\"submit\" \n                    disabled={isLoading}\n                    className=\"w-full h-13 bg-gradient-to-r from-primary to-cyan-400 text-white font-bold rounded-xl hover:shadow-2xl hover:shadow-primary/50 transition-all duration-300 disabled:opacity-60 disabled:cursor-not-allowed text-base\"\n                    data-testid=\"button-submit\"\n                  >\n                    {isLoading ? (\n                      <span className=\"flex items-center justify-center gap-2\">\n                        <ShieldCheck className=\"h-5 w-5 animate-pulse\" /> \n                        {t('auth.authenticating')}\n                      </span>\n                    ) : (\n                      <span className=\"flex items-center justify-center gap-2\">\n                        {t('auth.initialize_session')} \n                        <ArrowRight className=\"h-5 w-5 transition-transform group-hover:translate-x-1\" />\n                      </span>\n                    )}\n                  </Button>\n                </motion.div>\n              </form>\n\n              {/* Security Footer */}\n              <div className=\"mt-8 pt-6 border-t border-gray-200 dark:border-white/10 text-center\">\n                <p className=\"text-xs text-gray-500 dark:text-gray-500 font-mono tracking-widest\">üîí SECURE CONNECTION ‚Ä¢ TLS 1.3</p>\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        {/* Bottom Spacing */}\n        <div className=\"h-8\" />\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":11215,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"start.sh":{"content":"#!/bin/sh\nset -e\n\necho \"[INFO] Starting BotNexus Application...\"\n\n# Check if running in production or development\nif [ \"$NODE_ENV\" = \"production\" ]; then\n    echo \"[INFO] Running in production mode\"\n    \n    # Check if dist exists\n    if [ ! -d \"dist\" ]; then\n        echo \"[ERROR] dist directory not found. Build may have failed.\"\n        exit 1\n    fi\n    \n    # Run database migrations\n    echo \"[INFO] Running database migrations...\"\n    npm run db:push || echo \"[WARN] Migration failed, continuing...\"\n    \n    # Start the production server\n    echo \"[INFO] Starting production server...\"\n    exec node dist/index.cjs\nelse\n    echo \"[INFO] Running in development mode\"\n    \n    # Ensure dependencies are installed\n    if [ ! -d \"node_modules\" ]; then\n        echo \"[INFO] Installing dependencies...\"\n        npm install\n    fi\n    \n    # Run database migrations\n    echo \"[INFO] Running database migrations...\"\n    npm run db:push || echo \"[WARN] Migration failed, continuing...\"\n    \n    # Start development server\n    echo \"[INFO] Starting development server...\"\n    exec npm run dev\nfi\n","path":null,"size_bytes":1094,"size_tokens":null},"SETUP_GUIDE.md":{"content":"# ÿØŸÑŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØ ÿßŸÑÿ¥ÿßŸÖŸÑ üöÄ\n\nŸáÿ∞ÿß ÿØŸÑŸäŸÑ ŸÖŸÅÿµŸÑ ŸÑÿ•ÿπÿØÿßÿØ Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ŸÜÿ∏ÿßŸÖ ÿ®Ÿàÿ™ ÿßŸÑÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ∞ŸÉŸä.\n\n## ÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© üìã\n\n### 1. ÿ®ÿ±ÿßŸÖÿ¨ ŸÖÿ∑ŸÑŸàÿ®ÿ©\n\n- **Node.js** 18.0 ÿ£Ÿà ÿ£ÿ≠ÿØÿ´\n- **Python** 3.11 ÿ£Ÿà ÿ£ÿ≠ÿØÿ´\n- **PostgreSQL** 13 ÿ£Ÿà ÿ£ÿ≠ÿØÿ´\n- **FFmpeg** (ŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà)\n- **Git**\n\n### 2. ÿ≠ÿ≥ÿßÿ®ÿßÿ™ ŸÖÿ∑ŸÑŸàÿ®ÿ©\n\n- ÿ≠ÿ≥ÿßÿ® Telegram (ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ API keys)\n- ÿ≠ÿ≥ÿßÿ® ŸÅŸä BotFather (ŸÑÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ®Ÿàÿ™)\n- (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) API keys ŸÑŸÄ:\n  - OpenAI\n  - Groq\n  - Anthropic (Claude)\n  - HuggingFace\n\n## ÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØ üõ†Ô∏è\n\n### ÿßŸÑÿÆÿ∑Ÿàÿ© 1: ÿ•ŸÜÿ¥ÿßÿ° ÿ®Ÿàÿ™ Telegram\n\n1. ÿßŸÅÿ™ÿ≠ Telegram Ÿàÿßÿ®ÿ≠ÿ´ ÿπŸÜ **@BotFather**\n2. ÿ£ÿ±ÿ≥ŸÑ ÿßŸÑÿ£ŸÖÿ± `/newbot`\n3. ÿßÿ™ÿ®ÿπ ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÑÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ®Ÿàÿ™\n4. ÿßÿ≠ŸÅÿ∏ **Bot Token** ÿßŸÑÿ∞Ÿä ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸäŸá\n\n### ÿßŸÑÿÆÿ∑Ÿàÿ© 2: ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ API ID Ÿà API Hash\n\n1. ÿßÿ∞Ÿáÿ® ÿ•ŸÑŸâ https://my.telegram.org/\n2. ÿ≥ÿ¨ŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅŸÉ\n3. ÿßÿ∞Ÿáÿ® ÿ•ŸÑŸâ \"API development tools\"\n4. ÿ£ŸÜÿ¥ÿ¶ ÿ™ÿ∑ÿ®ŸäŸÇ ÿ¨ÿØŸäÿØ\n5. ÿßÿ≠ŸÅÿ∏ **API ID** Ÿà **API Hash**\n\n### ÿßŸÑÿÆÿ∑Ÿàÿ© 3: ŸÖÿπÿ±ŸÅÿ© User ID ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ\n\n1. ÿßŸÅÿ™ÿ≠ ÿ®Ÿàÿ™ **@userinfobot** ŸÅŸä Telegram\n2. ÿ£ÿ±ÿ≥ŸÑ ÿ£Ÿä ÿ±ÿ≥ÿßŸÑÿ©\n3. ÿ≥Ÿäÿ±ÿØ ÿπŸÑŸäŸÉ ÿ®ÿ±ŸÇŸÖ User ID ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ\n4. ÿßÿ≠ŸÅÿ∏ Ÿáÿ∞ÿß ÿßŸÑÿ±ŸÇŸÖ (ÿ≥ÿ™ÿ≥ÿ™ÿÆÿØŸÖŸá ŸÉŸÄ BOT_ADMIN_ID)\n\n### ÿßŸÑÿÆÿ∑Ÿàÿ© 4: ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™\n\n#### Node.js\n```bash\nnpm install\n```\n\n#### Python\n```bash\ncd telegram_bot\npip install -r requirements.txt\n```\n\n#### ÿ™ÿ´ÿ®Ÿäÿ™ FFmpeg\n\n**Ubuntu/Debian:**\n```bash\nsudo apt update\nsudo apt install ffmpeg\n```\n\n**macOS:**\n```bash\nbrew install ffmpeg\n```\n\n**Windows:**\nŸÇŸÖ ÿ®ÿ™ÿ≠ŸÖŸäŸÑ FFmpeg ŸÖŸÜ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ±ÿ≥ŸÖŸä: https://ffmpeg.org/download.html\n\n### ÿßŸÑÿÆÿ∑Ÿàÿ© 5: ÿ•ÿπÿØÿßÿØ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n\n#### ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ PostgreSQL\n\n```bash\n# ŸÇŸÖ ÿ®ÿ™ÿ¥ÿ∫ŸäŸÑ PostgreSQL\nsudo service postgresql start\n\n# ÿ£ŸÜÿ¥ÿ¶ ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿ¨ÿØŸäÿØÿ©\ncreatedb telegram_bot\n\n# ÿ£Ÿà ÿπÿ®ÿ± psql\npsql -U postgres\nCREATE DATABASE telegram_bot;\n\\q\n```\n\n### ÿßŸÑÿÆÿ∑Ÿàÿ© 6: ÿ•ÿπÿØÿßÿØ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ©\n\n#### 1. ŸÅŸä ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä (ŸÑŸÑŸàÿßÿ¨Ÿáÿ© Web)\n\nÿ£ŸÜÿ¥ÿ¶ ŸÖŸÑŸÅ `.env`:\n```env\nDATABASE_URL=postgresql://username:password@localhost:5432/telegram_bot\nNODE_ENV=development\n```\n\n#### 2. ŸÅŸä ŸÖÿ¨ŸÑÿØ telegram_bot (ŸÑŸÑÿ®Ÿàÿ™)\n\nÿ£ŸÜÿ¥ÿ¶ ŸÖŸÑŸÅ `telegram_bot/.env`:\n```env\n# Telegram Bot\nBOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz\nAPI_ID=12345678\nAPI_HASH=abcdef1234567890abcdef1234567890\nBOT_ADMIN_ID=987654321\n\n# Database\nDATABASE_URL=postgresql://username:password@localhost:5432/telegram_bot\n\n# AI Providers (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä - ÿ£ÿ∂ŸÅ ŸÖÿß ÿ™ÿ≠ÿ™ÿßÿ¨Ÿá ŸÅŸÇÿ∑)\nOPENAI_API_KEY=sk-...\nGROQ_API_KEY=gsk_...\nANTHROPIC_API_KEY=sk-ant-...\nHUGGINGFACE_API_KEY=hf_...\n\n# Redis (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä ŸÑŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ ÿßŸÑŸÉÿ®Ÿäÿ±ÿ©)\nREDIS_URL=redis://localhost:6379/0\n\n# Webhook (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)\nWEBHOOK_URL=https://yourdomain.com/webhook\nWEBHOOK_PORT=8443\nUSE_WEBHOOK=false\n\n# API Server\nAPI_HOST=0.0.0.0\nAPI_PORT=8000\n\n# Workers\nMAX_WORKERS=10\nQUEUE_MAX_SIZE=1000\n```\n\n### ÿßŸÑÿÆÿ∑Ÿàÿ© 7: ÿ•ÿπÿØÿßÿØ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n\n```bash\n# ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¨ÿØÿßŸàŸÑ\nnpm run db:push\n\n# ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© (AI providers and models)\nnpx tsx server/seed.ts\n```\n\n### ÿßŸÑÿÆÿ∑Ÿàÿ© 8: ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ŸÖÿ≥ÿ™ÿÆÿØŸÖ\n\n```bash\n# ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸàÿßÿ¨Ÿáÿ©\nnpm run dev\n\n# ŸÅŸä ŸÖÿ™ÿµŸÅÿ≠ ÿ¢ÿÆÿ±ÿå ÿßŸÅÿ™ÿ≠:\n# http://localhost:5000/auth\n\n# ÿ≥ÿ¨ŸÑ ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ:\n# Username: admin\n# Password: ÿßÿÆÿ™ÿ± ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ŸÇŸàŸäÿ©\n```\n\n## ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ üöÄ\n\n### ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸàÿßÿ¨Ÿáÿ© Web Ÿà API\n\n```bash\nnpm run dev\n```\n\nÿ≥ÿ™ÿπŸÖŸÑ ÿπŸÑŸâ: http://localhost:5000\n\n### ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ®Ÿàÿ™ Telegram\n\n```bash\ncd telegram_bot\npython main.py\n```\n\n## ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ‚úÖ\n\n### 1. ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ®Ÿàÿ™\n\n1. ÿßŸÅÿ™ÿ≠ Telegram Ÿàÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ®Ÿàÿ™ ÿßŸÑÿ∞Ÿä ÿ£ŸÜÿ¥ÿ£ÿ™Ÿá\n2. ÿ£ÿ±ÿ≥ŸÑ `/start`\n3. Ÿäÿ¨ÿ® ÿ£ŸÜ Ÿäÿ±ÿØ ÿπŸÑŸäŸÉ ÿßŸÑÿ®Ÿàÿ™ ÿ®ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ŸàÿßŸÖÿ±\n\n### 2. ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸàÿßÿ¨Ÿáÿ©\n\n1. ÿßŸÅÿ™ÿ≠ http://localhost:5000\n2. ÿ≥ÿ¨ŸÑ ÿßŸÑÿØÿÆŸàŸÑ\n3. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ∏ŸáŸàÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ\n\n### 3. ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n\n```bash\n# ŸÅŸä ŸÖÿ¨ŸÑÿØ ÿßŸÑÿ®Ÿàÿ™\ncd telegram_bot\npython -c \"import asyncio; from utils.database import db; asyncio.run(db.connect()); print('‚úÖ Database connected')\"\n```\n\n## ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨ (Production) üè≠\n\n### 1. ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Webhook ÿ®ÿØŸÑÿßŸã ŸÖŸÜ Polling\n\nŸÅŸä ŸÖŸÑŸÅ `telegram_bot/.env`:\n```env\nUSE_WEBHOOK=true\nWEBHOOK_URL=https://yourdomain.com/webhook\nWEBHOOK_PORT=8443\n```\n\n### 2. ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Redis ŸÑŸÑŸÄ Queues\n\n```bash\n# ÿ™ÿ´ÿ®Ÿäÿ™ Redis\nsudo apt install redis-server\n\n# ÿ™ÿ¥ÿ∫ŸäŸÑ Redis\nredis-server\n```\n\nŸÅŸä ŸÖŸÑŸÅ `.env`:\n```env\nREDIS_URL=redis://localhost:6379/0\n```\n\n### 3. ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Process Manager\n\n#### PM2 ŸÑŸÑŸÜŸàÿØ\n```bash\nnpm install -g pm2\npm2 start npm --name \"telegram-web\" -- run start\n```\n\n#### Systemd ŸÑŸÑÿ®Ÿàÿ™\nÿ£ŸÜÿ¥ÿ¶ ŸÖŸÑŸÅ `/etc/systemd/system/telegram-bot.service`:\n```ini\n[Unit]\nDescription=Telegram Forwarding Bot\nAfter=network.target\n\n[Service]\nType=simple\nUser=youruser\nWorkingDirectory=/path/to/telegram_bot\nEnvironment=\"PATH=/usr/bin:/usr/local/bin\"\nExecStart=/usr/bin/python3 main.py\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n```\n\nÿ´ŸÖ:\n```bash\nsudo systemctl enable telegram-bot\nsudo systemctl start telegram-bot\nsudo systemctl status telegram-bot\n```\n\n## ÿ≠ŸÑ ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑÿ¥ÿßÿ¶ÿπÿ© üîß\n\n### ÿßŸÑÿ®Ÿàÿ™ ŸÑÿß Ÿäÿ≥ÿ™ÿ¨Ÿäÿ®\n\n1. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© BOT_TOKEN\n2. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ BOT_ADMIN_ID ÿµÿ≠Ÿäÿ≠\n3. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™: `telegram_bot/logs/bot.log`\n\n### ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n\n1. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ PostgreSQL ŸäÿπŸÖŸÑ\n2. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© DATABASE_URL\n3. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™\n4. ÿ≠ÿßŸàŸÑ ÿ•ÿπÿßÿØÿ© ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¨ÿØÿßŸàŸÑ: `npm run db:push`\n\n### ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà ŸÑÿß ÿ™ÿπŸÖŸÑ\n\n1. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ´ÿ®Ÿäÿ™ ffmpeg: `ffmpeg -version`\n2. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ŸàŸÅÿ± ŸÖÿ≥ÿßÿ≠ÿ© ŸÉÿßŸÅŸäÿ© ŸÅŸä `/tmp`\n3. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿ¨ŸÖ ÿßŸÑŸÅŸäÿØŸäŸà (ŸÇÿØ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿ≤ŸäÿßÿØÿ© ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ)\n\n### ÿßŸÑŸàÿßÿ¨Ÿáÿ© Web ŸÑÿß ÿ™ÿπŸÖŸÑ\n\n1. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ¥ÿ∫ŸäŸÑ `npm run dev`\n2. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖŸÜŸÅÿ∞ 5000\n3. ÿßŸÅÿ≠ÿµ ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ (F12 > Console)\n\n## ÿßŸÑÿ£ŸÖÿßŸÜ üîê\n\n### ŸÜÿµÿßÿ¶ÿ≠ ÿ£ŸÖŸÜŸäÿ©\n\n1. **ŸÑÿß ÿ™ÿ¥ÿßÿ±ŸÉ** ŸÖŸÑŸÅ `.env` ÿ£ÿ®ÿØÿßŸã\n2. ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÉŸÑŸÖÿßÿ™ ŸÖÿ±Ÿàÿ± ŸÇŸàŸäÿ©\n3. ŸÅÿπŸëŸÑ HTTPS ŸÅŸä ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨\n4. ÿ≠ÿØÿ´ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿ®ÿßŸÜÿ™ÿ∏ÿßŸÖ:\n   ```bash\n   npm update\n   pip install --upgrade -r requirements.txt\n   ```\n5. ÿ±ÿßÿ¨ÿπ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿ®ÿßŸÜÿ™ÿ∏ÿßŸÖ\n\n### Firewall\n\n```bash\n# ÿßŸÑÿ≥ŸÖÿßÿ≠ ŸÅŸÇÿ∑ ÿ®ÿßŸÑŸÖŸÜÿßŸÅÿ∞ ÿßŸÑÿ∂ÿ±Ÿàÿ±Ÿäÿ©\nsudo ufw allow 5000/tcp  # Webapp\nsudo ufw allow 8443/tcp  # Webhook\nsudo ufw allow 5432/tcp  # PostgreSQL (ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿπŸÑŸâ ÿÆÿßÿØŸÖ ŸÖŸÜŸÅÿµŸÑ)\nsudo ufw enable\n```\n\n## ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä üíæ\n\n### ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n\n```bash\n# ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©\npg_dump -U username telegram_bot > backup_$(date +%Y%m%d).sql\n\n# ÿßÿ≥ÿ™ÿπÿßÿØÿ© ŸÖŸÜ ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©\npsql -U username telegram_bot < backup_20231130.sql\n```\n\n### ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ®Ÿàÿ™\n\n```bash\n# ŸÜÿ≥ÿÆ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä ŸÑŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸàÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™\ntar -czf bot_backup_$(date +%Y%m%d).tar.gz telegram_bot/.env telegram_bot/logs/\n```\n\n## ÿßŸÑŸÖÿ±ÿßŸÇÿ®ÿ© ŸàÿßŸÑÿµŸäÿßŸÜÿ© üìä\n\n### ŸÖÿ±ÿßŸÇÿ®ÿ© ÿßŸÑÿ£ÿØÿßÿ°\n\n```bash\n# ŸÅÿ≠ÿµ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ CPU ŸàÿßŸÑÿ∞ÿßŸÉÿ±ÿ©\ntop\nhtop\n\n# ŸÅÿ≠ÿµ ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÇÿ±ÿµ\ndf -h\n\n# ŸÅÿ≠ÿµ ÿ≠ÿßŸÑÿ© PostgreSQL\nsudo systemctl status postgresql\n\n# ŸÅÿ≠ÿµ ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ®Ÿàÿ™\ntail -f telegram_bot/logs/bot.log\n```\n\n### ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ÿßÿ™\n\n```bash\n# ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™\ngit pull\nnpm install\ncd telegram_bot && pip install -r requirements.txt\n\n# ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿÆÿØŸÖÿßÿ™\nsudo systemctl restart telegram-bot\npm2 restart telegram-web\n```\n\n## ÿßŸÑÿØÿπŸÖ üí¨\n\nŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©:\n- ÿßŸÅÿ™ÿ≠ Issue ÿπŸÑŸâ GitHub\n- ÿ±ÿßÿ¨ÿπ ÿßŸÑŸàÿ´ÿßÿ¶ŸÇ ŸÅŸä README.md\n- ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÑŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿ™ŸÅÿµŸäŸÑŸäÿ©\n\n---\n\n**ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠! üéâ** ÿßŸÑÿ¢ŸÜ ŸÑÿØŸäŸÉ ŸÜÿ∏ÿßŸÖ ÿ™Ÿàÿ¨ŸäŸá Telegram ŸÖÿ™ŸÉÿßŸÖŸÑ ŸÖÿπ ÿ∞ŸÉÿßÿ° ÿµŸÜÿßÿπŸä!\n","path":null,"size_bytes":8309,"size_tokens":null},"client/src/pages/ai-config.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { \n  Bot, \n  Sparkles, \n  Save,\n  Cpu,\n  Loader,\n  Eye,\n  EyeOff,\n  Check\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface Provider {\n  id: number;\n  name: string;\n  apiKey: string | null;\n  isActive: boolean;\n  config: any;\n  createdAt: string;\n}\n\ninterface Model {\n  id: number;\n  providerId: number;\n  modelName: string;\n  displayName: string;\n  capabilities: string[];\n  isActive: boolean;\n}\n\nexport default function AIConfigPage() {\n  const queryClient = useQueryClient();\n  const [configDialogOpen, setConfigDialogOpen] = useState(false);\n  const [selectedProvider, setSelectedProvider] = useState<Provider | null>(null);\n  const [apiKeyInput, setApiKeyInput] = useState(\"\");\n  const [showApiKey, setShowApiKey] = useState(false);\n  const [defaultPrompt, setDefaultPrompt] = useState(\n    \"You are an expert summarizer and content curator. Your goal is to extract key insights from tech discussions and present them in a concise, bulleted format. Maintain the original tone but remove noise.\"\n  );\n  const [temperature, setTemperature] = useState(0.7);\n\n  const { data: providers = [], isLoading: loadingProviders } = useQuery({\n    queryKey: [\"ai-providers\"],\n    queryFn: () => api.getAiProviders(),\n  });\n\n  const { data: models = [] } = useQuery({\n    queryKey: [\"ai-models\"],\n    queryFn: () => api.getAiModels(),\n  });\n\n  const updateProviderMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateAiProvider(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≤ŸàÿØ ÿßŸÑÿÆÿØŸÖÿ© ÿ®ŸÜÿ¨ÿßÿ≠\");\n      queryClient.invalidateQueries({ queryKey: [\"ai-providers\"] });\n      setConfigDialogOpen(false);\n      setApiKeyInput(\"\");\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≤ŸàÿØ ÿßŸÑÿÆÿØŸÖÿ©\");\n    },\n  });\n\n  const toggleProviderMutation = useMutation({\n    mutationFn: (id: number) => api.toggleAiProvider(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿ≠ÿßŸÑÿ© ŸÖÿ≤ŸàÿØ ÿßŸÑÿÆÿØŸÖÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"ai-providers\"] });\n    },\n  });\n\n  const saveSettingMutation = useMutation({\n    mutationFn: ({ key, value }: { key: string; value: string }) => api.saveSetting(key, value),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\");\n    },\n    onError: () => {\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\");\n    },\n  });\n\n  const handleConfigureProvider = (provider: Provider) => {\n    setSelectedProvider(provider);\n    setApiKeyInput(provider.apiKey || \"\");\n    setConfigDialogOpen(true);\n  };\n\n  const handleSaveApiKey = () => {\n    if (!selectedProvider) return;\n    updateProviderMutation.mutate({\n      id: selectedProvider.id,\n      data: { apiKey: apiKeyInput }\n    });\n  };\n\n  const handleSaveAllSettings = async () => {\n    try {\n      await saveSettingMutation.mutateAsync({ key: \"default_prompt\", value: defaultPrompt });\n      await saveSettingMutation.mutateAsync({ key: \"temperature\", value: temperature.toString() });\n      toast.success(\"ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\");\n    } catch (error) {\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ≠ŸÅÿ∏ ÿ®ÿπÿ∂ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\");\n    }\n  };\n\n  const getProviderDisplayName = (name: string) => {\n    const names: Record<string, string> = {\n      openai: \"OpenAI\",\n      groq: \"Groq\",\n      claude: \"Anthropic Claude\",\n      huggingface: \"HuggingFace\"\n    };\n    return names[name] || name;\n  };\n\n  const getProviderColor = (name: string) => {\n    const colors: Record<string, string> = {\n      openai: \"bg-green-500/20 text-green-600 dark:text-green-500\",\n      groq: \"bg-orange-500/20 text-orange-600 dark:text-orange-500\",\n      claude: \"bg-purple-500/20 text-purple-600 dark:text-purple-500\",\n      huggingface: \"bg-yellow-500/20 text-yellow-600 dark:text-yellow-500\"\n    };\n    return colors[name] || \"bg-muted text-foreground\";\n  };\n\n  if (loadingProviders) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <Loader className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 md:space-y-8 max-w-5xl mx-auto\">\n      <div className=\"flex flex-col sm:flex-row sm:items-end justify-between gap-4\">\n        <div>\n          <h2 className=\"text-2xl md:text-3xl font-display font-bold text-foreground tracking-wide\">AI Neural Core</h2>\n          <p className=\"text-muted-foreground mt-1 text-sm md:text-base\">ÿ•ÿπÿØÿßÿØ ŸÖÿ≤ŸàÿØŸä ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä ŸàÿßŸÑŸÖŸàÿØŸäŸÑÿßÿ™ ŸàŸÇŸàÿßÿπÿØ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ</p>\n        </div>\n        <Button \n          onClick={handleSaveAllSettings}\n          className=\"bg-primary text-primary-foreground font-bold hover:bg-primary/90 w-full sm:w-auto\"\n          disabled={saveSettingMutation.isPending}\n          data-testid=\"button-save-config\"\n        >\n          {saveSettingMutation.isPending ? (\n            <Loader className=\"h-4 w-4 mr-2 animate-spin\" />\n          ) : (\n            <Save className=\"h-4 w-4 mr-2\" />\n          )}\n          ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8\">\n        {/* Provider Configuration */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          <Card className=\"border shadow-sm\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-foreground\">\n                <Cpu className=\"h-5 w-5 text-primary\" /> ŸÖÿ≤ŸàÿØŸä ÿßŸÑÿÆÿØŸÖÿ© ÿßŸÑŸÜÿ¥ÿ∑ŸàŸÜ\n              </CardTitle>\n              <CardDescription>ÿ•ÿπÿØÿßÿØ ŸÖŸÅÿßÿ™Ÿäÿ≠ API Ÿàÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÑÿÆÿØŸÖÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {providers.map((provider: Provider) => {\n                const isActive = provider.isActive && provider.apiKey;\n                const hasApiKey = !!provider.apiKey;\n                return (\n                  <div \n                    key={provider.id} \n                    className={`relative overflow-hidden flex flex-col sm:flex-row sm:items-center justify-between gap-4 p-5 rounded-2xl border-2 transition-all duration-300 ${\n                      isActive \n                        ? 'border-green-500/40 bg-gradient-to-l from-green-500/10 via-emerald-500/5 to-transparent dark:from-green-500/20 dark:via-emerald-500/10' \n                        : hasApiKey \n                          ? 'border-yellow-500/40 bg-gradient-to-l from-yellow-500/10 to-transparent dark:from-yellow-500/15'\n                          : 'border-border bg-muted/30 hover:bg-muted/50'\n                    }`}\n                    data-testid={`provider-card-${provider.name}`}\n                  >\n                    {isActive && (\n                      <div className=\"absolute top-0 right-0 left-0 h-1 bg-gradient-to-l from-green-500 to-emerald-500\" />\n                    )}\n                    <div className=\"flex items-center gap-4\">\n                      <div className={`h-12 w-12 rounded-xl flex items-center justify-center shadow-lg transition-all ${getProviderColor(provider.name)}`}>\n                        <Bot className=\"h-6 w-6\" />\n                      </div>\n                      <div>\n                        <h4 className=\"font-bold text-foreground text-base\">{getProviderDisplayName(provider.name)}</h4>\n                        <div className=\"flex items-center gap-2 mt-1\">\n                          <div className={`h-2 w-2 rounded-full ${hasApiKey ? (isActive ? 'bg-green-500 animate-pulse' : 'bg-yellow-500') : 'bg-red-500'}`} />\n                          <span className={`text-xs font-medium ${isActive ? 'text-green-600 dark:text-green-400' : hasApiKey ? 'text-yellow-600 dark:text-yellow-400' : 'text-muted-foreground'}`}>\n                            {hasApiKey \n                              ? (isActive ? 'ŸÖÿ™ÿµŸÑ ŸàŸÜÿ¥ÿ∑' : 'ŸÖÿ™ÿµŸÑ ŸàŸÖÿπÿ∑ŸÑ') \n                              : 'ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ - Ÿäÿ≠ÿ™ÿßÿ¨ ŸÖŸÅÿ™ÿßÿ≠ API'}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-3 justify-end\">\n                      <div className={`px-3 py-1.5 rounded-full text-xs font-bold transition-all ${\n                        isActive \n                          ? 'bg-green-500/20 text-green-600 dark:text-green-400' \n                          : 'bg-muted text-muted-foreground'\n                      }`}>\n                        {isActive ? 'ŸÖŸÅÿπŸëŸÑ' : 'ŸÖÿπÿ∑ŸëŸÑ'}\n                      </div>\n                      <Switch\n                        checked={provider.isActive}\n                        onCheckedChange={() => toggleProviderMutation.mutate(provider.id)}\n                        disabled={!provider.apiKey}\n                        data-testid={`switch-provider-${provider.name}`}\n                      />\n                      <Button \n                        variant={hasApiKey ? \"outline\" : \"default\"}\n                        size=\"sm\"\n                        onClick={() => handleConfigureProvider(provider)}\n                        className={`rounded-xl font-semibold ${!hasApiKey ? 'bg-primary hover:bg-primary/90' : ''}`}\n                        data-testid={`button-configure-${provider.name}`}\n                      >\n                        {hasApiKey ? 'ÿ™ÿπÿØŸäŸÑ' : 'ÿ•ÿπÿØÿßÿØ'}\n                      </Button>\n                    </div>\n                  </div>\n                );\n              })}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Sidebar Settings */}\n        <div className=\"space-y-6\">\n          {/* Available Models Section */}\n          <Card className=\"border shadow-sm\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-foreground\">\n                <Bot className=\"h-5 w-5 text-primary\" /> ÿßŸÑŸÖŸàÿØŸäŸÑÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©\n              </CardTitle>\n              <CardDescription>ŸÇÿßÿ¶ŸÖÿ© ÿ®ÿ¨ŸÖŸäÿπ ŸÖŸàÿØŸäŸÑÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-3 max-h-[400px] overflow-y-auto\">\n              {providers.map((provider: Provider) => {\n                const providerModels = models.filter((m: Model) => m.providerId === provider.id);\n                if (providerModels.length === 0) return null;\n                return (\n                  <div key={provider.id} className=\"space-y-2\">\n                    <div className={`px-2 py-1 rounded-lg text-xs font-bold ${getProviderColor(provider.name)}`}>\n                      {getProviderDisplayName(provider.name)} ({providerModels.length})\n                    </div>\n                    <div className=\"space-y-1 pr-2\">\n                      {providerModels.map((model: Model) => (\n                        <div \n                          key={model.id}\n                          className={`flex items-center justify-between p-2 rounded-lg text-xs transition-all ${\n                            model.isActive \n                              ? 'bg-green-500/10 border border-green-500/30' \n                              : 'bg-muted/50 border border-transparent'\n                          }`}\n                        >\n                          <div className=\"flex items-center gap-2\">\n                            <div className={`h-2 w-2 rounded-full ${model.isActive ? 'bg-green-500' : 'bg-muted-foreground'}`} />\n                            <span className=\"font-medium text-foreground\">{model.displayName}</span>\n                          </div>\n                          <span className={`px-1.5 py-0.5 rounded text-[10px] ${\n                            model.capabilities?.includes('audio') \n                              ? 'bg-blue-500/20 text-blue-600 dark:text-blue-400' \n                              : 'bg-purple-500/20 text-purple-600 dark:text-purple-400'\n                          }`}>\n                            {model.capabilities?.includes('audio') ? 'ÿµŸàÿ™' : 'ŸÜÿµ'}\n                          </span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                );\n              })}\n              {models.length === 0 && (\n                <div className=\"text-center text-muted-foreground py-8\">\n                  <Bot className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                  <p className=\"text-sm\">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿØŸäŸÑÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ©</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card className=\"border shadow-sm bg-gradient-to-b from-purple-500/5 to-transparent dark:from-purple-900/10\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-foreground\">\n                <Sparkles className=\"h-5 w-5 text-yellow-600 dark:text-yellow-400\" /> ÿßŸÑÿ¥ÿÆÿµŸäÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-xs uppercase text-muted-foreground tracking-wider\">System Prompt</Label>\n                <Textarea \n                  className=\"min-h-[200px] font-mono text-sm resize-none\"\n                  value={defaultPrompt}\n                  onChange={(e) => setDefaultPrompt(e.target.value)}\n                  data-testid=\"textarea-system-prompt\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label className=\"text-xs uppercase text-muted-foreground tracking-wider\">Temperature</Label>\n                <div className=\"flex items-center gap-4\">\n                  <input\n                    type=\"range\"\n                    min=\"0\"\n                    max=\"1\"\n                    step=\"0.1\"\n                    value={temperature}\n                    onChange={(e) => setTemperature(parseFloat(e.target.value))}\n                    className=\"flex-1 h-2 bg-muted rounded-full appearance-none cursor-pointer accent-primary\"\n                    data-testid=\"slider-temperature\"\n                  />\n                  <span className=\"font-mono text-sm text-foreground w-10\">{temperature.toFixed(1)}</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Configure Provider Dialog */}\n      <Dialog open={configDialogOpen} onOpenChange={setConfigDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>ÿ•ÿπÿØÿßÿØ {selectedProvider ? getProviderDisplayName(selectedProvider.name) : \"\"}</DialogTitle>\n            <DialogDescription>ÿ£ÿØÿÆŸÑ ŸÖŸÅÿ™ÿßÿ≠ API ŸÑŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿÆÿØŸÖÿ©</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"api-key\">ŸÖŸÅÿ™ÿßÿ≠ API</Label>\n              <div className=\"relative mt-1\">\n                <Input\n                  id=\"api-key\"\n                  type={showApiKey ? \"text\" : \"password\"}\n                  value={apiKeyInput}\n                  onChange={(e) => setApiKeyInput(e.target.value)}\n                  placeholder=\"sk-...\"\n                  className=\"pr-10\"\n                  data-testid=\"input-api-key\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowApiKey(!showApiKey)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n                >\n                  {showApiKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                </button>\n              </div>\n            </div>\n            \n            <Button \n              onClick={handleSaveApiKey}\n              className=\"w-full\"\n              disabled={updateProviderMutation.isPending}\n              data-testid=\"button-save-api-key\"\n            >\n              {updateProviderMutation.isPending ? (\n                <Loader className=\"h-4 w-4 mr-2 animate-spin\" />\n              ) : (\n                <Check className=\"h-4 w-4 mr-2\" />\n              )}\n              ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":17051,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/main.tsx":{"content":"import { StrictMode } from \"react\";\nimport { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport \"./lib/i18n\";\n\ncreateRoot(document.getElementById(\"root\")!).render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n);\n","path":null,"size_bytes":252,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/lib/api.ts":{"content":"/**\n * API Client for Backend Communication\n * Provides typed methods for all API endpoints\n */\n\nconst API_BASE = \"/api\";\n\ninterface ApiError {\n  error: string;\n  details?: unknown;\n}\n\nclass ApiClient {\n  private async request<T>(\n    endpoint: string,\n    options?: RequestInit\n  ): Promise<T> {\n    const response = await fetch(`${API_BASE}${endpoint}`, {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        ...options?.headers,\n      },\n      ...options,\n    });\n\n    if (!response.ok) {\n      const error: ApiError = await response.json();\n      throw new Error(error.error || \"API request failed\");\n    }\n\n    return response.json();\n  }\n\n  // Authentication\n  async login(username: string, password: string) {\n    return this.request<{ user: any; message: string }>(\"/auth/login\", {\n      method: \"POST\",\n      body: JSON.stringify({ username, password }),\n    });\n  }\n\n  async register(username: string, password: string) {\n    return this.request<{ user: any; message: string }>(\"/auth/register\", {\n      method: \"POST\",\n      body: JSON.stringify({ username, password }),\n    });\n  }\n\n  // Dashboard\n  async getDashboardStats() {\n    return this.request<{\n      totalTasks: number;\n      activeTasks: number;\n      inactiveTasks: number;\n      totalChannels: number;\n      totalForwarded: number;\n      aiEnabledTasks: number;\n      videoEnabledTasks: number;\n    }>(\"/dashboard/stats\");\n  }\n\n  // Tasks\n  async getTasks() {\n    return this.request<any[]>(\"/tasks\");\n  }\n\n  async getTask(id: number) {\n    return this.request<any>(`/tasks/${id}`);\n  }\n\n  async createTask(data: any) {\n    return this.request<any>(\"/tasks\", {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateTask(id: number, data: any) {\n    return this.request<any>(`/tasks/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async toggleTask(id: number) {\n    return this.request<any>(`/tasks/${id}/toggle`, {\n      method: \"POST\",\n    });\n  }\n\n  async deleteTask(id: number) {\n    return this.request<{ message: string }>(`/tasks/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  async getTaskStats(id: number, days: number = 7) {\n    return this.request<any[]>(`/tasks/${id}/stats?days=${days}`);\n  }\n\n  async getTaskLogs(id: number, limit: number = 100) {\n    return this.request<any[]>(`/tasks/${id}/logs?limit=${limit}`);\n  }\n\n  async getErrorLogs(limit: number = 100) {\n    return this.request<any[]>(`/error-logs?limit=${limit}`);\n  }\n\n  // Channels\n  async getChannels() {\n    return this.request<any[]>(\"/channels\");\n  }\n\n  async getChannel(id: number) {\n    return this.request<any>(`/channels/${id}`);\n  }\n\n  async createChannel(data: any) {\n    return this.request<any>(\"/channels\", {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateChannel(id: number, data: any) {\n    return this.request<any>(`/channels/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteChannel(id: number) {\n    return this.request<{ message: string }>(`/channels/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // AI Providers and Models\n  async getAiProviders() {\n    return this.request<any[]>(\"/ai/providers\");\n  }\n\n  async getAiModels() {\n    return this.request<any[]>(\"/ai/models\");\n  }\n\n  async getProviderModels(providerId: number) {\n    return this.request<any[]>(`/ai/providers/${providerId}/models`);\n  }\n\n  // AI Rules\n  async getTaskRules(taskId: number) {\n    return this.request<any[]>(`/tasks/${taskId}/rules`);\n  }\n\n  async createRule(taskId: number, data: any) {\n    return this.request<any>(`/tasks/${taskId}/rules`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateRule(ruleId: number, data: any) {\n    return this.request<any>(`/rules/${ruleId}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async toggleRule(ruleId: number) {\n    return this.request<any>(`/rules/${ruleId}/toggle`, {\n      method: \"POST\",\n    });\n  }\n\n  async deleteRule(ruleId: number) {\n    return this.request<{ message: string }>(`/rules/${ruleId}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // Admins\n  async getAdmins() {\n    return this.request<any[]>(\"/admins\");\n  }\n\n  async createAdmin(data: { telegramId: string; username?: string; addedBy?: number }) {\n    return this.request<any>(\"/admins\", {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteAdmin(id: number) {\n    return this.request<{ message: string }>(`/admins/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // AI Provider Management\n  async updateAiProvider(id: number, data: { apiKey?: string; isActive?: boolean; config?: any }) {\n    return this.request<any>(`/ai/providers/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async toggleAiProvider(id: number) {\n    return this.request<any>(`/ai/providers/${id}/toggle`, {\n      method: \"POST\",\n    });\n  }\n\n  // Settings / Bot Config\n  async getSettings() {\n    return this.request<{ key: string; value: string }[]>(\"/settings\");\n  }\n\n  async getSetting(key: string) {\n    return this.request<{ key: string; value: string }>(`/settings/${key}`);\n  }\n\n  async saveSetting(key: string, value: string, description?: string) {\n    return this.request<{ message: string }>(\"/settings\", {\n      method: \"POST\",\n      body: JSON.stringify({ key, value, description }),\n    });\n  }\n\n  async deleteSetting(key: string) {\n    return this.request<{ message: string }>(`/settings/${key}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // Logs\n  async getLogs(limit: number = 100) {\n    return this.request<any[]>(`/logs?limit=${limit}`);\n  }\n\n  // Health\n  async healthCheck() {\n    return this.request<{ status: string; timestamp: string }>(\"/health\");\n  }\n\n  // ============================================\n  // Advanced AI Rules - Entity Replacements\n  // ============================================\n  \n  async getEntityReplacements(taskId: number) {\n    return this.request<any[]>(`/tasks/${taskId}/entity-replacements`);\n  }\n\n  async createEntityReplacement(data: any) {\n    return this.request<any>(`/tasks/${data.taskId}/entity-replacements`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateEntityReplacement(id: number, data: any) {\n    return this.request<any>(`/entity-replacements/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteEntityReplacement(id: number) {\n    return this.request<{ message: string }>(`/entity-replacements/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // ============================================\n  // Advanced AI Rules - Context Rules\n  // ============================================\n  \n  async getContextRules(taskId: number) {\n    return this.request<any[]>(`/tasks/${taskId}/context-rules`);\n  }\n\n  async createContextRule(data: any) {\n    return this.request<any>(`/tasks/${data.taskId}/context-rules`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateContextRule(id: number, data: any) {\n    return this.request<any>(`/context-rules/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteContextRule(id: number) {\n    return this.request<{ message: string }>(`/context-rules/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // ============================================\n  // Advanced AI Rules - Training Examples\n  // ============================================\n  \n  async getTrainingExamples(taskId?: number | null) {\n    const url = taskId ? `/training-examples?taskId=${taskId}` : `/training-examples`;\n    return this.request<any[]>(url);\n  }\n\n  async createTrainingExample(data: any) {\n    return this.request<any>(`/training-examples`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateTrainingExample(id: number, data: any) {\n    return this.request<any>(`/training-examples/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteTrainingExample(id: number) {\n    return this.request<{ message: string }>(`/training-examples/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // ============================================\n  // Advanced AI Rules - Processing Config\n  // ============================================\n  \n  async getProcessingConfig(taskId?: number) {\n    const url = taskId ? `/processing-config?taskId=${taskId}` : `/processing-config`;\n    return this.request<any>(url);\n  }\n\n  async saveProcessingConfig(data: any) {\n    return this.request<any>(`/processing-config`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  // ============================================\n  // Content Filters\n  // ============================================\n  \n  async getContentFilters(taskId: number) {\n    return this.request<any[]>(`/tasks/${taskId}/content-filters`);\n  }\n\n  async createContentFilter(data: any) {\n    return this.request<any>(`/tasks/${data.taskId}/content-filters`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateContentFilter(id: number, data: any) {\n    return this.request<any>(`/content-filters/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteContentFilter(id: number) {\n    return this.request<{ message: string }>(`/content-filters/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // ============================================\n  // Publishing Templates\n  // ============================================\n  \n  async getPublishingTemplates(taskId: number) {\n    return this.request<any[]>(`/tasks/${taskId}/publishing-templates`);\n  }\n\n  async getPublishingTemplate(templateId: number) {\n    return this.request<any>(`/publishing-templates/${templateId}`);\n  }\n\n  async createPublishingTemplate(data: any) {\n    return this.request<any>(`/tasks/${data.taskId}/publishing-templates`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updatePublishingTemplate(id: number, data: any) {\n    return this.request<any>(`/publishing-templates/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deletePublishingTemplate(id: number) {\n    return this.request<{ message: string }>(`/publishing-templates/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // ============================================\n  // Template Custom Fields\n  // ============================================\n  \n  async getTemplateCustomFields(templateId: number) {\n    return this.request<any[]>(`/publishing-templates/${templateId}/custom-fields`);\n  }\n\n  async createTemplateCustomField(templateId: number, data: any) {\n    return this.request<any>(`/publishing-templates/${templateId}/custom-fields`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateTemplateCustomField(id: number, data: any) {\n    return this.request<any>(`/custom-fields/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteTemplateCustomField(id: number) {\n    return this.request<{ message: string }>(`/custom-fields/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  async reorderTemplateCustomFields(templateId: number, fieldOrders: { id: number; order: number }[]) {\n    return this.request<{ message: string }>(`/publishing-templates/${templateId}/custom-fields/reorder`, {\n      method: \"POST\",\n      body: JSON.stringify({ fieldOrders }),\n    });\n  }\n\n  // ============================================\n  // Message Archive\n  // ============================================\n  \n  async getArchiveMessages(filters: {\n    taskId?: number;\n    search?: string;\n    classification?: string;\n    province?: string;\n    specialist?: string;\n    newsType?: string;\n    status?: string;\n    dateFrom?: string;\n    dateTo?: string;\n    isPinned?: boolean;\n    isFlagged?: boolean;\n    hasMedia?: boolean;\n    limit?: number;\n    offset?: number;\n    sortBy?: string;\n    sortOrder?: 'asc' | 'desc';\n  } = {}) {\n    const params = new URLSearchParams();\n    Object.entries(filters).forEach(([key, value]) => {\n      if (value !== undefined && value !== null && value !== '') {\n        params.append(key, String(value));\n      }\n    });\n    return this.request<{ messages: any[]; total: number }>(`/archive?${params.toString()}`);\n  }\n\n  async getArchiveMessage(id: number) {\n    return this.request<any>(`/archive/${id}`);\n  }\n\n  async getArchiveStats(taskId?: number) {\n    const url = taskId ? `/archive/stats?taskId=${taskId}` : '/archive/stats';\n    return this.request<{\n      totalMessages: number;\n      todayMessages: number;\n      pinnedMessages: number;\n      flaggedMessages: number;\n      byClassification: { classification: string; count: number }[];\n      byProvince: { province: string; count: number }[];\n      byNewsType: { newsType: string; count: number }[];\n      recentActivity: { date: string; count: number }[];\n    }>(url);\n  }\n\n  async getArchiveFilterOptions(taskId?: number) {\n    const url = taskId ? `/archive/filters?taskId=${taskId}` : '/archive/filters';\n    return this.request<{\n      classifications: string[];\n      provinces: string[];\n      newsTypes: string[];\n      specialists: string[];\n    }>(url);\n  }\n\n  async updateArchiveMessage(id: number, data: any) {\n    return this.request<any>(`/archive/${id}`, {\n      method: \"PUT\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteArchiveMessage(id: number) {\n    return this.request<{ message: string }>(`/archive/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  async toggleArchivePin(id: number) {\n    return this.request<any>(`/archive/${id}/toggle-pin`, {\n      method: \"POST\",\n    });\n  }\n\n  async toggleArchiveFlag(id: number, reason?: string) {\n    return this.request<any>(`/archive/${id}/toggle-flag`, {\n      method: \"POST\",\n      body: JSON.stringify({ reason }),\n    });\n  }\n\n  // ============================================\n  // Summarization Rules\n  // ============================================\n\n  async getSummarizationRules(taskId: number) {\n    return this.request<any[]>(`/tasks/${taskId}/summarization-rules`);\n  }\n\n  async createSummarizationRule(data: any) {\n    return this.request<any>(`/tasks/${data.taskId}/summarization-rules`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateSummarizationRule(id: number, data: any) {\n    return this.request<any>(`/summarization-rules/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async toggleSummarizationRule(id: number) {\n    return this.request<any>(`/summarization-rules/${id}/toggle`, {\n      method: \"POST\",\n    });\n  }\n\n  async deleteSummarizationRule(id: number) {\n    return this.request<{ message: string }>(`/summarization-rules/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // ============================================\n  // Video Processing Rules\n  // ============================================\n\n  async getVideoProcessingRules(taskId: number) {\n    return this.request<any[]>(`/tasks/${taskId}/video-processing-rules`);\n  }\n\n  async createVideoProcessingRule(data: any) {\n    return this.request<any>(`/tasks/${data.taskId}/video-processing-rules`, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateVideoProcessingRule(id: number, data: any) {\n    return this.request<any>(`/video-processing-rules/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async toggleVideoProcessingRule(id: number) {\n    return this.request<any>(`/video-processing-rules/${id}/toggle`, {\n      method: \"POST\",\n    });\n  }\n\n  async deleteVideoProcessingRule(id: number) {\n    return this.request<{ message: string }>(`/video-processing-rules/${id}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  // Text-to-Speech (TTS)\n  async getTTSVoices() {\n    return this.request<{\n      id: string;\n      name: string;\n      language: string;\n      gender: string;\n      description: string;\n    }[]>(\"/tts/voices\");\n  }\n\n  async getTTSStatus() {\n    return this.request<{\n      configured: boolean;\n      message: string;\n    }>(\"/tts/status\");\n  }\n\n  async textToSpeech(text: string, voice: string = \"Ahmad-PlayAI\") {\n    return this.request<{\n      audio: string;\n      format: string;\n      voice: string;\n      textLength: number;\n      needsApiKey?: boolean;\n    }>(\"/tts/speak\", {\n      method: \"POST\",\n      body: JSON.stringify({ text, voice }),\n    });\n  }\n}\n\nexport const api = new ApiClient();\n","path":null,"size_bytes":16533,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"telegram_bot/handlers/__init__.py":{"content":"# Handlers package\n","path":null,"size_bytes":19,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"telegram_bot/config/settings.py":{"content":"\"\"\"\nConfiguration settings for the Telegram Bot\nCentralized configuration management with environment variables\nSupports both Bot mode and Userbot mode for channel monitoring\n\"\"\"\nimport os\nimport re\nfrom typing import Optional\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n\ndef get_database_url() -> str:\n    \"\"\"\n    Get database URL from DATABASE_URL secret.\n    Handles multi-host URLs by using primary host only.\n    \"\"\"\n    from urllib.parse import urlparse, urlunparse\n\n    url = os.getenv(\"DATABASE_URL\", \"\")\n    if not url:\n        return url\n\n    if ',' not in url:\n        if 'sslmode=' not in url:\n            url += ('&' if '?' in url else '?') + 'sslmode=require'\n        print(f\"[Settings] Using DATABASE_URL\")\n        return url\n\n    try:\n        parsed = urlparse(url)\n        hosts = parsed.netloc.split('@')[-1]\n        primary_host = hosts.split(',')[0].strip()\n\n        user_pass = parsed.netloc.split('@')[0] if '@' in parsed.netloc else ''\n        new_netloc = f\"{user_pass}@{primary_host}\" if user_pass else primary_host\n\n        sanitized_url = urlunparse((\n            parsed.scheme,\n            new_netloc,\n            parsed.path,\n            parsed.params,\n            parsed.query,\n            parsed.fragment\n        ))\n\n        if 'sslmode=' not in sanitized_url:\n            sanitized_url += ('&' if '?' in sanitized_url else '?') + 'sslmode=require'\n\n        print(f\"[Settings] Using primary host from multi-host DATABASE_URL\")\n        return sanitized_url\n    except Exception as e:\n        print(f\"[Settings] Error parsing DATABASE_URL: {e}\")\n        return url\n\n\nclass Settings:\n    \"\"\"Application settings\"\"\"\n\n    # Telegram Configuration\n    BOT_TOKEN: str = os.getenv(\"BOT_TOKEN\") or \"\"\n    API_ID: int = int(os.getenv(\"API_ID\") or \"0\")\n    API_HASH: str = os.getenv(\"API_HASH\") or \"\"\n\n    # Admin Configuration\n    BOT_ADMIN_ID: int = int(os.getenv(\"BOT_ADMIN_ID\") or \"0\")\n\n    # Userbot Configuration (Required for receiving channel messages)\n    # Bots cannot receive messages from channels - need user session\n    PHONE_NUMBER: Optional[str] = os.getenv(\"PHONE_NUMBER\")\n    SESSION_STRING: Optional[str] = os.getenv(\"SESSION_STRING\")\n\n    # Database (use local Replit database if available)\n    DATABASE_URL: str = get_database_url()\n\n    # AI Providers\n    OPENAI_API_KEY: Optional[str] = os.getenv(\"OPENAI_API_KEY\")\n    GROQ_API_KEY: Optional[str] = os.getenv(\"GROQ_API_KEY\")\n    ANTHROPIC_API_KEY: Optional[str] = os.getenv(\"ANTHROPIC_API_KEY\")\n    HUGGINGFACE_API_KEY: Optional[str] = os.getenv(\"HUGGINGFACE_API_KEY\")\n\n    # Redis\n    REDIS_URL: str = os.getenv(\"REDIS_URL\", \"redis://localhost:6379/0\")\n\n    # Webhook\n    WEBHOOK_URL: str = os.getenv(\"WEBHOOK_URL\", \"\")\n    WEBHOOK_PORT: int = int(os.getenv(\"WEBHOOK_PORT\", \"8443\"))\n    USE_WEBHOOK: bool = os.getenv(\"USE_WEBHOOK\", \"true\").lower() == \"true\"\n\n    # API Server\n    API_HOST: str = os.getenv(\"API_HOST\", \"0.0.0.0\")\n    API_PORT: int = int(os.getenv(\"API_PORT\", \"8000\"))\n\n    # Worker Configuration\n    MAX_WORKERS: int = int(os.getenv(\"MAX_WORKERS\", \"10\"))\n    QUEUE_MAX_SIZE: int = int(os.getenv(\"QUEUE_MAX_SIZE\", \"1000\"))\n\n    # AI Models Configuration\n    AI_MODELS = {\n        \"openai\": [\n            {\"name\": \"gpt-4-turbo-preview\", \"display\": \"GPT-4 Turbo\", \"type\": \"text\"},\n            {\"name\": \"gpt-4\", \"display\": \"GPT-4\", \"type\": \"text\"},\n            {\"name\": \"gpt-3.5-turbo\", \"display\": \"GPT-3.5 Turbo\", \"type\": \"text\"},\n        ],\n        \"groq\": [\n            # Production Models - ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨\n            {\"name\": \"llama-3.1-8b-instant\", \"display\": \"LLaMA 3.1 8B Instant\", \"type\": \"text\"},\n            {\"name\": \"llama-3.3-70b-versatile\", \"display\": \"LLaMA 3.3 70B Versatile\", \"type\": \"text\"},\n            {\"name\": \"meta-llama/llama-guard-4-12b\", \"display\": \"LLaMA Guard 4 12B\", \"type\": \"text\"},\n            {\"name\": \"openai/gpt-oss-120b\", \"display\": \"GPT OSS 120B\", \"type\": \"text\"},\n            {\"name\": \"openai/gpt-oss-20b\", \"display\": \"GPT OSS 20B\", \"type\": \"text\"},\n            {\"name\": \"whisper-large-v3\", \"display\": \"Whisper Large v3\", \"type\": \"audio\"},\n            {\"name\": \"whisper-large-v3-turbo\", \"display\": \"Whisper Large v3 Turbo\", \"type\": \"audio\"},\n            \n            # Preview Models - ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑŸÖÿπÿßŸäŸÜÿ©\n            {\"name\": \"meta-llama/llama-4-maverick-17b-128e-instruct\", \"display\": \"Llama 4 Maverick 17B 128E\", \"type\": \"text\"},\n            {\"name\": \"meta-llama/llama-4-scout-17b-16e-instruct\", \"display\": \"Llama 4 Scout 17B 16E\", \"type\": \"text\"},\n            {\"name\": \"moonshotai/kimi-k2-instruct-0905\", \"display\": \"Kimi K2\", \"type\": \"text\"},\n            {\"name\": \"openai/gpt-oss-safeguard-20b\", \"display\": \"Safety GPT OSS 20B\", \"type\": \"text\"},\n            {\"name\": \"playai-tts\", \"display\": \"PlayAI TTS\", \"type\": \"tts\"},\n            {\"name\": \"playai-tts-arabic\", \"display\": \"PlayAI TTS Arabic\", \"type\": \"tts\"},\n            {\"name\": \"qwen/qwen3-32b\", \"display\": \"Qwen 3 32B\", \"type\": \"text\"},\n            \n            # Legacy Models (Still Supported) - ŸÜŸÖÿßÿ∞ÿ¨ ŸÇÿØŸäŸÖÿ© (ŸÖÿØÿπŸàŸÖÿ©)\n            {\"name\": \"mixtral-8x7b-32768\", \"display\": \"Mixtral 8x7B\", \"type\": \"text\"},\n            {\"name\": \"gemma-7b-it\", \"display\": \"Gemma 7B\", \"type\": \"text\"},\n            {\"name\": \"llama-3.3-70b-specdec\", \"display\": \"LLaMA 3.3 70B SpecDec\", \"type\": \"text\"},\n            {\"name\": \"llama-guard-3-8b\", \"display\": \"LLaMA Guard 3 8B\", \"type\": \"text\"},\n            {\"name\": \"llama3-groq-70b-8192-tool-use-preview\", \"display\": \"LLaMA 3 Groq 70B Tool Use\", \"type\": \"text\"},\n            {\"name\": \"llama3-groq-8b-8192-tool-use-preview\", \"display\": \"LLaMA 3 Groq 8B Tool Use\", \"type\": \"text\"},\n        ],\n        \"claude\": [\n            {\"name\": \"claude-3-opus-20240229\", \"display\": \"Claude 3 Opus\", \"type\": \"text\"},\n            {\"name\": \"claude-3-sonnet-20240229\", \"display\": \"Claude 3 Sonnet\", \"type\": \"text\"},\n            {\"name\": \"claude-3-haiku-20240307\", \"display\": \"Claude 3 Haiku\", \"type\": \"text\"},\n        ],\n        \"huggingface\": [\n            {\"name\": \"meta-llama/Llama-2-70b-chat-hf\", \"display\": \"LLaMA 2 70B Chat\", \"type\": \"text\"},\n            {\"name\": \"mistralai/Mixtral-8x7B-Instruct-v0.1\", \"display\": \"Mixtral 8x7B Instruct\", \"type\": \"text\"},\n            {\"name\": \"google/flan-t5-xxl\", \"display\": \"FLAN-T5 XXL\", \"type\": \"text\"},\n        ]\n    }\n\n    # Whisper Model for Video Processing\n    WHISPER_MODEL = \"whisper-large-v3-turbo\"\n\n    @classmethod\n    def is_userbot_mode(cls) -> bool:\n        \"\"\"Check if userbot mode is available (phone number or session string set)\"\"\"\n        return bool(cls.PHONE_NUMBER or cls.SESSION_STRING)\n\n    @classmethod\n    def validate(cls) -> bool:\n        \"\"\"Validate critical settings\"\"\"\n        required = [cls.API_ID, cls.API_HASH, cls.DATABASE_URL]\n        if not all(required):\n            return False\n\n        # Need either BOT_TOKEN or PHONE_NUMBER/SESSION_STRING\n        if not cls.BOT_TOKEN and not cls.is_userbot_mode():\n            return False\n\n        return True\n\n    @classmethod\n    def get_mode_description(cls) -> str:\n        \"\"\"Get description of current mode\"\"\"\n        if cls.is_userbot_mode():\n            return \"Userbot Mode (Can receive channel messages)\"\n        elif cls.BOT_TOKEN:\n            return \"Bot Mode (Limited - Cannot receive channel messages passively)\"\n        else:\n            return \"No authentication configured\"\n\nsettings = Settings()","path":null,"size_bytes":7386,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport { spawn, ChildProcess } from \"child_process\";\nimport { authServiceManager } from \"./auth-service-manager\";\nimport { logger } from \"./logger\";\nimport path from \"path\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\n// Auth Service Management\nasync function startAuthService() {\n  try {\n    await authServiceManager.start();\n  } catch (error) {\n    console.error(\"[auth-service] Failed to start:\", error);\n    console.log(\"[auth-service] Continuing without auth service...\");\n  }\n}\n\n// Telegram Bot Process Management\nlet botProcess: ChildProcess | null = null;\nlet botRestartAttempts = 0;\nconst MAX_RESTART_ATTEMPTS = 5;\nconst RESTART_DELAY = 5000;\n\nfunction startTelegramBot() {\n  if (botProcess) {\n    console.log(\"[telegram-bot] Bot process already running\");\n    return;\n  }\n\n  const botPath = path.join(process.cwd(), \"telegram_bot\");\n  console.log(`[telegram-bot] Starting bot from: ${botPath}`);\n\n  // Use python directly in Docker, uv in development\n  const command = process.env.NODE_ENV === \"production\" ? \"python\" : \"uv\";\n  const args = process.env.NODE_ENV === \"production\" \n    ? [\"main.py\"]\n    : [\"run\", \"python\", \"main.py\"];\n\n  botProcess = spawn(command, args, {\n    cwd: botPath,\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\n    env: { ...process.env, UV_PROJECT_ENVIRONMENT: \"venv\" },\n  });\n\n  botProcess.stdout?.on(\"data\", (data) => {\n    const lines = data.toString().trim().split(\"\\n\");\n    lines.forEach((line: string) => {\n      if (line.trim()) {\n        console.log(`[telegram-bot] ${line}`);\n        logger.info(\"telegram-bot\", \"process\", line);\n      }\n    });\n  });\n\n  botProcess.stderr?.on(\"data\", (data) => {\n    const lines = data.toString().trim().split(\"\\n\");\n    lines.forEach((line: string) => {\n      if (line.trim()) {\n        console.error(`[telegram-bot-err] ${line}`);\n        logger.error(\"telegram-bot\", \"process\", line);\n      }\n    });\n  });\n\n  botProcess.on(\"close\", (code) => {\n    console.log(`[telegram-bot] Process exited with code ${code}`);\n    botProcess = null;\n\n    // Auto-restart if not too many attempts\n    if (botRestartAttempts < MAX_RESTART_ATTEMPTS) {\n      botRestartAttempts++;\n      console.log(`[telegram-bot] Restarting in ${RESTART_DELAY / 1000}s (attempt ${botRestartAttempts}/${MAX_RESTART_ATTEMPTS})`);\n      setTimeout(startTelegramBot, RESTART_DELAY);\n    } else {\n      console.error(\"[telegram-bot] Max restart attempts reached. Bot stopped.\");\n    }\n  });\n\n  botProcess.on(\"error\", (err) => {\n    console.error(`[telegram-bot] Failed to start: ${err.message}`);\n    botProcess = null;\n  });\n\n  // Reset restart counter after successful run (30 seconds)\n  setTimeout(() => {\n    if (botProcess) {\n      botRestartAttempts = 0;\n    }\n  }, 30000);\n}\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"[server] SIGTERM received, shutting down...\");\n  if (botProcess) {\n    botProcess.kill(\"SIGTERM\");\n  }\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"[server] SIGINT received, shutting down...\");\n  if (botProcess) {\n    botProcess.kill(\"SIGTERM\");\n  }\n  process.exit(0);\n});\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n  logger.info(source, \"log\", message);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  // Ensure database tables exist before registering routes\n  const { ensureTablesExist } = await import(\"./storage\");\n  await ensureTablesExist();\n  \n  await registerRoutes(httpServer, app);\n\n  // Serve static assets (images, etc.)\n  app.use(\"/attached_assets\", express.static(path.join(process.cwd(), \"attached_assets\")));\n\n  // Middleware to handle 404 for API routes before Vite catches them\n  app.use(\"/api\", (req, res) => {\n    res.status(404).json({ error: \"API endpoint not found\", path: req.path });\n  });\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    async () => {\n      log(`serving on port ${port}`);\n      \n      // Start auth service first\n      await startAuthService();\n      \n      // Start Telegram bot after services are ready\n      log(\"Starting Telegram bot process...\");\n      startTelegramBot();\n    },\n  );\n})();\n","path":null,"size_bytes":6326,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n/* Local Fonts */\n@font-face {\n  font-family: 'Tajawal';\n  font-style: normal;\n  font-weight: 300;\n  font-display: swap;\n  src: url('@/assets/fonts/Tajawal-Light.woff2') format('woff2');\n}\n@font-face {\n  font-family: 'Tajawal';\n  font-style: normal;\n  font-weight: 400;\n  font-display: swap;\n  src: url('@/assets/fonts/Tajawal-Regular.woff2') format('woff2');\n}\n@font-face {\n  font-family: 'Tajawal';\n  font-style: normal;\n  font-weight: 500;\n  font-display: swap;\n  src: url('@/assets/fonts/Tajawal-Medium.woff2') format('woff2');\n}\n@font-face {\n  font-family: 'Tajawal';\n  font-style: normal;\n  font-weight: 700;\n  font-display: swap;\n  src: url('@/assets/fonts/Tajawal-Bold.woff2') format('woff2');\n}\n@font-face {\n  font-family: 'Tajawal';\n  font-style: normal;\n  font-weight: 800;\n  font-display: swap;\n  src: url('@/assets/fonts/Tajawal-ExtraBold.woff2') format('woff2');\n}\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --radius-sm: 0.25rem;\n  --radius-md: 0.5rem;\n  --radius-lg: 0.75rem;\n\n  --font-sans: \"Inter\", \"Tajawal\", sans-serif;\n  --font-mono: \"JetBrains Mono\", monospace;\n  --font-display: \"Orbitron\", sans-serif;\n  \n  --radius: 0.5rem;\n  \n  /* Theme Colors Mapped to CSS Variables */\n  --color-background: var(--background);\n  --color-foreground: var(--foreground);\n  --color-card: var(--card);\n  --color-card-foreground: var(--card-foreground);\n  --color-popover: var(--popover);\n  --color-popover-foreground: var(--popover-foreground);\n  --color-primary: var(--primary);\n  --color-primary-foreground: var(--primary-foreground);\n  --color-secondary: var(--secondary);\n  --color-secondary-foreground: var(--secondary-foreground);\n  --color-muted: var(--muted);\n  --color-muted-foreground: var(--muted-foreground);\n  --color-accent: var(--accent);\n  --color-accent-foreground: var(--accent-foreground);\n  --color-destructive: var(--destructive);\n  --color-destructive-foreground: var(--destructive-foreground);\n  --color-border: var(--border);\n  --color-input: var(--input);\n  --color-ring: var(--ring);\n\n  --color-chart-1: var(--chart-1);\n  --color-chart-2: var(--chart-2);\n  --color-chart-3: var(--chart-3);\n  --color-chart-4: var(--chart-4);\n  --color-chart-5: var(--chart-5);\n}\n\n@layer base {\n  :root {\n    /* Light Mode */\n    --background: 0 0% 98%;\n    --foreground: 240 10% 3.9%;\n    \n    --card: 0 0% 100%;\n    --card-foreground: 240 10% 3.9%;\n    \n    --popover: 0 0% 100%;\n    --popover-foreground: 240 10% 3.9%;\n    \n    --primary: 190 90% 40%;\n    --primary-foreground: 0 0% 98%;\n    \n    --secondary: 260 60% 60%;\n    --secondary-foreground: 0 0% 98%;\n    \n    --muted: 240 4.8% 95.9%;\n    --muted-foreground: 240 3.8% 46.1%;\n    \n    --accent: 240 4.8% 95.9%;\n    --accent-foreground: 240 5.9% 10%;\n    \n    --destructive: 0 84.2% 60.2%;\n    --destructive-foreground: 0 0% 98%;\n    \n    --border: 240 5.9% 90%;\n    --input: 240 5.9% 90%;\n    --ring: 190 90% 40%;\n\n    --chart-1: 190 90% 40%;\n    --chart-2: 260 60% 60%;\n    --chart-3: 320 60% 60%;\n    --chart-4: 45 90% 45%;\n    --chart-5: 150 90% 35%;\n\n    /* Sidebar Colors - Light Mode */\n    --sidebar: 0 0% 100%;\n    --sidebar-foreground: 240 10% 3.9%;\n    --sidebar-border: 240 5.9% 90%;\n    --sidebar-accent: 240 4.8% 95.9%;\n    --sidebar-accent-foreground: 240 5.9% 10%;\n    --sidebar-ring: 190 90% 40%;\n  }\n\n  .dark {\n    /* Dark Mode */\n    --background: 240 10% 4%;\n    --foreground: 0 0% 98%;\n    \n    --card: 240 10% 7%;\n    --card-foreground: 0 0% 98%;\n    \n    --popover: 240 10% 7%;\n    --popover-foreground: 0 0% 98%;\n    \n    --primary: 190 100% 50%;\n    --primary-foreground: 240 10% 4%;\n    \n    --secondary: 260 100% 65%;\n    --secondary-foreground: 0 0% 98%;\n    \n    --muted: 240 6% 15%;\n    --muted-foreground: 240 5% 65%;\n    \n    --accent: 240 6% 15%;\n    --accent-foreground: 0 0% 98%;\n    \n    --destructive: 0 62.8% 30.6%;\n    --destructive-foreground: 0 0% 98%;\n    \n    --border: 240 6% 15%;\n    --input: 240 6% 15%;\n    --ring: 190 100% 50%;\n\n    --chart-1: 190 100% 50%;\n    --chart-2: 260 100% 65%;\n    --chart-3: 320 100% 60%;\n    --chart-4: 45 100% 55%;\n    --chart-5: 150 100% 45%;\n\n    /* Sidebar Colors - Dark Mode */\n    --sidebar: 240 10% 7%;\n    --sidebar-foreground: 0 0% 98%;\n    --sidebar-border: 240 6% 15%;\n    --sidebar-accent: 240 6% 15%;\n    --sidebar-accent-foreground: 0 0% 98%;\n    --sidebar-ring: 190 100% 50%;\n  }\n\n  * {\n    @apply border-border;\n  }\n  \n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    min-height: 100vh;\n  }\n  \n  .dark body {\n    background-image: \n      radial-gradient(circle at 50% 0%, hsl(260 100% 65% / 0.05), transparent 40%),\n      radial-gradient(circle at 0% 50%, hsl(190 100% 50% / 0.05), transparent 40%);\n  }\n\n  body:not(.dark) {\n    background-image: \n      radial-gradient(circle at 50% 0%, hsl(220 100% 90% / 0.5), transparent 40%),\n      radial-gradient(circle at 0% 50%, hsl(190 100% 90% / 0.5), transparent 40%);\n  }\n\n  /* Custom scrollbar */\n  ::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n  }\n  ::-webkit-scrollbar-track {\n    background: transparent;\n  }\n  ::-webkit-scrollbar-thumb {\n    @apply bg-muted;\n    border-radius: 4px;\n  }\n  ::-webkit-scrollbar-thumb:hover {\n    @apply bg-muted-foreground;\n  }\n}\n\n@layer utilities {\n  .dark .glass-panel {\n    @apply bg-card/50 backdrop-blur-xl border border-white/5 shadow-xl;\n  }\n  \n  .glass-panel {\n    @apply bg-white/70 backdrop-blur-xl border border-black/5 shadow-lg;\n  }\n  \n  .dark .neon-text {\n    text-shadow: 0 0 10px hsl(var(--primary) / 0.5);\n  }\n  \n  .dark .neon-border {\n    box-shadow: 0 0 10px hsl(var(--primary) / 0.2);\n  }\n\n  /* Light mode dialog styles */\n  :not(.dark) {\n    --dialog-bg: hsl(var(--background));\n    --dialog-border: hsl(var(--border));\n    --dialog-text: hsl(var(--foreground));\n    --dialog-muted: hsl(var(--muted-foreground));\n  }\n\n  .dark {\n    --dialog-bg: hsl(var(--card));\n    --dialog-border: hsl(var(--border));\n    --dialog-text: hsl(var(--foreground));\n    --dialog-muted: hsl(var(--muted-foreground));\n  }\n\n  /* Ensure Dialog content respects theme */\n  [role=\"dialog\"] {\n    background-color: hsl(var(--background));\n    color: hsl(var(--foreground));\n  }\n\n  .dark [role=\"dialog\"] {\n    background-color: hsl(var(--card));\n    color: hsl(var(--foreground));\n  }\n}\n","path":null,"size_bytes":6331,"size_tokens":null},"telegram_bot/services/ai_providers.py":{"content":"\"\"\"\nAI Providers Integration\nSupport for OpenAI, Groq, Claude, and HuggingFace\n\"\"\"\nimport asyncio\nimport re\nfrom typing import Optional, Dict, Any\nfrom config.settings import settings\nfrom utils.error_handler import handle_errors, ErrorLogger\nfrom services.rate_limiter import rate_limiter\n\nerror_logger = ErrorLogger(\"ai_providers\")\n\n\ndef strip_thinking_tags(content: str) -> str:\n    \"\"\"\n    Strip <think>...</think> tags from AI model responses.\n    Some models like qwen/qwen3-32b include thinking tags in their output.\n    \"\"\"\n    if not content:\n        return content\n    \n    # Remove <think>...</think> blocks (including multiline)\n    cleaned = re.sub(r'<think>.*?</think>\\s*', '', content, flags=re.DOTALL | re.IGNORECASE)\n    \n    # Also handle unclosed <think> tags (just in case)\n    cleaned = re.sub(r'<think>.*$', '', cleaned, flags=re.DOTALL | re.IGNORECASE)\n    \n    return cleaned.strip()\n\nclass AIProvider:\n    \"\"\"Base AI Provider class\"\"\"\n    \n    def __init__(self, provider_name: str, api_key: str):\n        self.provider_name = provider_name\n        self.api_key = api_key\n    \n    async def generate_text(\n        self, \n        prompt: str, \n        model: str, \n        max_tokens: int = 8000,\n        temperature: float = 0.7\n    ) -> str:\n        \"\"\"Generate text from prompt\"\"\"\n        raise NotImplementedError\n\n\nclass OpenAIProvider(AIProvider):\n    \"\"\"OpenAI API Integration\"\"\"\n    \n    def __init__(self, api_key: str):\n        super().__init__(\"openai\", api_key)\n        self.client = None\n    \n    @handle_errors(\"ai_providers\", \"openai_generate\")\n    async def generate_text(\n        self,\n        prompt: str,\n        model: str = \"gpt-3.5-turbo\",\n        max_tokens: int = 8000,\n        temperature: float = 0.7,\n        tpm_limit: Optional[int] = None,\n        rpm_limit: Optional[int] = None,\n        tpd_limit: Optional[int] = None\n    ) -> str:\n        \"\"\"Generate text using OpenAI with fallback support and rate limiting\"\"\"\n        try:\n            from openai import AsyncOpenAI\n            \n            # Check rate limits before proceeding\n            if tpm_limit or rpm_limit or tpd_limit:\n                estimated_tokens = len(prompt.split()) + max_tokens  # Rough estimate\n                can_proceed, error_msg = await rate_limiter.can_request(\n                    model, estimated_tokens, tpm_limit, rpm_limit, tpd_limit\n                )\n                if not can_proceed:\n                    error_logger.log_warning(f\"[OpenAI] ‚ö†Ô∏è Rate limit check failed: {error_msg}\")\n                    raise Exception(f\"Rate limit exceeded: {error_msg}\")\n            \n            if not self.client:\n                self.client = AsyncOpenAI(api_key=self.api_key)\n            \n            error_logger.log_info(f\"[OpenAI] üì• INPUT | Model: {model} | Max Tokens: {max_tokens} | Input length: {len(prompt)} chars\")\n            error_logger.log_info(f\"[OpenAI] üìù PROMPT PREVIEW: {prompt[:500]}...\")\n            \n            # Map models to their actual equivalents or fallbacks\n            models_to_try = [model]\n            \n            # Build fallback chain based on model\n            model_lower = model.lower()\n            \n            # GPT-5.x family (future/beta models)\n            if \"gpt-5\" in model_lower:\n                models_to_try.extend([\"gpt-4o\", \"gpt-4-turbo\", \"gpt-4\"])\n            # GPT-4.1 family (future/beta models)\n            elif \"gpt-4.1\" in model_lower:\n                models_to_try.extend([\"gpt-4o\", \"gpt-4-turbo\", \"gpt-4\"])\n            # O3 family (reasoning models)\n            elif \"o3\" in model_lower:\n                models_to_try.extend([\"gpt-4o\", \"gpt-4-turbo\", \"gpt-4\"])\n            # O4 family (future reasoning)\n            elif \"o4\" in model_lower:\n                models_to_try.extend([\"gpt-4o\", \"gpt-4-turbo\", \"gpt-4\"])\n            # Current stable models\n            elif model_lower not in [\"gpt-4o\", \"gpt-4o-mini\", \"gpt-4-turbo\", \"gpt-4\", \"gpt-3.5-turbo\"]:\n                # Unknown model, try fallbacks\n                models_to_try.extend([\"gpt-4o\", \"gpt-4-turbo\", \"gpt-4\", \"gpt-3.5-turbo\"])\n            \n            # Per-model max_tokens limits\n            model_token_limits = {\n                \"gpt-5.1\": 16000,\n                \"gpt-5\": 16000,\n                \"gpt-5-mini\": 16000,\n                \"gpt-5-nano\": 16000,\n                \"gpt-5-pro\": 16000,\n                \"gpt-5.1-codex\": 16000,\n                \"gpt-5.1-codex-max\": 16000,\n                \"gpt-4.1\": 8192,\n                \"gpt-4.1-mini\": 8192,\n                \"gpt-4.1-nano\": 8192,\n                \"gpt-4o\": 4096,\n                \"gpt-4o-mini\": 4096,\n                \"gpt-4-turbo\": 4096,\n                \"gpt-4\": 8192,\n                \"o3\": 4096,\n                \"o3-pro\": 4096,\n                \"o3-mini\": 4096,\n                \"o3-deep-research\": 4096,\n                \"o4-mini\": 4096,\n                \"gpt-3.5-turbo\": 4096\n            }\n            \n            last_error = None\n            for try_model in models_to_try:\n                try:\n                    request_params = {\n                        \"model\": try_model,\n                        \"messages\": [{\"role\": \"user\", \"content\": prompt}]\n                    }\n                    \n                    # Determine token parameters based on model\n                    is_reasoning = \"o3\" in try_model.lower() or \"o4\" in try_model.lower()\n                    is_future = \"gpt-5\" in try_model.lower() or \"gpt-4.1\" in try_model.lower()\n                    \n                    # Get model-specific token limit, default to 4096\n                    model_limit = model_token_limits.get(try_model.lower(), 4096)\n                    adjusted_tokens = min(max_tokens, model_limit)\n                    \n                    # Clamp max_tokens based on model limits\n                    if is_reasoning or is_future:\n                        # Reasoning/future models: use max_completion_tokens\n                        request_params[\"max_completion_tokens\"] = adjusted_tokens\n                        error_logger.log_info(f\"[OpenAI] Using max_completion_tokens={adjusted_tokens} for {try_model} (limit: {model_limit})\")\n                    else:\n                        # All other models: use max_tokens\n                        request_params[\"max_tokens\"] = adjusted_tokens\n                        request_params[\"temperature\"] = temperature\n                        error_logger.log_info(f\"[OpenAI] Using max_tokens={adjusted_tokens} for {try_model} (limit: {model_limit})\")\n                    \n                    error_logger.log_info(f\"[OpenAI] üöÄ Trying model: {try_model}\")\n                    \n                    response = await self.client.chat.completions.create(**request_params)\n                    \n                    finish_reason = response.choices[0].finish_reason if response.choices else 'NO_CHOICES'\n                    usage_info = \"\"\n                    if hasattr(response, 'usage') and response.usage:\n                        usage_info = f\" | Tokens: prompt={response.usage.prompt_tokens}, completion={response.usage.completion_tokens}, total={response.usage.total_tokens}\"\n                    \n                    if not response.choices:\n                        error_logger.log_warning(f\"[OpenAI] ‚ö†Ô∏è No choices in response from {try_model}\")\n                        last_error = \"no_choices\"\n                        continue\n                    \n                    choice = response.choices[0]\n                    content = choice.message.content\n                    \n                    if hasattr(choice.message, 'reasoning') and choice.message.reasoning:\n                        error_logger.log_info(f\"[OpenAI] üß† Reasoning field (length: {len(choice.message.reasoning)})\")\n                    \n                    if finish_reason == 'length':\n                        error_logger.log_warning(f\"[OpenAI] ‚ö†Ô∏è Output truncated! finish_reason=length. Consider increasing max_tokens.\")\n                    \n                    if content and content.strip():\n                        if try_model != model:\n                            error_logger.log_info(f\"[OpenAI] ‚ÑπÔ∏è Using fallback model {try_model} instead of {model}\")\n                        error_logger.log_info(f\"[OpenAI] ‚úÖ SUCCESS | Model: {try_model} | Finish reason: {finish_reason}{usage_info}\")\n                        error_logger.log_info(f\"[OpenAI] üìù OUTPUT PREVIEW: {content[:300]}...\")\n                        return content.strip()\n                    else:\n                        error_logger.log_warning(f\"[OpenAI] ‚ö†Ô∏è Empty content from {try_model}!\")\n                        if hasattr(choice.message, 'refusal') and choice.message.refusal:\n                            error_logger.log_warning(f\"[OpenAI] Model refused: {choice.message.refusal}\")\n                        last_error = \"empty_content\"\n                        continue\n                        \n                except Exception as e:\n                    error_msg = str(e)\n                    error_logger.log_info(f\"[OpenAI] ‚ö†Ô∏è Model {try_model} failed | Error: {error_msg[:100]}\")\n                    last_error = error_msg\n                    continue\n            \n            # If all models failed\n            error_logger.log_warning(f\"[OpenAI] ‚ùå All models failed | Last error: {last_error}\")\n            raise Exception(f\"All OpenAI models failed. Last error: {last_error}\")\n                \n        except Exception as e:\n            error_logger.log_warning(f\"[OpenAI] ‚ùå Fatal error: {str(e)}\")\n            import traceback\n            error_logger.log_warning(f\"[OpenAI] Traceback: {traceback.format_exc()}\")\n            raise\n\n\nclass GroqProvider(AIProvider):\n    \"\"\"Groq API Integration\"\"\"\n    \n    def __init__(self, api_key: str):\n        super().__init__(\"groq\", api_key)\n        self.client = None\n    \n    @handle_errors(\"ai_providers\", \"groq_generate\")\n    async def generate_text(\n        self,\n        prompt: str,\n        model: str = \"llama-3.1-8b-instant\",\n        max_tokens: int = 8000,\n        temperature: float = 0.7\n    ) -> str:\n        \"\"\"Generate text using Groq with fallback models\"\"\"\n        try:\n            from groq import AsyncGroq\n            \n            if not self.client:\n                self.client = AsyncGroq(api_key=self.api_key)\n            \n            # Normalize old model names to new format\n            model_mapping = {\n                \"gpt-oss-120b\": \"openai/gpt-oss-120b\",\n                \"gpt-oss-20b\": \"openai/gpt-oss-20b\",\n                \"qwen-3-32b\": \"qwen/qwen3-32b\",\n                \"llama-4-scout\": \"meta-llama/llama-4-scout-17b-16e-instruct\",\n                \"llama-4-maverick\": \"meta-llama/llama-4-maverick-17b-128e-instruct\",\n                \"llama-3.3-70b\": \"llama-3.3-70b-versatile\",\n                \"kimi-k2\": \"moonshotai/kimi-k2-instruct-0905\"\n            }\n            if model in model_mapping:\n                model = model_mapping[model]\n            \n            # Model-specific max_tokens limits\n            model_max_tokens = {\n                \"openai/gpt-oss-120b\": 65536,\n                \"openai/gpt-oss-20b\": 65536,\n                \"qwen/qwen3-32b\": 40960,\n                \"meta-llama/llama-4-scout-17b-16e-instruct\": 8192,\n                \"meta-llama/llama-4-maverick-17b-128e-instruct\": 8192,\n                \"llama-3.3-70b-versatile\": 32768,\n                \"moonshotai/kimi-k2-instruct-0905\": 16384,\n                \"llama-3.1-8b-instant\": 131072\n            }\n            \n            # Ensure max_tokens doesn't exceed model limit\n            safe_max_tokens = min(max_tokens, model_max_tokens.get(model, max_tokens))\n            \n            # Log request details\n            error_logger.log_info(f\"[Groq] Starting request | Model: {model} | Max Tokens: {safe_max_tokens} | Temperature: {temperature} | Input length: {len(prompt)} chars\")\n            \n            # Define fallback models in case primary fails\n            # Using only available and confirmed working models\n            approved_models = [\n                \"openai/gpt-oss-120b\",\n                \"openai/gpt-oss-20b\",\n                \"qwen/qwen3-32b\",\n                \"meta-llama/llama-4-scout-17b-16e-instruct\",\n                \"meta-llama/llama-4-maverick-17b-128e-instruct\",\n                \"llama-3.3-70b-versatile\",\n                \"moonshotai/kimi-k2-instruct-0905\",\n                \"llama-3.1-8b-instant\"\n            ]\n            \n            models_to_try = [model]\n            # Add all approved models as fallback (except the primary model to avoid duplication)\n            for approved in approved_models:\n                if approved.lower() != model.lower() and approved not in models_to_try:\n                    models_to_try.append(approved)\n            \n            last_error = None\n            rate_limit_hit = False\n            for try_model in models_to_try:\n                try:\n                    # Get safe max_tokens for this model\n                    model_safe_max = min(max_tokens, model_max_tokens.get(try_model, max_tokens))\n                    \n                    # Prepare request parameters\n                    request_params = {\n                        \"model\": try_model,\n                        \"messages\": [{\"role\": \"user\", \"content\": prompt}],\n                        \"max_tokens\": model_safe_max,\n                        \"temperature\": temperature\n                    }\n                    \n                    response = await self.client.chat.completions.create(**request_params)\n                    \n                    # Extract content safely\n                    if response and response.choices and len(response.choices) > 0:\n                        content = response.choices[0].message.content\n                        if content and content.strip():\n                            # Clean thinking tags from models like qwen/qwen3-32b\n                            cleaned_content = strip_thinking_tags(content)\n                            if cleaned_content:\n                                if try_model != model:\n                                    error_logger.log_info(f\"[Groq] ‚ÑπÔ∏è Using fallback model {try_model} instead of {model}\")\n                                error_logger.log_info(f\"[Groq] ‚úÖ Success | Model: {try_model} | Output length: {len(cleaned_content)} chars | First 100 chars: {cleaned_content[:100]}\")\n                                return cleaned_content\n                            else:\n                                error_logger.log_warning(f\"[Groq] ‚ö†Ô∏è Content empty after stripping thinking tags | Model: {try_model}\")\n                                last_error = \"empty_after_cleanup\"\n                                continue\n                        else:\n                            error_logger.log_warning(f\"[Groq] ‚ö†Ô∏è Empty content from model {try_model}\")\n                            last_error = \"empty_content\"\n                            continue\n                    else:\n                        error_logger.log_warning(f\"[Groq] ‚ö†Ô∏è No choices in response | Model: {try_model}\")\n                        last_error = \"no_choices\"\n                        continue\n                        \n                except Exception as e:\n                    error_msg = str(e)\n                    error_logger.log_info(f\"[Groq] ‚ö†Ô∏è Model {try_model} failed | Error: {error_msg[:150]}\")\n                    \n                    # Check for rate limit error\n                    if \"rate_limit\" in error_msg.lower() or \"429\" in error_msg:\n                        error_logger.log_warning(f\"[Groq] ‚è±Ô∏è RATE LIMIT HIT | Groq daily token limit reached. Please wait or upgrade plan.\")\n                        rate_limit_hit = True\n                        last_error = f\"Rate limit: {error_msg[:100]}\"\n                        # Don't continue trying other models if rate limited\n                        break\n                    # Check for model not found\n                    elif \"model\" in error_msg.lower() and (\"not found\" in error_msg.lower() or \"does not exist\" in error_msg.lower()):\n                        error_logger.log_warning(f\"[Groq] ‚ùå Model {try_model} not available/doesn't exist\")\n                        last_error = f\"Model not found: {try_model}\"\n                        continue\n                    else:\n                        last_error = error_msg\n                        continue\n            \n            # If all models failed\n            if rate_limit_hit:\n                error_logger.log_warning(f\"[Groq] ‚ùå Rate limit reached - cannot continue with Groq | {last_error}\")\n            else:\n                error_logger.log_info(f\"[Groq] ‚ùå All models failed | Last error: {last_error}\")\n            return \"\"\n            \n        except Exception as e:\n            error_logger.log_info(f\"[Groq] ‚ùå Fatal error | Error: {str(e)}\")\n            raise\n\n\nclass ClaudeProvider(AIProvider):\n    \"\"\"Anthropic Claude API Integration\"\"\"\n    \n    def __init__(self, api_key: str):\n        super().__init__(\"claude\", api_key)\n        self.client = None\n    \n    @handle_errors(\"ai_providers\", \"claude_generate\")\n    async def generate_text(\n        self,\n        prompt: str,\n        model: str = \"claude-3-sonnet-20240229\",\n        max_tokens: int = 8000,\n        temperature: float = 0.7\n    ) -> str:\n        \"\"\"Generate text using Claude\"\"\"\n        try:\n            from anthropic import AsyncAnthropic\n            \n            if not self.client:\n                self.client = AsyncAnthropic(api_key=self.api_key)\n            \n            response = await self.client.messages.create(\n                model=model,\n                max_tokens=max_tokens,\n                temperature=temperature,\n                messages=[{\"role\": \"user\", \"content\": prompt}]\n            )\n            \n            # Extract text from response content safely\n            text_content = \"\"\n            if response.content and len(response.content) > 0:\n                block = response.content[0]\n                # Use getattr to safely access text attribute regardless of block type\n                text_content = getattr(block, 'text', '') or ''\n            return text_content\n        except Exception as e:\n            error_logger.log_info(f\"Claude error: {str(e)}\")\n            raise\n\n\nclass HuggingFaceProvider(AIProvider):\n    \"\"\"HuggingFace Inference API Integration\"\"\"\n    \n    def __init__(self, api_key: str):\n        super().__init__(\"huggingface\", api_key)\n    \n    @handle_errors(\"ai_providers\", \"huggingface_generate\")\n    async def generate_text(\n        self,\n        prompt: str,\n        model: str = \"meta-llama/Llama-2-70b-chat-hf\",\n        max_tokens: int = 8000,\n        temperature: float = 0.7\n    ) -> str:\n        \"\"\"Generate text using HuggingFace\"\"\"\n        try:\n            # Try to import huggingface_hub, return error message if not available\n            try:\n                from huggingface_hub import AsyncInferenceClient  # type: ignore\n            except ImportError:\n                error_logger.log_warning(\"huggingface_hub not installed, skipping HuggingFace provider\")\n                return \"\"\n            \n            client = AsyncInferenceClient(token=self.api_key)\n            \n            response = await client.text_generation(\n                prompt=prompt,\n                model=model,\n                max_new_tokens=max_tokens,\n                temperature=temperature\n            )\n            \n            return response or \"\"\n        except Exception as e:\n            error_logger.log_info(f\"HuggingFace error: {str(e)}\")\n            raise\n\n\nclass AIManager:\n    \"\"\"AI Manager to handle all providers\"\"\"\n    \n    def __init__(self):\n        self.providers: Dict[str, AIProvider] = {}\n        # Providers will be loaded from database in initialize_from_database()\n    \n    async def initialize_from_database(self):\n        \"\"\"Initialize providers from database\"\"\"\n        from utils.database import db\n        try:\n            active_providers = await db.get_active_providers()\n            error_logger.log_info(f\"[DB Init] Retrieved {len(active_providers)} active providers from database\")\n            \n            for provider_info in active_providers:\n                provider_name = provider_info.get(\"name\", \"\").lower()\n                api_key = provider_info.get(\"api_key\")\n                \n                error_logger.log_info(f\"[DB Init] Processing provider: {provider_name} | Has API key: {bool(api_key)}\")\n                \n                if not api_key:\n                    error_logger.log_warning(f\"[DB Init] No API key found for provider: {provider_name}\")\n                    continue\n                \n                if provider_name == \"openai\":\n                    self.providers[\"openai\"] = OpenAIProvider(api_key)\n                    error_logger.log_info(f\"[DB Init] ‚úÖ Loaded OpenAI provider from database\")\n                elif provider_name == \"groq\":\n                    self.providers[\"groq\"] = GroqProvider(api_key)\n                    error_logger.log_info(f\"[DB Init] ‚úÖ Loaded Groq provider from database\")\n                elif provider_name == \"claude\":\n                    self.providers[\"claude\"] = ClaudeProvider(api_key)\n                    error_logger.log_info(f\"[DB Init] ‚úÖ Loaded Claude provider from database\")\n                elif provider_name == \"huggingface\":\n                    self.providers[\"huggingface\"] = HuggingFaceProvider(api_key)\n                    error_logger.log_info(f\"[DB Init] ‚úÖ Loaded HuggingFace provider from database\")\n            \n            error_logger.log_info(f\"[DB Init] Providers available: {list(self.providers.keys())}\")\n        except Exception as e:\n            error_logger.log_warning(f\"[DB Init] Failed to initialize providers from database: {str(e)}\")\n    \n    @handle_errors(\"ai_manager\", \"generate\")\n    async def generate(\n        self,\n        provider: str,\n        model: str,\n        prompt: str,\n        max_tokens: int = 8000,\n        temperature: float = 0.7\n    ) -> Optional[str]:\n        \"\"\"Generate text using specified provider\"\"\"\n        if provider not in self.providers:\n            error_logger.log_warning(f\"Provider {provider} not available\")\n            return None\n        \n        return await self.providers[provider].generate_text(\n            prompt=prompt,\n            model=model,\n            max_tokens=max_tokens,\n            temperature=temperature\n        )\n    \n    @handle_errors(\"ai_manager\", \"summarize_text\")\n    async def summarize_text(\n        self,\n        text: str,\n        provider: str,\n        model: str,\n        custom_rule: Optional[str] = None,\n        system_prompt: Optional[str] = None,\n        max_tokens: Optional[int] = None\n    ) -> str:\n        \"\"\"\n        Summarize text using AI - combines system prompt and custom rule\n        \n        Args:\n            text: The text to summarize\n            provider: AI provider name (openai, groq, claude, huggingface)\n            model: Model name to use\n            custom_rule: Custom rule/prompt for summarization\n            system_prompt: System prompt to override default\n            max_tokens: Maximum tokens for response (auto-calculated if not provided)\n        \"\"\"\n        if not text or not text.strip():\n            error_logger.log_warning(\"[AIManager] Empty text provided for summarization\")\n            return text or \"\"\n        \n        text = text.strip()\n        text_length = len(text)\n        \n        if text_length < 50:\n            error_logger.log_info(f\"[AIManager] Text too short for summarization ({text_length} chars), returning as-is\")\n            return text\n        \n        base_prompt = system_prompt or \"ŸÇŸÖ ÿ®ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµ ÿßŸÑÿ™ÿßŸÑŸä ÿ®ÿ¥ŸÉŸÑ ŸÖŸàÿ¨ÿ≤ ŸàŸÖŸÅŸäÿØ:\"\n        \n        if custom_rule and custom_rule.strip():\n            final_prompt = f\"{base_prompt}\\n\\n{custom_rule.strip()}\"\n        else:\n            final_prompt = base_prompt\n            \n        prompt = f\"{final_prompt}\\n\\n{text}\"\n        \n        if max_tokens is None:\n            if text_length < 500:\n                max_tokens = 300\n            elif text_length < 1500:\n                max_tokens = 600\n            elif text_length < 4000:\n                max_tokens = 8000\n            else:\n                max_tokens = 1500\n        \n        error_logger.log_info(f\"[AIManager] Starting summarization | Provider: {provider} | Model: {model} | Input: {text_length} chars | Max tokens: {max_tokens}\")\n        \n        result = None\n        retry_count = 0\n        max_retries = 2\n        \n        while retry_count <= max_retries:\n            try:\n                result = await self.generate(\n                    provider=provider,\n                    model=model,\n                    prompt=prompt,\n                    max_tokens=max_tokens\n                )\n                if result and result.strip():\n                    break\n            except Exception as e:\n                error_logger.log_warning(f\"[AIManager] Summarization attempt {retry_count + 1} failed: {str(e)}\")\n            retry_count += 1\n            if retry_count <= max_retries:\n                await asyncio.sleep(1)\n        \n        if result and result.strip():\n            result = result.strip()\n            result_length = len(result)\n            if text_length > 0:\n                reduction_percent = max(0, min(100, 100 - (result_length * 100 // text_length)))\n            else:\n                reduction_percent = 0\n            \n            error_logger.log_info(f\"[AIManager] ‚úÖ Summarization complete | Provider: {provider} | Model: {model} | Output: {result_length} chars | Reduction: {text_length - result_length} chars ({reduction_percent}%)\")\n            error_logger.log_info(f\"[AIManager] Summary preview: {result[:150]}\")\n            return result\n        else:\n            error_logger.log_info(f\"[AIManager] ‚ö†Ô∏è Summarization failed after {max_retries + 1} attempts, returning original text | Provider: {provider} | Model: {model}\")\n            return text\n    \n    @handle_errors(\"ai_manager\", \"transcribe_audio\")\n    async def transcribe_audio(\n        self, \n        audio_file_path: str, \n        language: str = \"auto\",\n        response_format: str = \"text\",\n        prompt: Optional[str] = None\n    ) -> str:\n        \"\"\"\n        Transcribe audio using Groq Whisper API with OpenAI Whisper as fallback\n        \n        Args:\n            audio_file_path: Path to audio file\n            language: Language code (ar, en, fr, es, de, etc.) or \"auto\" for detection\n            response_format: Output format (text, json, verbose_json, srt, vtt)\n            prompt: Optional prompt to guide transcription style/context\n            \n        Supported languages with high accuracy:\n            ar (Arabic), en (English), fr (French), es (Spanish), de (German),\n            ru (Russian), zh (Chinese), ja (Japanese), ko (Korean), tr (Turkish),\n            pt (Portuguese), it (Italian), nl (Dutch), pl (Polish), hi (Hindi),\n            id (Indonesian), vi (Vietnamese), th (Thai), he (Hebrew), fa (Persian)\n        \"\"\"\n        import os\n        \n        if not os.path.exists(audio_file_path):\n            raise FileNotFoundError(f\"Audio file not found: {audio_file_path}\")\n        \n        file_size = os.path.getsize(audio_file_path)\n        file_size_mb = file_size / (1024 * 1024)\n        error_logger.log_info(f\"[Whisper] Starting transcription | File: {audio_file_path} | Size: {file_size_mb:.2f}MB | Language: {language}\")\n        \n        ext = os.path.splitext(audio_file_path)[1].lower()\n        mime_types = {\n            '.mp3': 'audio/mpeg',\n            '.mp4': 'audio/mp4',\n            '.m4a': 'audio/mp4',\n            '.wav': 'audio/wav',\n            '.ogg': 'audio/ogg',\n            '.oga': 'audio/ogg',\n            '.opus': 'audio/opus',\n            '.flac': 'audio/flac',\n            '.webm': 'audio/webm',\n            '.aac': 'audio/aac'\n        }\n        mime_type = mime_types.get(ext, 'audio/mpeg')\n        \n        # Build default prompt if not provided - preserves English words in mixed Arabic/English text\n        if not prompt:\n            prompt = \"ÿ£ÿ±ÿ¨ŸàŸÉ ÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ÿ¨ŸÖŸäÿπ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© ŸÉŸÖÿß ŸáŸä ÿ®ÿØŸàŸÜ ÿ™ÿ≠ŸàŸäŸÑŸáÿß ÿ•ŸÑŸâ ÿπÿ±ÿ®Ÿä. Keep all English words in English. ÿßŸÉÿ™ÿ® ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© ÿ®ÿ≠ÿ±ŸàŸÅ ŸÑÿßÿ™ŸäŸÜŸäÿ© ŸÅŸÇÿ∑.\"\n        \n        groq_error = None\n        \n        # Try Groq Whisper first\n        try:\n            groq_api_key = settings.GROQ_API_KEY or (self.providers[\"groq\"].api_key if \"groq\" in self.providers else None)\n            \n            if groq_api_key:\n                error_logger.log_info(f\"[Whisper] Trying Groq Whisper API first...\")\n                from groq import Groq\n                \n                client = Groq(api_key=groq_api_key)\n                \n                transcribe_params = {\n                    \"model\": \"whisper-large-v3-turbo\",\n                    \"response_format\": response_format,\n                    \"prompt\": prompt\n                }\n                \n                if language != \"auto\":\n                    transcribe_params[\"language\"] = language\n                    error_logger.log_info(f\"[Whisper] Using specified language: {language}\")\n                else:\n                    error_logger.log_info(f\"[Whisper] Auto-detecting language...\")\n                \n                with open(audio_file_path, \"rb\") as audio_file:\n                    error_logger.log_info(f\"[Whisper] Sending to Groq Whisper API (whisper-large-v3-turbo) | MIME: {mime_type}\")\n                    \n                    transcript = client.audio.transcriptions.create(\n                        file=(os.path.basename(audio_file_path), audio_file, mime_type),\n                        **transcribe_params\n                    )\n                \n                transcribed_text = transcript.text if hasattr(transcript, 'text') else str(transcript)\n                \n                if transcribed_text and transcribed_text.strip():\n                    transcribed_text = transcribed_text.strip()\n                    detected_lang = self._detect_text_language(transcribed_text)\n                    error_logger.log_info(f\"[Whisper] ‚úÖ Groq transcription complete | Length: {len(transcribed_text)} chars | Detected language: {detected_lang}\")\n                    error_logger.log_info(f\"[Whisper] Preview: {transcribed_text[:150]}...\")\n                    return transcribed_text\n                else:\n                    groq_error = \"Empty transcription result from Groq\"\n                    error_logger.log_warning(f\"[Whisper] ‚ö†Ô∏è {groq_error}\")\n            else:\n                groq_error = \"Groq API key not available\"\n                error_logger.log_warning(f\"[Whisper] ‚ö†Ô∏è {groq_error}\")\n                \n        except Exception as e:\n            groq_error = str(e)\n            error_logger.log_warning(f\"[Whisper] ‚ö†Ô∏è Groq Whisper failed: {groq_error}\")\n        \n        # Fallback to OpenAI Whisper\n        error_logger.log_info(f\"[Whisper] üîÑ Falling back to OpenAI Whisper API...\")\n        \n        try:\n            openai_api_key = settings.OPENAI_API_KEY or (self.providers[\"openai\"].api_key if \"openai\" in self.providers else None)\n            \n            if not openai_api_key:\n                raise Exception(f\"OpenAI API key not available. Groq error: {groq_error}\")\n            \n            from openai import OpenAI\n            \n            client = OpenAI(api_key=openai_api_key)\n            \n            with open(audio_file_path, \"rb\") as audio_file:\n                error_logger.log_info(f\"[Whisper] Sending to OpenAI Whisper API (whisper-1) | MIME: {mime_type} | Timeout: 120s\")\n                error_logger.log_info(f\"[Whisper] Using prompt to preserve English words in mixed-language content\")\n                \n                transcribe_kwargs = {\n                    \"model\": \"whisper-1\",\n                    \"file\": audio_file,\n                    \"response_format\": \"text\",\n                    \"prompt\": prompt\n                }\n                \n                if language != \"auto\":\n                    transcribe_kwargs[\"language\"] = language\n                \n                # Create client with timeout to prevent hanging\n                client_with_timeout = OpenAI(api_key=openai_api_key, timeout=120)\n                \n                transcript = client_with_timeout.audio.transcriptions.create(**transcribe_kwargs)\n            \n            transcribed_text = transcript if isinstance(transcript, str) else (transcript.text if hasattr(transcript, 'text') else str(transcript))\n            \n            if not transcribed_text or not transcribed_text.strip():\n                error_logger.log_warning(f\"[Whisper] ‚ö†Ô∏è Empty transcription result from OpenAI\")\n                raise Exception(f\"Both Groq and OpenAI returned empty transcription. Groq error: {groq_error}\")\n            \n            transcribed_text = transcribed_text.strip()\n            detected_lang = self._detect_text_language(transcribed_text)\n            error_logger.log_info(f\"[Whisper] ‚úÖ OpenAI transcription complete | Length: {len(transcribed_text)} chars | Detected language: {detected_lang}\")\n            error_logger.log_info(f\"[Whisper] Preview: {transcribed_text[:150]}...\")\n            \n            return transcribed_text\n            \n        except Exception as e:\n            error_logger.log_info(f\"[Whisper] ‚ùå OpenAI Whisper also failed: {str(e)}\")\n            raise Exception(f\"Transcription failed with both providers. Groq: {groq_error}, OpenAI: {str(e)}\")\n    \n    def _detect_text_language(self, text: str) -> str:\n        \"\"\"Detect the primary language of transcribed text\"\"\"\n        if not text:\n            return \"unknown\"\n        \n        sample = text[:500]\n        \n        arabic_chars = sum(1 for c in sample if '\\u0600' <= c <= '\\u06FF' or '\\u0750' <= c <= '\\u077F')\n        hebrew_chars = sum(1 for c in sample if '\\u0590' <= c <= '\\u05FF')\n        cjk_chars = sum(1 for c in sample if '\\u4E00' <= c <= '\\u9FFF' or '\\u3040' <= c <= '\\u30FF' or '\\uAC00' <= c <= '\\uD7AF')\n        cyrillic_chars = sum(1 for c in sample if '\\u0400' <= c <= '\\u04FF')\n        thai_chars = sum(1 for c in sample if '\\u0E00' <= c <= '\\u0E7F')\n        latin_chars = sum(1 for c in sample if 'A' <= c <= 'Z' or 'a' <= c <= 'z')\n        \n        total_chars = len(sample.replace(' ', ''))\n        if total_chars == 0:\n            return \"unknown\"\n        \n        if arabic_chars / total_chars > 0.3:\n            return \"ar\"\n        elif hebrew_chars / total_chars > 0.3:\n            return \"he\"\n        elif cjk_chars / total_chars > 0.3:\n            return \"cjk\"\n        elif cyrillic_chars / total_chars > 0.3:\n            return \"ru\"\n        elif thai_chars / total_chars > 0.3:\n            return \"th\"\n        elif latin_chars / total_chars > 0.5:\n            return \"en/latin\"\n        \n        return \"mixed\"\n\n# Global AI manager instance\nai_manager = AIManager()\n","path":null,"size_bytes":34969,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"telegram_bot/utils/__init__.py":{"content":"# Utils package\n","path":null,"size_bytes":16,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nlet dbUrl = process.env.DATABASE_URL.includes(',') \n  ? process.env.DATABASE_URL.split(',')[0]\n  : process.env.DATABASE_URL;\n\nif (!dbUrl.includes('sslmode=')) {\n  dbUrl += (dbUrl.includes('?') ? '&' : '?') + 'sslmode=require';\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: dbUrl,\n  },\n});\n","path":null,"size_bytes":536,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Link } from \"wouter\";\nimport { AlertTriangle, ArrowLeft } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex flex-col items-center justify-center bg-background text-white font-sans relative overflow-hidden\">\n      {/* Background Grid */}\n      <div className=\"absolute inset-0 pointer-events-none z-0 opacity-20\" \n             style={{ \n               backgroundImage: 'linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px)', \n               backgroundSize: '40px 40px' \n             }} \n      />\n      \n      <div className=\"z-10 text-center space-y-6 p-8 glass-panel rounded-2xl max-w-md mx-4 border-red-500/20 shadow-[0_0_50px_rgba(239,68,68,0.1)]\">\n        <div className=\"inline-flex h-20 w-20 rounded-full bg-red-500/10 items-center justify-center border border-red-500/20 mb-2\">\n          <AlertTriangle className=\"h-10 w-10 text-red-500 animate-pulse\" />\n        </div>\n        \n        <div>\n          <h1 className=\"text-4xl font-display font-bold mb-2 text-white\">System Error 404</h1>\n          <p className=\"text-muted-foreground font-mono text-sm\">\n            MODULE_NOT_FOUND: The requested sector is unreachable or has been decommissioned.\n          </p>\n        </div>\n\n        <Link href=\"/\">\n          <Button className=\"w-full bg-white/5 hover:bg-white/10 border border-white/10 text-white gap-2\">\n            <ArrowLeft className=\"h-4 w-4\" /> Return to Nexus\n          </Button>\n        </Link>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1652,"size_tokens":null},"telegram_bot/services/ai_pipeline.py":{"content":"\"\"\"\nAI Processing Pipeline\nUnified 4-stage AI processing system\nStage 1: Preprocessing (Entity extraction, sentiment analysis)\nStage 2: Rule Engine (Entity replacement, context neutralization)\nStage 3: AI Summarization (Enhanced prompts with rules)\nStage 4: Postprocessing (Validation, verification, formatting)\n\"\"\"\nimport asyncio\nfrom typing import Dict, Any, List, Optional, Tuple\nfrom dataclasses import dataclass, field\nfrom datetime import datetime\nfrom utils.error_handler import ErrorLogger\nfrom utils.database import db\nfrom services.ai_preprocessing import preprocessing_engine, PreprocessingResult\nfrom services.ai_rule_engine import rule_engine, RuleEngineResult\nfrom services.ai_postprocessing import postprocessing_engine, PostprocessingResult\n\nerror_logger = ErrorLogger(\"ai_pipeline\")\n\n@dataclass\nclass PipelineStageResult:\n    \"\"\"Result from a single pipeline stage\"\"\"\n    stage_name: str\n    input_text: str\n    output_text: str\n    processing_time: float\n    success: bool\n    details: Dict[str, Any] = field(default_factory=dict)\n    error: Optional[str] = None\n\n@dataclass\nclass PipelineResult:\n    \"\"\"Complete pipeline processing result\"\"\"\n    original_text: str\n    final_text: str\n    stages: List[PipelineStageResult]\n    preprocessing: Optional[PreprocessingResult] = None\n    rule_engine: Optional[RuleEngineResult] = None\n    postprocessing: Optional[PostprocessingResult] = None\n    total_time: float = 0.0\n    quality_score: float = 1.0\n    success: bool = True\n    rules_applied_count: int = 0\n    entities_replaced: Dict[str, List[Tuple[str, str]]] = field(default_factory=dict)\n    warnings: List[str] = field(default_factory=list)\n    errors: List[str] = field(default_factory=list)\n    extracted_fields: Dict[str, Any] = field(default_factory=dict)\n\nclass AIPipeline:\n    \"\"\"\n    Main AI Processing Pipeline\n    Orchestrates all 4 stages of AI text processing\n    \"\"\"\n    \n    def __init__(self):\n        self.preprocessing = preprocessing_engine\n        self.rule_engine = rule_engine\n        self.postprocessing = postprocessing_engine\n        self.ai_manager = None\n        error_logger.log_info(\"[Pipeline] AI Processing Pipeline initialized\")\n    \n    def set_ai_manager(self, ai_manager):\n        \"\"\"Set the AI manager for text generation\"\"\"\n        self.ai_manager = ai_manager\n    \n    async def process(\n        self,\n        text: str,\n        task_id: int,\n        provider: str,\n        model: str,\n        system_prompt: Optional[str] = None,\n        custom_rules: Optional[List[Dict]] = None,\n        config: Optional[Dict[str, Any]] = None,\n        video_source_info: Optional[Dict[str, str]] = None,\n        fields_to_extract: Optional[List[Dict[str, Any]]] = None,\n        serial_number: Optional[int] = None\n    ) -> PipelineResult:\n        \"\"\"\n        Main pipeline processing function\n        Executes all 4 stages in order\n        \"\"\"\n        start_time = datetime.now()\n        config = config or await self._get_config(task_id)\n        \n        if not text or not text.strip():\n            return self._empty_result(text)\n        \n        stages = []\n        warnings = []\n        errors = []\n        current_text = text.strip()\n        \n        error_logger.log_info(f\"[Pipeline] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\")\n        error_logger.log_info(f\"[Pipeline] üöÄ STARTING PROCESSING | Task: {task_id} | Text length: {len(current_text)}\")\n        error_logger.log_info(f\"[Pipeline] üì• INPUT TEXT: {current_text[:200]}...\")\n        error_logger.log_info(f\"[Pipeline] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\")\n        \n        stage_start = datetime.now()\n        preprocessing_result = await self.preprocessing.process(current_text, config)\n        stage_time = (datetime.now() - stage_start).total_seconds()\n        \n        stages.append(PipelineStageResult(\n            stage_name='preprocessing',\n            input_text=current_text[:100],\n            output_text=preprocessing_result.cleaned_text[:100],\n            processing_time=stage_time,\n            success=True,\n            details={\n                'entities_found': len(preprocessing_result.entities),\n                'sentiment': preprocessing_result.sentiment.overall,\n                'keywords': len(preprocessing_result.keywords),\n                'language': preprocessing_result.language\n            }\n        ))\n        \n        error_logger.log_info(f\"[Pipeline] Stage 1 complete | Entities: {len(preprocessing_result.entities)} | Sentiment: {preprocessing_result.sentiment.overall}\")\n        \n        stage_start = datetime.now()\n        rule_result = await self.rule_engine.process(\n            current_text,\n            task_id,\n            preprocessing_result\n        )\n        stage_time = (datetime.now() - stage_start).total_seconds()\n        \n        current_text = rule_result.processed_text\n        \n        stages.append(PipelineStageResult(\n            stage_name='rule_engine',\n            input_text=text[:100],\n            output_text=current_text[:100],\n            processing_time=stage_time,\n            success=rule_result.success,\n            details={\n                'rules_applied': len(rule_result.rules_applied),\n                'replacements': rule_result.total_replacements,\n                'context_mods': len(rule_result.context_modifications)\n            },\n            error='; '.join(rule_result.errors) if rule_result.errors else None\n        ))\n        \n        warnings.extend(rule_result.errors)\n        \n        error_logger.log_info(f\"[Pipeline] Stage 2 complete | Rules: {len(rule_result.rules_applied)} | Replacements: {rule_result.total_replacements}\")\n        \n        # ‚úÖ Log detailed rules applied\n        if rule_result.rules_applied:\n            error_logger.log_info(f\"[Pipeline] üìã DETAILED RULES APPLIED:\")\n            for i, rule_app in enumerate(rule_result.rules_applied, 1):\n                error_logger.log_info(f\"[Pipeline]   Rule {i}: {rule_app.rule_name} (Type: {rule_app.rule_type})\")\n                if rule_app.changes_made:\n                    error_logger.log_info(f\"[Pipeline]     Changes: {len(rule_app.changes_made)} modifications\")\n        \n        # ‚úÖ Log text after rules processing\n        error_logger.log_info(f\"[Pipeline] üìù TEXT AFTER RULES: {current_text[:300]}...\")\n        \n        # Skip pre-truncation summarization rule - let AI do the actual summarization\n        # The AI will handle both summarization and rule application via custom_rules in prompt\n        \n        stage_start = datetime.now()\n        ai_output, extracted_fields = await self._process_with_ai(\n            current_text,\n            task_id,\n            provider,\n            model,\n            system_prompt,\n            custom_rules,\n            preprocessing_result,\n            rule_result,\n            config,\n            video_source_info=video_source_info,\n            fields_to_extract=fields_to_extract,\n            serial_number=serial_number\n        )\n        stage_time = (datetime.now() - stage_start).total_seconds()\n        \n        if ai_output and ai_output.strip():\n            stages.append(PipelineStageResult(\n                stage_name='ai_summarization',\n                input_text=current_text[:100],\n                output_text=ai_output[:100],\n                processing_time=stage_time,\n                success=True,\n                details={\n                    'provider': provider,\n                    'model': model,\n                    'input_length': len(current_text),\n                    'output_length': len(ai_output)\n                }\n            ))\n            error_logger.log_info(f\"[Pipeline] ‚úÖ Stage 3 AI SUCCESS | Input: {len(current_text)} ‚Üí Output: {len(ai_output)} chars\")\n            error_logger.log_info(f\"[Pipeline] üì§ AI OUTPUT: {ai_output[:300]}...\")\n            current_text = ai_output\n        else:\n            stages.append(PipelineStageResult(\n                stage_name='ai_summarization',\n                input_text=current_text[:100],\n                output_text=current_text[:100],\n                processing_time=stage_time,\n                success=False,\n                error='AI returned empty response'\n            ))\n            error_logger.log_warning(f\"[Pipeline] ‚ö†Ô∏è Stage 3 AI FAILED | Empty response from {provider}/{model}\")\n            error_logger.log_warning(f\"[Pipeline] ‚ö†Ô∏è Using original text (no summarization applied)\")\n            warnings.append('AI summarization failed, using rule-processed text')\n        \n        error_logger.log_info(f\"[Pipeline] Stage 3 complete | Output length: {len(current_text)}\")\n        \n        stage_start = datetime.now()\n        postprocess_result = await self.postprocessing.process(\n            current_text,\n            text,\n            rule_result,\n            config\n        )\n        stage_time = (datetime.now() - stage_start).total_seconds()\n        \n        final_text = postprocess_result.final_output\n        \n        stages.append(PipelineStageResult(\n            stage_name='postprocessing',\n            input_text=current_text[:100],\n            output_text=final_text[:100],\n            processing_time=stage_time,\n            success=postprocess_result.success,\n            details={\n                'validations': len(postprocess_result.validations),\n                'rules_verified': sum(1 for v in postprocess_result.rules_verified.values() if v),\n                'quality_score': postprocess_result.quality_score\n            }\n        ))\n        \n        warnings.extend(postprocess_result.warnings)\n        errors.extend(postprocess_result.errors)\n        \n        error_logger.log_info(f\"[Pipeline] Stage 4 complete | Quality: {postprocess_result.quality_score:.2f}\")\n        \n        total_time = (datetime.now() - start_time).total_seconds()\n        \n        result = PipelineResult(\n            original_text=text,\n            final_text=final_text,\n            stages=stages,\n            preprocessing=preprocessing_result,\n            rule_engine=rule_result,\n            postprocessing=postprocess_result,\n            total_time=total_time,\n            quality_score=postprocess_result.quality_score,\n            success=all(s.success for s in stages),\n            rules_applied_count=len(rule_result.rules_applied),\n            entities_replaced=rule_result.entities_replaced,\n            warnings=warnings,\n            errors=errors,\n            extracted_fields=extracted_fields or {}\n        )\n        \n        error_logger.log_info(\n            f\"[Pipeline] ‚úÖ COMPLETE | Total time: {total_time:.2f}s | \"\n            f\"Quality: {postprocess_result.quality_score:.2f} | \"\n            f\"Original: {len(text)} ‚Üí Final: {len(final_text)} chars\"\n        )\n        \n        reduction_pct = 100 - (len(final_text) * 100 // len(text)) if len(text) > 0 else 0\n        error_logger.log_info(\n            f\"[Pipeline] üìä SUMMARY: {len(text)} ‚Üí {len(final_text)} chars ({reduction_pct}% reduction) | \"\n            f\"Rules: {len(rule_result.rules_applied)} | Entities: {len(rule_result.entities_replaced)}\"\n        )\n        \n        return result\n    \n    async def _process_with_ai(\n        self,\n        text: str,\n        task_id: int,\n        provider: str,\n        model: str,\n        system_prompt: Optional[str],\n        custom_rules: Optional[List[Dict]],\n        preprocessing_result: PreprocessingResult,\n        rule_result: RuleEngineResult,\n        config: Dict[str, Any],\n        video_source_info: Optional[Dict[str, str]] = None,\n        fields_to_extract: Optional[List[Dict[str, Any]]] = None,\n        serial_number: Optional[int] = None\n    ) -> Tuple[str, Dict[str, Any]]:\n        \"\"\"\n        Stage 3: Process text with AI\n        Builds enhanced prompt with context from preprocessing and rules\n        Includes training examples for few-shot learning\n        \"\"\"\n        if not self.ai_manager:\n            from services.ai_providers import ai_manager\n            self.ai_manager = ai_manager\n        \n        # ‚úÖ Log input text for AI processing\n        error_logger.log_info(f\"[Pipeline] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\")\n        error_logger.log_info(f\"[Pipeline] ü§ñ STAGE 3: AI SUMMARIZATION\")\n        error_logger.log_info(f\"[Pipeline] üì• AI INPUT TEXT ({len(text)} chars):\")\n        error_logger.log_info(f\"[Pipeline] {text[:500]}...\")\n        error_logger.log_info(f\"[Pipeline] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\")\n        \n        training_examples = await self._get_training_examples(task_id)\n        error_logger.log_info(f\"[Pipeline] üìö Training Examples | Loaded: {len(training_examples)} for task {task_id}\")\n        if training_examples:\n            for i, ex in enumerate(training_examples[:3], 1):\n                error_logger.log_info(f\"[Pipeline]   üìù Example {i}: type={ex.get('example_type')} | input={ex.get('input_text', '')[:50]}... | output={ex.get('expected_output', '')[:50]}...\")\n        \n        # No token limit - let AI produce complete summary without cutoff\n        max_tokens = 128000  # No limit - allows full text generation without any restrictions\n        if custom_rules:\n            error_logger.log_info(f\"[Pipeline] ‚ö†Ô∏è SUMMARIZATION RULES ({len(custom_rules)} rules):\")\n            for i, rule in enumerate(custom_rules, 1):\n                rule_name = rule.get('name', 'Unknown')\n                rule_type = rule.get('type', 'unknown')\n                rule_prompt = rule.get('prompt', '')\n                rule_config = rule.get('config', {})\n                error_logger.log_info(f\"[Pipeline]   üìå Rule {i}: name={rule_name} | type={rule_type}\")\n                error_logger.log_info(f\"[Pipeline]      prompt={rule_prompt[:100]}...\")\n                error_logger.log_info(f\"[Pipeline]      config={str(rule_config)[:100]}...\")\n        else:\n            error_logger.log_info(f\"[Pipeline] ‚ö†Ô∏è SUMMARIZATION RULES: None provided\")\n        \n        # Initialize extracted fields with serial number\n        extracted_fields = {}\n        if serial_number is not None:\n            extracted_fields[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ\"] = f\"#{serial_number}\"\n            extracted_fields[\"ÿ±ŸÇŸÖ_ÿßŸÑŸÇŸäÿØ_\"] = f\"#{serial_number}\"\n            extracted_fields[\"serial_number\"] = serial_number\n        \n        # Build enhanced prompt including field extraction if needed\n        error_logger.log_info(f\"[Pipeline] üìù BUILDING ENHANCED PROMPT...\")\n        enhanced_prompt = self._build_enhanced_prompt(\n            text,\n            system_prompt,\n            custom_rules,\n            preprocessing_result,\n            rule_result,\n            config,\n            training_examples,\n            video_source_info=video_source_info,\n            fields_to_extract=fields_to_extract\n        )\n        \n        error_logger.log_info(f\"[Pipeline] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\")\n        error_logger.log_info(f\"[Pipeline] üìã AI PROMPT ({len(enhanced_prompt)} chars):\")\n        error_logger.log_info(f\"[Pipeline] {enhanced_prompt[:800]}...\")\n        error_logger.log_info(f\"[Pipeline] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\")\n        \n        temperature = float(config.get('temperature', '0.7'))\n        quality = config.get('quality_level', 'balanced')\n        \n        # No token restrictions - allow full text completion\n        error_logger.log_info(f\"[Pipeline] üîì Token limit: UNLIMITED (max_tokens={max_tokens} - ÿ®ÿØŸàŸÜ ÿ≠ÿØŸàÿØ)\")\n        \n        try:\n            error_logger.log_info(f\"[Pipeline] üîÑ CALLING AI\")\n            error_logger.log_info(f\"[Pipeline]    Provider: {provider}\")\n            error_logger.log_info(f\"[Pipeline]    Model: {model}\")\n            error_logger.log_info(f\"[Pipeline]    Max Tokens: {max_tokens}\")\n            error_logger.log_info(f\"[Pipeline]    Temperature: {temperature}\")\n            \n            result = await self.ai_manager.generate(\n                provider=provider,\n                model=model,\n                prompt=enhanced_prompt,\n                max_tokens=max_tokens,\n                temperature=temperature\n            )\n            \n            if not result:\n                error_logger.log_warning(f\"[Pipeline] ‚ö†Ô∏è AI returned EMPTY result (provider={provider}, model={model})\")\n                return (\"\", extracted_fields)\n            \n            error_logger.log_info(f\"[Pipeline] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\")\n            error_logger.log_info(f\"[Pipeline] ‚úÖ AI RETURNED {len(result)} chars\")\n            error_logger.log_info(f\"[Pipeline] üì§ AI OUTPUT (BEFORE RULES):\")\n            error_logger.log_info(f\"[Pipeline] {result[:500]}...\")\n            error_logger.log_info(f\"[Pipeline] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\")\n            \n            # Parse result - check if it contains JSON with extracted fields\n            if fields_to_extract:\n                summary_text, ai_extracted = self._parse_combined_response(result, fields_to_extract)\n                extracted_fields.update(ai_extracted)\n                error_logger.log_info(f\"[Pipeline] üì¶ Extracted {len(ai_extracted)} fields in single AI call\")\n                \n                # ‚úÖ FIXED: Apply summarization rules to extracted summary\n                summary_text = await self._apply_post_summarization_rules(summary_text, task_id)\n                error_logger.log_info(f\"[Pipeline] ‚úÖ Post-summarization rules applied | Final: {len(summary_text)} chars\")\n                \n                return (summary_text, extracted_fields)\n            \n            # ‚úÖ FIXED: Apply summarization rules to direct AI output\n            final_result = await self._apply_post_summarization_rules(result, task_id)\n            error_logger.log_info(f\"[Pipeline] ‚úÖ Post-summarization rules applied | Final: {len(final_result)} chars\")\n            error_logger.log_info(f\"[Pipeline] üì§ FINAL OUTPUT (AFTER RULES): {final_result[:500]}...\")\n            \n            return (final_result or \"\", extracted_fields)\n        except Exception as e:\n            error_logger.log_warning(f\"[Pipeline] ‚ùå AI generation EXCEPTION: {str(e)} (provider={provider}, model={model})\")\n            import traceback\n            error_logger.log_warning(f\"[Pipeline] Traceback: {traceback.format_exc()}\")\n            return (\"\", extracted_fields)\n    \n    async def _apply_post_summarization_rules(self, text: str, task_id: int) -> str:\n        \"\"\"\n        ‚úÖ FIXED: Apply summarization rules to AI output\n        Supports maxLength, style, keyPointsCount from database rules\n        \"\"\"\n        try:\n            if not text:\n                return text\n            \n            from utils.database import db\n            ai_rules = await db.get_task_rules(task_id)\n            if not ai_rules:\n                return text\n            \n            # Filter for active summarize rules\n            summarize_rules = []\n            for r in ai_rules:\n                rule_dict = dict(r) if hasattr(r, '__iter__') and not isinstance(r, dict) else r\n                if isinstance(rule_dict, dict) and rule_dict.get('type') == 'summarize' and rule_dict.get('is_active'):\n                    summarize_rules.append(rule_dict)\n            \n            if not summarize_rules:\n                return text\n            \n            processed_text = text\n            for rule in sorted(summarize_rules, key=lambda r: r.get('priority', 0), reverse=True):\n                rule_config = rule.get('config', {})\n                if isinstance(rule_config, str):\n                    try:\n                        import json\n                        rule_config = json.loads(rule_config)\n                    except:\n                        rule_config = {}\n                \n                # Extract max_length and apply truncation\n                max_length = rule_config.get('maxLength') or rule_config.get('max_length')\n                if max_length and isinstance(max_length, (int, float)) and max_length > 0:\n                    if len(processed_text) > max_length:\n                        processed_text = processed_text[:int(max_length)].rsplit(' ', 1)[0]\n                        if not processed_text.endswith(('...', 'ÿå', '.', 'ÿü')):\n                            processed_text += '...'\n                        error_logger.log_info(f\"[Pipeline] ‚úÖ Applied max_length({max_length}): {len(text)} ‚Üí {len(processed_text)} chars\")\n            \n            return processed_text\n        except Exception as e:\n            error_logger.log_warning(f\"[Pipeline] ‚ö†Ô∏è Error in post-summarization rules: {str(e)}\")\n            return text\n    \n    def _build_enhanced_prompt(\n        self,\n        text: str,\n        system_prompt: Optional[str],\n        custom_rules: Optional[List[Dict]],\n        preprocessing_result: PreprocessingResult,\n        rule_result: RuleEngineResult,\n        config: Dict[str, Any],\n        training_examples: Optional[List[Dict]] = None,\n        video_source_info: Optional[Dict[str, str]] = None,\n        fields_to_extract: Optional[List[Dict[str, Any]]] = None\n    ) -> str:\n        \"\"\"\n        Build enhanced prompt with all context, rules, and training examples\n        Includes video metadata (title, description, uploader) for better summarization\n        \"\"\"\n        prompt_parts = []\n        \n        base_prompt = system_prompt or \"\"\"ÿ£ŸÜÿ™ ŸÖÿ≠ÿ±ÿ± ÿ•ÿÆÿ®ÿßÿ±Ÿä ŸÖÿ≠ÿ™ÿ±ŸÅ ŸàŸÖÿ≠ŸÑŸÑ ŸÑÿ∫ŸàŸä ÿ∞ŸÉŸä ŸÖÿ™ÿÆÿµÿµ ŸÅŸä ÿ™ÿ≠ÿ±Ÿäÿ± Ÿàÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ŸàÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±.\n\nüéØ ŸÖŸáÿßŸÖŸÉ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© (ÿ®ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®):\n1. ÿ™ÿ∑ÿ®ŸäŸÇ ŸÇŸàÿßÿπÿØ ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿßŸÑÿ∞ŸÉŸä (ÿ•ÿ∞ÿß ŸàŸèÿ¨ÿØÿ™) - Ÿáÿ∞Ÿá ÿßŸÑÿ£ŸàŸÑŸàŸäÿ© ÿßŸÑŸÇÿµŸàŸâ\n2. ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµ ÿ®ÿ¥ŸÉŸÑ ŸÖŸàÿ¨ÿ≤ ŸàÿØŸÇŸäŸÇ\n3. ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑÿ≠ŸäÿßÿØ ŸàÿßŸÑŸÖŸàÿ∂ŸàÿπŸäÿ©\n4. ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿµŸäÿßÿ∫ÿ© ÿ±ÿ≥ŸÖŸäÿ© ŸàŸÖŸáŸÜŸäÿ©\n\nüìä ŸÖŸÜŸáÿ¨Ÿäÿ© ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ:\n‚Ä¢ ÿ≠ŸÑŸÑ ÿßŸÑŸÜÿµ ŸÉŸÑŸÖÿ© ÿ®ŸÉŸÑŸÖÿ© ŸÑŸÅŸáŸÖ ÿßŸÑÿ≥ŸäÿßŸÇ ÿßŸÑŸÉÿßŸÖŸÑ\n‚Ä¢ ÿ≠ÿØÿØ ÿßŸÑŸÉŸäÿßŸÜÿßÿ™ ŸàÿßŸÑÿ£ÿ¥ÿÆÿßÿµ ŸàÿßŸÑŸÖŸÜÿ∏ŸÖÿßÿ™ ÿßŸÑŸÖÿ∞ŸÉŸàÿ±ÿ©\n‚Ä¢ ÿßŸÅŸáŸÖ ÿßŸÑÿπŸÑÿßŸÇÿßÿ™ ÿ®ŸäŸÜ ÿßŸÑŸÉŸäÿßŸÜÿßÿ™ ŸÅŸä ÿßŸÑŸÜÿµ\n‚Ä¢ ÿ∑ÿ®ŸÇ ŸÇŸàÿßÿπÿØ ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿ¥ÿßÿ±ÿßÿ™ ŸÑŸÑŸÉŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿØÿØÿ©\"\"\"\n        \n        prompt_parts.append(base_prompt)\n        \n        # Add video metadata if available (title, description, uploader)\n        if video_source_info:\n            metadata_text = \"\\n\\nüìπ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÅŸäÿØŸäŸà/ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ:\"\n            \n            if video_source_info.get('title'):\n                metadata_text += f\"\\n‚Ä¢ ÿßŸÑÿπŸÜŸàÿßŸÜ: {video_source_info.get('title')}\"\n            \n            if video_source_info.get('description'):\n                desc = video_source_info.get('description', '')\n                # Truncate if too long\n                if len(desc) > 500:\n                    desc = desc[:500] + \"...\"\n                metadata_text += f\"\\n‚Ä¢ ÿßŸÑŸàÿµŸÅ: {desc}\"\n            \n            if video_source_info.get('uploader'):\n                metadata_text += f\"\\n‚Ä¢ ÿßŸÑŸÖÿµÿØÿ±/ÿßŸÑŸÖÿ≠ŸÖŸÑ: {video_source_info.get('uploader')}\"\n            \n            if video_source_info.get('platform'):\n                metadata_text += f\"\\n‚Ä¢ ÿßŸÑŸÖŸÜÿµÿ©: {video_source_info.get('platform')}\"\n            \n            if video_source_info.get('duration'):\n                duration = video_source_info.get('duration', 0)\n                if isinstance(duration, (int, float)) and duration > 0:\n                    metadata_text += f\"\\n‚Ä¢ ÿßŸÑŸÖÿØÿ©: {int(duration)} ÿ´ÿßŸÜŸäÿ©\"\n            \n            metadata_text += \"\\n\\n‚ö†Ô∏è ÿßÿ≥ÿ™ÿÆÿØŸÖ Ÿáÿ∞Ÿá ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ŸÅŸáŸÖŸÉ ŸÑŸÑŸÖÿ≠ÿ™ŸàŸâ ŸàÿßŸÑÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿØŸÇŸäŸÇ\"\n            prompt_parts.append(metadata_text)\n        \n        # Add summarization options from config\n        summ_config = config.get('config', {}) if isinstance(config.get('config'), dict) else {}\n        max_length = summ_config.get('maxLength', 300)\n        style = summ_config.get('style', 'balanced')\n        key_points = summ_config.get('keyPointsCount', 3)\n        \n        if max_length or style:\n            options_text = f\"\\n\\nÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÑÿÆŸäÿµ:\"\n            options_text += f\"\\n- ÿßŸÑÿ∑ŸàŸÑ ÿßŸÑÿ£ŸÇÿµŸâ: {max_length} ÿ≠ÿ±ŸÅ\"\n            options_text += f\"\\n- ÿßŸÑÿ£ÿ≥ŸÑŸàÿ®: {style}\"\n            if key_points:\n                options_text += f\"\\n- ÿπÿØÿØ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©: {key_points}\"\n            prompt_parts.append(options_text)\n        \n        if custom_rules:\n            rules_text = \"\\n\\n‚ö†Ô∏è ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑÿ•ŸÑÿ≤ÿßŸÖŸäÿ© (Ÿäÿ¨ÿ® ÿ™ÿ∑ÿ®ŸäŸÇŸáÿß ÿ®ÿØŸÇÿ©):\"\n            for i, rule in enumerate(custom_rules, 1):\n                rule_prompt = rule.get('prompt', '')\n                rule_type = rule.get('type', '')\n                \n                # For summarization rules, build enhanced prompt from config\n                if rule_type == 'summarize' and not rule_prompt:\n                    rule_config = rule.get('config', {})\n                    \n                    # Parse config if it's a JSON string\n                    if isinstance(rule_config, str):\n                        try:\n                            import json\n                            rule_config = json.loads(rule_config)\n                        except:\n                            rule_config = {}\n                    \n                    max_length = rule_config.get('maxLength', 300) if isinstance(rule_config, dict) else 300\n                    style = rule_config.get('style', 'balanced') if isinstance(rule_config, dict) else 'balanced'\n                    rule_prompt = f\"ŸÇŸÖ ÿ®ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµ ŸÑŸäŸÉŸàŸÜ {style} ŸÖÿπ ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑŸÖÿπŸÜŸâ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ: {max_length} ÿ≠ÿ±ŸÅ)\"\n                \n                if rule_prompt:\n                    rules_text += f\"\\n{i}. {rule_prompt}\"\n                    \n                    # Add special handling for news format requirements\n                    if 'ÿÆÿ®ÿ±' in rule_prompt or 'ÿ£ÿ≥ŸÑŸàÿ® ÿ•ÿÆÿ®ÿßÿ±Ÿä' in rule_prompt or 'news' in rule_prompt.lower():\n                        rules_text += \"\\n   üì∞ ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿÆÿ®ÿ± ÿßŸÑÿ•ŸÑÿ≤ÿßŸÖŸä:\"\n                        rules_text += \"\\n   ‚Ä¢ ÿßŸÉÿ™ÿ® ÿßŸÑÿÆÿ®ÿ± ŸÅŸä ÿ¥ŸÉŸÑ ŸÅŸÇÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÖÿ™ÿ≥ŸÑÿ≥ŸÑÿ©\"\n                        rules_text += \"\\n   ‚Ä¢ ÿßÿ®ÿØÿ£ ÿ®ÿ£ŸáŸÖ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ (ÿßŸÑŸÅŸÉÿ±ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©)\"\n                        rules_text += \"\\n   ‚Ä¢ ŸÑÿß ÿ™ÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÜŸÇÿßÿ∑ (‚Ä¢) ÿ£Ÿà ÿßŸÑÿ™ÿ±ŸÇŸäŸÖ\"\n                        rules_text += \"\\n   ‚Ä¢ ÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ÿßŸÑÿ™ÿ≥ŸÑÿ≥ŸÑ ÿßŸÑŸÖŸÜÿ∑ŸÇŸä ŸàÿßŸÑÿ≥ŸÑÿßÿ≥ÿ©\"\n                        rules_text += \"\\n   ‚Ä¢ ÿßÿ¨ÿπŸÑ ÿßŸÑÿµŸäÿßÿ∫ÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© Ÿàÿ•ÿÆÿ®ÿßÿ±Ÿäÿ©\"\n                    \n            \n            if len(rules_text) > len(\"\\n\\n‚ö†Ô∏è ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑÿ•ŸÑÿ≤ÿßŸÖŸäÿ© (Ÿäÿ¨ÿ® ÿ™ÿ∑ÿ®ŸäŸÇŸáÿß ÿ®ÿØŸÇÿ©):\"):\n                prompt_parts.append(rules_text)\n        \n        if rule_result.entities_replaced:\n            entity_instructions = \"\"\"\n\nüîñ ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇŸáÿß ŸÖÿ≥ÿ®ŸÇÿßŸã (ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπÿØŸÖ ÿ•ÿπÿßÿØÿ™Ÿáÿß ŸÑŸÑÿ£ÿµŸÑ):\n\"\"\"\n            for entity_type, replacements in rule_result.entities_replaced.items():\n                entity_instructions += f\"\\nüìå ŸÜŸàÿπ ÿßŸÑŸÉŸäÿßŸÜ: {entity_type}\"\n                for original, replacement in replacements:\n                    entity_instructions += f\"\\n   ‚Ä¢ '{original}' ‚Üê ÿ™ŸÖ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸáÿß ÿ®ŸÄ ‚Üê '{replacement}'\"\n                    entity_instructions += f\"\\n     ‚ö° ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿ£Ÿä ÿµŸäÿ∫ÿ© ÿ£ÿÆÿ±Ÿâ ŸÑŸÄ '{original}' ÿ®ŸÄ '{replacement}'\"\n            \n            entity_instructions += \"\"\"\n\n‚ö†Ô∏è ŸÖŸÑÿßÿ≠ÿ∏ÿ© ŸÖŸáŸÖÿ©: ÿ•ÿ∞ÿß Ÿàÿ¨ÿØÿ™ ÿ£Ÿä ÿ∞ŸÉÿ± ÿ¢ÿÆÿ± ŸÑŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸáÿå ŸÇŸÖ ÿ®ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸá.\n\"\"\"\n            prompt_parts.append(entity_instructions)\n        \n        # Add semantic replacement rules for AI to find and replace variations\n        if hasattr(rule_result, 'semantic_replacement_rules') and rule_result.semantic_replacement_rules:\n            semantic_instructions = \"\"\"\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n‚ö†Ô∏è ŸÖŸáŸÖÿ© ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿßŸÑÿ∞ŸÉŸä (ÿßŸÑÿ£ŸàŸÑŸàŸäÿ© ÿßŸÑŸÇÿµŸàŸâ - Ÿäÿ¨ÿ® ÿ™ŸÜŸÅŸäÿ∞Ÿáÿß ÿ®ÿØŸÇÿ© ŸÖÿ™ŸÜÿßŸáŸäÿ©)\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nüìã ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ŸÖŸÜŸÉ:\nŸÇŸÖ ÿ®ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÜÿµ ÿßŸÑÿ™ÿßŸÑŸä ÿ≥ÿ∑ÿ±ÿßŸã ÿ®ÿ≥ÿ∑ÿ±ÿå ŸÉŸÑŸÖÿ© ÿ®ŸÉŸÑŸÖÿ©ÿå Ÿàÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£Ÿä ÿ∞ŸÉÿ± ŸÑŸÑŸÉŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿØÿØÿ© ÿ£ÿØŸÜÿßŸá.\nŸäÿ¨ÿ® ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸáÿß ÿ≠ÿ™Ÿâ ŸÑŸà ŸÉÿßŸÜÿ™ ŸÖŸÉÿ™Ÿàÿ®ÿ© ÿ®ÿ∑ÿ±ŸäŸÇÿ© ŸÖÿÆÿ™ŸÑŸÅÿ© ÿ£Ÿà ŸÅŸä ÿ≥ŸäÿßŸÇ ŸÖÿÆÿ™ŸÑŸÅ.\n\nüîç ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©:\n1Ô∏è‚É£ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≥ŸäÿßŸÇŸä: ÿßŸÅŸáŸÖ ŸÖÿπŸÜŸâ ŸÉŸÑ ÿ¨ŸÖŸÑÿ© Ÿàÿ≠ÿØÿØ ŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿ™ÿ¥Ÿäÿ± ŸÑŸÑŸÉŸäÿßŸÜ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸá\n2Ô∏è‚É£ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿØŸÑÿßŸÑŸä: ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÖÿ™ÿ±ÿßÿØŸÅÿßÿ™ ŸàÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿ∞ÿßÿ™ ÿßŸÑŸÖÿπŸÜŸâ ÿßŸÑŸÖÿ¥ÿßÿ®Ÿá\n3Ô∏è‚É£ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿµÿ±ŸÅŸä: ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ¨ŸÖŸäÿπ ÿ™ÿµÿ±ŸäŸÅÿßÿ™ ÿßŸÑŸÉŸÑŸÖÿ© (ÿ¨ŸÖÿπÿå ŸÖŸÅÿ±ÿØÿå ŸÖÿ§ŸÜÿ´ÿå ŸÖÿ∞ŸÉÿ±ÿå ŸÖÿ∂ÿßŸÅ)\n4Ô∏è‚É£ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ•ŸÖŸÑÿßÿ¶Ÿä: ÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑŸÉŸÑŸÖÿ© ÿ≠ÿ™Ÿâ ŸÖÿπ ÿ£ÿÆÿ∑ÿßÿ° ÿ•ŸÖŸÑÿßÿ¶Ÿäÿ© ÿ£Ÿà ÿßÿÆÿ™ŸÑÿßŸÅ ŸÅŸä ÿßŸÑŸáŸÖÿ≤ÿßÿ™\n5Ô∏è‚É£ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ•ÿ¥ÿßÿ±ÿßÿ™: ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÜÿµ Ÿäÿ¥Ÿäÿ± ŸÑŸÑŸÉŸäÿßŸÜ ÿ®ÿ∂ŸÖŸäÿ± ÿ£Ÿà ŸÑŸÇÿ® ÿ£Ÿà ŸàÿµŸÅÿå ÿßÿ≥ÿ™ÿ®ÿØŸÑŸá ÿ£Ÿäÿ∂ÿßŸã\n\nüìå ÿ£ŸÜŸàÿßÿπ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ© ÿßŸÑÿ™Ÿä Ÿäÿ¨ÿ® ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜŸáÿß:\n‚Ä¢ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ© ÿßŸÑÿ≠ÿ±ŸÅŸäÿ©: ŸÜŸÅÿ≥ ÿßŸÑŸÉŸÑŸÖÿ© ÿ®ÿßŸÑÿ∂ÿ®ÿ∑\n‚Ä¢ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ© ÿßŸÑÿµÿ±ŸÅŸäÿ©: ÿßŸÑÿ¨ŸÖÿπ ŸàÿßŸÑŸÖŸÅÿ±ÿØ (ŸÖŸÑŸäÿ¥Ÿäÿß/ŸÖŸÑŸäÿ¥Ÿäÿßÿ™ÿå ÿ≠Ÿàÿ´Ÿä/ÿ≠Ÿàÿ´ŸäŸäŸÜ/ÿ≠Ÿàÿ´ŸäŸàŸÜ)\n‚Ä¢ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÖÿπ ÿßŸÑÿ™ÿπÿ±ŸäŸÅ: ŸÖÿπ \"ÿßŸÑ\" ÿ£Ÿà ÿ®ÿØŸàŸÜŸáÿß (ÿßŸÑÿ≠Ÿàÿ´Ÿä/ÿ≠Ÿàÿ´Ÿäÿå ÿßŸÑÿ¨Ÿäÿ¥/ÿ¨Ÿäÿ¥)\n‚Ä¢ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÖÿπ ÿßŸÑÿ∂ŸÖÿßÿ¶ÿ±: ÿßŸÑŸÉŸÑŸÖÿ© ŸÖÿπ ÿ∂ŸÖÿßÿ¶ÿ± ŸÖÿ™ÿµŸÑÿ© (ÿ¨Ÿäÿ¥Ÿáÿå ÿ¨Ÿäÿ¥ŸáŸÖÿå ŸÖŸÑŸäÿ¥Ÿäÿßÿ™ŸáŸÖ)\n‚Ä¢ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ© ÿßŸÑÿ≥ŸäÿßŸÇŸäÿ©: ÿπŸÜÿØŸÖÿß ŸäŸèÿ¥ÿßÿ± ŸÑŸÑŸÉŸäÿßŸÜ ÿ®ŸàÿµŸÅ ÿ£Ÿà ŸÑŸÇÿ® ŸÖÿπÿ±ŸàŸÅ\n‚Ä¢ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ© ÿßŸÑÿ¨ÿ≤ÿ¶Ÿäÿ©: ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÉŸÑŸÖÿ© ÿ¨ÿ≤ÿ°ÿßŸã ŸÖŸÜ ÿπÿ®ÿßÿ±ÿ© ÿ£ÿ∑ŸàŸÑ\n‚Ä¢ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ© ÿßŸÑÿ•ŸÖŸÑÿßÿ¶Ÿäÿ©: ŸÜŸÅÿ≥ ÿßŸÑŸÉŸÑŸÖÿ© ÿ®ÿ£ÿÆÿ∑ÿßÿ° ÿ•ŸÖŸÑÿßÿ¶Ÿäÿ© ÿ¥ÿßÿ¶ÿπÿ©\n\nüéØ ŸÇŸàÿßÿπÿØ ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿßŸÑÿ•ŸÑÿ≤ÿßŸÖŸäÿ©:\n\"\"\"\n            for rule in rule_result.semantic_replacement_rules:\n                originals = rule.get('originals', [])\n                replacements = rule.get('replacements', [])\n                if not originals and rule.get('original'):\n                    originals = [rule.get('original')]\n                if not replacements and rule.get('replacement'):\n                    replacements = [rule.get('replacement')]\n                \n                if originals and replacements:\n                    primary_replacement = replacements[0] if replacements[0] else \"\"\n                    originals_str = 'ÿå '.join([str(o) for o in originals if o])\n                    \n                    semantic_instructions += f\"\"\"\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n‚îÇ üîÑ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ£ÿµŸÑŸäÿ©: {originals_str}\n‚îÇ ‚úÖ ÿßŸÑÿ®ÿØŸäŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®: {primary_replacement}\n‚îÇ \n‚îÇ üìù ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿÆÿßÿµÿ© ÿ®Ÿáÿ∞Ÿá ÿßŸÑŸÇÿßÿπÿØÿ©:\n‚îÇ ‚Ä¢ ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£Ÿä ÿ∞ŸÉÿ± ŸÖÿ®ÿßÿ¥ÿ± ÿ£Ÿà ÿ∫Ÿäÿ± ŸÖÿ®ÿßÿ¥ÿ± ŸÑŸáÿ∞Ÿá ÿßŸÑŸÉŸÑŸÖÿßÿ™\n‚îÇ ‚Ä¢ ÿßÿ≥ÿ™ÿ®ÿØŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿµÿ±ŸäŸÅÿßÿ™: (ŸÖŸÅÿ±ÿØ/ÿ¨ŸÖÿπ/ŸÖÿ∞ŸÉÿ±/ŸÖÿ§ŸÜÿ´/ŸÖÿπÿ±ŸÅ/ŸÜŸÉÿ±ÿ©)\n‚îÇ ‚Ä¢ ÿßÿ≥ÿ™ÿ®ÿØŸÑ ÿ≠ÿ™Ÿâ ŸÑŸà ŸÉÿßŸÜÿ™ ŸÖÿπ ÿ∂ŸÖÿßÿ¶ÿ± ŸÖÿ™ÿµŸÑÿ© ÿ£Ÿà ÿ≠ÿ±ŸàŸÅ ÿ¨ÿ±\n‚îÇ ‚Ä¢ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ≥ŸäÿßŸÇ Ÿäÿ¥Ÿäÿ± ŸÑŸÜŸÅÿ≥ ÿßŸÑŸÉŸäÿßŸÜ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ŸÖÿÆÿ™ŸÑŸÅÿ©ÿå ÿßÿ≥ÿ™ÿ®ÿØŸÑŸá\n‚îÇ ‚Ä¢ ÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ÿ≥ŸÑÿßÿ≥ÿ© ÿßŸÑŸÜÿµ Ÿàÿµÿ≠ÿ© ÿßŸÑÿ•ÿπÿ±ÿßÿ® ÿ®ÿπÿØ ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\"\"\"\n            \n            semantic_instructions += \"\"\"\n‚ö° ÿ£ŸÖÿ´ŸÑÿ© ÿπŸÑŸâ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ∞ŸÉŸä:\nŸÖÿ´ÿßŸÑ 1: ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ \"ŸÖŸÑŸäÿ¥Ÿäÿß ÿßŸÑÿ≠Ÿàÿ´Ÿä\" ÿ®ŸÄ \"ÿ¨ŸÖÿßÿπÿ© ÿ£ŸÜÿµÿßÿ± ÿßŸÑŸÑŸá\"\n   - \"ŸÖŸÑŸäÿ¥Ÿäÿß ÿßŸÑÿ≠Ÿàÿ´Ÿä\" ‚Üê \"ÿ¨ŸÖÿßÿπÿ© ÿ£ŸÜÿµÿßÿ± ÿßŸÑŸÑŸá\" ‚úì\n   - \"ŸÖŸÑŸäÿ¥Ÿäÿßÿ™ ÿßŸÑÿ≠Ÿàÿ´Ÿä\" ‚Üê \"ÿ¨ŸÖÿßÿπÿ© ÿ£ŸÜÿµÿßÿ± ÿßŸÑŸÑŸá\" ‚úì\n   - \"ÿßŸÑŸÖŸäŸÑŸäÿ¥Ÿäÿß ÿßŸÑÿ≠Ÿàÿ´Ÿäÿ©\" ‚Üê \"ÿ¨ŸÖÿßÿπÿ© ÿ£ŸÜÿµÿßÿ± ÿßŸÑŸÑŸá\" ‚úì\n   - \"ŸÖŸÑŸäÿ¥Ÿäÿßÿ™ŸáŸÖ\" ‚Üê \"ÿßŸÑÿ¨ŸÖÿßÿπÿ©\" ‚úì\n   - \"ÿßŸÑŸÖŸÑŸäÿ¥Ÿäÿß\" (ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ≥ŸäÿßŸÇ Ÿäÿ¥Ÿäÿ± ŸÑŸÑÿ≠Ÿàÿ´Ÿä) ‚Üê \"ÿ¨ŸÖÿßÿπÿ© ÿ£ŸÜÿµÿßÿ± ÿßŸÑŸÑŸá\" ‚úì\n\nŸÖÿ´ÿßŸÑ 2: ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ \"ÿßŸÑÿ•ÿ±Ÿáÿßÿ®ŸäŸäŸÜ\" ÿ®ŸÄ \"ÿßŸÑŸÖÿ≥ŸÑÿ≠ŸäŸÜ\"\n   - \"ÿßŸÑÿ•ÿ±Ÿáÿßÿ®ŸäŸäŸÜ\" ‚Üê \"ÿßŸÑŸÖÿ≥ŸÑÿ≠ŸäŸÜ\" ‚úì\n   - \"ÿ•ÿ±Ÿáÿßÿ®Ÿä\" ‚Üê \"ŸÖÿ≥ŸÑÿ≠\" ‚úì\n   - \"ÿßŸÑÿ•ÿ±Ÿáÿßÿ®ŸäŸàŸÜ\" ‚Üê \"ÿßŸÑŸÖÿ≥ŸÑÿ≠ŸàŸÜ\" ‚úì\n   - \"ÿ•ÿ±Ÿáÿßÿ®Ÿäÿ©\" ‚Üê \"ŸÖÿ≥ŸÑÿ≠ÿ©\" ‚úì\n   - \"ÿßŸÑÿ¨ŸÖÿßÿπÿ© ÿßŸÑÿ•ÿ±Ÿáÿßÿ®Ÿäÿ©\" ‚Üê \"ÿßŸÑÿ¨ŸÖÿßÿπÿ© ÿßŸÑŸÖÿ≥ŸÑÿ≠ÿ©\" ‚úì\n\nüö´ ÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™ ŸÖŸáŸÖÿ©:\n‚Ä¢ ŸÑÿß ÿ™ÿ≥ÿ™ÿ®ÿØŸÑ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÉŸÑŸÖÿ© ŸÅŸä ÿ≥ŸäÿßŸÇ ŸÖÿÆÿ™ŸÑŸÅ ÿ™ŸÖÿßŸÖÿßŸã ŸÑÿß ÿπŸÑÿßŸÇÿ© ŸÑŸá ÿ®ÿßŸÑŸÉŸäÿßŸÜ ÿßŸÑŸÖŸÇÿµŸàÿØ\n‚Ä¢ ÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ÿßŸÑŸÖÿπŸÜŸâ ÿßŸÑÿπÿßŸÖ ŸÑŸÑÿ¨ŸÖŸÑÿ©\n‚Ä¢ ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ•ÿπÿ±ÿßÿ® ŸàÿßŸÑÿ™ÿ∞ŸÉŸäÿ± ŸàÿßŸÑÿ™ÿ£ŸÜŸäÿ´ ÿ®ÿπÿØ ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ\n‚Ä¢ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÉŸÑŸÖÿ© ÿ∂ŸÖŸÜ ÿßŸÇÿ™ÿ®ÿßÿ≥ ÿ≠ÿ±ŸÅŸäÿå ÿßÿ≥ÿ™ÿ®ÿØŸÑŸáÿß ÿ£Ÿäÿ∂ÿßŸã\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\"\"\"\n            prompt_parts.append(semantic_instructions)\n            error_logger.log_info(f\"[Pipeline] Added {len(rule_result.semantic_replacement_rules)} enhanced semantic replacement rules to prompt\")\n        \n        # Add context rules instructions for AI processing\n        if hasattr(rule_result, 'ai_instructions') and rule_result.ai_instructions:\n            context_instructions = \"\"\"\n\nüìù ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ± ÿßŸÑÿ≥ŸäÿßŸÇŸä (ÿ•ŸÑÿ≤ÿßŸÖŸäÿ©):\nŸáÿ∞Ÿá ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ™ÿ≠ÿØÿØ ŸÉŸäŸÅŸäÿ© ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿ≥ŸäÿßŸÇÿßÿ™ ŸÖÿπŸäŸÜÿ© ŸÅŸä ÿßŸÑŸÜÿµ.\n\"\"\"\n            for i, inst in enumerate(rule_result.ai_instructions, 1):\n                instructions_text = inst.get('instructions', '')\n                rule_type = inst.get('rule_type', '')\n                target_sentiment = inst.get('target_sentiment', 'neutral')\n                if instructions_text:\n                    sentiment_label = {\n                        'positive': 'üü¢ ÿ•Ÿäÿ¨ÿßÿ®Ÿä',\n                        'negative': 'üî¥ ÿ≥ŸÑÿ®Ÿä', \n                        'neutral': '‚ö™ ŸÖÿ≠ÿßŸäÿØ'\n                    }.get(target_sentiment, '‚ö™ ŸÖÿ≠ÿßŸäÿØ')\n                    \n                    context_instructions += f\"\"\"\n‚îå‚îÄ‚îÄ ÿßŸÑÿ™ÿπŸÑŸäŸÖÿ© {i} ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n‚îÇ üìã {instructions_text}\n‚îÇ üéØ ÿßŸÑŸÜÿ®ÿ±ÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©: {sentiment_label}\n‚îÇ üí° ÿ∑ÿ®ŸÇ Ÿáÿ∞Ÿá ÿßŸÑÿ™ÿπŸÑŸäŸÖÿ© ÿπŸÑŸâ ŸÉŸÑ ÿ¨ÿ≤ÿ° ŸÖŸÜÿßÿ≥ÿ® ŸÅŸä ÿßŸÑŸÜÿµ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\"\"\"\n            prompt_parts.append(context_instructions)\n            error_logger.log_info(f\"[Pipeline] Added {len(rule_result.ai_instructions)} context instructions to prompt\")\n        \n        if preprocessing_result.sentiment.has_offensive:\n            offensive_instructions = \"\"\"\n\n‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá: ÿ™ŸÖ ÿ±ÿµÿØ ŸÑÿ∫ÿ© ÿ∫Ÿäÿ± ŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÅŸä ÿßŸÑŸÜÿµ\n\nüìå ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™:\n‚Ä¢ ÿ≠ŸäŸëÿØ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸÑŸÅÿßÿ∏ ÿßŸÑŸÖÿ≥Ÿäÿ¶ÿ© ÿ£Ÿà ÿßŸÑÿπŸÜŸäŸÅÿ©\n‚Ä¢ ÿßÿ≥ÿ™ÿ®ÿØŸÑ ÿßŸÑÿ¥ÿ™ÿßÿ¶ŸÖ ŸàÿßŸÑÿ•ŸáÿßŸÜÿßÿ™ ÿ®ŸàÿµŸÅ ŸÖÿ≠ÿßŸäÿØ\n‚Ä¢ ÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ÿßŸÑŸÖÿπŸÜŸâ ÿØŸàŸÜ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ¨ÿßÿ±ÿ≠ÿ©\n‚Ä¢ ÿßÿ¨ÿπŸÑ ÿßŸÑÿµŸäÿßÿ∫ÿ© ŸÖŸáŸÜŸäÿ© ŸàŸÖÿ≠ÿßŸäÿØÿ©\n\nüîÑ ÿ£ŸÖÿ´ŸÑÿ© ÿπŸÑŸâ ÿßŸÑÿ™ÿ≠ŸäŸäÿØ:\n‚Ä¢ \"ÿ•ÿ±Ÿáÿßÿ®Ÿä/ŸÖÿ¨ÿ±ŸÖ\" ‚Üí \"ŸÖÿ≥ŸÑÿ≠/ŸÖÿ™ŸáŸÖ\"\n‚Ä¢ \"ÿπÿµÿßÿ®ÿ©\" ‚Üí \"ŸÖÿ¨ŸÖŸàÿπÿ©\"  \n‚Ä¢ \"ŸÉŸÑÿ®/ÿ≠ŸÖÿßÿ±\" ‚Üí \"ÿ¥ÿÆÿµ\"\n‚Ä¢ ÿßŸÑÿ¥ÿ™ÿßÿ¶ŸÖ ‚Üí ÿ≠ÿ∞ŸÅŸáÿß ÿ£Ÿà ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸáÿß ÿ®ŸàÿµŸÅ ŸÖÿ≠ÿßŸäÿØ\n\"\"\"\n            prompt_parts.append(offensive_instructions)\n        \n        if training_examples:\n            examples_section = \"\\n\\nüìö ÿ£ŸÖÿ´ŸÑÿ© ÿ™ÿØÿ±Ÿäÿ®Ÿäÿ© (ÿ™ÿπŸÑŸÖ ŸÖŸÜ Ÿáÿ∞Ÿá ÿßŸÑÿ£ŸÖÿ´ŸÑÿ© Ÿàÿßÿ™ÿ®ÿπ ŸÜŸÅÿ≥ ÿßŸÑÿ£ÿ≥ŸÑŸàÿ®):\"\n            for i, example in enumerate(training_examples[:5], 1):\n                input_text = example.get('input_text', '')[:200]\n                expected_output = example.get('expected_output', '')[:200]\n                explanation = example.get('explanation', '')\n                example_type = example.get('example_type', 'general')\n                \n                examples_section += f\"\\n\\n--- ŸÖÿ´ÿßŸÑ {i} ({example_type}) ---\"\n                examples_section += f\"\\n‚óÄÔ∏è ÿßŸÑŸÖÿØÿÆŸÑ: {input_text}\"\n                examples_section += f\"\\n‚ñ∂Ô∏è ÿßŸÑŸÖÿÆÿ±ÿ¨ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®: {expected_output}\"\n                if explanation:\n                    examples_section += f\"\\nüí° ÿßŸÑÿ≥ÿ®ÿ®: {explanation}\"\n            \n            examples_section += \"\\n\\n--- ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑÿ£ŸÖÿ´ŸÑÿ© ---\"\n            examples_section += \"\\nÿßÿ™ÿ®ÿπ ŸÜŸÅÿ≥ ÿßŸÑÿ£ÿ≥ŸÑŸàÿ® ŸàÿßŸÑÿ™ÿ≠ŸàŸäŸÑÿßÿ™ ŸÅŸä ÿßŸÑŸÜÿµ ÿßŸÑÿ™ÿßŸÑŸä.\"\n            prompt_parts.append(examples_section)\n            error_logger.log_info(f\"[Pipeline] Added {min(len(training_examples), 5)} training examples to prompt\")\n        \n        preserve_format = config.get('preserve_formatting', True)\n        output_format = config.get('output_format', 'markdown')\n        \n        format_instructions = \"\"\"\n\nüìã ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©:\n\"\"\"\n        if output_format == 'markdown':\n            format_instructions += \"‚Ä¢ ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ™ŸÜÿ≥ŸäŸÇ Markdown ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ© ŸÑŸÑÿ™ŸÜÿ∏ŸäŸÖ\\n\"\n            format_instructions += \"‚Ä¢ ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿπŸÜÿßŸàŸäŸÜ ŸàÿßŸÑŸÜŸÇÿßÿ∑ ŸÑÿ™Ÿàÿ∂Ÿäÿ≠ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ\\n\"\n        elif output_format == 'plain':\n            format_instructions += \"‚Ä¢ ÿ£ÿÆÿ±ÿ¨ ŸÜÿµÿßŸã ÿπÿßÿØŸäÿßŸã ÿ®ÿØŸàŸÜ ÿ™ŸÜÿ≥ŸäŸÇ\\n\"\n        \n        format_instructions += \"\"\"‚Ä¢ ŸÑÿß ÿ™ÿ®ÿØÿ£ ÿ®ŸÉŸÑŸÖÿ© 'ŸÖŸÑÿÆÿµ' ÿ£Ÿà 'Summary'\n‚Ä¢ ŸÑÿß ÿ™ÿ∞ŸÉÿ± ÿ£ŸÜŸÉ ŸÜŸÖŸàÿ∞ÿ¨ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä\n‚Ä¢ ŸÑÿß ÿ™ÿ¥ÿ±ÿ≠ ŸÖÿß ŸÇŸÖÿ™ ÿ®Ÿáÿå ŸÅŸÇÿ∑ ÿ£ÿÆÿ±ÿ¨ ÿßŸÑŸÜÿµ ÿßŸÑŸÜŸáÿßÿ¶Ÿä\n\n‚úÖ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨:\n‚ñ° ŸáŸÑ ÿ∑ÿ®ŸÇÿ™ ÿ¨ŸÖŸäÿπ ŸÇŸàÿßÿπÿØ ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑÿü\n‚ñ° ŸáŸÑ ÿ®ÿ≠ÿ´ÿ™ ÿπŸÜ ÿ¨ŸÖŸäÿπ ÿµŸäÿ∫ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸáÿßÿü\n‚ñ° ŸáŸÑ ÿ≠ÿßŸÅÿ∏ÿ™ ÿπŸÑŸâ ÿ≥ŸÑÿßÿ≥ÿ© ÿßŸÑŸÜÿµ ÿ®ÿπÿØ ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑÿü\n‚ñ° ŸáŸÑ ÿµÿ≠ÿ© ÿßŸÑÿ•ÿπÿ±ÿßÿ® ŸàÿßŸÑÿ™ÿ∞ŸÉŸäÿ± ŸàÿßŸÑÿ™ÿ£ŸÜŸäÿ´ ÿ≥ŸÑŸäŸÖÿ©ÿü\n‚ñ° ŸáŸÑ ÿßŸÑŸÜÿµ ŸÖÿ≠ÿßŸäÿØ ŸàŸÖŸáŸÜŸäÿü\n\"\"\"\n        prompt_parts.append(format_instructions)\n        \n        # Add field extraction instructions if fields are provided\n        if fields_to_extract:\n            # Filter fields that need AI extraction\n            ai_fields = [f for f in fields_to_extract \n                        if f.get('field_type') == 'extracted' \n                        and f.get('field_name')]\n            \n            if ai_fields:\n                fields_prompt = \"\"\n                for f in ai_fields:\n                    field_name = f.get('field_name', '')\n                    instructions = f.get('extraction_instructions', '').strip()\n                    fields_prompt += f\"\\n‚Ä¢ {field_name}: {instructions or 'ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÖŸÜ ÿßŸÑŸÜÿµ'}\"\n                \n                extraction_instructions = f\"\"\"\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nüìä ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©:\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nÿ®ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ™ŸÑÿÆŸäÿµÿå ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ™ÿßŸÑŸäÿ© ŸÖŸÜ ÿßŸÑŸÜÿµ:\n{fields_prompt}\n\n‚ö†Ô∏è ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®:\nÿ£ÿÆÿ±ÿ¨ ÿßŸÑÿ±ÿØ ÿ®ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ™ÿßŸÑŸä (JSON + ÿßŸÑÿ™ŸÑÿÆŸäÿµ):\n\n```json\n{{\n  \"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\": \"ÿßŸÑŸÜÿµ ÿßŸÑŸÖŸÑÿÆÿµ ŸáŸÜÿß\",\n{chr(10).join([f'  \"{f.get(\"field_name\")}\": \"ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©\"' + (',' if i < len(ai_fields)-1 else '') for i, f in enumerate(ai_fields)])}\n}}\n```\n\nŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™:\n- ÿ∂ÿπ ÿßŸÑÿ™ŸÑÿÆŸäÿµ ŸÅŸä ÿ≠ŸÇŸÑ \"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"\n- ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ÿ¨ÿØ ŸÇŸäŸÖÿ© ŸÑÿ≠ŸÇŸÑ ŸÖÿßÿå ÿßÿ™ÿ±ŸÉŸá ŸÅÿßÿ±ÿ∫ÿßŸã \"\"\n- ÿ£ÿÆÿ±ÿ¨ JSON ÿµÿ≠Ÿäÿ≠ ŸÅŸÇÿ∑ ÿ®ÿØŸàŸÜ ÿ£Ÿä ŸÜÿµ ÿ•ÿ∂ÿßŸÅŸä\n\"\"\"\n                prompt_parts.append(extraction_instructions)\n                \n                prompt_parts.append(f\"\"\"\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nüìÑ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ŸÖÿπÿßŸÑÿ¨ÿ™Ÿá:\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n{text}\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n‚¨áÔ∏è ÿ£ÿÆÿ±ÿ¨ JSON ŸÅŸÇÿ∑ ÿ®ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿ£ÿπŸÑÿßŸá:\n\"\"\")\n            else:\n                # No AI fields, regular output\n                prompt_parts.append(f\"\"\"\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nüìÑ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ŸÖÿπÿßŸÑÿ¨ÿ™Ÿá:\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n{text}\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n‚¨áÔ∏è ÿ£ÿÆÿ±ÿ¨ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿπÿßŸÑÿ¨ ŸÅŸÇÿ∑ (ÿ®ÿØŸàŸÜ ÿ¥ÿ±ÿ≠ ÿ£Ÿà ÿ™ÿπŸÑŸäŸÇÿßÿ™):\n\"\"\")\n        else:\n            prompt_parts.append(f\"\"\"\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nüìÑ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ŸÖÿπÿßŸÑÿ¨ÿ™Ÿá:\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n{text}\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n‚¨áÔ∏è ÿ£ÿÆÿ±ÿ¨ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿπÿßŸÑÿ¨ ŸÅŸÇÿ∑ (ÿ®ÿØŸàŸÜ ÿ¥ÿ±ÿ≠ ÿ£Ÿà ÿ™ÿπŸÑŸäŸÇÿßÿ™):\n\"\"\")\n        \n        return \"\\n\".join(prompt_parts)\n    \n    def _parse_combined_response(\n        self,\n        response: str,\n        fields_to_extract: List[Dict[str, Any]]\n    ) -> Tuple[str, Dict[str, Any]]:\n        \"\"\"\n        Parse combined AI response containing both summary and extracted fields\n        Returns tuple of (summary_text, extracted_fields)\n        \"\"\"\n        import json\n        import re\n        \n        extracted = {}\n        summary = response  # Default to full response if parsing fails\n        \n        try:\n            # Try to find JSON in response\n            json_match = re.search(r'\\{[\\s\\S]*\\}', response, re.DOTALL)\n            if json_match:\n                json_str = json_match.group()\n                parsed = json.loads(json_str)\n                \n                # Extract summary\n                summary = parsed.get('ÿßŸÑÿ™ŸÑÿÆŸäÿµ', '') or parsed.get('summary', '') or ''\n                \n                # Extract other fields\n                for field in fields_to_extract:\n                    field_name = field.get('field_name', '')\n                    if field_name and field_name in parsed:\n                        value = parsed[field_name]\n                        if value and str(value).strip():\n                            extracted[field_name] = str(value).strip()\n                \n                error_logger.log_info(f\"[Pipeline] ‚úÖ Parsed combined response | Summary: {len(summary)} chars | Fields: {len(extracted)}\")\n        except json.JSONDecodeError as e:\n            error_logger.log_warning(f\"[Pipeline] ‚ö†Ô∏è Failed to parse JSON from response: {str(e)}\")\n            # Use full response as summary if JSON parsing fails\n            summary = response\n        except Exception as e:\n            error_logger.log_warning(f\"[Pipeline] ‚ö†Ô∏è Error parsing combined response: {str(e)}\")\n            summary = response\n        \n        return (summary, extracted)\n    \n    async def _get_training_examples(self, task_id: int) -> List[Dict]:\n        \"\"\"Get training examples for few-shot learning\"\"\"\n        try:\n            examples = await db.get_training_examples(task_id=task_id)\n            if examples:\n                active_examples = [e for e in examples if e.get('is_active', True)]\n                \n                # Increment use_count for each example used\n                for example in active_examples[:5]:  # Only for the ones we'll actually use\n                    try:\n                        await db.increment_example_use_count(example['id'])\n                    except Exception as count_err:\n                        error_logger.log_info(f\"[Pipeline] Failed to increment use_count for example {example['id']}: {str(count_err)}\")\n                \n                return active_examples\n        except Exception as e:\n            error_logger.log_info(f\"[Pipeline] No training examples for task {task_id}: {str(e)}\")\n        return []\n    \n    async def _get_config(self, task_id: int) -> Dict[str, Any]:\n        \"\"\"Get processing configuration for task\"\"\"\n        try:\n            config = await db.get_processing_config(task_id)\n            if config:\n                return config\n        except Exception as e:\n            error_logger.log_info(f\"[Pipeline] No custom config for task {task_id}, using defaults\")\n        \n        return {\n            'enable_entity_extraction': True,\n            'enable_sentiment_analysis': True,\n            'enable_keyword_detection': True,\n            'enable_output_validation': True,\n            'enable_rule_verification': True,\n            'preserve_formatting': True,\n            'output_format': 'markdown',\n            'temperature': '0.7',\n            'quality_level': 'balanced'\n        }\n    \n    def _empty_result(self, text: str) -> PipelineResult:\n        \"\"\"Return empty result for empty text\"\"\"\n        return PipelineResult(\n            original_text=text or \"\",\n            final_text=text or \"\",\n            stages=[],\n            success=True\n        )\n    \n    async def process_video_summary(\n        self,\n        transcript: str,\n        task_id: int,\n        provider: str,\n        model: str,\n        config: Optional[Dict[str, Any]] = None\n    ) -> PipelineResult:\n        \"\"\"\n        Process video transcript with specialized video summarization\n        \"\"\"\n        video_system_prompt = \"\"\"ÿ£ŸÜÿ™ ŸÖÿ≠ÿ±ÿ± ŸÅŸäÿØŸäŸà ŸÖÿ≠ÿ™ÿ±ŸÅ ŸÖÿ™ÿÆÿµÿµ ŸÅŸä ÿ™ŸÑÿÆŸäÿµ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÅŸäÿØŸäŸàŸáÿßÿ™.\nŸÖŸáŸÖÿ™ŸÉ: ÿ™ŸÑÿÆŸäÿµ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÅŸäÿØŸäŸà ÿ®ÿ¥ŸÉŸÑ ŸÖŸàÿ¨ÿ≤ ŸàÿØŸÇŸäŸÇ ŸÖÿπ:\n- ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©\n- ÿ∞ŸÉÿ± ÿßŸÑŸÖÿ™ÿ≠ÿØÿ´ŸäŸÜ ÿßŸÑÿ±ÿ¶Ÿäÿ≥ŸäŸäŸÜ ÿ•ŸÜ Ÿàÿ¨ÿØŸàÿß\n- ÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑŸÖŸáŸÖÿ© ÿ®ÿ™ÿ±ÿ™Ÿäÿ® ÿ≤ŸÖŸÜŸä\n- ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑÿ≥ŸäÿßŸÇ ÿßŸÑÿπÿßŸÖ ŸÑŸÑŸÅŸäÿØŸäŸà\"\"\"\n        \n        video_rules = await db.get_task_rules(task_id)\n        video_rules = [r for r in video_rules if r.get('type') == 'video_summarize' and r.get('is_active')]\n        \n        return await self.process(\n            text=transcript,\n            task_id=task_id,\n            provider=provider,\n            model=model,\n            system_prompt=video_system_prompt,\n            custom_rules=video_rules,\n            config=config\n        )\n    \n    async def process_audio_summary(\n        self,\n        transcript: str,\n        task_id: int,\n        provider: str,\n        model: str,\n        config: Optional[Dict[str, Any]] = None\n    ) -> PipelineResult:\n        \"\"\"\n        Process audio transcript with specialized audio summarization\n        Applies AUDIO-SPECIFIC summarization rules (type='audio_summarize')\n        Falls back to general summarization rules if no audio-specific rules exist\n        \"\"\"\n        transcript_length = len(transcript)\n        \n        if transcript_length < 200:\n            target_length = \"50-100 ŸÉŸÑŸÖÿ©\"\n        elif transcript_length < 500:\n            target_length = \"100-150 ŸÉŸÑŸÖÿ©\"\n        elif transcript_length < 1000:\n            target_length = \"150-250 ŸÉŸÑŸÖÿ©\"\n        elif transcript_length < 3000:\n            target_length = \"250-400 ŸÉŸÑŸÖÿ©\"\n        else:\n            target_length = \"400-600 ŸÉŸÑŸÖÿ©\"\n        \n        audio_system_prompt = f\"\"\"ÿ£ŸÜÿ™ ŸÖÿ≠ÿ±ÿ± ÿµŸàÿ™Ÿä ŸÖÿ≠ÿ™ÿ±ŸÅ ŸÖÿ™ÿÆÿµÿµ ŸÅŸä ÿ™ŸÑÿÆŸäÿµ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÇÿßÿ∑ÿπ ÿßŸÑÿµŸàÿ™Ÿäÿ© ŸàÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿµŸàÿ™Ÿäÿ©.\n\n‚ö†Ô∏è ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿµÿßÿ±ŸÖÿ© - Ÿäÿ¨ÿ® ÿßÿ™ÿ®ÿßÿπŸáÿß ÿ®ÿØŸÇÿ©:\n\n1. üìù ŸÇŸÖ ÿ®ÿ•ŸÜÿ™ÿßÿ¨ ŸÖŸÑÿÆÿµ ŸÖÿÆÿ™ÿµÿ± ŸàŸÖŸàÿ¨ÿ≤ ŸÑŸÑŸÜÿµ ÿßŸÑŸÖŸèŸÅÿ±Ÿëÿ∫ (ŸàŸÑŸäÿ≥ ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ)\n2. üìè ÿßŸÑÿ∑ŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ŸÑŸÑŸÖŸÑÿÆÿµ: {target_length} (ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä {transcript_length} ÿ≠ÿ±ŸÅ)\n3. üéØ ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸàÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑŸÖŸáŸÖÿ© ŸÅŸÇÿ∑\n4. ‚ùå ŸÑÿß ÿ™ŸèÿπŸêÿØ ŸÉÿ™ÿßÿ®ÿ© ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ - ŸÇŸÖ ÿ®ÿ™ŸÑÿÆŸäÿµŸá ŸÅŸÇÿ∑\n5. ‚úÖ ÿ£ÿπÿØ ÿßŸÑŸÖŸÑÿÆÿµ ŸÖÿ®ÿßÿ¥ÿ±ÿ© ÿ®ÿØŸàŸÜ ŸÖŸÇÿØŸÖÿßÿ™ ÿ£Ÿà ÿπÿ®ÿßÿ±ÿßÿ™ ŸÖÿ´ŸÑ \"ÿ•ŸÑŸäŸÉ ÿßŸÑŸÖŸÑÿÆÿµ\"\n\nüìã ŸÖÿπÿßŸäŸäÿ± ÿßŸÑÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿ¨ŸäÿØ:\n- ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸàÿßŸÑÿ¨ŸàŸáÿ±Ÿäÿ©\n- ÿ≠ÿ∞ŸÅ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±ÿßÿ™ ŸàÿßŸÑÿ≠ÿ¥Ÿà ŸàÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ´ÿßŸÜŸàŸäÿ©\n- ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ¨ŸÖŸÑ ŸÇÿµŸäÿ±ÿ© ŸàŸÖÿ®ÿßÿ¥ÿ±ÿ©\n- ÿ∞ŸÉÿ± ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° ŸàÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ŸàÿßŸÑÿ™Ÿàÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸáŸÖÿ©\n- ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑÿ≥ŸäÿßŸÇ ÿßŸÑÿπÿßŸÖ ŸàÿßŸÑŸÖÿπŸÜŸâ ÿßŸÑÿ£ÿµŸÑŸä\n\nüö´ ÿ™ÿ¨ŸÜÿ®:\n- ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÜÿµ ŸÉŸÖÿß ŸáŸà\n- ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ© ŸÅŸä ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä\n- ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿπÿ®ÿßÿ±ÿßÿ™ ÿ∑ŸàŸäŸÑÿ© ŸàŸÖÿπŸÇÿØÿ©\n- ÿ∞ŸÉÿ± ÿ™ŸÅÿßÿµŸäŸÑ ÿ∫Ÿäÿ± ÿ∂ÿ±Ÿàÿ±Ÿäÿ©\"\"\"\n        \n        # First try to get audio-specific rules\n        all_rules = await db.get_task_rules(task_id)\n        audio_rules = [r for r in all_rules if r.get('type') == 'audio_summarize' and r.get('is_active')]\n        \n        # If no audio-specific rules exist, fall back to general summarization rules\n        if not audio_rules:\n            error_logger.log_info(f\"[Pipeline] No audio-specific rules found, falling back to general summarization rules\")\n            audio_rules = [r for r in all_rules if r.get('type') == 'summarize' and r.get('is_active')]\n        \n        if audio_rules:\n            error_logger.log_info(f\"[Pipeline] üéôÔ∏è Loaded {len(audio_rules)} AUDIO-SPECIFIC summarization rules for task {task_id}\")\n        \n        return await self.process(\n            text=transcript,\n            task_id=task_id,\n            provider=provider,\n            model=model,\n            system_prompt=audio_system_prompt,\n            custom_rules=audio_rules,\n            config=config\n        )\n\nai_pipeline = AIPipeline()\n","path":null,"size_bytes":53828,"size_tokens":null},"telegram_bot/services/ai_postprocessing.py":{"content":"\"\"\"\nAI Postprocessing Engine\nStage 4: Validate output, verify rules applied, format result\nFinal quality control before delivery\n\"\"\"\nimport re\nimport asyncio\nfrom typing import Dict, Any, List, Optional, Tuple\nfrom dataclasses import dataclass, field\nfrom datetime import datetime\nfrom utils.error_handler import ErrorLogger\n\nerror_logger = ErrorLogger(\"ai_postprocessing\")\n\n@dataclass\nclass ValidationResult:\n    \"\"\"Result of validation check\"\"\"\n    check_name: str\n    passed: bool\n    details: str\n    severity: str = 'info'  # 'info' | 'warning' | 'error'\n\n@dataclass\nclass PostprocessingResult:\n    \"\"\"Complete postprocessing result\"\"\"\n    original_ai_output: str\n    final_output: str\n    validations: List[ValidationResult]\n    rules_verified: Dict[str, bool]\n    formatting_applied: List[str]\n    quality_score: float\n    processing_time: float\n    success: bool\n    warnings: List[str] = field(default_factory=list)\n    errors: List[str] = field(default_factory=list)\n\nclass AIPostprocessingEngine:\n    \"\"\"\n    Advanced postprocessing engine for AI output validation and formatting\n    Ensures all rules were applied and output meets quality standards\n    \"\"\"\n    \n    def __init__(self):\n        self.min_output_ratio = 0.1\n        self.max_output_ratio = 1.5\n        self.forbidden_patterns = [\n            r'ŸÉŸÖÿ≥ÿßÿπÿØ\\s+ÿ∞ŸÉÿßÿ°\\s+ÿßÿµÿ∑ŸÜÿßÿπŸä',\n            r'ÿ£ŸÜÿß\\s+ŸÜŸÖŸàÿ∞ÿ¨\\s+ŸÑÿ∫ÿ©',\n            r'ŸÑÿß\\s+ÿ£ÿ≥ÿ™ÿ∑Ÿäÿπ\\s+ÿ™ŸÑÿÆŸäÿµ',\n            r'I am an AI',\n            r'As an AI assistant',\n            r'I cannot summarize',\n            r'ŸÖŸÑÿÆÿµ:',\n            r'^ŸÖŸÑÿÆÿµ\\s*$',\n            r'Summary:',\n            r'Here is the summary',\n        ]\n        \n        self.required_cleanups = [\n            (r'\\n{3,}', '\\n\\n'),\n            (r'\\s+([ÿå,\\.!?])', r'\\1'),\n            (r'([ÿå,\\.!?])\\s*([ÿå,\\.!?])', r'\\1'),\n            (r'^\\s+', ''),\n            (r'\\s+$', ''),\n        ]\n        \n        error_logger.log_info(\"[Postprocessing] Engine initialized\")\n    \n    async def process(\n        self,\n        ai_output: str,\n        original_text: str,\n        rule_engine_result: Optional[Any] = None,\n        config: Optional[Dict[str, Any]] = None\n    ) -> PostprocessingResult:\n        \"\"\"\n        Main postprocessing function\n        Validates and formats AI output\n        \"\"\"\n        start_time = datetime.now()\n        config = config or {}\n        \n        if not ai_output or not ai_output.strip():\n            return self._empty_result(ai_output, original_text)\n        \n        processed_output = ai_output.strip()\n        validations = []\n        rules_verified = {}\n        formatting_applied = []\n        warnings = []\n        errors = []\n        \n        if config.get('enable_output_validation', True):\n            output_validations = await self._validate_output(\n                processed_output, \n                original_text\n            )\n            validations.extend(output_validations)\n            \n            for v in output_validations:\n                if not v.passed and v.severity == 'error':\n                    errors.append(v.details)\n                elif not v.passed and v.severity == 'warning':\n                    warnings.append(v.details)\n        \n        if config.get('enable_rule_verification', True) and rule_engine_result:\n            rules_verified = await self._verify_rules_applied(\n                processed_output,\n                rule_engine_result\n            )\n            \n            for rule_name, verified in rules_verified.items():\n                if not verified:\n                    warnings.append(f\"Rule may not be applied: {rule_name}\")\n        \n        output_format = config.get('output_format', 'markdown')\n        processed_output, formatting_actions = await self._apply_formatting(\n            processed_output,\n            output_format\n        )\n        formatting_applied.extend(formatting_actions)\n        \n        processed_output = await self._final_cleanup(processed_output)\n        \n        quality_score = self._calculate_quality_score(\n            processed_output,\n            original_text,\n            validations,\n            rules_verified\n        )\n        \n        processing_time = (datetime.now() - start_time).total_seconds()\n        \n        failed_critical = any(\n            not v.passed and v.severity == 'error' \n            for v in validations\n        )\n        \n        return PostprocessingResult(\n            original_ai_output=ai_output,\n            final_output=processed_output,\n            validations=validations,\n            rules_verified=rules_verified,\n            formatting_applied=formatting_applied,\n            quality_score=quality_score,\n            processing_time=processing_time,\n            success=not failed_critical,\n            warnings=warnings,\n            errors=errors\n        )\n    \n    async def _validate_output(\n        self, \n        output: str, \n        original: str\n    ) -> List[ValidationResult]:\n        \"\"\"Validate AI output quality and appropriateness\"\"\"\n        validations = []\n        \n        if not output or len(output.strip()) < 10:\n            validations.append(ValidationResult(\n                check_name='output_exists',\n                passed=False,\n                details='Output is empty or too short',\n                severity='error'\n            ))\n        else:\n            validations.append(ValidationResult(\n                check_name='output_exists',\n                passed=True,\n                details='Output has content'\n            ))\n        \n        # Check if output follows news format (no bullet points)\n        bullet_patterns = [r'^\\s*[‚Ä¢\\-\\*]', r'\\n\\s*[‚Ä¢\\-\\*]', r'^\\s*\\d+\\.', r'\\n\\s*\\d+\\.']\n        has_bullets = any(re.search(pattern, output, re.MULTILINE) for pattern in bullet_patterns)\n        if has_bullets:\n            validations.append(ValidationResult(\n                check_name='news_format',\n                passed=False,\n                details='Output contains bullet points - should be news paragraph format',\n                severity='warning'\n            ))\n        else:\n            validations.append(ValidationResult(\n                check_name='news_format',\n                passed=True,\n                details='Output is in proper paragraph format (no bullets)'\n            ))\n        \n        \n        if original:\n            ratio = len(output) / len(original) if len(original) > 0 else 1\n            \n            if ratio < self.min_output_ratio:\n                validations.append(ValidationResult(\n                    check_name='length_ratio',\n                    passed=False,\n                    details=f'Output too short ({ratio:.1%} of original)',\n                    severity='warning'\n                ))\n            elif ratio > self.max_output_ratio:\n                validations.append(ValidationResult(\n                    check_name='length_ratio',\n                    passed=False,\n                    details=f'Output longer than original ({ratio:.1%})',\n                    severity='warning'\n                ))\n            else:\n                validations.append(ValidationResult(\n                    check_name='length_ratio',\n                    passed=True,\n                    details=f'Length ratio acceptable ({ratio:.1%})'\n                ))\n        \n        for pattern in self.forbidden_patterns:\n            if re.search(pattern, output, re.IGNORECASE):\n                validations.append(ValidationResult(\n                    check_name='forbidden_content',\n                    passed=False,\n                    details=f'Contains forbidden pattern: {pattern[:30]}',\n                    severity='warning'\n                ))\n                break\n        else:\n            validations.append(ValidationResult(\n                check_name='forbidden_content',\n                passed=True,\n                details='No forbidden content detected'\n            ))\n        \n        if original:\n            original_sentences = set(s.strip() for s in re.split(r'[.!?ÿå]', original) if len(s.strip()) > 20)\n            output_sentences = set(s.strip() for s in re.split(r'[.!?ÿå]', output) if len(s.strip()) > 20)\n            \n            if original_sentences and output_sentences:\n                overlap = len(original_sentences.intersection(output_sentences))\n                total = len(original_sentences)\n                \n                if overlap > total * 0.8:\n                    validations.append(ValidationResult(\n                        check_name='originality',\n                        passed=False,\n                        details='Output too similar to original (minimal processing)',\n                        severity='warning'\n                    ))\n                else:\n                    validations.append(ValidationResult(\n                        check_name='originality',\n                        passed=True,\n                        details='Output appears to be processed'\n                    ))\n        \n        arabic_chars = len(re.findall(r'[\\u0600-\\u06FF]', original))\n        output_arabic = len(re.findall(r'[\\u0600-\\u06FF]', output))\n        \n        if arabic_chars > len(original) * 0.3:\n            if output_arabic < len(output) * 0.2:\n                validations.append(ValidationResult(\n                    check_name='language_consistency',\n                    passed=False,\n                    details='Arabic input but output lacks Arabic content',\n                    severity='warning'\n                ))\n            else:\n                validations.append(ValidationResult(\n                    check_name='language_consistency',\n                    passed=True,\n                    details='Language consistency maintained'\n                ))\n        \n        return validations\n    \n    async def _verify_rules_applied(\n        self,\n        output: str,\n        rule_engine_result: Any\n    ) -> Dict[str, bool]:\n        \"\"\"Verify that entity replacements and context rules were preserved in AI output\"\"\"\n        verified = {}\n        \n        if hasattr(rule_engine_result, 'entities_replaced'):\n            for entity_type, replacements in rule_engine_result.entities_replaced.items():\n                for original, replacement in replacements:\n                    is_verified = replacement in output\n                    \n                    original_still_present = original in output\n                    \n                    key = f\"entity_{entity_type}_{original[:20]}\"\n                    verified[key] = is_verified and not original_still_present\n                    \n                    if not verified[key]:\n                        error_logger.log_info(\n                            f\"[Postprocessing] Entity replacement not verified: {original} ‚Üí {replacement}\"\n                        )\n        \n        if hasattr(rule_engine_result, 'context_modifications'):\n            for modification in rule_engine_result.context_modifications:\n                verified[f\"context_{modification[:20]}\"] = True\n        \n        return verified\n    \n    async def _apply_formatting(\n        self,\n        text: str,\n        output_format: str\n    ) -> Tuple[str, List[str]]:\n        \"\"\"Apply formatting based on output format setting\"\"\"\n        formatting_applied = []\n        \n        if output_format == 'markdown':\n            if not any(c in text for c in ['**', '*', '‚Ä¢', '-', '#']):\n                lines = text.split('\\n')\n                formatted_lines = []\n                \n                for line in lines:\n                    line = line.strip()\n                    if not line:\n                        formatted_lines.append('')\n                        continue\n                    \n                    if line.endswith(':') and len(line) < 50:\n                        formatted_lines.append(f\"**{line}**\")\n                        formatting_applied.append('bold_headers')\n                    elif line.startswith(('-', '‚Ä¢', '*', '‚Äì')):\n                        formatted_lines.append(line)\n                    else:\n                        formatted_lines.append(line)\n                \n                text = '\\n'.join(formatted_lines)\n        \n        elif output_format == 'plain':\n            text = re.sub(r'\\*\\*([^*]+)\\*\\*', r'\\1', text)\n            text = re.sub(r'\\*([^*]+)\\*', r'\\1', text)\n            text = re.sub(r'#{1,6}\\s*', '', text)\n            formatting_applied.append('stripped_markdown')\n        \n        elif output_format == 'html':\n            text = text.replace('**', '<strong>').replace('**', '</strong>')\n            text = text.replace('\\n', '<br>\\n')\n            formatting_applied.append('html_conversion')\n        \n        return text, formatting_applied\n    \n    async def _final_cleanup(self, text: str) -> str:\n        \"\"\"Apply final cleanup patterns\"\"\"\n        for pattern, replacement in self.required_cleanups:\n            text = re.sub(pattern, replacement, text)\n        \n        return text.strip()\n    \n    def _calculate_quality_score(\n        self,\n        output: str,\n        original: str,\n        validations: List[ValidationResult],\n        rules_verified: Dict[str, bool]\n    ) -> float:\n        \"\"\"Calculate overall quality score (0.0 to 1.0)\"\"\"\n        score = 1.0\n        \n        for v in validations:\n            if not v.passed:\n                if v.severity == 'error':\n                    score -= 0.3\n                elif v.severity == 'warning':\n                    score -= 0.1\n        \n        if rules_verified:\n            verified_count = sum(1 for v in rules_verified.values() if v)\n            total_count = len(rules_verified)\n            if total_count > 0:\n                rule_score = verified_count / total_count\n                score = (score * 0.7) + (rule_score * 0.3)\n        \n        return max(0.0, min(1.0, score))\n    \n    def _empty_result(self, ai_output: str, original: str) -> PostprocessingResult:\n        \"\"\"Return result for empty/failed AI output\"\"\"\n        return PostprocessingResult(\n            original_ai_output=ai_output or \"\",\n            final_output=original or \"\",\n            validations=[ValidationResult(\n                check_name='output_exists',\n                passed=False,\n                details='AI returned empty output, using original text',\n                severity='warning'\n            )],\n            rules_verified={},\n            formatting_applied=[],\n            quality_score=0.5,\n            processing_time=0.0,\n            success=True,\n            warnings=['AI output was empty, returning original text']\n        )\n\npostprocessing_engine = AIPostprocessingEngine()\n","path":null,"size_bytes":14619,"size_tokens":null},"telegram_bot/services/ai_rule_engine.py":{"content":"\"\"\"\nAI Rule Engine\nStage 2: Apply programmatic rules before AI processing\nHandles entity replacement, context neutralization, sentiment adjustment\n\"\"\"\nimport re\nimport asyncio\nimport time\nfrom typing import Dict, Any, List, Optional, Tuple\nfrom dataclasses import dataclass, field\nfrom datetime import datetime\nfrom utils.error_handler import ErrorLogger\nfrom utils.database import db\n\nerror_logger = ErrorLogger(\"ai_rule_engine\")\n\n# Cache TTL in seconds\nCACHE_TTL = 30\n\n@dataclass\nclass RuleApplication:\n    \"\"\"Record of a rule being applied\"\"\"\n    rule_id: int\n    rule_name: str\n    rule_type: str\n    original_text: str\n    modified_text: str\n    changes_made: List[Dict[str, Any]]  # Can contain nested structures\n    success: bool\n    error: Optional[str] = None\n\n@dataclass\nclass RuleEngineResult:\n    \"\"\"Complete result of rule engine processing\"\"\"\n    original_text: str\n    processed_text: str\n    rules_applied: List[RuleApplication]\n    total_replacements: int\n    entities_replaced: Dict[str, List[Tuple[str, str]]]\n    context_modifications: List[str]\n    processing_time: float\n    success: bool\n    errors: List[str] = field(default_factory=list)\n    ai_instructions: List[Dict[str, Any]] = field(default_factory=list)  # Instructions for AI processing\n    semantic_replacement_rules: List[Dict[str, Any]] = field(default_factory=list)  # Rules for AI semantic matching\n\nclass AIRuleEngine:\n    \"\"\"\n    Advanced rule engine for applying programmatic rules to text\n    Supports entity replacement, context neutralization, and custom transformations\n    \"\"\"\n    \n    def __init__(self):\n        # Cache structure: {task_id: {'data': [...], 'timestamp': float}}\n        self.rule_cache: Dict[int, Dict[str, Any]] = {}\n        self.entity_cache: Dict[int, Dict[str, Any]] = {}\n        self.context_cache: Dict[int, Dict[str, Any]] = {}\n        error_logger.log_info(\"[RuleEngine] Engine initialized with TTL-based caching\")\n    \n    def _is_cache_valid(self, cache: Dict[int, Dict[str, Any]], task_id: int) -> bool:\n        \"\"\"Check if cached data is still valid (not expired)\"\"\"\n        if task_id not in cache:\n            return False\n        entry = cache[task_id]\n        if 'timestamp' not in entry:\n            return False\n        return (time.time() - entry['timestamp']) < CACHE_TTL\n    \n    def _get_cached_data(self, cache: Dict[int, Dict[str, Any]], task_id: int) -> Optional[List[Dict]]:\n        \"\"\"Get cached data if valid, otherwise return None\"\"\"\n        if self._is_cache_valid(cache, task_id):\n            return cache[task_id].get('data', [])\n        return None\n    \n    def _set_cache(self, cache: Dict[int, Dict[str, Any]], task_id: int, data: List[Dict]):\n        \"\"\"Set cache with timestamp\"\"\"\n        cache[task_id] = {\n            'data': data,\n            'timestamp': time.time()\n        }\n    \n    async def process(\n        self, \n        text: str, \n        task_id: int,\n        preprocessing_result: Optional[Any] = None\n    ) -> RuleEngineResult:\n        \"\"\"\n        Main rule processing function\n        Applies all rules in priority order\n        \"\"\"\n        start_time = datetime.now()\n        \n        if not text or not text.strip():\n            return self._empty_result(text)\n        \n        original_text = text\n        processed_text = text\n        rules_applied = []\n        total_replacements = 0\n        entities_replaced = {}\n        context_modifications = []\n        ai_instructions = []\n        semantic_replacement_rules = []\n        errors = []\n        \n        try:\n            entity_rules = await self._get_entity_rules(task_id)\n            if entity_rules:\n                result = await self._apply_entity_replacements(\n                    processed_text, \n                    entity_rules,\n                    preprocessing_result\n                )\n                processed_text = result['text']\n                rules_applied.extend(result['applications'])\n                total_replacements += result['count']\n                entities_replaced = result['entities']\n                semantic_replacement_rules = result.get('semantic_rules', [])\n                error_logger.log_info(f\"[RuleEngine] Entity replacements: {result['count']}, Semantic rules: {len(semantic_replacement_rules)}\")\n            \n            context_rules = await self._get_context_rules(task_id)\n            if context_rules:\n                result = await self._apply_context_rules(\n                    processed_text,\n                    context_rules,\n                    preprocessing_result\n                )\n                processed_text = result['text']\n                rules_applied.extend(result['applications'])\n                context_modifications = result['modifications']\n                ai_instructions = result.get('ai_instructions', [])\n                error_logger.log_info(f\"[RuleEngine] Context modifications: {len(result['modifications'])}, AI instructions: {len(ai_instructions)}\")\n            \n            ai_rules = await self._get_ai_rules(task_id)\n            preprocessing_rules = [r for r in ai_rules if r.get('category') == 'preprocessing']\n            if preprocessing_rules:\n                result = await self._apply_preprocessing_rules(\n                    processed_text,\n                    preprocessing_rules\n                )\n                processed_text = result['text']\n                rules_applied.extend(result['applications'])\n                total_replacements += result['count']\n            \n        except Exception as e:\n            errors.append(str(e))\n            error_logger.log_warning(f\"[RuleEngine] Error: {str(e)}\")\n        \n        processing_time = (datetime.now() - start_time).total_seconds()\n        \n        return RuleEngineResult(\n            original_text=original_text,\n            processed_text=processed_text,\n            rules_applied=rules_applied,\n            total_replacements=total_replacements,\n            entities_replaced=entities_replaced,\n            context_modifications=context_modifications,\n            processing_time=processing_time,\n            success=len(errors) == 0,\n            errors=errors,\n            ai_instructions=ai_instructions,\n            semantic_replacement_rules=semantic_replacement_rules\n        )\n    \n    async def _get_entity_rules(self, task_id: int) -> List[Dict]:\n        \"\"\"Get entity replacement rules for task with TTL-based caching\"\"\"\n        try:\n            # Check cache with TTL\n            cached = self._get_cached_data(self.entity_cache, task_id)\n            if cached is not None:\n                error_logger.log_info(f\"[RuleEngine] Using cached entity rules for task {task_id} ({len(cached)} rules)\")\n                return cached\n            \n            # Fetch from database\n            rules = await db.get_entity_replacements(task_id)\n            active_rules = [r for r in rules if r.get('is_active', True)]\n            active_rules.sort(key=lambda x: x.get('priority', 0), reverse=True)\n            \n            # Store in cache with timestamp\n            self._set_cache(self.entity_cache, task_id, active_rules)\n            error_logger.log_info(f\"[RuleEngine] Loaded {len(active_rules)} entity rules for task {task_id} from DB\")\n            return active_rules\n        except Exception as e:\n            error_logger.log_warning(f\"[RuleEngine] Failed to get entity rules: {str(e)}\")\n            return []\n    \n    async def _get_context_rules(self, task_id: int) -> List[Dict]:\n        \"\"\"Get context modification rules for task with TTL-based caching\"\"\"\n        try:\n            # Check cache with TTL\n            cached = self._get_cached_data(self.context_cache, task_id)\n            if cached is not None:\n                error_logger.log_info(f\"[RuleEngine] Using cached context rules for task {task_id} ({len(cached)} rules)\")\n                return cached\n            \n            # Fetch from database\n            rules = await db.get_context_rules(task_id)\n            active_rules = [r for r in rules if r.get('is_active', True)]\n            active_rules.sort(key=lambda x: x.get('priority', 0), reverse=True)\n            \n            # Store in cache with timestamp\n            self._set_cache(self.context_cache, task_id, active_rules)\n            error_logger.log_info(f\"[RuleEngine] Loaded {len(active_rules)} context rules for task {task_id} from DB\")\n            return active_rules\n        except Exception as e:\n            error_logger.log_warning(f\"[RuleEngine] Failed to get context rules: {str(e)}\")\n            return []\n    \n    async def _get_ai_rules(self, task_id: int) -> List[Dict]:\n        \"\"\"Get AI rules for task with TTL-based caching\"\"\"\n        try:\n            # Check cache with TTL\n            cached = self._get_cached_data(self.rule_cache, task_id)\n            if cached is not None:\n                return cached\n            \n            # Fetch from database\n            rules = await db.get_task_rules(task_id)\n            active_rules = [r for r in rules if r.get('is_active', True)]\n            active_rules.sort(key=lambda x: x.get('priority', 0), reverse=True)\n            \n            # Store in cache with timestamp\n            self._set_cache(self.rule_cache, task_id, active_rules)\n            return active_rules\n        except Exception as e:\n            error_logger.log_warning(f\"[RuleEngine] Failed to get AI rules: {str(e)}\")\n            return []\n    \n    async def _apply_entity_replacements(\n        self,\n        text: str,\n        rules: List[Dict],\n        preprocessing_result: Optional[Any] = None\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Apply entity replacement rules\n        Example: \"ŸÖÿ≠ŸÖÿØ ŸÖÿµÿ∑ŸÅŸâ\" ‚Üí \"ÿßŸÑÿ®ÿ∑ŸÑ ŸÖÿ≠ŸÖÿØ ŸÖÿµÿ∑ŸÅŸâ\"\n        \n        Supports multiple original texts and replacement texts separated by '|':\n        - original_text: \"ÿßÿ≠ŸÖÿØ|ÿµÿßŸÑÿ≠|ÿπŸÑŸä\" means any of these will be replaced\n        - replacement_text: \"ÿ∑ŸÅŸÑ\" means they will all be replaced with this\n        \n        When use_context is True, rules are passed to AI for semantic matching\n        (e.g., \"ŸÖŸÑŸäÿ¥Ÿäÿß ÿßŸÑÿ≠Ÿàÿ´Ÿä\" will also match \"ŸÖŸÑŸäÿ¥Ÿäÿßÿ™ ÿßŸÑÿ≠Ÿàÿ´Ÿä\")\n        \"\"\"\n        processed_text = text\n        applications = []\n        count = 0\n        entities_replaced = {}\n        semantic_replacement_rules = []  # Rules to be processed by AI for semantic matching\n        \n        for rule in rules:\n            try:\n                original_text = rule.get('original_text', '')\n                replacement_text = rule.get('replacement_text', '')\n                entity_type = rule.get('entity_type', 'custom')\n                case_sensitive = rule.get('case_sensitive', False)\n                use_context = rule.get('use_context', True)\n                \n                if not original_text or not replacement_text:\n                    continue\n                \n                original_list = [o.strip() for o in original_text.split('|') if o.strip()]\n                replacement_list = [r.strip() for r in replacement_text.split('|') if r.strip()]\n                \n                if not original_list or not replacement_list:\n                    continue\n                \n                primary_replacement = replacement_list[0]\n                \n                flags = 0 if case_sensitive else re.IGNORECASE\n                rule_changes = []\n                rule_match_count = 0\n                \n                for original in original_list:\n                    pattern = re.escape(original)\n                    matches = list(re.finditer(pattern, processed_text, flags))\n                    \n                    if matches:\n                        for match in matches:\n                            rule_changes.append({\n                                'original': match.group(),\n                                'replacement': primary_replacement,\n                                'position': match.start()\n                            })\n                        \n                        processed_text = re.sub(pattern, primary_replacement, processed_text, flags=flags)\n                        rule_match_count += len(matches)\n                        \n                        if entity_type not in entities_replaced:\n                            entities_replaced[entity_type] = []\n                        entities_replaced[entity_type].append((original, primary_replacement))\n                        \n                        error_logger.log_info(f\"[RuleEngine] Replaced '{original}' with '{primary_replacement}' ({len(matches)} times)\")\n                \n                if rule_changes:\n                    count += rule_match_count\n                    originals_display = ', '.join(original_list[:3])\n                    if len(original_list) > 3:\n                        originals_display += f'... (+{len(original_list) - 3})'\n                    \n                    applications.append(RuleApplication(\n                        rule_id=rule.get('id', 0),\n                        rule_name=f\"Entity: {originals_display}\",\n                        rule_type='entity_replace',\n                        original_text=text[:100],\n                        modified_text=processed_text[:100],\n                        changes_made=rule_changes,\n                        success=True\n                    ))\n                \n                if use_context:\n                    semantic_replacement_rules.append({\n                        'id': rule.get('id', 0),\n                        'originals': original_list,\n                        'replacements': replacement_list,\n                        'entity_type': entity_type,\n                        'case_sensitive': case_sensitive\n                    })\n                    error_logger.log_info(f\"[RuleEngine] Added semantic rule: {original_list} ‚Üí {replacement_list} (AI will find variations)\")\n                    \n            except Exception as e:\n                applications.append(RuleApplication(\n                    rule_id=rule.get('id', 0),\n                    rule_name=f\"Entity: {rule.get('original_text', 'Unknown')[:30]}\",\n                    rule_type='entity_replace',\n                    original_text=text[:100],\n                    modified_text=processed_text[:100],\n                    changes_made=[],\n                    success=False,\n                    error=str(e)\n                ))\n        \n        return {\n            'text': processed_text,\n            'applications': applications,\n            'count': count,\n            'entities': entities_replaced,\n            'semantic_rules': semantic_replacement_rules  # Pass to AI for semantic matching\n        }\n    \n    async def _apply_context_rules(\n        self,\n        text: str,\n        rules: List[Dict],\n        preprocessing_result: Optional[Any] = None\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Apply context modification rules\n        Applies pattern-based rules and stores instructions for AI processing\n        All context rules with instructions will be passed to AI for processing\n        \"\"\"\n        processed_text = text\n        applications = []\n        modifications = []\n        ai_instructions = []  # Instructions to be passed to AI\n        \n        # Standard neutralization map for common offensive terms\n        neutralization_map = {\n            'ÿ•ÿ±Ÿáÿßÿ®Ÿä': 'ŸÖÿ≥ŸÑÿ≠',\n            'ÿ•ÿ±Ÿáÿßÿ®ŸäŸäŸÜ': 'ŸÖÿ≥ŸÑÿ≠ŸäŸÜ',\n            'ÿπÿµÿßÿ®ÿ©': 'ŸÖÿ¨ŸÖŸàÿπÿ©',\n            'ÿπÿµÿßÿ®ÿßÿ™': 'ŸÖÿ¨ŸÖŸàÿπÿßÿ™',\n            'ŸÖÿ¨ÿ±ŸÖ': 'ŸÖÿ™ŸáŸÖ',\n            'ŸÖÿ¨ÿ±ŸÖŸäŸÜ': 'ŸÖÿ™ŸáŸÖŸäŸÜ',\n            'ŸÉŸÑÿ®': 'ÿ¥ÿÆÿµ',\n            'ÿ≠ŸÖÿßÿ±': 'ÿ¥ÿÆÿµ',\n            'ÿ∫ÿ®Ÿä': 'ÿ¥ÿÆÿµ',\n            'ÿ£ÿ≠ŸÖŸÇ': 'ÿ¥ÿÆÿµ'\n        }\n        \n        error_logger.log_info(f\"[RuleEngine] Applying {len(rules)} context rules\")\n        \n        for rule in rules:\n            try:\n                rule_type = rule.get('rule_type', '')\n                trigger_pattern = rule.get('trigger_pattern', '')\n                target_sentiment = rule.get('target_sentiment', 'neutral')\n                instructions = rule.get('instructions', '')\n                rule_id = rule.get('id', 0)\n                \n                error_logger.log_info(f\"[RuleEngine] Processing rule {rule_id}: type={rule_type}, instructions={instructions[:50] if instructions else 'none'}...\")\n                \n                # Always record instructions for AI processing\n                if instructions:\n                    ai_instructions.append({\n                        'rule_id': rule_id,\n                        'rule_type': rule_type,\n                        'instructions': instructions,\n                        'target_sentiment': target_sentiment\n                    })\n                    modifications.append(f\"AI_INSTRUCTION: {instructions}\")\n                \n                if rule_type == 'neutralize_negative':\n                    changes_made = []\n                    for offensive, neutral in neutralization_map.items():\n                        if offensive in processed_text:\n                            processed_text = processed_text.replace(offensive, neutral)\n                            changes_made.append(f\"{offensive} ‚Üí {neutral}\")\n                            modifications.append(f\"Neutralized: {offensive} ‚Üí {neutral}\")\n                    \n                    applications.append(RuleApplication(\n                        rule_id=rule_id,\n                        rule_name=instructions[:50] if instructions else 'Neutralize Negative',\n                        rule_type='context_neutralize',\n                        original_text=text[:100],\n                        modified_text=processed_text[:100],\n                        changes_made=[{'type': 'neutralization', 'changes': changes_made}],\n                        success=True\n                    ))\n                    error_logger.log_info(f\"[RuleEngine] Neutralized {len(changes_made)} terms\")\n                \n                elif rule_type == 'remove_bias':\n                    bias_patterns = [\n                        (r'ÿßŸÑŸÖÿ≤ÿπŸàŸÖ[ÿ©]?\\s*', ''),\n                        (r'ÿßŸÑŸÖÿØÿπŸà[ÿ©]?\\s*', ''),\n                        (r'ÿßŸÑÿ•ÿ±Ÿáÿßÿ®Ÿä[ÿ©]?\\s+', ''),\n                    ]\n                    \n                    changes_made = []\n                    for pattern, replacement in bias_patterns:\n                        if re.search(pattern, processed_text):\n                            processed_text = re.sub(pattern, replacement, processed_text)\n                            changes_made.append(pattern)\n                            modifications.append(f\"Removed bias pattern: {pattern}\")\n                    \n                    applications.append(RuleApplication(\n                        rule_id=rule_id,\n                        rule_name=instructions[:50] if instructions else 'Remove Bias',\n                        rule_type='remove_bias',\n                        original_text=text[:100],\n                        modified_text=processed_text[:100],\n                        changes_made=[{'type': 'bias_removal', 'patterns': changes_made}],\n                        success=True\n                    ))\n                \n                elif rule_type == 'enhance_positive':\n                    positive_enhancements = [\n                        ('ÿßŸÜÿ™ÿµÿßÿ±', 'ÿßŸÜÿ™ÿµÿßÿ± ÿπÿ∏ŸäŸÖ'),\n                        ('ŸÜÿ¨ÿßÿ≠', 'ŸÜÿ¨ÿßÿ≠ ÿ®ÿßŸáÿ±'),\n                        ('ÿ™ŸÇÿØŸÖ', 'ÿ™ŸÇÿØŸÖ ŸÖŸÑŸÖŸàÿ≥'),\n                    ]\n                    \n                    changes_made = []\n                    for original, enhanced in positive_enhancements:\n                        if original in processed_text and enhanced not in processed_text:\n                            processed_text = processed_text.replace(original, enhanced, 1)\n                            changes_made.append(f\"{original} ‚Üí {enhanced}\")\n                            modifications.append(f\"Enhanced: {original} ‚Üí {enhanced}\")\n                    \n                    applications.append(RuleApplication(\n                        rule_id=rule_id,\n                        rule_name=instructions[:50] if instructions else 'Enhance Positive',\n                        rule_type='enhance_positive',\n                        original_text=text[:100],\n                        modified_text=processed_text[:100],\n                        changes_made=[{'type': 'positive_enhancement', 'changes': changes_made}],\n                        success=True\n                    ))\n                \n                elif rule_type == 'formal_tone':\n                    informal_formal = {\n                        'ÿ≠ŸÉŸâ': 'ŸÇÿßŸÑ',\n                        'ÿ±ÿßÿ≠': 'ÿ∞Ÿáÿ®',\n                        'ÿ¨ÿßÿ®': 'ÿ£ÿ≠ÿ∂ÿ±',\n                        'ÿ¥ÿßŸÅ': 'ÿ±ÿ£Ÿâ',\n                    }\n                    \n                    changes_made = []\n                    for informal, formal in informal_formal.items():\n                        if informal in processed_text:\n                            processed_text = processed_text.replace(informal, formal)\n                            changes_made.append(f\"{informal} ‚Üí {formal}\")\n                            modifications.append(f\"Formalized: {informal} ‚Üí {formal}\")\n                    \n                    applications.append(RuleApplication(\n                        rule_id=rule_id,\n                        rule_name=instructions[:50] if instructions else 'Formal Tone',\n                        rule_type='formal_tone',\n                        original_text=text[:100],\n                        modified_text=processed_text[:100],\n                        changes_made=[{'type': 'formalization', 'changes': changes_made}],\n                        success=True\n                    ))\n                \n                elif rule_type == 'custom':\n                    # Custom rules - check trigger if present, always apply instructions\n                    triggered = True\n                    if trigger_pattern:\n                        try:\n                            triggered = bool(re.search(trigger_pattern, processed_text))\n                        except re.error as e:\n                            error_logger.log_warning(f\"[RuleEngine] Invalid regex pattern: {trigger_pattern}, error: {e}\")\n                            triggered = False\n                    \n                    if triggered:\n                        modifications.append(f\"Custom rule applied: {instructions[:50] if instructions else trigger_pattern[:30]}\")\n                        applications.append(RuleApplication(\n                            rule_id=rule_id,\n                            rule_name=f'Custom: {instructions[:30] if instructions else \"trigger\"}',\n                            rule_type='custom',\n                            original_text=text[:100],\n                            modified_text=processed_text[:100],\n                            changes_made=[{'type': 'custom_trigger', 'instructions': instructions}],\n                            success=True\n                        ))\n                        error_logger.log_info(f\"[RuleEngine] Custom rule {rule_id} triggered\")\n                \n                else:\n                    # Unknown rule type - still record it if it has instructions\n                    if instructions:\n                        applications.append(RuleApplication(\n                            rule_id=rule_id,\n                            rule_name=f'{rule_type}: {instructions[:30]}',\n                            rule_type=rule_type or 'unknown',\n                            original_text=text[:100],\n                            modified_text=processed_text[:100],\n                            changes_made=[{'type': 'instruction', 'instructions': instructions}],\n                            success=True\n                        ))\n                        error_logger.log_info(f\"[RuleEngine] Rule {rule_id} ({rule_type}) recorded with instructions\")\n                        \n            except Exception as e:\n                applications.append(RuleApplication(\n                    rule_id=rule.get('id', 0),\n                    rule_name=f\"Context: {rule.get('rule_type', 'Unknown')}\",\n                    rule_type='context_rule',\n                    original_text=text[:100],\n                    modified_text=processed_text[:100],\n                    changes_made=[],\n                    success=False,\n                    error=str(e)\n                ))\n        \n        error_logger.log_info(f\"[RuleEngine] Context rules result: {len(applications)} applied, {len(ai_instructions)} AI instructions\")\n        \n        return {\n            'text': processed_text,\n            'applications': applications,\n            'modifications': modifications,\n            'ai_instructions': ai_instructions  # Pass to AI for processing\n        }\n    \n    async def _apply_preprocessing_rules(\n        self,\n        text: str,\n        rules: List[Dict]\n    ) -> Dict[str, Any]:\n        \"\"\"Apply preprocessing AI rules\"\"\"\n        processed_text = text\n        applications = []\n        count = 0\n        \n        for rule in rules:\n            try:\n                rule_type = rule.get('type', '')\n                config = rule.get('config', {}) or {}\n                \n                if rule_type == 'format':\n                    remove_extra_spaces = config.get('remove_extra_spaces', True)\n                    if remove_extra_spaces:\n                        processed_text = re.sub(r'\\s+', ' ', processed_text)\n                        count += 1\n                    \n                    remove_urls = config.get('remove_urls', False)\n                    if remove_urls:\n                        processed_text = re.sub(r'https?://\\S+', '', processed_text)\n                        count += 1\n                    \n                    applications.append(RuleApplication(\n                        rule_id=rule.get('id', 0),\n                        rule_name=rule.get('name', 'Format'),\n                        rule_type='format',\n                        original_text=text[:100],\n                        modified_text=processed_text[:100],\n                        changes_made=[{'type': 'formatting'}],\n                        success=True\n                    ))\n                \n            except Exception as e:\n                applications.append(RuleApplication(\n                    rule_id=rule.get('id', 0),\n                    rule_name=rule.get('name', 'Unknown'),\n                    rule_type=rule.get('type', 'unknown'),\n                    original_text=text[:100],\n                    modified_text=processed_text[:100],\n                    changes_made=[],\n                    success=False,\n                    error=str(e)\n                ))\n        \n        return {\n            'text': processed_text,\n            'applications': applications,\n            'count': count\n        }\n    \n    async def apply_summarization_rule(\n        self,\n        text: str,\n        rule_config: Optional[Dict[str, Any]] = None,\n        task_config: Optional[Dict[str, Any]] = None\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Apply text summarization rule\n        Truncates text to specified max length while preserving word boundaries\n        \"\"\"\n        if not text or not text.strip():\n            return {'text': text, 'success': True, 'applied': False}\n        \n        rule_config = rule_config or {}\n        max_length = rule_config.get('maxLength', 300)\n        style = rule_config.get('style', 'balanced')\n        \n        if not max_length or max_length <= 0:\n            return {'text': text, 'success': True, 'applied': False}\n        \n        text_length = len(text)\n        \n        # If text is already shorter than max_length, no need to summarize\n        if text_length <= max_length:\n            error_logger.log_info(f\"[RuleEngine] Text length ({text_length}) already within max ({max_length})\")\n            return {'text': text, 'success': True, 'applied': False}\n        \n        # Truncate text while preserving word boundaries\n        truncated = text[:max_length]\n        \n        # Find the last space to avoid cutting a word\n        last_space = truncated.rfind(' ')\n        if last_space > max_length * 0.7:  # Only cut at space if it's reasonably close\n            truncated = truncated[:last_space]\n        \n        # Clean up trailing punctuation\n        truncated = truncated.rstrip()\n        if truncated and truncated[-1] not in '.:ÿåÿõ!ÿü':\n            truncated += '...'\n        \n        error_logger.log_info(f\"[RuleEngine] Summarization applied | Original: {text_length} chars | Style: {style} | Truncated: {len(truncated)} chars\")\n        \n        return {\n            'text': truncated,\n            'success': True,\n            'applied': True,\n            'original_length': text_length,\n            'new_length': len(truncated),\n            'style': style\n        }\n    \n    def clear_cache(self, task_id: Optional[int] = None):\n        \"\"\"Clear rule caches\"\"\"\n        if task_id:\n            self.rule_cache.pop(task_id, None)\n            self.entity_cache.pop(task_id, None)\n            self.context_cache.pop(task_id, None)\n        else:\n            self.rule_cache.clear()\n            self.entity_cache.clear()\n            self.context_cache.clear()\n        error_logger.log_info(f\"[RuleEngine] Cache cleared for task_id={task_id}\")\n    \n    def _empty_result(self, text: str) -> RuleEngineResult:\n        \"\"\"Return empty result for empty text\"\"\"\n        return RuleEngineResult(\n            original_text=text or \"\",\n            processed_text=text or \"\",\n            rules_applied=[],\n            total_replacements=0,\n            entities_replaced={},\n            context_modifications=[],\n            processing_time=0.0,\n            success=True,\n            errors=[],\n            ai_instructions=[]\n        )\n\nrule_engine = AIRuleEngine()\n","path":null,"size_bytes":29836,"size_tokens":null},"telegram_bot/services/ai_preprocessing.py":{"content":"\"\"\"\nAI Preprocessing Engine\nStage 1: Extract entities, analyze sentiment, detect keywords\nPrepares text for rule application and AI processing\n\"\"\"\nimport re\nimport asyncio\nfrom typing import Dict, Any, List, Optional, Tuple\nfrom dataclasses import dataclass, field\nfrom datetime import datetime\nfrom utils.error_handler import ErrorLogger\n\nerror_logger = ErrorLogger(\"ai_preprocessing\")\n\n@dataclass\nclass Entity:\n    \"\"\"Represents an extracted entity\"\"\"\n    text: str\n    entity_type: str  # 'person' | 'organization' | 'location' | 'date' | 'number' | 'event' | 'custom'\n    start_pos: int\n    end_pos: int\n    confidence: float = 1.0\n    context: str = \"\"\n\n@dataclass\nclass SentimentResult:\n    \"\"\"Sentiment analysis result\"\"\"\n    overall: str  # 'positive' | 'negative' | 'neutral' | 'mixed'\n    score: float  # -1.0 to 1.0\n    keywords_positive: List[str] = field(default_factory=list)\n    keywords_negative: List[str] = field(default_factory=list)\n    has_offensive: bool = False\n    offensive_words: List[str] = field(default_factory=list)\n\n@dataclass\nclass PreprocessingResult:\n    \"\"\"Complete preprocessing result\"\"\"\n    original_text: str\n    cleaned_text: str\n    entities: List[Entity]\n    sentiment: SentimentResult\n    keywords: List[str]\n    language: str\n    text_length: int\n    word_count: int\n    has_urls: bool\n    urls: List[str]\n    has_mentions: bool\n    mentions: List[str]\n    has_hashtags: bool\n    hashtags: List[str]\n    processing_time: float\n    metadata: Dict[str, Any] = field(default_factory=dict)\n\nclass AIPreprocessingEngine:\n    \"\"\"\n    Advanced preprocessing engine for text analysis\n    Extracts entities, analyzes sentiment, detects patterns\n    \"\"\"\n    \n    def __init__(self):\n        self.arabic_positive_words = [\n            'ŸÜÿ¨ÿßÿ≠', 'ÿ™ÿ≠ŸÇŸäŸÇ', 'ÿ•ŸÜÿ¨ÿßÿ≤', 'ÿ™ŸÇÿØŸÖ', 'ÿ™ÿ∑Ÿàÿ±', 'ÿ•Ÿäÿ¨ÿßÿ®Ÿä', 'ÿ±ÿßÿ¶ÿπ', 'ŸÖŸÖÿ™ÿßÿ≤',\n            'ÿ®ÿ∑ŸÑ', 'ÿ®ÿ∑ŸàŸÑÿ©', 'ÿßŸÜÿ™ÿµÿßÿ±', 'ŸÅŸàÿ≤', 'ÿ™ŸÅŸàŸÇ', 'ÿ•ÿ®ÿØÿßÿπ', 'ÿ™ŸÖŸäÿ≤', 'ÿ¥ÿ¨ÿßÿπÿ©',\n            'ŸÉŸÅÿßÿ≠', 'ŸÖŸÇÿßŸàŸÖÿ©', 'ÿµŸÖŸàÿØ', 'ÿπÿ≤ŸäŸÖÿ©', 'ÿ•ÿ±ÿßÿØÿ©', 'ÿ£ŸÖŸÑ', 'ÿ≠ÿ±Ÿäÿ©', 'ÿßÿ≥ÿ™ŸÇŸÑÿßŸÑ'\n        ]\n        \n        self.arabic_negative_words = [\n            'ŸÅÿ¥ŸÑ', 'Ÿáÿ≤ŸäŸÖÿ©', 'ÿÆÿ≥ÿßÿ±ÿ©', 'ÿ≥ŸÑÿ®Ÿä', 'ÿ≥Ÿäÿ°', 'ÿ±ÿØŸäÿ°', 'ÿ∂ÿπŸäŸÅ', 'ÿßŸÜŸáŸäÿßÿ±',\n            'ŸÉÿßÿ±ÿ´ÿ©', 'ŸÖÿ£ÿ≥ÿßÿ©', 'ÿ£ÿ≤ŸÖÿ©', 'ŸÖÿ¥ŸÉŸÑÿ©', 'ÿÆÿ∑ÿ±', 'ÿ™ŸáÿØŸäÿØ', 'ÿπÿØŸàÿßŸÜ'\n        ]\n        \n        self.arabic_offensive_patterns = [\n            r'\\bŸÉŸÑÿ®\\b', r'\\bÿ≠ŸÖÿßÿ±\\b', r'\\bÿ∫ÿ®Ÿä\\b', r'\\bÿ£ÿ≠ŸÖŸÇ\\b', r'\\bŸÖÿ¨ÿ±ŸÖ\\b',\n            r'\\bÿ•ÿ±Ÿáÿßÿ®Ÿä\\b', r'\\bÿÆÿßÿ¶ŸÜ\\b', r'\\bÿπŸÖŸäŸÑ\\b', r'\\bŸÉÿßÿ∞ÿ®\\b', r'\\bŸÖŸÜÿßŸÅŸÇ\\b'\n        ]\n        \n        self.person_indicators = [\n            'ÿßŸÑÿ≥ŸäÿØ', 'ÿßŸÑÿØŸÉÿ™Ÿàÿ±', 'ÿßŸÑŸÖŸáŸÜÿØÿ≥', 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥', 'ÿßŸÑŸàÿ≤Ÿäÿ±', 'ÿßŸÑŸÇÿßÿ¶ÿØ',\n            'ÿßŸÑÿ¥ŸäÿÆ', 'ÿßŸÑÿ£ÿ≥ÿ™ÿßÿ∞', 'ÿßŸÑÿ®ÿ∑ŸÑ', 'ÿßŸÑÿ¥ŸáŸäÿØ', 'ÿßŸÑŸÖŸÜÿßÿ∂ŸÑ', 'ÿßŸÑÿ£ŸÖŸäÿ±'\n        ]\n        \n        self.organization_indicators = [\n            'Ÿàÿ≤ÿßÿ±ÿ©', 'ŸáŸäÿ¶ÿ©', 'ŸÖÿ§ÿ≥ÿ≥ÿ©', 'ŸÖŸÜÿ∏ŸÖÿ©', 'ÿ¨ŸÖÿπŸäÿ©', 'ÿ≠ÿ≤ÿ®', 'ÿ≠ÿ±ŸÉÿ©',\n            'ÿ¨Ÿäÿ¥', 'ÿ¥ÿ±ÿ∑ÿ©', 'ÿ£ŸÖŸÜ', 'ŸÖÿ≠ŸÉŸÖÿ©', 'ÿ¨ÿßŸÖÿπÿ©', 'ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ'\n        ]\n        \n        self.location_indicators = [\n            'ŸÖÿØŸäŸÜÿ©', 'ŸÇÿ±Ÿäÿ©', 'ŸÖŸÜÿ∑ŸÇÿ©', 'ŸÖÿ≠ÿßŸÅÿ∏ÿ©', 'ÿØŸàŸÑÿ©', 'ÿ®ŸÑÿØ', 'ÿ¥ÿßÿ±ÿπ',\n            'ÿ≠Ÿä', 'ŸÖÿÆŸäŸÖ', 'ŸÖÿπÿ®ÿ±', 'ÿ≠ÿØŸàÿØ', 'ŸÖŸäŸÜÿßÿ°', 'ŸÖÿ∑ÿßÿ±'\n        ]\n        \n        error_logger.log_info(\"[Preprocessing] Engine initialized with Arabic language support\")\n    \n    async def process(self, text: str, config: Optional[Dict[str, Any]] = None) -> PreprocessingResult:\n        \"\"\"\n        Main preprocessing function\n        Analyzes text and extracts all relevant information\n        \"\"\"\n        start_time = datetime.now()\n        config = config or {}\n        \n        if not text or not text.strip():\n            return self._empty_result(text)\n        \n        text = text.strip()\n        \n        cleaned_text = self._clean_text(text)\n        \n        entities = await self._extract_entities(text, config.get('enable_entity_extraction', True))\n        \n        sentiment = await self._analyze_sentiment(text, config.get('enable_sentiment_analysis', True))\n        \n        keywords = await self._extract_keywords(text, config.get('enable_keyword_detection', True))\n        \n        urls = self._extract_urls(text)\n        mentions = self._extract_mentions(text)\n        hashtags = self._extract_hashtags(text)\n        \n        language = self._detect_language(text)\n        \n        processing_time = (datetime.now() - start_time).total_seconds()\n        \n        result = PreprocessingResult(\n            original_text=text,\n            cleaned_text=cleaned_text,\n            entities=entities,\n            sentiment=sentiment,\n            keywords=keywords,\n            language=language,\n            text_length=len(text),\n            word_count=len(text.split()),\n            has_urls=bool(urls),\n            urls=urls,\n            has_mentions=bool(mentions),\n            mentions=mentions,\n            has_hashtags=bool(hashtags),\n            hashtags=hashtags,\n            processing_time=processing_time,\n            metadata={\n                'preprocessed_at': datetime.now().isoformat(),\n                'config_used': config\n            }\n        )\n        \n        error_logger.log_info(f\"[Preprocessing] Completed | Entities: {len(entities)} | Sentiment: {sentiment.overall} | Keywords: {len(keywords)} | Time: {processing_time:.3f}s\")\n        \n        return result\n    \n    def _clean_text(self, text: str) -> str:\n        \"\"\"Clean and normalize text\"\"\"\n        cleaned = re.sub(r'\\s+', ' ', text)\n        \n        cleaned = re.sub(r'[\\u200b\\u200c\\u200d\\ufeff]', '', cleaned)\n        \n        return cleaned.strip()\n    \n    async def _extract_entities(self, text: str, enabled: bool = True) -> List[Entity]:\n        \"\"\"Extract named entities from text\"\"\"\n        if not enabled:\n            return []\n        \n        entities = []\n        \n        for indicator in self.person_indicators:\n            pattern = rf'{indicator}\\s+([\\u0600-\\u06FF\\s]+?)(?:\\s|ÿå|,|\\.|$)'\n            for match in re.finditer(pattern, text):\n                name = match.group(1).strip()\n                if len(name) > 2 and len(name.split()) <= 4:\n                    entities.append(Entity(\n                        text=f\"{indicator} {name}\",\n                        entity_type='person',\n                        start_pos=match.start(),\n                        end_pos=match.end(),\n                        confidence=0.9,\n                        context=text[max(0, match.start()-20):min(len(text), match.end()+20)]\n                    ))\n        \n        for indicator in self.organization_indicators:\n            pattern = rf'{indicator}\\s+([\\u0600-\\u06FF\\s]+?)(?:\\s|ÿå|,|\\.|$)'\n            for match in re.finditer(pattern, text):\n                name = match.group(1).strip()\n                if len(name) > 2:\n                    entities.append(Entity(\n                        text=f\"{indicator} {name}\",\n                        entity_type='organization',\n                        start_pos=match.start(),\n                        end_pos=match.end(),\n                        confidence=0.85,\n                        context=text[max(0, match.start()-20):min(len(text), match.end()+20)]\n                    ))\n        \n        for indicator in self.location_indicators:\n            pattern = rf'{indicator}\\s+([\\u0600-\\u06FF\\s]+?)(?:\\s|ÿå|,|\\.|$)'\n            for match in re.finditer(pattern, text):\n                name = match.group(1).strip()\n                if len(name) > 2:\n                    entities.append(Entity(\n                        text=f\"{indicator} {name}\",\n                        entity_type='location',\n                        start_pos=match.start(),\n                        end_pos=match.end(),\n                        confidence=0.85,\n                        context=text[max(0, match.start()-20):min(len(text), match.end()+20)]\n                    ))\n        \n        date_patterns = [\n            r'\\d{1,2}/\\d{1,2}/\\d{2,4}',\n            r'\\d{1,2}-\\d{1,2}-\\d{2,4}',\n            r'\\d{4}/\\d{1,2}/\\d{1,2}',\n            r'\\d{1,2}\\s+(?:ŸäŸÜÿßŸäÿ±|ŸÅÿ®ÿ±ÿßŸäÿ±|ŸÖÿßÿ±ÿ≥|ÿ£ÿ®ÿ±ŸäŸÑ|ŸÖÿßŸäŸà|ŸäŸàŸÜŸäŸà|ŸäŸàŸÑŸäŸà|ÿ£ÿ∫ÿ≥ÿ∑ÿ≥|ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±|ÿ£ŸÉÿ™Ÿàÿ®ÿ±|ŸÜŸàŸÅŸÖÿ®ÿ±|ÿØŸäÿ≥ŸÖÿ®ÿ±)\\s+\\d{4}'\n        ]\n        \n        for pattern in date_patterns:\n            for match in re.finditer(pattern, text):\n                entities.append(Entity(\n                    text=match.group(),\n                    entity_type='date',\n                    start_pos=match.start(),\n                    end_pos=match.end(),\n                    confidence=0.95\n                ))\n        \n        unique_entities = []\n        seen = set()\n        for entity in entities:\n            key = (entity.text, entity.entity_type)\n            if key not in seen:\n                seen.add(key)\n                unique_entities.append(entity)\n        \n        return unique_entities\n    \n    async def _analyze_sentiment(self, text: str, enabled: bool = True) -> SentimentResult:\n        \"\"\"Analyze text sentiment\"\"\"\n        if not enabled:\n            return SentimentResult(overall='neutral', score=0.0)\n        \n        text_lower = text\n        \n        positive_found = []\n        negative_found = []\n        offensive_found = []\n        \n        for word in self.arabic_positive_words:\n            if word in text_lower:\n                positive_found.append(word)\n        \n        for word in self.arabic_negative_words:\n            if word in text_lower:\n                negative_found.append(word)\n        \n        for pattern in self.arabic_offensive_patterns:\n            matches = re.findall(pattern, text_lower, re.IGNORECASE)\n            offensive_found.extend(matches)\n        \n        positive_score = len(positive_found) * 0.15\n        negative_score = len(negative_found) * 0.15\n        \n        score = min(1.0, max(-1.0, positive_score - negative_score))\n        \n        if score > 0.2:\n            overall = 'positive'\n        elif score < -0.2:\n            overall = 'negative'\n        elif positive_found and negative_found:\n            overall = 'mixed'\n        else:\n            overall = 'neutral'\n        \n        return SentimentResult(\n            overall=overall,\n            score=score,\n            keywords_positive=positive_found,\n            keywords_negative=negative_found,\n            has_offensive=bool(offensive_found),\n            offensive_words=offensive_found\n        )\n    \n    async def _extract_keywords(self, text: str, enabled: bool = True) -> List[str]:\n        \"\"\"Extract important keywords from text\"\"\"\n        if not enabled:\n            return []\n        \n        stop_words = {\n            'ŸÅŸä', 'ŸÖŸÜ', 'ÿ•ŸÑŸâ', 'ÿπŸÑŸâ', 'ÿπŸÜ', 'ŸÖÿπ', 'Ÿáÿ∞ÿß', 'Ÿáÿ∞Ÿá', 'ÿ∞ŸÑŸÉ', 'ÿ™ŸÑŸÉ',\n            'ÿßŸÑÿ™Ÿä', 'ÿßŸÑÿ∞Ÿä', 'ÿßŸÑÿ∞ŸäŸÜ', 'ÿßŸÑŸÑÿ∞ŸäŸÜ', 'ŸáŸà', 'ŸáŸä', 'ŸáŸÖ', 'ŸáŸÜ', 'ÿ£ŸÜÿß',\n            'ŸÜÿ≠ŸÜ', 'ÿ£ŸÜÿ™', 'ÿ£ŸÜÿ™ŸÖ', 'ŸÉÿßŸÜ', 'ŸÉÿßŸÜÿ™', 'ŸÉÿßŸÜŸàÿß', 'ŸäŸÉŸàŸÜ', 'ÿ™ŸÉŸàŸÜ',\n            'ŸÇÿØ', 'ŸÑŸÇÿØ', 'ÿ•ŸÜ', 'ÿ£ŸÜ', 'ŸÑÿß', 'ŸÖÿß', 'ŸÑŸÖ', 'ŸÑŸÜ', 'ÿ≠ÿ™Ÿâ', 'ÿ´ŸÖ',\n            'ÿ£Ÿà', 'Ÿà', 'ŸÅ', 'ÿ®', 'ŸÑ', 'ŸÉ', 'the', 'a', 'an', 'is', 'are',\n            'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had',\n            'do', 'does', 'did', 'will', 'would', 'could', 'should'\n        }\n        \n        words = re.findall(r'[\\u0600-\\u06FF]{3,}|\\b[a-zA-Z]{4,}\\b', text)\n        \n        word_freq = {}\n        for word in words:\n            if word not in stop_words:\n                word_freq[word] = word_freq.get(word, 0) + 1\n        \n        sorted_words = sorted(word_freq.items(), key=lambda x: x[1], reverse=True)\n        keywords = [word for word, freq in sorted_words[:20]]\n        \n        return keywords\n    \n    def _extract_urls(self, text: str) -> List[str]:\n        \"\"\"Extract URLs from text\"\"\"\n        url_pattern = r'https?://[^\\s<>\"{}|\\\\^`\\[\\]]+'\n        return re.findall(url_pattern, text)\n    \n    def _extract_mentions(self, text: str) -> List[str]:\n        \"\"\"Extract @mentions from text\"\"\"\n        mention_pattern = r'@[\\w]+'\n        return re.findall(mention_pattern, text)\n    \n    def _extract_hashtags(self, text: str) -> List[str]:\n        \"\"\"Extract #hashtags from text\"\"\"\n        hashtag_pattern = r'#[\\u0600-\\u06FF\\w]+'\n        return re.findall(hashtag_pattern, text)\n    \n    def _detect_language(self, text: str) -> str:\n        \"\"\"Detect text language\"\"\"\n        arabic_chars = len(re.findall(r'[\\u0600-\\u06FF]', text))\n        english_chars = len(re.findall(r'[a-zA-Z]', text))\n        \n        if arabic_chars > english_chars:\n            return 'ar'\n        elif english_chars > arabic_chars:\n            return 'en'\n        else:\n            return 'mixed'\n    \n    def _empty_result(self, text: str) -> PreprocessingResult:\n        \"\"\"Return empty result for empty text\"\"\"\n        return PreprocessingResult(\n            original_text=text or \"\",\n            cleaned_text=\"\",\n            entities=[],\n            sentiment=SentimentResult(overall='neutral', score=0.0),\n            keywords=[],\n            language='unknown',\n            text_length=0,\n            word_count=0,\n            has_urls=False,\n            urls=[],\n            has_mentions=False,\n            mentions=[],\n            has_hashtags=False,\n            hashtags=[],\n            processing_time=0.0\n        )\n    \n    def get_entities_by_type(self, result: PreprocessingResult, entity_type: str) -> List[Entity]:\n        \"\"\"Get entities of a specific type\"\"\"\n        return [e for e in result.entities if e.entity_type == entity_type]\n    \n    def get_entity_texts(self, result: PreprocessingResult) -> Dict[str, List[str]]:\n        \"\"\"Get all entity texts grouped by type\"\"\"\n        grouped = {}\n        for entity in result.entities:\n            if entity.entity_type not in grouped:\n                grouped[entity.entity_type] = []\n            grouped[entity.entity_type].append(entity.text)\n        return grouped\n\npreprocessing_engine = AIPreprocessingEngine()\n","path":null,"size_bytes":14120,"size_tokens":null},"client/src/pages/ai-rules.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { api } from \"@/lib/api\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { \n  Sparkles, \n  Plus, \n  Trash2, \n  Edit, \n  ArrowRightLeft,\n  Shield,\n  Brain,\n  Settings2,\n  FileText,\n  Loader,\n  Filter,\n  ToggleRight,\n  LayoutGrid,\n  BookOpen,\n  Film,\n  Link2,\n  Mic\n} from \"lucide-react\";\nimport { Label } from \"@/components/ui/label\";\nimport { ToggleSwitch } from \"@/components/ui/toggle-switch\";\nimport { toast } from \"sonner\";\n\nimport {\n  EntityReplacement,\n  ContextRule,\n  TrainingExample,\n  ContentFilter,\n  PublishingTemplate,\n  SummarizationRule,\n  VideoProcessingRule,\n  AudioProcessingRule,\n  entityTypes,\n  contextRuleTypes,\n  exampleTypes,\n  filterTypes,\n  matchTypes,\n  filterActions,\n  templateTypes,\n  fieldTypes,\n  summarizationStyles\n} from \"@/components/ai-rules/types\";\nimport { EntityDialog } from \"@/components/ai-rules/EntityDialog\";\nimport { ContextDialog } from \"@/components/ai-rules/ContextDialog\";\nimport { TrainingDialog } from \"@/components/ai-rules/TrainingDialog\";\nimport { FilterDialog } from \"@/components/ai-rules/FilterDialog\";\nimport { TemplateDialog } from \"@/components/ai-rules/TemplateDialog\";\nimport { SummarizationDialog } from \"@/components/ai-rules/SummarizationDialog\";\nimport { VideoProcessingDialog } from \"@/components/ai-rules/VideoProcessingDialog\";\nimport { AudioSummarizationDialog } from \"@/components/ai-rules/AudioSummarizationDialog\";\nimport { RuleSection } from \"@/components/ai-rules/RuleSection\";\n\ntype SectionType = 'entities' | 'context' | 'training' | 'filters' | 'templates' | 'summarization' | 'video' | 'audio';\n\ninterface SectionInfo {\n  id: SectionType;\n  label: string;\n  shortLabel: string;\n  icon: React.ReactNode;\n  color: string;\n  bgColor: string;\n  description: string;\n}\n\nconst sections: SectionInfo[] = [\n  { \n    id: 'entities', \n    label: 'ŸÇŸàÿßÿπÿØ ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ', \n    shortLabel: 'ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ',\n    icon: <ArrowRightLeft className=\"h-4 w-4\" />, \n    color: 'text-foreground',\n    bgColor: 'from-slate-500/8 to-slate-600/8',\n    description: 'ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° ŸàÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã'\n  },\n  { \n    id: 'context', \n    label: 'ŸÇŸàÿßÿπÿØ ÿßŸÑÿ≥ŸäÿßŸÇ', \n    shortLabel: 'ÿ≥ŸäÿßŸÇ',\n    icon: <Shield className=\"h-4 w-4\" />, \n    color: 'text-foreground',\n    bgColor: 'from-slate-500/8 to-slate-600/8',\n    description: 'ÿ™ÿ≠ŸäŸäÿØ ÿßŸÑŸÑÿ∫ÿ© Ÿàÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ£ÿ≥ŸÑŸàÿ®'\n  },\n  { \n    id: 'training', \n    label: 'ÿ£ŸÖÿ´ŸÑÿ© ÿßŸÑÿ™ÿØÿ±Ÿäÿ®', \n    shortLabel: 'ÿ™ÿØÿ±Ÿäÿ®',\n    icon: <Brain className=\"h-4 w-4\" />, \n    color: 'text-foreground',\n    bgColor: 'from-slate-500/8 to-slate-600/8',\n    description: 'ÿ™ÿØÿ±Ÿäÿ® ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿ®ÿ£ŸÖÿ´ŸÑÿ©'\n  },\n  { \n    id: 'filters', \n    label: 'ŸÅŸÑÿßÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ', \n    shortLabel: 'ŸÅŸÑÿßÿ™ÿ±',\n    icon: <Filter className=\"h-4 w-4\" />, \n    color: 'text-foreground',\n    bgColor: 'from-slate-500/8 to-slate-600/8',\n    description: 'ÿ™ÿµŸÅŸäÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ≠ÿ≥ÿ® ÿ£ŸÜŸÖÿßÿ∑'\n  },\n  { \n    id: 'templates', \n    label: 'ŸÇŸàÿßŸÑÿ® ÿßŸÑŸÜÿ¥ÿ±', \n    shortLabel: 'ŸÇŸàÿßŸÑÿ®',\n    icon: <FileText className=\"h-4 w-4\" />, \n    color: 'text-foreground',\n    bgColor: 'from-slate-500/8 to-slate-600/8',\n    description: 'ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖÿÆÿ±ÿ¨ÿßÿ™ ÿßŸÑŸÖŸÜÿ¥Ÿàÿ±ÿ©'\n  },\n  {\n    id: 'summarization',\n    label: 'ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµŸàÿµ',\n    shortLabel: 'ÿ™ŸÑÿÆŸäÿµ',\n    icon: <BookOpen className=\"h-4 w-4\" />,\n    color: 'text-foreground',\n    bgColor: 'from-slate-500/8 to-slate-600/8',\n    description: 'ÿ•ÿπÿØÿßÿØÿßÿ™ ŸàŸÇŸàÿßÿπÿØ ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµŸàÿµ'\n  },\n  {\n    id: 'video',\n    label: 'ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà',\n    shortLabel: 'ŸÅŸäÿØŸäŸà',\n    icon: <Film className=\"h-4 w-4\" />,\n    color: 'text-foreground',\n    bgColor: 'from-slate-500/8 to-slate-600/8',\n    description: 'ÿ•ÿπÿØÿßÿØÿßÿ™ ŸàŸÖÿπÿßŸÑÿ¨ÿ© ŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÅŸäÿØŸäŸà ŸàÿßŸÑÿ±Ÿàÿßÿ®ÿ∑'\n  },\n  {\n    id: 'audio',\n    label: 'ÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿµŸàÿ™',\n    shortLabel: 'ÿµŸàÿ™',\n    icon: <Mic className=\"h-4 w-4\" />,\n    color: 'text-foreground',\n    bgColor: 'from-slate-500/8 to-slate-600/8',\n    description: 'ÿ™ŸÅÿ±Ÿäÿ∫ Ÿàÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÖŸÇÿßÿ∑ÿπ ÿßŸÑÿµŸàÿ™Ÿäÿ© ŸàÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿµŸàÿ™Ÿäÿ©'\n  },\n];\n\nexport default function AIRulesPage() {\n  const queryClient = useQueryClient();\n  const [location] = useLocation();\n  const [selectedTaskId, setSelectedTaskId] = useState<number | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [sectionStates, setSectionStates] = useState<Record<SectionType, boolean>>({\n    entities: true,\n    context: true,\n    training: true,\n    filters: true,\n    templates: true,\n    summarization: true,\n    video: true,\n    audio: true\n  });\n\n  // Auto-select task from URL query parameter\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const taskIdParam = params.get('taskId');\n    if (taskIdParam) {\n      const taskId = parseInt(taskIdParam);\n      if (!isNaN(taskId)) {\n        setSelectedTaskId(taskId);\n      }\n    }\n  }, [location]);\n\n  const [isEntityDialogOpen, setIsEntityDialogOpen] = useState(false);\n  const [isContextDialogOpen, setIsContextDialogOpen] = useState(false);\n  const [isTrainingDialogOpen, setIsTrainingDialogOpen] = useState(false);\n  const [isFilterDialogOpen, setIsFilterDialogOpen] = useState(false);\n  const [isTemplateDialogOpen, setIsTemplateDialogOpen] = useState(false);\n  const [isSummarizationDialogOpen, setIsSummarizationDialogOpen] = useState(false);\n  const [isVideoDialogOpen, setIsVideoDialogOpen] = useState(false);\n  const [isAudioDialogOpen, setIsAudioDialogOpen] = useState(false);\n\n  const [editingEntity, setEditingEntity] = useState<EntityReplacement | null>(null);\n  const [editingContext, setEditingContext] = useState<ContextRule | null>(null);\n  const [editingTraining, setEditingTraining] = useState<TrainingExample | null>(null);\n  const [editingFilter, setEditingFilter] = useState<ContentFilter | null>(null);\n  const [editingTemplate, setEditingTemplate] = useState<PublishingTemplate | null>(null);\n  const [editingSummarization, setEditingSummarization] = useState<SummarizationRule | null>(null);\n  const [editingVideo, setEditingVideo] = useState<VideoProcessingRule | null>(null);\n  const [editingAudio, setEditingAudio] = useState<SummarizationRule | null>(null);\n\n  const { data: tasks = [] } = useQuery({\n    queryKey: [\"tasks\"],\n    queryFn: () => api.getTasks(),\n  });\n\n  const { data: entityReplacements = [], isLoading: loadingEntities } = useQuery({\n    queryKey: [\"entity-replacements\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getEntityReplacements(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: contextRules = [], isLoading: loadingContext } = useQuery({\n    queryKey: [\"context-rules\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getContextRules(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: trainingExamples = [], isLoading: loadingTraining } = useQuery({\n    queryKey: [\"training-examples\", selectedTaskId],\n    queryFn: () => api.getTrainingExamples(selectedTaskId),\n  });\n\n  const { data: contentFilters = [], isLoading: loadingFilters } = useQuery({\n    queryKey: [\"content-filters\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getContentFilters(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: publishingTemplates = [], isLoading: loadingTemplates } = useQuery({\n    queryKey: [\"publishing-templates\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getPublishingTemplates(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: summarizationRules = [], isLoading: loadingSummarization } = useQuery({\n    queryKey: [\"summarization-rules\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getSummarizationRules(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: videoProcessingRules = [], isLoading: loadingVideo } = useQuery({\n    queryKey: [\"video-processing-rules\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getVideoProcessingRules(selectedTaskId) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: audioSummarizationRules = [], isLoading: loadingAudioSummarization } = useQuery({\n    queryKey: [\"audio-summarization-rules\", selectedTaskId],\n    queryFn: () => selectedTaskId ? api.getSummarizationRules(selectedTaskId).then((rules: any[]) => rules.filter(r => r.type === 'audio_summarize')) : Promise.resolve([]),\n    enabled: !!selectedTaskId,\n  });\n\n  const { data: providers = [] } = useQuery({\n    queryKey: [\"ai-providers\"],\n    queryFn: () => api.getAiProviders(),\n  });\n\n  const { data: models = [] } = useQuery({\n    queryKey: [\"ai-models\"],\n    queryFn: () => api.getAiModels(),\n  });\n\n  const selectedTask = useMemo(() => {\n    return tasks.find((t: any) => t.id === selectedTaskId);\n  }, [tasks, selectedTaskId]);\n\n  const summarizationModels = useMemo(() => {\n    if (!selectedTask?.summarizationProviderId) return [];\n    return models.filter((m: any) => m.providerId === selectedTask.summarizationProviderId);\n  }, [models, selectedTask?.summarizationProviderId]);\n\n  const videoModels = useMemo(() => {\n    if (!selectedTask?.videoAiProviderId) return [];\n    return models.filter((m: any) => m.providerId === selectedTask.videoAiProviderId);\n  }, [models, selectedTask?.videoAiProviderId]);\n\n  const audioModels = useMemo(() => {\n    if (!selectedTask?.audioAiProviderId) return [];\n    return models.filter((m: any) => m.providerId === selectedTask.audioAiProviderId);\n  }, [models, selectedTask?.audioAiProviderId]);\n\n  const getProviderName = (providerId: number) => {\n    const provider = providers.find((p: any) => p.id === providerId);\n    return provider?.name?.toUpperCase() || '';\n  };\n\n  const updateTaskSettingsMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateTask(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"tasks\"] });\n      toast.success(\"ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\");\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\"),\n  });\n\n  const createEntityMutation = useMutation({\n    mutationFn: (data: any) => api.createEntityReplacement(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ\");\n      queryClient.invalidateQueries({ queryKey: [\"entity-replacements\"] });\n      setIsEntityDialogOpen(false);\n      setEditingEntity(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const updateEntityMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateEntityReplacement(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"entity-replacements\"] });\n      setIsEntityDialogOpen(false);\n      setEditingEntity(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const deleteEntityMutation = useMutation({\n    mutationFn: (id: number) => api.deleteEntityReplacement(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"entity-replacements\"] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const createContextMutation = useMutation({\n    mutationFn: (data: any) => api.createContextRule(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿßŸÑÿ≥ŸäÿßŸÇ\");\n      queryClient.invalidateQueries({ queryKey: [\"context-rules\"] });\n      setIsContextDialogOpen(false);\n      setEditingContext(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const updateContextMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateContextRule(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"context-rules\"] });\n      setIsContextDialogOpen(false);\n      setEditingContext(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const deleteContextMutation = useMutation({\n    mutationFn: (id: number) => api.deleteContextRule(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"context-rules\"] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const createTrainingMutation = useMutation({\n    mutationFn: (data: any) => api.createTrainingExample(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ´ÿßŸÑ ÿßŸÑÿ™ÿØÿ±Ÿäÿ®\");\n      queryClient.invalidateQueries({ queryKey: [\"training-examples\"] });\n      setIsTrainingDialogOpen(false);\n      setEditingTraining(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ´ÿßŸÑ\"),\n  });\n\n  const updateTrainingMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateTrainingExample(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ´ÿßŸÑ\");\n      queryClient.invalidateQueries({ queryKey: [\"training-examples\"] });\n      setIsTrainingDialogOpen(false);\n      setEditingTraining(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ´ÿßŸÑ\"),\n  });\n\n  const deleteTrainingMutation = useMutation({\n    mutationFn: (id: number) => api.deleteTrainingExample(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ´ÿßŸÑ\");\n      queryClient.invalidateQueries({ queryKey: [\"training-examples\"] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ´ÿßŸÑ\"),\n  });\n\n  const createFilterMutation = useMutation({\n    mutationFn: (data: any) => api.createContentFilter(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅŸÑÿ™ÿ±\");\n      queryClient.invalidateQueries({ queryKey: [\"content-filters\"] });\n      setIsFilterDialogOpen(false);\n      setEditingFilter(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅŸÑÿ™ÿ±\"),\n  });\n\n  const updateFilterMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateContentFilter(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅŸÑÿ™ÿ±\");\n      queryClient.invalidateQueries({ queryKey: [\"content-filters\"] });\n      setIsFilterDialogOpen(false);\n      setEditingFilter(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅŸÑÿ™ÿ±\"),\n  });\n\n  const deleteFilterMutation = useMutation({\n    mutationFn: (id: number) => api.deleteContentFilter(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÅŸÑÿ™ÿ±\");\n      queryClient.invalidateQueries({ queryKey: [\"content-filters\"] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÅŸÑÿ™ÿ±\"),\n  });\n\n  const createTemplateMutation = useMutation({\n    mutationFn: (data: any) => api.createPublishingTemplate(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßŸÑÿ®\");\n      queryClient.invalidateQueries({ queryKey: [\"publishing-templates\"] });\n      setIsTemplateDialogOpen(false);\n      setEditingTemplate(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßŸÑÿ®\"),\n  });\n\n  const updateTemplateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updatePublishingTemplate(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßŸÑÿ®\");\n      queryClient.invalidateQueries({ queryKey: [\"publishing-templates\"] });\n      setIsTemplateDialogOpen(false);\n      setEditingTemplate(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßŸÑÿ®\"),\n  });\n\n  const deleteTemplateMutation = useMutation({\n    mutationFn: (id: number) => api.deletePublishingTemplate(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßŸÑÿ®\");\n      queryClient.invalidateQueries({ queryKey: [\"publishing-templates\"] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßŸÑÿ®\"),\n  });\n\n  const createSummarizationMutation = useMutation({\n    mutationFn: (data: any) => api.createSummarizationRule(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿßŸÑÿ™ŸÑÿÆŸäÿµ\");\n      queryClient.invalidateQueries({ queryKey: [\"summarization-rules\"] });\n      setIsSummarizationDialogOpen(false);\n      setEditingSummarization(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const updateSummarizationMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateSummarizationRule(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"summarization-rules\"] });\n      setIsSummarizationDialogOpen(false);\n      setEditingSummarization(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const deleteSummarizationMutation = useMutation({\n    mutationFn: (id: number) => api.deleteSummarizationRule(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"summarization-rules\"] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const createVideoMutation = useMutation({\n    mutationFn: (data: any) => api.createVideoProcessingRule(data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅÿØŸäŸà\");\n      queryClient.invalidateQueries({ queryKey: [\"video-processing-rules\"] });\n      setIsVideoDialogOpen(false);\n      setEditingVideo(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const updateVideoMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateVideoProcessingRule(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"video-processing-rules\"] });\n      setIsVideoDialogOpen(false);\n      setEditingVideo(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const deleteVideoMutation = useMutation({\n    mutationFn: (id: number) => api.deleteVideoProcessingRule(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"video-processing-rules\"] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const createAudioMutation = useMutation({\n    mutationFn: (data: any) => api.createSummarizationRule({ ...data, type: 'audio_summarize' }),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿµŸàÿ™\");\n      queryClient.invalidateQueries({ queryKey: [\"audio-summarization-rules\"] });\n      setIsAudioDialogOpen(false);\n      setEditingAudio(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const updateAudioMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateSummarizationRule(id, { ...data, type: 'audio_summarize' }),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"audio-summarization-rules\"] });\n      setIsAudioDialogOpen(false);\n      setEditingAudio(null);\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const deleteAudioMutation = useMutation({\n    mutationFn: (id: number) => api.deleteSummarizationRule(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"audio-summarization-rules\"] });\n    },\n    onError: () => toast.error(\"ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\"),\n  });\n\n  const handleSubmitEntity = (data: Partial<EntityReplacement>) => {\n    if (!selectedTaskId) return;\n    const payload = { ...data, taskId: selectedTaskId };\n    if (editingEntity?.id) {\n      updateEntityMutation.mutate({ id: editingEntity.id, data: payload });\n    } else {\n      createEntityMutation.mutate(payload);\n    }\n  };\n\n  const handleSubmitContext = (data: Partial<ContextRule>) => {\n    if (!selectedTaskId) return;\n    const payload = { ...data, taskId: selectedTaskId };\n    if (editingContext?.id) {\n      updateContextMutation.mutate({ id: editingContext.id, data: payload });\n    } else {\n      createContextMutation.mutate(payload);\n    }\n  };\n\n  const handleSubmitTraining = (data: Partial<TrainingExample>) => {\n    if (!selectedTaskId) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸáŸÖÿ© ÿ£ŸàŸÑÿßŸã\");\n      return;\n    }\n    const payload = { ...data, taskId: selectedTaskId };\n    if (editingTraining?.id) {\n      updateTrainingMutation.mutate({ id: editingTraining.id, data: payload });\n    } else {\n      createTrainingMutation.mutate(payload);\n    }\n  };\n\n  const handleSubmitFilter = (data: Partial<ContentFilter>) => {\n    if (!selectedTaskId) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸáŸÖÿ© ÿ£ŸàŸÑÿßŸã\");\n      return;\n    }\n    const payload = { ...data, taskId: selectedTaskId };\n    if (editingFilter?.id) {\n      updateFilterMutation.mutate({ id: editingFilter.id, data: payload });\n    } else {\n      createFilterMutation.mutate(payload);\n    }\n  };\n\n  const handleSubmitTemplate = (data: Partial<PublishingTemplate>) => {\n    if (!selectedTaskId) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸáŸÖÿ© ÿ£ŸàŸÑÿßŸã\");\n      return;\n    }\n    const payload = { ...data, taskId: selectedTaskId };\n    if (editingTemplate?.id) {\n      updateTemplateMutation.mutate({ id: editingTemplate.id, data: payload });\n    } else {\n      createTemplateMutation.mutate(payload);\n    }\n  };\n\n  const handleSubmitSummarization = (data: Partial<SummarizationRule>) => {\n    if (!selectedTaskId) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸáŸÖÿ© ÿ£ŸàŸÑÿßŸã\");\n      return;\n    }\n    const payload = { ...data, taskId: selectedTaskId };\n    if (editingSummarization?.id) {\n      updateSummarizationMutation.mutate({ id: editingSummarization.id, data: payload });\n    } else {\n      createSummarizationMutation.mutate(payload);\n    }\n  };\n\n  const handleSubmitVideo = (data: Partial<VideoProcessingRule>) => {\n    if (!selectedTaskId) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸáŸÖÿ© ÿ£ŸàŸÑÿßŸã\");\n      return;\n    }\n    const payload = { ...data, taskId: selectedTaskId };\n    if (editingVideo?.id) {\n      updateVideoMutation.mutate({ id: editingVideo.id, data: payload });\n    } else {\n      createVideoMutation.mutate(payload);\n    }\n  };\n\n  const handleSubmitAudio = (data: Partial<SummarizationRule>) => {\n    if (!selectedTaskId) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸáŸÖÿ© ÿ£ŸàŸÑÿßŸã\");\n      return;\n    }\n    const payload = { ...data, taskId: selectedTaskId };\n    if (editingAudio?.id) {\n      updateAudioMutation.mutate({ id: editingAudio.id, data: payload });\n    } else {\n      createAudioMutation.mutate(payload);\n    }\n  };\n\n  const getSectionCount = (sectionId: SectionType): number => {\n    switch (sectionId) {\n      case 'entities': return entityReplacements.length;\n      case 'context': return contextRules.length;\n      case 'training': return trainingExamples.length;\n      case 'filters': return contentFilters.length;\n      case 'templates': return publishingTemplates.length;\n      case 'summarization': return summarizationRules.length;\n      case 'video': return videoProcessingRules.length;\n      case 'audio': return audioSummarizationRules.length;\n      default: return 0;\n    }\n  };\n\n  const toggleSection = (sectionId: SectionType, enabled: boolean) => {\n    setSectionStates(prev => ({ ...prev, [sectionId]: enabled }));\n  };\n\n  const totalRules = useMemo(() => \n    entityReplacements.length + contextRules.length + trainingExamples.length + \n    contentFilters.length + publishingTemplates.length\n  , [entityReplacements, contextRules, trainingExamples, contentFilters, publishingTemplates]);\n\n  const activeRules = useMemo(() => \n    entityReplacements.filter((e: any) => e.isActive).length +\n    contextRules.filter((c: any) => c.isActive).length +\n    trainingExamples.filter((t: any) => t.isActive).length +\n    contentFilters.filter((f: any) => f.isActive).length\n  , [entityReplacements, contextRules, trainingExamples, contentFilters]);\n\n  const isLoading = loadingEntities || loadingContext || loadingTraining || loadingFilters || loadingTemplates || loadingSummarization || loadingVideo || loadingAudioSummarization;\n\n  const openAddDialog = (sectionId: SectionType) => {\n    switch (sectionId) {\n      case 'entities':\n        setEditingEntity(null);\n        setIsEntityDialogOpen(true);\n        break;\n      case 'context':\n        setEditingContext(null);\n        setIsContextDialogOpen(true);\n        break;\n      case 'training':\n        setEditingTraining(null);\n        setIsTrainingDialogOpen(true);\n        break;\n      case 'filters':\n        setEditingFilter(null);\n        setIsFilterDialogOpen(true);\n        break;\n      case 'templates':\n        setEditingTemplate(null);\n        setIsTemplateDialogOpen(true);\n        break;\n      case 'summarization':\n        setEditingSummarization(null);\n        setIsSummarizationDialogOpen(true);\n        break;\n      case 'video':\n        setEditingVideo(null);\n        setIsVideoDialogOpen(true);\n        break;\n      case 'audio':\n        setEditingAudio(null);\n        setIsAudioDialogOpen(true);\n        break;\n    }\n  };\n\n  return (\n    <TooltipProvider>\n      <div className=\"min-h-screen bg-gradient-to-br from-background via-background to-muted/20\">\n        <div className=\"max-w-7xl mx-auto p-4 md:p-6 space-y-6\">\n          <div className=\"flex flex-col lg:flex-row lg:items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"p-3 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/5 border border-primary/10\">\n                <Sparkles className=\"h-7 w-7 text-primary\" />\n              </div>\n              <div>\n                <h1 className=\"text-2xl md:text-3xl font-bold bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text\">\n                  ŸÇŸàÿßÿπÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©\n                </h1>\n                <p className=\"text-muted-foreground text-sm mt-1\">\n                  ÿ™ÿÆÿµŸäÿµ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÜÿµŸàÿµ ÿ®ŸÇŸàÿßÿπÿØ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ Ÿàÿ≥ŸäÿßŸÇ Ÿàÿ™ÿØÿ±Ÿäÿ®\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3\">\n              <Select\n                value={selectedTaskId?.toString() || \"\"}\n                onValueChange={(value) => setSelectedTaskId(value ? parseInt(value) : null)}\n              >\n                <SelectTrigger className=\"w-[240px] h-11 bg-card border-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Settings2 className=\"h-4 w-4 text-muted-foreground\" />\n                    <SelectValue placeholder=\"ÿßÿÆÿ™ÿ± ŸÖŸáŸÖÿ©...\" />\n                  </div>\n                </SelectTrigger>\n                <SelectContent>\n                  {tasks.map((task: any) => (\n                    <SelectItem key={task.id} value={task.id.toString()}>\n                      <div className=\"flex items-center gap-2\">\n                        <span className={`w-2 h-2 rounded-full ${task.isActive ? 'bg-green-500' : 'bg-gray-400'}`} />\n                        {task.name}\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {selectedTaskId && (\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"space-y-6\"\n            >\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                <Card className=\"p-4 bg-gradient-to-br from-blue-500/5 to-indigo-500/5 border-blue-200/50 dark:border-blue-800/50\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÇŸàÿßÿπÿØ</p>\n                      <p className=\"text-2xl font-bold text-blue-600\">{totalRules}</p>\n                    </div>\n                    <LayoutGrid className=\"h-8 w-8 text-blue-500/30\" />\n                  </div>\n                </Card>\n                <Card className=\"p-4 bg-gradient-to-br from-green-500/5 to-emerald-500/5 border-green-200/50 dark:border-green-800/50\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑŸÜÿ¥ÿ∑ÿ©</p>\n                      <p className=\"text-2xl font-bold text-green-600\">{activeRules}</p>\n                    </div>\n                    <ToggleRight className=\"h-8 w-8 text-green-500/30\" />\n                  </div>\n                </Card>\n                <Card className=\"p-4 bg-gradient-to-br from-violet-500/5 to-purple-500/5 border-violet-200/50 dark:border-violet-800/50\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">ÿ£ŸÖÿ´ŸÑÿ© ÿßŸÑÿ™ÿØÿ±Ÿäÿ®</p>\n                      <p className=\"text-2xl font-bold text-violet-600\">{trainingExamples.length}</p>\n                    </div>\n                    <Brain className=\"h-8 w-8 text-violet-500/30\" />\n                  </div>\n                </Card>\n                <Card className=\"p-4 bg-gradient-to-br from-pink-500/5 to-rose-500/5 border-pink-200/50 dark:border-pink-800/50\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">ÿßŸÑŸÇŸàÿßŸÑÿ®</p>\n                      <p className=\"text-2xl font-bold text-pink-600\">{publishingTemplates.length}</p>\n                    </div>\n                    <FileText className=\"h-8 w-8 text-pink-500/30\" />\n                  </div>\n                </Card>\n              </div>\n\n              {isLoading ? (\n                <div className=\"flex flex-col items-center justify-center py-16 text-muted-foreground\">\n                  <Loader className=\"h-8 w-8 animate-spin mb-3\" />\n                  <p>ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  <RuleSection\n                    title={sections[0].label}\n                    description={sections[0].description}\n                    icon={sections[0].icon}\n                    color={sections[0].color}\n                    bgColor={sections[0].bgColor}\n                    isEnabled={sectionStates.entities}\n                    onToggleEnabled={(enabled) => toggleSection('entities', enabled)}\n                    count={getSectionCount('entities')}\n                    onAdd={() => openAddDialog('entities')}\n                    addLabel=\"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ©\"\n                  >\n                    <EntityList \n                      items={entityReplacements}\n                      onEdit={(item) => { setEditingEntity(item); setIsEntityDialogOpen(true); }}\n                      onDelete={(id) => deleteEntityMutation.mutate(id)}\n                      searchQuery=\"\"\n                    />\n                  </RuleSection>\n\n                  <RuleSection\n                    title={sections[1].label}\n                    description={sections[1].description}\n                    icon={sections[1].icon}\n                    color={sections[1].color}\n                    bgColor={sections[1].bgColor}\n                    isEnabled={sectionStates.context}\n                    onToggleEnabled={(enabled) => toggleSection('context', enabled)}\n                    count={getSectionCount('context')}\n                    onAdd={() => openAddDialog('context')}\n                    addLabel=\"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ©\"\n                  >\n                    <ContextList\n                      items={contextRules}\n                      onEdit={(item) => { setEditingContext(item); setIsContextDialogOpen(true); }}\n                      onDelete={(id) => deleteContextMutation.mutate(id)}\n                      searchQuery=\"\"\n                    />\n                  </RuleSection>\n\n                  <RuleSection\n                    title={sections[2].label}\n                    description={sections[2].description}\n                    icon={sections[2].icon}\n                    color={sections[2].color}\n                    bgColor={sections[2].bgColor}\n                    isEnabled={sectionStates.training}\n                    onToggleEnabled={(enabled) => toggleSection('training', enabled)}\n                    count={getSectionCount('training')}\n                    onAdd={() => openAddDialog('training')}\n                    addLabel=\"ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ´ÿßŸÑ\"\n                  >\n                    <TrainingList\n                      items={trainingExamples}\n                      onEdit={(item) => { setEditingTraining(item); setIsTrainingDialogOpen(true); }}\n                      onDelete={(id) => deleteTrainingMutation.mutate(id)}\n                      searchQuery=\"\"\n                    />\n                  </RuleSection>\n\n                  <RuleSection\n                    title={sections[3].label}\n                    description={sections[3].description}\n                    icon={sections[3].icon}\n                    color={sections[3].color}\n                    bgColor={sections[3].bgColor}\n                    isEnabled={sectionStates.filters}\n                    onToggleEnabled={(enabled) => toggleSection('filters', enabled)}\n                    count={getSectionCount('filters')}\n                    onAdd={() => openAddDialog('filters')}\n                    addLabel=\"ÿ•ÿ∂ÿßŸÅÿ© ŸÅŸÑÿ™ÿ±\"\n                  >\n                    <FilterList\n                      items={contentFilters}\n                      onEdit={(item) => { setEditingFilter(item); setIsFilterDialogOpen(true); }}\n                      onDelete={(id) => deleteFilterMutation.mutate(id)}\n                      searchQuery=\"\"\n                    />\n                  </RuleSection>\n\n                  <RuleSection\n                    title={sections[4].label}\n                    description={sections[4].description}\n                    icon={sections[4].icon}\n                    color={sections[4].color}\n                    bgColor={sections[4].bgColor}\n                    isEnabled={sectionStates.templates}\n                    onToggleEnabled={(enabled) => toggleSection('templates', enabled)}\n                    count={getSectionCount('templates')}\n                    onAdd={() => openAddDialog('templates')}\n                    addLabel=\"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßŸÑÿ®\"\n                  >\n                    <TemplateList\n                      items={publishingTemplates}\n                      onEdit={(item) => { setEditingTemplate(item); setIsTemplateDialogOpen(true); }}\n                      onDelete={(id) => deleteTemplateMutation.mutate(id)}\n                      searchQuery=\"\"\n                    />\n                  </RuleSection>\n\n                  <RuleSection\n                    title={sections[5].label}\n                    description={sections[5].description}\n                    icon={sections[5].icon}\n                    color={sections[5].color}\n                    bgColor={sections[5].bgColor}\n                    isEnabled={sectionStates.summarization}\n                    onToggleEnabled={(enabled) => {\n                      toggleSection('summarization', enabled);\n                      if (selectedTaskId) {\n                        updateTaskSettingsMutation.mutate({ \n                          id: selectedTaskId, \n                          data: { summarizationEnabled: enabled } \n                        });\n                      }\n                    }}\n                    count={getSectionCount('summarization')}\n                    onAdd={() => openAddDialog('summarization')}\n                    addLabel=\"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ©\"\n                    settingsPanel={\n                      <div className=\"space-y-4\">\n                        <div className=\"flex items-center gap-2 mb-3\">\n                          <div className=\"p-2 rounded-lg bg-slate-100 dark:bg-slate-800\">\n                            <Sparkles className=\"h-4 w-4 text-slate-600 dark:text-slate-400\" />\n                          </div>\n                          <Label className=\"text-sm font-semibold\">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</Label>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                          <div className=\"space-y-2\">\n                            <Label className=\"text-xs font-medium text-muted-foreground\">ŸÖÿ≤ŸàÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</Label>\n                            <Select\n                              value={selectedTask?.summarizationProviderId?.toString() || \"\"}\n                              onValueChange={(value) => {\n                                if (selectedTaskId) {\n                                  updateTaskSettingsMutation.mutate({\n                                    id: selectedTaskId,\n                                    data: { \n                                      summarizationProviderId: value ? parseInt(value) : null,\n                                      summarizationModelId: null\n                                    }\n                                  });\n                                }\n                              }}\n                            >\n                              <SelectTrigger className=\"h-11 rounded-lg border-2 bg-background hover:bg-muted/50 transition-colors\">\n                                <SelectValue placeholder=\"ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≤ŸàÿØ\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {providers.map((provider: any) => (\n                                  <SelectItem key={provider.id} value={provider.id.toString()}>\n                                    {provider.name}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                          <div className=\"space-y-2\">\n                            <Label className=\"text-xs font-medium text-muted-foreground\">ÿßŸÑŸÖŸàÿØŸÑ</Label>\n                            <Select\n                              value={selectedTask?.summarizationModelId?.toString() || \"\"}\n                              onValueChange={(value) => {\n                                if (selectedTaskId) {\n                                  updateTaskSettingsMutation.mutate({\n                                    id: selectedTaskId,\n                                    data: { summarizationModelId: value ? parseInt(value) : null }\n                                  });\n                                }\n                              }}\n                              disabled={!selectedTask?.summarizationProviderId}\n                            >\n                              <SelectTrigger className=\"h-11 rounded-lg border-2 bg-background hover:bg-muted/50 transition-colors\">\n                                <SelectValue placeholder=\"ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿØŸÑ\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {summarizationModels.map((model: any) => (\n                                  <SelectItem key={model.id} value={model.id.toString()}>\n                                    <span className=\"flex items-center gap-2\">\n                                      <span className=\"text-xs text-muted-foreground\">[{getProviderName(model.providerId)}]</span>\n                                      {model.displayName}\n                                    </span>\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                        </div>\n                      </div>\n                    }\n                  >\n                    <SummarizationList\n                      items={summarizationRules}\n                      onEdit={(item) => { setEditingSummarization(item); setIsSummarizationDialogOpen(true); }}\n                      onDelete={(id) => deleteSummarizationMutation.mutate(id)}\n                      searchQuery=\"\"\n                    />\n                  </RuleSection>\n\n                  <RuleSection\n                    title={sections[6].label}\n                    description={sections[6].description}\n                    icon={sections[6].icon}\n                    color={sections[6].color}\n                    bgColor={sections[6].bgColor}\n                    isEnabled={sectionStates.video}\n                    onToggleEnabled={(enabled) => {\n                      toggleSection('video', enabled);\n                      if (selectedTaskId) {\n                        updateTaskSettingsMutation.mutate({ \n                          id: selectedTaskId, \n                          data: { videoProcessingEnabled: enabled } \n                        });\n                      }\n                    }}\n                    count={getSectionCount('video')}\n                    onAdd={() => openAddDialog('video')}\n                    addLabel=\"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ©\"\n                    settingsPanel={\n                      <div className=\"space-y-4\">\n                        <div className=\"grid grid-cols-2 gap-4\">\n                          <div>\n                            <Label className=\"text-sm font-medium mb-2 block\">ŸÖÿ≤ŸàÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</Label>\n                            <Select\n                              value={selectedTask?.videoAiProviderId?.toString() || \"\"}\n                              onValueChange={(value) => {\n                                if (selectedTaskId) {\n                                  updateTaskSettingsMutation.mutate({\n                                    id: selectedTaskId,\n                                    data: { \n                                      videoAiProviderId: value ? parseInt(value) : null,\n                                      videoAiModelId: null\n                                    }\n                                  });\n                                }\n                              }}\n                            >\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≤ŸàÿØ\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {providers.map((provider: any) => (\n                                  <SelectItem key={provider.id} value={provider.id.toString()}>\n                                    {provider.name}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                          <div>\n                            <Label className=\"text-sm font-medium mb-2 block\">ÿßŸÑŸÖŸàÿØŸÑ</Label>\n                            <Select\n                              value={selectedTask?.videoAiModelId?.toString() || \"\"}\n                              onValueChange={(value) => {\n                                if (selectedTaskId) {\n                                  updateTaskSettingsMutation.mutate({\n                                    id: selectedTaskId,\n                                    data: { videoAiModelId: value ? parseInt(value) : null }\n                                  });\n                                }\n                              }}\n                              disabled={!selectedTask?.videoAiProviderId}\n                            >\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿØŸÑ\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {videoModels.map((model: any) => (\n                                  <SelectItem key={model.id} value={model.id.toString()}>\n                                    <span className=\"flex items-center gap-2\">\n                                      <span className=\"text-xs text-muted-foreground\">[{getProviderName(model.providerId)}]</span>\n                                      {model.displayName}\n                                    </span>\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                        </div>\n\n                        <div className=\"border-t pt-4 mt-4\">\n                          <div className=\"flex items-center gap-2 mb-3\">\n                            <Link2 className=\"h-4 w-4 text-cyan-600\" />\n                            <Label className=\"text-sm font-medium\">ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑</Label>\n                          </div>\n\n                          <div className=\"space-y-3\">\n                            <div className=\"flex items-center justify-between p-3 rounded-lg bg-cyan-500/5 border border-cyan-500/20\">\n                              <Label className=\"text-sm\">ÿ™ŸÅÿπŸäŸÑ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑</Label>\n                              <ToggleSwitch\n                                checked={selectedTask?.linkProcessingEnabled || false}\n                                onCheckedChange={(checked) => {\n                                  if (selectedTaskId) {\n                                    updateTaskSettingsMutation.mutate({\n                                      id: selectedTaskId,\n                                      data: { linkProcessingEnabled: checked }\n                                    });\n                                  }\n                                }}\n                                size=\"sm\"\n                              />\n                            </div>\n\n                            {selectedTask?.linkProcessingEnabled && (\n                              <>\n                                <div className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50\">\n                                  <Label className=\"text-sm\">ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖŸÜ ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑</Label>\n                                  <ToggleSwitch\n                                    checked={selectedTask?.linkVideoDownloadEnabled !== false}\n                                    onCheckedChange={(checked) => {\n                                      if (selectedTaskId) {\n                                        updateTaskSettingsMutation.mutate({\n                                          id: selectedTaskId,\n                                          data: { linkVideoDownloadEnabled: checked }\n                                        });\n                                      }\n                                    }}\n                                    size=\"sm\"\n                                  />\n                                </div>\n\n                                <div>\n                                  <Label className=\"text-sm mb-2 block\">ÿ¨ŸàÿØÿ© ÿßŸÑŸÅŸäÿØŸäŸà</Label>\n                                  <Select\n                                    value={selectedTask?.linkVideoQuality || \"high\"}\n                                    onValueChange={(value) => {\n                                      if (selectedTaskId) {\n                                        updateTaskSettingsMutation.mutate({\n                                          id: selectedTaskId,\n                                          data: { linkVideoQuality: value }\n                                        });\n                                      }\n                                    }}\n                                  >\n                                    <SelectTrigger>\n                                      <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                      <SelectItem value=\"high\">ÿπÿßŸÑŸäÿ© (1080p)</SelectItem>\n                                      <SelectItem value=\"medium\">ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© (720p)</SelectItem>\n                                      <SelectItem value=\"low\">ŸÖŸÜÿÆŸÅÿ∂ÿ© (480p)</SelectItem>\n                                    </SelectContent>\n                                  </Select>\n                                </div>\n                              </>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    }\n                  >\n                    <VideoProcessingList\n                      items={videoProcessingRules}\n                      onEdit={(item) => { setEditingVideo(item); setIsVideoDialogOpen(true); }}\n                      onDelete={(id) => deleteVideoMutation.mutate(id)}\n                      searchQuery=\"\"\n                    />\n                  </RuleSection>\n\n                  <RuleSection\n                    title={sections[7].label}\n                    description={sections[7].description}\n                    icon={sections[7].icon}\n                    color={sections[7].color}\n                    bgColor={sections[7].bgColor}\n                    isEnabled={sectionStates.audio}\n                    onToggleEnabled={(enabled) => {\n                      toggleSection('audio', enabled);\n                      if (selectedTaskId) {\n                        updateTaskSettingsMutation.mutate({ \n                          id: selectedTaskId, \n                          data: { audioProcessingEnabled: enabled } \n                        });\n                      }\n                    }}\n                    count={getSectionCount('audio')}\n                    onAdd={() => openAddDialog('audio')}\n                    addLabel=\"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ©\"\n                    settingsPanel={\n                      <div className=\"space-y-4\">\n                        <div className=\"grid grid-cols-2 gap-4\">\n                          <div>\n                            <Label className=\"text-sm font-medium mb-2 block\">ŸÖÿ≤ŸàÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</Label>\n                            <Select\n                              value={selectedTask?.audioAiProviderId?.toString() || \"\"}\n                              onValueChange={(value) => {\n                                if (selectedTaskId) {\n                                  updateTaskSettingsMutation.mutate({\n                                    id: selectedTaskId,\n                                    data: { \n                                      audioAiProviderId: value ? parseInt(value) : null,\n                                      audioAiModelId: null\n                                    }\n                                  });\n                                }\n                              }}\n                            >\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≤ŸàÿØ\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {providers.map((provider: any) => (\n                                  <SelectItem key={provider.id} value={provider.id.toString()}>\n                                    {provider.name}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                          <div>\n                            <Label className=\"text-sm font-medium mb-2 block\">ÿßŸÑŸÖŸàÿØŸÑ</Label>\n                            <Select\n                              value={selectedTask?.audioAiModelId?.toString() || \"\"}\n                              onValueChange={(value) => {\n                                if (selectedTaskId) {\n                                  updateTaskSettingsMutation.mutate({\n                                    id: selectedTaskId,\n                                    data: { audioAiModelId: value ? parseInt(value) : null }\n                                  });\n                                }\n                              }}\n                              disabled={!selectedTask?.audioAiProviderId}\n                            >\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿØŸÑ\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {audioModels.map((model: any) => (\n                                  <SelectItem key={model.id} value={model.id.toString()}>\n                                    <span className=\"flex items-center gap-2\">\n                                      <span className=\"text-xs text-muted-foreground\">[{getProviderName(model.providerId)}]</span>\n                                      {model.displayName}\n                                    </span>\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                        </div>\n                        \n                        <div className=\"p-3 rounded-lg bg-muted/50 text-sm text-muted-foreground\">\n                          <p>ÿπŸÜÿØ ÿ™ŸÅÿπŸäŸÑ Ÿáÿ∞Ÿá ÿßŸÑŸÖŸäÿ≤ÿ©ÿå ÿ≥Ÿäÿ™ŸÖ:</p>\n                          <ul className=\"list-disc list-inside mt-2 space-y-1\">\n                            <li>ÿ™ŸÅÿ±Ÿäÿ∫ ÿßŸÑŸÖŸÇÿßÿ∑ÿπ ÿßŸÑÿµŸàÿ™Ÿäÿ© ŸàÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿµŸàÿ™Ÿäÿ© ÿ•ŸÑŸâ ŸÜÿµ</li>\n                            <li>ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµ ÿßŸÑŸÖŸèŸÅÿ±Ÿëÿ∫ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</li>\n                            <li>ÿ•ŸÜÿ¥ÿßÿ° ÿµŸÅÿ≠ÿ© Telegraph ŸÑŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ</li>\n                          </ul>\n                        </div>\n                      </div>\n                    }\n                  >\n                    <AudioSummarizationRuleList\n                      items={audioSummarizationRules}\n                      onEdit={(item) => { setEditingAudio(item); setIsAudioDialogOpen(true); }}\n                      onDelete={(id) => deleteAudioMutation.mutate(id)}\n                      searchQuery=\"\"\n                    />\n                  </RuleSection>\n                </div>\n              )}\n            </motion.div>\n          )}\n\n          {!selectedTaskId && (\n            <Card className=\"p-12 text-center\">\n              <div className=\"p-4 rounded-full bg-muted/50 w-fit mx-auto mb-4\">\n                <Settings2 className=\"h-12 w-12 text-muted-foreground/50\" />\n              </div>\n              <h3 className=\"text-xl font-semibold mb-2\">ÿßÿÆÿ™ÿ± ŸÖŸáŸÖÿ© ŸÑŸÑÿ®ÿØÿ°</h3>\n              <p className=\"text-muted-foreground max-w-md mx-auto\">\n                Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸáŸÖÿ© ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ£ÿπŸÑÿßŸá ŸÑÿ™ÿ™ŸÖŸÉŸÜ ŸÖŸÜ ÿ•ÿπÿØÿßÿØ ŸÇŸàÿßÿπÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑÿÆÿßÿµÿ© ÿ®Ÿáÿß\n              </p>\n            </Card>\n          )}\n        </div>\n\n        <EntityDialog\n          open={isEntityDialogOpen}\n          onOpenChange={(open) => { setIsEntityDialogOpen(open); if (!open) setEditingEntity(null); }}\n          onSubmit={handleSubmitEntity}\n          editingData={editingEntity}\n          isLoading={createEntityMutation.isPending || updateEntityMutation.isPending}\n        />\n        <ContextDialog\n          open={isContextDialogOpen}\n          onOpenChange={(open) => { setIsContextDialogOpen(open); if (!open) setEditingContext(null); }}\n          onSubmit={handleSubmitContext}\n          editingData={editingContext}\n          isLoading={createContextMutation.isPending || updateContextMutation.isPending}\n        />\n        <TrainingDialog\n          open={isTrainingDialogOpen}\n          onOpenChange={(open) => { setIsTrainingDialogOpen(open); if (!open) setEditingTraining(null); }}\n          onSubmit={handleSubmitTraining}\n          editingData={editingTraining}\n          isLoading={createTrainingMutation.isPending || updateTrainingMutation.isPending}\n        />\n        <FilterDialog\n          open={isFilterDialogOpen}\n          onOpenChange={(open) => { setIsFilterDialogOpen(open); if (!open) setEditingFilter(null); }}\n          onSubmit={handleSubmitFilter}\n          editingData={editingFilter}\n          isLoading={createFilterMutation.isPending || updateFilterMutation.isPending}\n        />\n        <TemplateDialog\n          open={isTemplateDialogOpen}\n          onOpenChange={(open) => { setIsTemplateDialogOpen(open); if (!open) setEditingTemplate(null); }}\n          onSubmit={handleSubmitTemplate}\n          editingData={editingTemplate}\n          isLoading={createTemplateMutation.isPending || updateTemplateMutation.isPending}\n        />\n        <SummarizationDialog\n          open={isSummarizationDialogOpen}\n          onOpenChange={(open) => { setIsSummarizationDialogOpen(open); if (!open) setEditingSummarization(null); }}\n          onSubmit={handleSubmitSummarization}\n          editingData={editingSummarization}\n          isLoading={createSummarizationMutation.isPending || updateSummarizationMutation.isPending}\n        />\n        <VideoProcessingDialog\n          open={isVideoDialogOpen}\n          onOpenChange={(open) => { setIsVideoDialogOpen(open); if (!open) setEditingVideo(null); }}\n          onSubmit={handleSubmitVideo}\n          editingData={editingVideo}\n          isLoading={createVideoMutation.isPending || updateVideoMutation.isPending}\n        />\n        <AudioSummarizationDialog\n          open={isAudioDialogOpen}\n          onOpenChange={(open) => { setIsAudioDialogOpen(open); if (!open) setEditingAudio(null); }}\n          onSubmit={handleSubmitAudio}\n          editingData={editingAudio}\n          isLoading={createAudioMutation.isPending || updateAudioMutation.isPending}\n        />\n      </div>\n    </TooltipProvider>\n  );\n}\n\nfunction SummarizationList({ items, onEdit, onDelete, searchQuery }: { \n  items: any[]; \n  onEdit: (item: any) => void; \n  onDelete: (id: number) => void;\n  searchQuery: string;\n}) {\n  const filtered = items.filter((item: any) => \n    !searchQuery || \n    item.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    item.prompt?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (filtered.length === 0) {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        <BookOpen className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸàÿßÿπÿØ ÿ™ŸÑÿÆŸäÿµ</p>\n        <p className=\"text-sm mt-1\">ÿ£ÿ∂ŸÅ ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÑÿ®ÿØÿ°</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      {filtered.map((rule: any) => (\n        <div key={rule.id} className={`group flex items-start gap-4 p-4 rounded-xl border bg-card hover:shadow-md transition-all ${!rule.isActive ? 'opacity-60' : ''}`}>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n              <Badge className=\"gap-1\">{rule.name}</Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">ÿ£ÿ≥ŸÑŸàÿ®: {summarizationStyles.find(s => s.value === rule.style)?.label || rule.style}</Badge>\n              {rule.priority > 0 && (\n                <Badge variant=\"outline\" className=\"text-xs\">ÿ£ŸàŸÑŸàŸäÿ©: {rule.priority}</Badge>\n              )}\n              <Badge variant={rule.isActive ? \"default\" : \"secondary\"} className=\"text-xs\">\n                {rule.isActive ? \"ŸÖŸÅÿπŸëŸÑ\" : \"ŸÖÿπÿ∑ŸëŸÑ\"}\n              </Badge>\n            </div>\n            <p className=\"text-sm text-muted-foreground line-clamp-2\">{rule.prompt || 'ÿ®ÿØŸàŸÜ ÿ™ÿπŸÑŸäŸÖÿßÿ™'}</p>\n            <div className=\"text-xs text-muted-foreground mt-2\">ÿßŸÑÿ∑ŸàŸÑ ÿßŸÑÿ£ŸÇÿµŸâ: {rule.maxLength} ÿ≠ÿ±ŸÅ | ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©: {rule.keyPointsCount}</div>\n          </div>\n          <div className=\"flex items-center gap-1 opacity-100 transition-opacity\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800\" onClick={() => onEdit(rule)}>\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿπÿØŸäŸÑ</TooltipContent>\n            </Tooltip>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-red-500/10 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800\" onClick={() => onDelete(rule.id)}>\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ≠ÿ∞ŸÅ</TooltipContent>\n            </Tooltip>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction AudioSummarizationRuleList({ items, onEdit, onDelete, searchQuery }: { \n  items: any[]; \n  onEdit: (item: any) => void; \n  onDelete: (id: number) => void;\n  searchQuery: string;\n}) {\n  const filtered = items.filter((item: any) => \n    !searchQuery || \n    item.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    item.prompt?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (filtered.length === 0) {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        <Mic className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸàÿßÿπÿØ ÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿµŸàÿ™</p>\n        <p className=\"text-sm mt-1\">ÿ£ÿ∂ŸÅ ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÑÿ®ÿØÿ°</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      {filtered.map((rule: any) => (\n        <div key={rule.id} className={`group flex items-start gap-4 p-4 rounded-xl border bg-card hover:shadow-md transition-all ${!rule.isActive ? 'opacity-60' : ''}`}>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n              <Badge className=\"gap-1\">{rule.name}</Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">ÿ£ÿ≥ŸÑŸàÿ®: {summarizationStyles.find(s => s.value === rule.style)?.label || rule.style}</Badge>\n              {rule.priority > 0 && (\n                <Badge variant=\"outline\" className=\"text-xs\">ÿ£ŸàŸÑŸàŸäÿ©: {rule.priority}</Badge>\n              )}\n              <Badge variant={rule.isActive ? \"default\" : \"secondary\"} className=\"text-xs\">\n                {rule.isActive ? \"ŸÖŸÅÿπŸëŸÑ\" : \"ŸÖÿπÿ∑ŸëŸÑ\"}\n              </Badge>\n            </div>\n            <p className=\"text-sm text-muted-foreground line-clamp-2\">{rule.prompt || 'ÿ®ÿØŸàŸÜ ÿ™ÿπŸÑŸäŸÖÿßÿ™'}</p>\n            <div className=\"text-xs text-muted-foreground mt-2\">ÿßŸÑÿ∑ŸàŸÑ ÿßŸÑÿ£ŸÇÿµŸâ: {rule.maxLength} ÿ≠ÿ±ŸÅ | ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©: {rule.keyPointsCount}</div>\n          </div>\n          <div className=\"flex items-center gap-1 opacity-100 transition-opacity\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800\" onClick={() => onEdit(rule)}>\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿπÿØŸäŸÑ</TooltipContent>\n            </Tooltip>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-red-500/10 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800\" onClick={() => onDelete(rule.id)}>\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ≠ÿ∞ŸÅ</TooltipContent>\n            </Tooltip>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction VideoProcessingList({ items, onEdit, onDelete, searchQuery }: { \n  items: any[]; \n  onEdit: (item: any) => void; \n  onDelete: (id: number) => void;\n  searchQuery: string;\n}) {\n  const filtered = items.filter((item: any) => \n    !searchQuery || \n    item.name?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (filtered.length === 0) {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        <Film className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸàÿßÿπÿØ ŸÖÿπÿßŸÑÿ¨ÿ© ŸÅÿØŸäŸà</p>\n        <p className=\"text-sm mt-1\">ÿ£ÿ∂ŸÅ ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÑÿ®ÿØÿ°</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      {filtered.map((rule: any) => (\n        <div key={rule.id} className={`group flex items-start gap-4 p-4 rounded-xl border bg-card hover:shadow-md transition-all ${!rule.isActive ? 'opacity-60' : ''}`}>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n              <Badge className=\"gap-1\">{rule.name}</Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">ÿµŸäÿ∫ÿ©: {rule.outputFormat.toUpperCase()}</Badge>\n              {rule.priority > 0 && (\n                <Badge variant=\"outline\" className=\"text-xs\">ÿ£ŸàŸÑŸàŸäÿ©: {rule.priority}</Badge>\n              )}\n              <Badge variant={rule.isActive ? \"default\" : \"secondary\"} className=\"text-xs\">\n                {rule.isActive ? \"ŸÖŸÅÿπŸëŸÑ\" : \"ŸÖÿπÿ∑ŸëŸÑ\"}\n              </Badge>\n            </div>\n            <div className=\"text-xs text-muted-foreground space-y-1\">\n              <p>ÿ£ŸÇÿµŸâ ŸÖÿØÿ©: {Math.floor(rule.maxDuration / 60)} ÿØŸÇŸäŸÇÿ©</p>\n              <div className=\"flex gap-4 mt-2\">\n                {rule.extractFrames && <span className=\"text-green-600\">‚úì ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿµŸàÿ±</span>}\n                {rule.extractAudio && <span className=\"text-green-600\">‚úì ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿµŸàÿ™</span>}\n                {rule.generateSubtitles && <span className=\"text-green-600\">‚úì ÿ™ÿ±ÿ¨ŸÖÿßÿ™</span>}\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-1 opacity-100 transition-opacity\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800\" onClick={() => onEdit(rule)}>\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿπÿØŸäŸÑ</TooltipContent>\n            </Tooltip>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-red-500/10 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800\" onClick={() => onDelete(rule.id)}>\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ≠ÿ∞ŸÅ</TooltipContent>\n            </Tooltip>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction EntityList({ items, onEdit, onDelete, searchQuery }: { \n  items: any[]; \n  onEdit: (item: any) => void; \n  onDelete: (id: number) => void;\n  searchQuery: string;\n}) {\n  const filtered = items.filter((item: any) => \n    !searchQuery || \n    item.originalText?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    item.replacementText?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (filtered.length === 0) {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        <ArrowRightLeft className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸàÿßÿπÿØ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ</p>\n        <p className=\"text-sm mt-1\">ÿ£ÿ∂ŸÅ ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÑÿ®ÿØÿ°</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <AnimatePresence>\n        {filtered.map((entity: any) => (\n          <motion.div\n            key={entity.id}\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n          >\n            <div className={`group flex items-center gap-4 p-4 rounded-xl border bg-card hover:shadow-md transition-all ${!entity.isActive ? 'opacity-60' : ''}`}>\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n                  <Badge variant=\"outline\" className=\"gap-1\">\n                    {entityTypes.find(t => t.value === entity.entityType)?.icon}\n                    {entityTypes.find(t => t.value === entity.entityType)?.label}\n                  </Badge>\n                  <Badge variant={entity.isActive ? \"default\" : \"secondary\"} className=\"text-xs\">\n                    {entity.isActive ? \"ŸÖŸÅÿπŸëŸÑ\" : \"ŸÖÿπÿ∑ŸëŸÑ\"}\n                  </Badge>\n                  {entity.priority > 0 && (\n                    <Badge variant=\"outline\" className=\"text-xs\">ÿ£ŸàŸÑŸàŸäÿ©: {entity.priority}</Badge>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-3 text-sm\">\n                  <code className=\"px-2 py-1 rounded bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 truncate max-w-[150px]\">\n                    {entity.originalText}\n                  </code>\n                  <ArrowRightLeft className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n                  <code className=\"px-2 py-1 rounded bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 truncate max-w-[150px]\">\n                    {entity.replacementText}\n                  </code>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-1 opacity-100 transition-opacity\">\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800\" onClick={() => onEdit(entity)}>\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent>ÿ™ÿπÿØŸäŸÑ</TooltipContent>\n                </Tooltip>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-red-500/10 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800\" onClick={() => onDelete(entity.id)}>\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent>ÿ≠ÿ∞ŸÅ</TooltipContent>\n                </Tooltip>\n              </div>\n            </div>\n          </motion.div>\n        ))}\n      </AnimatePresence>\n    </div>\n  );\n}\n\nfunction ContextList({ items, onEdit, onDelete, searchQuery }: { \n  items: any[]; \n  onEdit: (item: any) => void; \n  onDelete: (id: number) => void;\n  searchQuery: string;\n}) {\n  const filtered = items.filter((item: any) => \n    !searchQuery || \n    item.instructions?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (filtered.length === 0) {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        <Shield className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸàÿßÿπÿØ ÿ≥ŸäÿßŸÇ</p>\n        <p className=\"text-sm mt-1\">ÿ£ÿ∂ŸÅ ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÑÿ®ÿØÿ°</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      {filtered.map((rule: any) => (\n        <div key={rule.id} className={`group flex items-start gap-4 p-4 rounded-xl border bg-card hover:shadow-md transition-all ${!rule.isActive ? 'opacity-60' : ''}`}>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n              <Badge className=\"gap-1\">\n                {contextRuleTypes.find(t => t.value === rule.ruleType)?.label}\n              </Badge>\n              <Badge variant=\"outline\">\n                {rule.targetSentiment}\n              </Badge>\n              {rule.priority > 0 && (\n                <Badge variant=\"outline\" className=\"text-xs\">ÿ£ŸàŸÑŸàŸäÿ©: {rule.priority}</Badge>\n              )}\n            </div>\n            <p className=\"text-sm text-muted-foreground line-clamp-2\">{rule.instructions}</p>\n          </div>\n          <div className=\"flex items-center gap-1 opacity-100 transition-opacity\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800\" onClick={() => onEdit(rule)}>\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿπÿØŸäŸÑ</TooltipContent>\n            </Tooltip>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-red-500/10 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800\" onClick={() => onDelete(rule.id)}>\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ≠ÿ∞ŸÅ</TooltipContent>\n            </Tooltip>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction TrainingList({ items, onEdit, onDelete, searchQuery }: { \n  items: any[]; \n  onEdit: (item: any) => void; \n  onDelete: (id: number) => void;\n  searchQuery: string;\n}) {\n  const filtered = items.filter((item: any) => \n    !searchQuery || \n    item.inputText?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    item.expectedOutput?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (filtered.length === 0) {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        <Brain className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ŸÖÿ´ŸÑÿ© ÿ™ÿØÿ±Ÿäÿ®</p>\n        <p className=\"text-sm mt-1\">ÿ£ÿ∂ŸÅ ŸÖÿ´ÿßŸÑ ÿ¨ÿØŸäÿØ ŸÑŸÑÿ®ÿØÿ°</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      {filtered.map((example: any) => (\n        <div key={example.id} className={`group flex items-start gap-4 p-4 rounded-xl border bg-card hover:shadow-md transition-all ${!example.isActive ? 'opacity-60' : ''}`}>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Badge variant=\"outline\">\n                {exampleTypes.find(t => t.value === example.exampleType)?.label}\n              </Badge>\n              {example.useCount > 0 && (\n                <span className=\"text-xs text-muted-foreground\">ÿßÿ≥ÿ™ŸèÿÆÿØŸÖ {example.useCount} ŸÖÿ±ÿ©</span>\n              )}\n            </div>\n            <div className=\"space-y-2\">\n              <div className=\"text-sm\">\n                <span className=\"text-muted-foreground text-xs\">ÿßŸÑŸÖŸèÿØÿÆŸÑ: </span>\n                <span className=\"line-clamp-1\">{example.inputText}</span>\n              </div>\n              <div className=\"text-sm\">\n                <span className=\"text-muted-foreground text-xs\">ÿßŸÑŸÖÿÆÿ±ÿ¨: </span>\n                <span className=\"line-clamp-1 text-green-600\">{example.expectedOutput}</span>\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-1 opacity-100 transition-opacity\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800\" onClick={() => onEdit(example)}>\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿπÿØŸäŸÑ</TooltipContent>\n            </Tooltip>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-red-500/10 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800\" onClick={() => onDelete(example.id)}>\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ≠ÿ∞ŸÅ</TooltipContent>\n            </Tooltip>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction FilterList({ items, onEdit, onDelete, searchQuery }: { \n  items: any[]; \n  onEdit: (item: any) => void; \n  onDelete: (id: number) => void;\n  searchQuery: string;\n}) {\n  const filtered = items.filter((item: any) => \n    !searchQuery || \n    item.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    item.pattern?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (filtered.length === 0) {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        <Filter className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÅŸÑÿßÿ™ÿ± ŸÖÿ≠ÿ™ŸàŸâ</p>\n        <p className=\"text-sm mt-1\">ÿ£ÿ∂ŸÅ ŸÅŸÑÿ™ÿ± ÿ¨ÿØŸäÿØ ŸÑŸÑÿ®ÿØÿ°</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      {filtered.map((filter: any) => (\n        <div key={filter.id} className={`group flex items-start gap-4 p-4 rounded-xl border bg-card hover:shadow-md transition-all ${!filter.isActive ? 'opacity-60' : ''}`}>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n              <span className=\"font-medium\">{filter.name}</span>\n              <Badge variant={filter.filterType === 'block' ? 'destructive' : filter.filterType === 'allow' ? 'default' : 'secondary'}>\n                {filterTypes.find(t => t.value === filter.filterType)?.label}\n              </Badge>\n              <Badge variant=\"outline\">\n                {matchTypes.find(t => t.value === filter.matchType)?.label}\n              </Badge>\n              <Badge variant=\"outline\">\n                {filterActions.find(t => t.value === filter.action)?.label}\n              </Badge>\n            </div>\n            <code className=\"text-xs bg-muted px-2 py-1 rounded font-mono\" dir=\"ltr\">{filter.pattern}</code>\n          </div>\n          <div className=\"flex items-center gap-1 opacity-100 transition-opacity\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800\" onClick={() => onEdit(filter)}>\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿπÿØŸäŸÑ</TooltipContent>\n            </Tooltip>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-red-500/10 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800\" onClick={() => onDelete(filter.id)}>\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ≠ÿ∞ŸÅ</TooltipContent>\n            </Tooltip>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction TemplateList({ items, onEdit, onDelete, searchQuery }: { \n  items: any[]; \n  onEdit: (item: any) => void; \n  onDelete: (id: number) => void;\n  searchQuery: string;\n}) {\n  const filtered = items.filter((item: any) => \n    !searchQuery || \n    item.name?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (filtered.length === 0) {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        <FileText className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸàÿßŸÑÿ® ŸÜÿ¥ÿ±</p>\n        <p className=\"text-sm mt-1\">ÿ£ŸÜÿ¥ÿ¶ ŸÇÿßŸÑÿ® ÿ¨ÿØŸäÿØ ŸÑŸÑÿ®ÿØÿ°</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      {filtered.map((template: any) => (\n        <div key={template.id} className=\"group flex items-start gap-4 p-4 rounded-xl border bg-card hover:shadow-md transition-all\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n              <span className=\"font-medium\">{template.name}</span>\n              <Badge variant=\"outline\">\n                {templateTypes.find(t => t.value === template.templateType)?.label}\n              </Badge>\n              {template.isDefault && (\n                <Badge className=\"bg-yellow-500/20 text-yellow-700 border-yellow-500/30\">ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä</Badge>\n              )}\n              {template.customFields?.length > 0 && (\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  {template.customFields.length} ÿ≠ŸÇŸÑ\n                </Badge>\n              )}\n            </div>\n            <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n              {template.headerText && <span>ÿ±ÿ£ÿ≥: {template.headerText.substring(0, 20)}...</span>}\n              {template.footerText && <span>ÿ™ÿ∞ŸäŸäŸÑ: {template.footerText.substring(0, 20)}...</span>}\n            </div>\n          </div>\n          <div className=\"flex items-center gap-1 opacity-100 transition-opacity\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800\" onClick={() => onEdit(template)}>\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿπÿØŸäŸÑ</TooltipContent>\n            </Tooltip>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-red-500/10 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800\" onClick={() => onDelete(template.id)}>\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ≠ÿ∞ŸÅ</TooltipContent>\n            </Tooltip>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}","path":null,"size_bytes":83597,"size_tokens":null},"node_modules/.vite/deps/@radix-ui_react-select.js":{"content":"\"use client\";\nimport {\n  usePrevious\n} from \"./chunk-3GL6P6IT.js\";\nimport {\n  Anchor,\n  Arrow,\n  Content,\n  Root2,\n  createPopperScope\n} from \"./chunk-E7BRGGVV.js\";\nimport \"./chunk-JTRY5A5K.js\";\nimport {\n  createCollection,\n  useDirection\n} from \"./chunk-NSDROFPJ.js\";\nimport {\n  Combination_default,\n  DismissableLayer,\n  FocusScope,\n  Portal,\n  hideOthers,\n  useFocusGuards\n} from \"./chunk-R3YZKR5V.js\";\nimport \"./chunk-734E7IPH.js\";\nimport {\n  useCallbackRef\n} from \"./chunk-QANW4NWU.js\";\nimport {\n  useId\n} from \"./chunk-JB42X4KE.js\";\nimport {\n  Primitive\n} from \"./chunk-YRTNRKIT.js\";\nimport {\n  createContextScope,\n  useLayoutEffect2\n} from \"./chunk-6KE3XZZ5.js\";\nimport {\n  composeRefs,\n  useComposedRefs\n} from \"./chunk-WGRQAFEQ.js\";\nimport {\n  require_jsx_runtime\n} from \"./chunk-FXVZLN7E.js\";\nimport {\n  require_react_dom\n} from \"./chunk-F5X6INBZ.js\";\nimport {\n  require_react\n} from \"./chunk-KMU3Z7QX.js\";\nimport {\n  __toESM\n} from \"./chunk-G3PMV62Z.js\";\n\n// node_modules/@radix-ui/react-select/dist/index.mjs\nvar React4 = __toESM(require_react(), 1);\nvar ReactDOM = __toESM(require_react_dom(), 1);\n\n// node_modules/@radix-ui/number/dist/index.mjs\nfunction clamp(value, [min, max]) {\n  return Math.min(max, Math.max(min, value));\n}\n\n// node_modules/@radix-ui/react-select/node_modules/@radix-ui/primitive/dist/index.mjs\nvar canUseDOM = !!(typeof window !== \"undefined\" && window.document && window.document.createElement);\nfunction composeEventHandlers(originalEventHandler, ourEventHandler, { checkForDefaultPrevented = true } = {}) {\n  return function handleEvent(event) {\n    originalEventHandler?.(event);\n    if (checkForDefaultPrevented === false || !event.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n}\n\n// node_modules/@radix-ui/react-select/node_modules/@radix-ui/react-slot/dist/index.mjs\nvar React = __toESM(require_react(), 1);\nvar import_jsx_runtime = __toESM(require_jsx_runtime(), 1);\nfunction createSlot(ownerName) {\n  const SlotClone = createSlotClone(ownerName);\n  const Slot22 = React.forwardRef((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n    const childrenArray = React.Children.toArray(children);\n    const slottable = childrenArray.find(isSlottable);\n    if (slottable) {\n      const newElement = slottable.props.children;\n      const newChildren = childrenArray.map((child) => {\n        if (child === slottable) {\n          if (React.Children.count(newElement) > 1) return React.Children.only(null);\n          return React.isValidElement(newElement) ? newElement.props.children : null;\n        } else {\n          return child;\n        }\n      });\n      return (0, import_jsx_runtime.jsx)(SlotClone, { ...slotProps, ref: forwardedRef, children: React.isValidElement(newElement) ? React.cloneElement(newElement, void 0, newChildren) : null });\n    }\n    return (0, import_jsx_runtime.jsx)(SlotClone, { ...slotProps, ref: forwardedRef, children });\n  });\n  Slot22.displayName = `${ownerName}.Slot`;\n  return Slot22;\n}\nvar Slot = createSlot(\"Slot\");\nfunction createSlotClone(ownerName) {\n  const SlotClone = React.forwardRef((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n    if (React.isValidElement(children)) {\n      const childrenRef = getElementRef(children);\n      const props2 = mergeProps(slotProps, children.props);\n      if (children.type !== React.Fragment) {\n        props2.ref = forwardedRef ? composeRefs(forwardedRef, childrenRef) : childrenRef;\n      }\n      return React.cloneElement(children, props2);\n    }\n    return React.Children.count(children) > 1 ? React.Children.only(null) : null;\n  });\n  SlotClone.displayName = `${ownerName}.SlotClone`;\n  return SlotClone;\n}\nvar SLOTTABLE_IDENTIFIER = Symbol(\"radix.slottable\");\nfunction createSlottable(ownerName) {\n  const Slottable2 = ({ children }) => {\n    return (0, import_jsx_runtime.jsx)(import_jsx_runtime.Fragment, { children });\n  };\n  Slottable2.displayName = `${ownerName}.Slottable`;\n  Slottable2.__radixId = SLOTTABLE_IDENTIFIER;\n  return Slottable2;\n}\nvar Slottable = createSlottable(\"Slottable\");\nfunction isSlottable(child) {\n  return React.isValidElement(child) && typeof child.type === \"function\" && \"__radixId\" in child.type && child.type.__radixId === SLOTTABLE_IDENTIFIER;\n}\nfunction mergeProps(slotProps, childProps) {\n  const overrideProps = { ...childProps };\n  for (const propName in childProps) {\n    const slotPropValue = slotProps[propName];\n    const childPropValue = childProps[propName];\n    const isHandler = /^on[A-Z]/.test(propName);\n    if (isHandler) {\n      if (slotPropValue && childPropValue) {\n        overrideProps[propName] = (...args) => {\n          const result = childPropValue(...args);\n          slotPropValue(...args);\n          return result;\n        };\n      } else if (slotPropValue) {\n        overrideProps[propName] = slotPropValue;\n      }\n    } else if (propName === \"style\") {\n      overrideProps[propName] = { ...slotPropValue, ...childPropValue };\n    } else if (propName === \"className\") {\n      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(\" \");\n    }\n  }\n  return { ...slotProps, ...overrideProps };\n}\nfunction getElementRef(element) {\n  let getter = Object.getOwnPropertyDescriptor(element.props, \"ref\")?.get;\n  let mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.ref;\n  }\n  getter = Object.getOwnPropertyDescriptor(element, \"ref\")?.get;\n  mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.props.ref;\n  }\n  return element.props.ref || element.ref;\n}\n\n// node_modules/@radix-ui/react-select/node_modules/@radix-ui/react-use-controllable-state/dist/index.mjs\nvar React2 = __toESM(require_react(), 1);\nvar React22 = __toESM(require_react(), 1);\nvar useInsertionEffect = React2[\" useInsertionEffect \".trim().toString()] || useLayoutEffect2;\nfunction useControllableState({\n  prop,\n  defaultProp,\n  onChange = () => {\n  },\n  caller\n}) {\n  const [uncontrolledProp, setUncontrolledProp, onChangeRef] = useUncontrolledState({\n    defaultProp,\n    onChange\n  });\n  const isControlled = prop !== void 0;\n  const value = isControlled ? prop : uncontrolledProp;\n  if (true) {\n    const isControlledRef = React2.useRef(prop !== void 0);\n    React2.useEffect(() => {\n      const wasControlled = isControlledRef.current;\n      if (wasControlled !== isControlled) {\n        const from = wasControlled ? \"controlled\" : \"uncontrolled\";\n        const to = isControlled ? \"controlled\" : \"uncontrolled\";\n        console.warn(\n          `${caller} is changing from ${from} to ${to}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`\n        );\n      }\n      isControlledRef.current = isControlled;\n    }, [isControlled, caller]);\n  }\n  const setValue = React2.useCallback(\n    (nextValue) => {\n      if (isControlled) {\n        const value2 = isFunction(nextValue) ? nextValue(prop) : nextValue;\n        if (value2 !== prop) {\n          onChangeRef.current?.(value2);\n        }\n      } else {\n        setUncontrolledProp(nextValue);\n      }\n    },\n    [isControlled, prop, setUncontrolledProp, onChangeRef]\n  );\n  return [value, setValue];\n}\nfunction useUncontrolledState({\n  defaultProp,\n  onChange\n}) {\n  const [value, setValue] = React2.useState(defaultProp);\n  const prevValueRef = React2.useRef(value);\n  const onChangeRef = React2.useRef(onChange);\n  useInsertionEffect(() => {\n    onChangeRef.current = onChange;\n  }, [onChange]);\n  React2.useEffect(() => {\n    if (prevValueRef.current !== value) {\n      onChangeRef.current?.(value);\n      prevValueRef.current = value;\n    }\n  }, [value, prevValueRef]);\n  return [value, setValue, onChangeRef];\n}\nfunction isFunction(value) {\n  return typeof value === \"function\";\n}\nvar SYNC_STATE = Symbol(\"RADIX:SYNC_STATE\");\n\n// node_modules/@radix-ui/react-visually-hidden/dist/index.mjs\nvar React3 = __toESM(require_react(), 1);\nvar import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);\nvar VISUALLY_HIDDEN_STYLES = Object.freeze({\n  // See: https://github.com/twbs/bootstrap/blob/main/scss/mixins/_visually-hidden.scss\n  position: \"absolute\",\n  border: 0,\n  width: 1,\n  height: 1,\n  padding: 0,\n  margin: -1,\n  overflow: \"hidden\",\n  clip: \"rect(0, 0, 0, 0)\",\n  whiteSpace: \"nowrap\",\n  wordWrap: \"normal\"\n});\nvar NAME = \"VisuallyHidden\";\nvar VisuallyHidden = React3.forwardRef(\n  (props, forwardedRef) => {\n    return (0, import_jsx_runtime2.jsx)(\n      Primitive.span,\n      {\n        ...props,\n        ref: forwardedRef,\n        style: { ...VISUALLY_HIDDEN_STYLES, ...props.style }\n      }\n    );\n  }\n);\nVisuallyHidden.displayName = NAME;\n\n// node_modules/@radix-ui/react-select/dist/index.mjs\nvar import_jsx_runtime3 = __toESM(require_jsx_runtime(), 1);\nvar OPEN_KEYS = [\" \", \"Enter\", \"ArrowUp\", \"ArrowDown\"];\nvar SELECTION_KEYS = [\" \", \"Enter\"];\nvar SELECT_NAME = \"Select\";\nvar [Collection, useCollection, createCollectionScope] = createCollection(SELECT_NAME);\nvar [createSelectContext, createSelectScope] = createContextScope(SELECT_NAME, [\n  createCollectionScope,\n  createPopperScope\n]);\nvar usePopperScope = createPopperScope();\nvar [SelectProvider, useSelectContext] = createSelectContext(SELECT_NAME);\nvar [SelectNativeOptionsProvider, useSelectNativeOptionsContext] = createSelectContext(SELECT_NAME);\nvar Select = (props) => {\n  const {\n    __scopeSelect,\n    children,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    value: valueProp,\n    defaultValue,\n    onValueChange,\n    dir,\n    name,\n    autoComplete,\n    disabled,\n    required,\n    form\n  } = props;\n  const popperScope = usePopperScope(__scopeSelect);\n  const [trigger, setTrigger] = React4.useState(null);\n  const [valueNode, setValueNode] = React4.useState(null);\n  const [valueNodeHasChildren, setValueNodeHasChildren] = React4.useState(false);\n  const direction = useDirection(dir);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen ?? false,\n    onChange: onOpenChange,\n    caller: SELECT_NAME\n  });\n  const [value, setValue] = useControllableState({\n    prop: valueProp,\n    defaultProp: defaultValue,\n    onChange: onValueChange,\n    caller: SELECT_NAME\n  });\n  const triggerPointerDownPosRef = React4.useRef(null);\n  const isFormControl = trigger ? form || !!trigger.closest(\"form\") : true;\n  const [nativeOptionsSet, setNativeOptionsSet] = React4.useState(/* @__PURE__ */ new Set());\n  const nativeSelectKey = Array.from(nativeOptionsSet).map((option) => option.props.value).join(\";\");\n  return (0, import_jsx_runtime3.jsx)(Root2, { ...popperScope, children: (0, import_jsx_runtime3.jsxs)(\n    SelectProvider,\n    {\n      required,\n      scope: __scopeSelect,\n      trigger,\n      onTriggerChange: setTrigger,\n      valueNode,\n      onValueNodeChange: setValueNode,\n      valueNodeHasChildren,\n      onValueNodeHasChildrenChange: setValueNodeHasChildren,\n      contentId: useId(),\n      value,\n      onValueChange: setValue,\n      open,\n      onOpenChange: setOpen,\n      dir: direction,\n      triggerPointerDownPosRef,\n      disabled,\n      children: [\n        (0, import_jsx_runtime3.jsx)(Collection.Provider, { scope: __scopeSelect, children: (0, import_jsx_runtime3.jsx)(\n          SelectNativeOptionsProvider,\n          {\n            scope: props.__scopeSelect,\n            onNativeOptionAdd: React4.useCallback((option) => {\n              setNativeOptionsSet((prev) => new Set(prev).add(option));\n            }, []),\n            onNativeOptionRemove: React4.useCallback((option) => {\n              setNativeOptionsSet((prev) => {\n                const optionsSet = new Set(prev);\n                optionsSet.delete(option);\n                return optionsSet;\n              });\n            }, []),\n            children\n          }\n        ) }),\n        isFormControl ? (0, import_jsx_runtime3.jsxs)(\n          SelectBubbleInput,\n          {\n            \"aria-hidden\": true,\n            required,\n            tabIndex: -1,\n            name,\n            autoComplete,\n            value,\n            onChange: (event) => setValue(event.target.value),\n            disabled,\n            form,\n            children: [\n              value === void 0 ? (0, import_jsx_runtime3.jsx)(\"option\", { value: \"\" }) : null,\n              Array.from(nativeOptionsSet)\n            ]\n          },\n          nativeSelectKey\n        ) : null\n      ]\n    }\n  ) });\n};\nSelect.displayName = SELECT_NAME;\nvar TRIGGER_NAME = \"SelectTrigger\";\nvar SelectTrigger = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, disabled = false, ...triggerProps } = props;\n    const popperScope = usePopperScope(__scopeSelect);\n    const context = useSelectContext(TRIGGER_NAME, __scopeSelect);\n    const isDisabled = context.disabled || disabled;\n    const composedRefs = useComposedRefs(forwardedRef, context.onTriggerChange);\n    const getItems = useCollection(__scopeSelect);\n    const pointerTypeRef = React4.useRef(\"touch\");\n    const [searchRef, handleTypeaheadSearch, resetTypeahead] = useTypeaheadSearch((search) => {\n      const enabledItems = getItems().filter((item) => !item.disabled);\n      const currentItem = enabledItems.find((item) => item.value === context.value);\n      const nextItem = findNextItem(enabledItems, search, currentItem);\n      if (nextItem !== void 0) {\n        context.onValueChange(nextItem.value);\n      }\n    });\n    const handleOpen = (pointerEvent) => {\n      if (!isDisabled) {\n        context.onOpenChange(true);\n        resetTypeahead();\n      }\n      if (pointerEvent) {\n        context.triggerPointerDownPosRef.current = {\n          x: Math.round(pointerEvent.pageX),\n          y: Math.round(pointerEvent.pageY)\n        };\n      }\n    };\n    return (0, import_jsx_runtime3.jsx)(Anchor, { asChild: true, ...popperScope, children: (0, import_jsx_runtime3.jsx)(\n      Primitive.button,\n      {\n        type: \"button\",\n        role: \"combobox\",\n        \"aria-controls\": context.contentId,\n        \"aria-expanded\": context.open,\n        \"aria-required\": context.required,\n        \"aria-autocomplete\": \"none\",\n        dir: context.dir,\n        \"data-state\": context.open ? \"open\" : \"closed\",\n        disabled: isDisabled,\n        \"data-disabled\": isDisabled ? \"\" : void 0,\n        \"data-placeholder\": shouldShowPlaceholder(context.value) ? \"\" : void 0,\n        ...triggerProps,\n        ref: composedRefs,\n        onClick: composeEventHandlers(triggerProps.onClick, (event) => {\n          event.currentTarget.focus();\n          if (pointerTypeRef.current !== \"mouse\") {\n            handleOpen(event);\n          }\n        }),\n        onPointerDown: composeEventHandlers(triggerProps.onPointerDown, (event) => {\n          pointerTypeRef.current = event.pointerType;\n          const target = event.target;\n          if (target.hasPointerCapture(event.pointerId)) {\n            target.releasePointerCapture(event.pointerId);\n          }\n          if (event.button === 0 && event.ctrlKey === false && event.pointerType === \"mouse\") {\n            handleOpen(event);\n            event.preventDefault();\n          }\n        }),\n        onKeyDown: composeEventHandlers(triggerProps.onKeyDown, (event) => {\n          const isTypingAhead = searchRef.current !== \"\";\n          const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;\n          if (!isModifierKey && event.key.length === 1) handleTypeaheadSearch(event.key);\n          if (isTypingAhead && event.key === \" \") return;\n          if (OPEN_KEYS.includes(event.key)) {\n            handleOpen();\n            event.preventDefault();\n          }\n        })\n      }\n    ) });\n  }\n);\nSelectTrigger.displayName = TRIGGER_NAME;\nvar VALUE_NAME = \"SelectValue\";\nvar SelectValue = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, className, style, children, placeholder = \"\", ...valueProps } = props;\n    const context = useSelectContext(VALUE_NAME, __scopeSelect);\n    const { onValueNodeHasChildrenChange } = context;\n    const hasChildren = children !== void 0;\n    const composedRefs = useComposedRefs(forwardedRef, context.onValueNodeChange);\n    useLayoutEffect2(() => {\n      onValueNodeHasChildrenChange(hasChildren);\n    }, [onValueNodeHasChildrenChange, hasChildren]);\n    return (0, import_jsx_runtime3.jsx)(\n      Primitive.span,\n      {\n        ...valueProps,\n        ref: composedRefs,\n        style: { pointerEvents: \"none\" },\n        children: shouldShowPlaceholder(context.value) ? (0, import_jsx_runtime3.jsx)(import_jsx_runtime3.Fragment, { children: placeholder }) : children\n      }\n    );\n  }\n);\nSelectValue.displayName = VALUE_NAME;\nvar ICON_NAME = \"SelectIcon\";\nvar SelectIcon = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, children, ...iconProps } = props;\n    return (0, import_jsx_runtime3.jsx)(Primitive.span, { \"aria-hidden\": true, ...iconProps, ref: forwardedRef, children: children || \"‚ñº\" });\n  }\n);\nSelectIcon.displayName = ICON_NAME;\nvar PORTAL_NAME = \"SelectPortal\";\nvar SelectPortal = (props) => {\n  return (0, import_jsx_runtime3.jsx)(Portal, { asChild: true, ...props });\n};\nSelectPortal.displayName = PORTAL_NAME;\nvar CONTENT_NAME = \"SelectContent\";\nvar SelectContent = React4.forwardRef(\n  (props, forwardedRef) => {\n    const context = useSelectContext(CONTENT_NAME, props.__scopeSelect);\n    const [fragment, setFragment] = React4.useState();\n    useLayoutEffect2(() => {\n      setFragment(new DocumentFragment());\n    }, []);\n    if (!context.open) {\n      const frag = fragment;\n      return frag ? ReactDOM.createPortal(\n        (0, import_jsx_runtime3.jsx)(SelectContentProvider, { scope: props.__scopeSelect, children: (0, import_jsx_runtime3.jsx)(Collection.Slot, { scope: props.__scopeSelect, children: (0, import_jsx_runtime3.jsx)(\"div\", { children: props.children }) }) }),\n        frag\n      ) : null;\n    }\n    return (0, import_jsx_runtime3.jsx)(SelectContentImpl, { ...props, ref: forwardedRef });\n  }\n);\nSelectContent.displayName = CONTENT_NAME;\nvar CONTENT_MARGIN = 10;\nvar [SelectContentProvider, useSelectContentContext] = createSelectContext(CONTENT_NAME);\nvar CONTENT_IMPL_NAME = \"SelectContentImpl\";\nvar Slot2 = createSlot(\"SelectContent.RemoveScroll\");\nvar SelectContentImpl = React4.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeSelect,\n      position = \"item-aligned\",\n      onCloseAutoFocus,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      //\n      // PopperContent props\n      side,\n      sideOffset,\n      align,\n      alignOffset,\n      arrowPadding,\n      collisionBoundary,\n      collisionPadding,\n      sticky,\n      hideWhenDetached,\n      avoidCollisions,\n      //\n      ...contentProps\n    } = props;\n    const context = useSelectContext(CONTENT_NAME, __scopeSelect);\n    const [content, setContent] = React4.useState(null);\n    const [viewport, setViewport] = React4.useState(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));\n    const [selectedItem, setSelectedItem] = React4.useState(null);\n    const [selectedItemText, setSelectedItemText] = React4.useState(\n      null\n    );\n    const getItems = useCollection(__scopeSelect);\n    const [isPositioned, setIsPositioned] = React4.useState(false);\n    const firstValidItemFoundRef = React4.useRef(false);\n    React4.useEffect(() => {\n      if (content) return hideOthers(content);\n    }, [content]);\n    useFocusGuards();\n    const focusFirst = React4.useCallback(\n      (candidates) => {\n        const [firstItem, ...restItems] = getItems().map((item) => item.ref.current);\n        const [lastItem] = restItems.slice(-1);\n        const PREVIOUSLY_FOCUSED_ELEMENT = document.activeElement;\n        for (const candidate of candidates) {\n          if (candidate === PREVIOUSLY_FOCUSED_ELEMENT) return;\n          candidate?.scrollIntoView({ block: \"nearest\" });\n          if (candidate === firstItem && viewport) viewport.scrollTop = 0;\n          if (candidate === lastItem && viewport) viewport.scrollTop = viewport.scrollHeight;\n          candidate?.focus();\n          if (document.activeElement !== PREVIOUSLY_FOCUSED_ELEMENT) return;\n        }\n      },\n      [getItems, viewport]\n    );\n    const focusSelectedItem = React4.useCallback(\n      () => focusFirst([selectedItem, content]),\n      [focusFirst, selectedItem, content]\n    );\n    React4.useEffect(() => {\n      if (isPositioned) {\n        focusSelectedItem();\n      }\n    }, [isPositioned, focusSelectedItem]);\n    const { onOpenChange, triggerPointerDownPosRef } = context;\n    React4.useEffect(() => {\n      if (content) {\n        let pointerMoveDelta = { x: 0, y: 0 };\n        const handlePointerMove = (event) => {\n          pointerMoveDelta = {\n            x: Math.abs(Math.round(event.pageX) - (triggerPointerDownPosRef.current?.x ?? 0)),\n            y: Math.abs(Math.round(event.pageY) - (triggerPointerDownPosRef.current?.y ?? 0))\n          };\n        };\n        const handlePointerUp = (event) => {\n          if (pointerMoveDelta.x <= 10 && pointerMoveDelta.y <= 10) {\n            event.preventDefault();\n          } else {\n            if (!content.contains(event.target)) {\n              onOpenChange(false);\n            }\n          }\n          document.removeEventListener(\"pointermove\", handlePointerMove);\n          triggerPointerDownPosRef.current = null;\n        };\n        if (triggerPointerDownPosRef.current !== null) {\n          document.addEventListener(\"pointermove\", handlePointerMove);\n          document.addEventListener(\"pointerup\", handlePointerUp, { capture: true, once: true });\n        }\n        return () => {\n          document.removeEventListener(\"pointermove\", handlePointerMove);\n          document.removeEventListener(\"pointerup\", handlePointerUp, { capture: true });\n        };\n      }\n    }, [content, onOpenChange, triggerPointerDownPosRef]);\n    React4.useEffect(() => {\n      const close = () => onOpenChange(false);\n      window.addEventListener(\"blur\", close);\n      window.addEventListener(\"resize\", close);\n      return () => {\n        window.removeEventListener(\"blur\", close);\n        window.removeEventListener(\"resize\", close);\n      };\n    }, [onOpenChange]);\n    const [searchRef, handleTypeaheadSearch] = useTypeaheadSearch((search) => {\n      const enabledItems = getItems().filter((item) => !item.disabled);\n      const currentItem = enabledItems.find((item) => item.ref.current === document.activeElement);\n      const nextItem = findNextItem(enabledItems, search, currentItem);\n      if (nextItem) {\n        setTimeout(() => nextItem.ref.current.focus());\n      }\n    });\n    const itemRefCallback = React4.useCallback(\n      (node, value, disabled) => {\n        const isFirstValidItem = !firstValidItemFoundRef.current && !disabled;\n        const isSelectedItem = context.value !== void 0 && context.value === value;\n        if (isSelectedItem || isFirstValidItem) {\n          setSelectedItem(node);\n          if (isFirstValidItem) firstValidItemFoundRef.current = true;\n        }\n      },\n      [context.value]\n    );\n    const handleItemLeave = React4.useCallback(() => content?.focus(), [content]);\n    const itemTextRefCallback = React4.useCallback(\n      (node, value, disabled) => {\n        const isFirstValidItem = !firstValidItemFoundRef.current && !disabled;\n        const isSelectedItem = context.value !== void 0 && context.value === value;\n        if (isSelectedItem || isFirstValidItem) {\n          setSelectedItemText(node);\n        }\n      },\n      [context.value]\n    );\n    const SelectPosition = position === \"popper\" ? SelectPopperPosition : SelectItemAlignedPosition;\n    const popperContentProps = SelectPosition === SelectPopperPosition ? {\n      side,\n      sideOffset,\n      align,\n      alignOffset,\n      arrowPadding,\n      collisionBoundary,\n      collisionPadding,\n      sticky,\n      hideWhenDetached,\n      avoidCollisions\n    } : {};\n    return (0, import_jsx_runtime3.jsx)(\n      SelectContentProvider,\n      {\n        scope: __scopeSelect,\n        content,\n        viewport,\n        onViewportChange: setViewport,\n        itemRefCallback,\n        selectedItem,\n        onItemLeave: handleItemLeave,\n        itemTextRefCallback,\n        focusSelectedItem,\n        selectedItemText,\n        position,\n        isPositioned,\n        searchRef,\n        children: (0, import_jsx_runtime3.jsx)(Combination_default, { as: Slot2, allowPinchZoom: true, children: (0, import_jsx_runtime3.jsx)(\n          FocusScope,\n          {\n            asChild: true,\n            trapped: context.open,\n            onMountAutoFocus: (event) => {\n              event.preventDefault();\n            },\n            onUnmountAutoFocus: composeEventHandlers(onCloseAutoFocus, (event) => {\n              context.trigger?.focus({ preventScroll: true });\n              event.preventDefault();\n            }),\n            children: (0, import_jsx_runtime3.jsx)(\n              DismissableLayer,\n              {\n                asChild: true,\n                disableOutsidePointerEvents: true,\n                onEscapeKeyDown,\n                onPointerDownOutside,\n                onFocusOutside: (event) => event.preventDefault(),\n                onDismiss: () => context.onOpenChange(false),\n                children: (0, import_jsx_runtime3.jsx)(\n                  SelectPosition,\n                  {\n                    role: \"listbox\",\n                    id: context.contentId,\n                    \"data-state\": context.open ? \"open\" : \"closed\",\n                    dir: context.dir,\n                    onContextMenu: (event) => event.preventDefault(),\n                    ...contentProps,\n                    ...popperContentProps,\n                    onPlaced: () => setIsPositioned(true),\n                    ref: composedRefs,\n                    style: {\n                      // flex layout so we can place the scroll buttons properly\n                      display: \"flex\",\n                      flexDirection: \"column\",\n                      // reset the outline by default as the content MAY get focused\n                      outline: \"none\",\n                      ...contentProps.style\n                    },\n                    onKeyDown: composeEventHandlers(contentProps.onKeyDown, (event) => {\n                      const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;\n                      if (event.key === \"Tab\") event.preventDefault();\n                      if (!isModifierKey && event.key.length === 1) handleTypeaheadSearch(event.key);\n                      if ([\"ArrowUp\", \"ArrowDown\", \"Home\", \"End\"].includes(event.key)) {\n                        const items = getItems().filter((item) => !item.disabled);\n                        let candidateNodes = items.map((item) => item.ref.current);\n                        if ([\"ArrowUp\", \"End\"].includes(event.key)) {\n                          candidateNodes = candidateNodes.slice().reverse();\n                        }\n                        if ([\"ArrowUp\", \"ArrowDown\"].includes(event.key)) {\n                          const currentElement = event.target;\n                          const currentIndex = candidateNodes.indexOf(currentElement);\n                          candidateNodes = candidateNodes.slice(currentIndex + 1);\n                        }\n                        setTimeout(() => focusFirst(candidateNodes));\n                        event.preventDefault();\n                      }\n                    })\n                  }\n                )\n              }\n            )\n          }\n        ) })\n      }\n    );\n  }\n);\nSelectContentImpl.displayName = CONTENT_IMPL_NAME;\nvar ITEM_ALIGNED_POSITION_NAME = \"SelectItemAlignedPosition\";\nvar SelectItemAlignedPosition = React4.forwardRef((props, forwardedRef) => {\n  const { __scopeSelect, onPlaced, ...popperProps } = props;\n  const context = useSelectContext(CONTENT_NAME, __scopeSelect);\n  const contentContext = useSelectContentContext(CONTENT_NAME, __scopeSelect);\n  const [contentWrapper, setContentWrapper] = React4.useState(null);\n  const [content, setContent] = React4.useState(null);\n  const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));\n  const getItems = useCollection(__scopeSelect);\n  const shouldExpandOnScrollRef = React4.useRef(false);\n  const shouldRepositionRef = React4.useRef(true);\n  const { viewport, selectedItem, selectedItemText, focusSelectedItem } = contentContext;\n  const position = React4.useCallback(() => {\n    if (context.trigger && context.valueNode && contentWrapper && content && viewport && selectedItem && selectedItemText) {\n      const triggerRect = context.trigger.getBoundingClientRect();\n      const contentRect = content.getBoundingClientRect();\n      const valueNodeRect = context.valueNode.getBoundingClientRect();\n      const itemTextRect = selectedItemText.getBoundingClientRect();\n      if (context.dir !== \"rtl\") {\n        const itemTextOffset = itemTextRect.left - contentRect.left;\n        const left = valueNodeRect.left - itemTextOffset;\n        const leftDelta = triggerRect.left - left;\n        const minContentWidth = triggerRect.width + leftDelta;\n        const contentWidth = Math.max(minContentWidth, contentRect.width);\n        const rightEdge = window.innerWidth - CONTENT_MARGIN;\n        const clampedLeft = clamp(left, [\n          CONTENT_MARGIN,\n          // Prevents the content from going off the starting edge of the\n          // viewport. It may still go off the ending edge, but this can be\n          // controlled by the user since they may want to manage overflow in a\n          // specific way.\n          // https://github.com/radix-ui/primitives/issues/2049\n          Math.max(CONTENT_MARGIN, rightEdge - contentWidth)\n        ]);\n        contentWrapper.style.minWidth = minContentWidth + \"px\";\n        contentWrapper.style.left = clampedLeft + \"px\";\n      } else {\n        const itemTextOffset = contentRect.right - itemTextRect.right;\n        const right = window.innerWidth - valueNodeRect.right - itemTextOffset;\n        const rightDelta = window.innerWidth - triggerRect.right - right;\n        const minContentWidth = triggerRect.width + rightDelta;\n        const contentWidth = Math.max(minContentWidth, contentRect.width);\n        const leftEdge = window.innerWidth - CONTENT_MARGIN;\n        const clampedRight = clamp(right, [\n          CONTENT_MARGIN,\n          Math.max(CONTENT_MARGIN, leftEdge - contentWidth)\n        ]);\n        contentWrapper.style.minWidth = minContentWidth + \"px\";\n        contentWrapper.style.right = clampedRight + \"px\";\n      }\n      const items = getItems();\n      const availableHeight = window.innerHeight - CONTENT_MARGIN * 2;\n      const itemsHeight = viewport.scrollHeight;\n      const contentStyles = window.getComputedStyle(content);\n      const contentBorderTopWidth = parseInt(contentStyles.borderTopWidth, 10);\n      const contentPaddingTop = parseInt(contentStyles.paddingTop, 10);\n      const contentBorderBottomWidth = parseInt(contentStyles.borderBottomWidth, 10);\n      const contentPaddingBottom = parseInt(contentStyles.paddingBottom, 10);\n      const fullContentHeight = contentBorderTopWidth + contentPaddingTop + itemsHeight + contentPaddingBottom + contentBorderBottomWidth;\n      const minContentHeight = Math.min(selectedItem.offsetHeight * 5, fullContentHeight);\n      const viewportStyles = window.getComputedStyle(viewport);\n      const viewportPaddingTop = parseInt(viewportStyles.paddingTop, 10);\n      const viewportPaddingBottom = parseInt(viewportStyles.paddingBottom, 10);\n      const topEdgeToTriggerMiddle = triggerRect.top + triggerRect.height / 2 - CONTENT_MARGIN;\n      const triggerMiddleToBottomEdge = availableHeight - topEdgeToTriggerMiddle;\n      const selectedItemHalfHeight = selectedItem.offsetHeight / 2;\n      const itemOffsetMiddle = selectedItem.offsetTop + selectedItemHalfHeight;\n      const contentTopToItemMiddle = contentBorderTopWidth + contentPaddingTop + itemOffsetMiddle;\n      const itemMiddleToContentBottom = fullContentHeight - contentTopToItemMiddle;\n      const willAlignWithoutTopOverflow = contentTopToItemMiddle <= topEdgeToTriggerMiddle;\n      if (willAlignWithoutTopOverflow) {\n        const isLastItem = items.length > 0 && selectedItem === items[items.length - 1].ref.current;\n        contentWrapper.style.bottom = \"0px\";\n        const viewportOffsetBottom = content.clientHeight - viewport.offsetTop - viewport.offsetHeight;\n        const clampedTriggerMiddleToBottomEdge = Math.max(\n          triggerMiddleToBottomEdge,\n          selectedItemHalfHeight + // viewport might have padding bottom, include it to avoid a scrollable viewport\n          (isLastItem ? viewportPaddingBottom : 0) + viewportOffsetBottom + contentBorderBottomWidth\n        );\n        const height = contentTopToItemMiddle + clampedTriggerMiddleToBottomEdge;\n        contentWrapper.style.height = height + \"px\";\n      } else {\n        const isFirstItem = items.length > 0 && selectedItem === items[0].ref.current;\n        contentWrapper.style.top = \"0px\";\n        const clampedTopEdgeToTriggerMiddle = Math.max(\n          topEdgeToTriggerMiddle,\n          contentBorderTopWidth + viewport.offsetTop + // viewport might have padding top, include it to avoid a scrollable viewport\n          (isFirstItem ? viewportPaddingTop : 0) + selectedItemHalfHeight\n        );\n        const height = clampedTopEdgeToTriggerMiddle + itemMiddleToContentBottom;\n        contentWrapper.style.height = height + \"px\";\n        viewport.scrollTop = contentTopToItemMiddle - topEdgeToTriggerMiddle + viewport.offsetTop;\n      }\n      contentWrapper.style.margin = `${CONTENT_MARGIN}px 0`;\n      contentWrapper.style.minHeight = minContentHeight + \"px\";\n      contentWrapper.style.maxHeight = availableHeight + \"px\";\n      onPlaced?.();\n      requestAnimationFrame(() => shouldExpandOnScrollRef.current = true);\n    }\n  }, [\n    getItems,\n    context.trigger,\n    context.valueNode,\n    contentWrapper,\n    content,\n    viewport,\n    selectedItem,\n    selectedItemText,\n    context.dir,\n    onPlaced\n  ]);\n  useLayoutEffect2(() => position(), [position]);\n  const [contentZIndex, setContentZIndex] = React4.useState();\n  useLayoutEffect2(() => {\n    if (content) setContentZIndex(window.getComputedStyle(content).zIndex);\n  }, [content]);\n  const handleScrollButtonChange = React4.useCallback(\n    (node) => {\n      if (node && shouldRepositionRef.current === true) {\n        position();\n        focusSelectedItem?.();\n        shouldRepositionRef.current = false;\n      }\n    },\n    [position, focusSelectedItem]\n  );\n  return (0, import_jsx_runtime3.jsx)(\n    SelectViewportProvider,\n    {\n      scope: __scopeSelect,\n      contentWrapper,\n      shouldExpandOnScrollRef,\n      onScrollButtonChange: handleScrollButtonChange,\n      children: (0, import_jsx_runtime3.jsx)(\n        \"div\",\n        {\n          ref: setContentWrapper,\n          style: {\n            display: \"flex\",\n            flexDirection: \"column\",\n            position: \"fixed\",\n            zIndex: contentZIndex\n          },\n          children: (0, import_jsx_runtime3.jsx)(\n            Primitive.div,\n            {\n              ...popperProps,\n              ref: composedRefs,\n              style: {\n                // When we get the height of the content, it includes borders. If we were to set\n                // the height without having `boxSizing: 'border-box'` it would be too big.\n                boxSizing: \"border-box\",\n                // We need to ensure the content doesn't get taller than the wrapper\n                maxHeight: \"100%\",\n                ...popperProps.style\n              }\n            }\n          )\n        }\n      )\n    }\n  );\n});\nSelectItemAlignedPosition.displayName = ITEM_ALIGNED_POSITION_NAME;\nvar POPPER_POSITION_NAME = \"SelectPopperPosition\";\nvar SelectPopperPosition = React4.forwardRef((props, forwardedRef) => {\n  const {\n    __scopeSelect,\n    align = \"start\",\n    collisionPadding = CONTENT_MARGIN,\n    ...popperProps\n  } = props;\n  const popperScope = usePopperScope(__scopeSelect);\n  return (0, import_jsx_runtime3.jsx)(\n    Content,\n    {\n      ...popperScope,\n      ...popperProps,\n      ref: forwardedRef,\n      align,\n      collisionPadding,\n      style: {\n        // Ensure border-box for floating-ui calculations\n        boxSizing: \"border-box\",\n        ...popperProps.style,\n        // re-namespace exposed content custom properties\n        ...{\n          \"--radix-select-content-transform-origin\": \"var(--radix-popper-transform-origin)\",\n          \"--radix-select-content-available-width\": \"var(--radix-popper-available-width)\",\n          \"--radix-select-content-available-height\": \"var(--radix-popper-available-height)\",\n          \"--radix-select-trigger-width\": \"var(--radix-popper-anchor-width)\",\n          \"--radix-select-trigger-height\": \"var(--radix-popper-anchor-height)\"\n        }\n      }\n    }\n  );\n});\nSelectPopperPosition.displayName = POPPER_POSITION_NAME;\nvar [SelectViewportProvider, useSelectViewportContext] = createSelectContext(CONTENT_NAME, {});\nvar VIEWPORT_NAME = \"SelectViewport\";\nvar SelectViewport = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, nonce, ...viewportProps } = props;\n    const contentContext = useSelectContentContext(VIEWPORT_NAME, __scopeSelect);\n    const viewportContext = useSelectViewportContext(VIEWPORT_NAME, __scopeSelect);\n    const composedRefs = useComposedRefs(forwardedRef, contentContext.onViewportChange);\n    const prevScrollTopRef = React4.useRef(0);\n    return (0, import_jsx_runtime3.jsxs)(import_jsx_runtime3.Fragment, { children: [\n      (0, import_jsx_runtime3.jsx)(\n        \"style\",\n        {\n          dangerouslySetInnerHTML: {\n            __html: `[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}`\n          },\n          nonce\n        }\n      ),\n      (0, import_jsx_runtime3.jsx)(Collection.Slot, { scope: __scopeSelect, children: (0, import_jsx_runtime3.jsx)(\n        Primitive.div,\n        {\n          \"data-radix-select-viewport\": \"\",\n          role: \"presentation\",\n          ...viewportProps,\n          ref: composedRefs,\n          style: {\n            // we use position: 'relative' here on the `viewport` so that when we call\n            // `selectedItem.offsetTop` in calculations, the offset is relative to the viewport\n            // (independent of the scrollUpButton).\n            position: \"relative\",\n            flex: 1,\n            // Viewport should only be scrollable in the vertical direction.\n            // This won't work in vertical writing modes, so we'll need to\n            // revisit this if/when that is supported\n            // https://developer.chrome.com/blog/vertical-form-controls\n            overflow: \"hidden auto\",\n            ...viewportProps.style\n          },\n          onScroll: composeEventHandlers(viewportProps.onScroll, (event) => {\n            const viewport = event.currentTarget;\n            const { contentWrapper, shouldExpandOnScrollRef } = viewportContext;\n            if (shouldExpandOnScrollRef?.current && contentWrapper) {\n              const scrolledBy = Math.abs(prevScrollTopRef.current - viewport.scrollTop);\n              if (scrolledBy > 0) {\n                const availableHeight = window.innerHeight - CONTENT_MARGIN * 2;\n                const cssMinHeight = parseFloat(contentWrapper.style.minHeight);\n                const cssHeight = parseFloat(contentWrapper.style.height);\n                const prevHeight = Math.max(cssMinHeight, cssHeight);\n                if (prevHeight < availableHeight) {\n                  const nextHeight = prevHeight + scrolledBy;\n                  const clampedNextHeight = Math.min(availableHeight, nextHeight);\n                  const heightDiff = nextHeight - clampedNextHeight;\n                  contentWrapper.style.height = clampedNextHeight + \"px\";\n                  if (contentWrapper.style.bottom === \"0px\") {\n                    viewport.scrollTop = heightDiff > 0 ? heightDiff : 0;\n                    contentWrapper.style.justifyContent = \"flex-end\";\n                  }\n                }\n              }\n            }\n            prevScrollTopRef.current = viewport.scrollTop;\n          })\n        }\n      ) })\n    ] });\n  }\n);\nSelectViewport.displayName = VIEWPORT_NAME;\nvar GROUP_NAME = \"SelectGroup\";\nvar [SelectGroupContextProvider, useSelectGroupContext] = createSelectContext(GROUP_NAME);\nvar SelectGroup = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, ...groupProps } = props;\n    const groupId = useId();\n    return (0, import_jsx_runtime3.jsx)(SelectGroupContextProvider, { scope: __scopeSelect, id: groupId, children: (0, import_jsx_runtime3.jsx)(Primitive.div, { role: \"group\", \"aria-labelledby\": groupId, ...groupProps, ref: forwardedRef }) });\n  }\n);\nSelectGroup.displayName = GROUP_NAME;\nvar LABEL_NAME = \"SelectLabel\";\nvar SelectLabel = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, ...labelProps } = props;\n    const groupContext = useSelectGroupContext(LABEL_NAME, __scopeSelect);\n    return (0, import_jsx_runtime3.jsx)(Primitive.div, { id: groupContext.id, ...labelProps, ref: forwardedRef });\n  }\n);\nSelectLabel.displayName = LABEL_NAME;\nvar ITEM_NAME = \"SelectItem\";\nvar [SelectItemContextProvider, useSelectItemContext] = createSelectContext(ITEM_NAME);\nvar SelectItem = React4.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeSelect,\n      value,\n      disabled = false,\n      textValue: textValueProp,\n      ...itemProps\n    } = props;\n    const context = useSelectContext(ITEM_NAME, __scopeSelect);\n    const contentContext = useSelectContentContext(ITEM_NAME, __scopeSelect);\n    const isSelected = context.value === value;\n    const [textValue, setTextValue] = React4.useState(textValueProp ?? \"\");\n    const [isFocused, setIsFocused] = React4.useState(false);\n    const composedRefs = useComposedRefs(\n      forwardedRef,\n      (node) => contentContext.itemRefCallback?.(node, value, disabled)\n    );\n    const textId = useId();\n    const pointerTypeRef = React4.useRef(\"touch\");\n    const handleSelect = () => {\n      if (!disabled) {\n        context.onValueChange(value);\n        context.onOpenChange(false);\n      }\n    };\n    if (value === \"\") {\n      throw new Error(\n        \"A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.\"\n      );\n    }\n    return (0, import_jsx_runtime3.jsx)(\n      SelectItemContextProvider,\n      {\n        scope: __scopeSelect,\n        value,\n        disabled,\n        textId,\n        isSelected,\n        onItemTextChange: React4.useCallback((node) => {\n          setTextValue((prevTextValue) => prevTextValue || (node?.textContent ?? \"\").trim());\n        }, []),\n        children: (0, import_jsx_runtime3.jsx)(\n          Collection.ItemSlot,\n          {\n            scope: __scopeSelect,\n            value,\n            disabled,\n            textValue,\n            children: (0, import_jsx_runtime3.jsx)(\n              Primitive.div,\n              {\n                role: \"option\",\n                \"aria-labelledby\": textId,\n                \"data-highlighted\": isFocused ? \"\" : void 0,\n                \"aria-selected\": isSelected && isFocused,\n                \"data-state\": isSelected ? \"checked\" : \"unchecked\",\n                \"aria-disabled\": disabled || void 0,\n                \"data-disabled\": disabled ? \"\" : void 0,\n                tabIndex: disabled ? void 0 : -1,\n                ...itemProps,\n                ref: composedRefs,\n                onFocus: composeEventHandlers(itemProps.onFocus, () => setIsFocused(true)),\n                onBlur: composeEventHandlers(itemProps.onBlur, () => setIsFocused(false)),\n                onClick: composeEventHandlers(itemProps.onClick, () => {\n                  if (pointerTypeRef.current !== \"mouse\") handleSelect();\n                }),\n                onPointerUp: composeEventHandlers(itemProps.onPointerUp, () => {\n                  if (pointerTypeRef.current === \"mouse\") handleSelect();\n                }),\n                onPointerDown: composeEventHandlers(itemProps.onPointerDown, (event) => {\n                  pointerTypeRef.current = event.pointerType;\n                }),\n                onPointerMove: composeEventHandlers(itemProps.onPointerMove, (event) => {\n                  pointerTypeRef.current = event.pointerType;\n                  if (disabled) {\n                    contentContext.onItemLeave?.();\n                  } else if (pointerTypeRef.current === \"mouse\") {\n                    event.currentTarget.focus({ preventScroll: true });\n                  }\n                }),\n                onPointerLeave: composeEventHandlers(itemProps.onPointerLeave, (event) => {\n                  if (event.currentTarget === document.activeElement) {\n                    contentContext.onItemLeave?.();\n                  }\n                }),\n                onKeyDown: composeEventHandlers(itemProps.onKeyDown, (event) => {\n                  const isTypingAhead = contentContext.searchRef?.current !== \"\";\n                  if (isTypingAhead && event.key === \" \") return;\n                  if (SELECTION_KEYS.includes(event.key)) handleSelect();\n                  if (event.key === \" \") event.preventDefault();\n                })\n              }\n            )\n          }\n        )\n      }\n    );\n  }\n);\nSelectItem.displayName = ITEM_NAME;\nvar ITEM_TEXT_NAME = \"SelectItemText\";\nvar SelectItemText = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, className, style, ...itemTextProps } = props;\n    const context = useSelectContext(ITEM_TEXT_NAME, __scopeSelect);\n    const contentContext = useSelectContentContext(ITEM_TEXT_NAME, __scopeSelect);\n    const itemContext = useSelectItemContext(ITEM_TEXT_NAME, __scopeSelect);\n    const nativeOptionsContext = useSelectNativeOptionsContext(ITEM_TEXT_NAME, __scopeSelect);\n    const [itemTextNode, setItemTextNode] = React4.useState(null);\n    const composedRefs = useComposedRefs(\n      forwardedRef,\n      (node) => setItemTextNode(node),\n      itemContext.onItemTextChange,\n      (node) => contentContext.itemTextRefCallback?.(node, itemContext.value, itemContext.disabled)\n    );\n    const textContent = itemTextNode?.textContent;\n    const nativeOption = React4.useMemo(\n      () => (0, import_jsx_runtime3.jsx)(\"option\", { value: itemContext.value, disabled: itemContext.disabled, children: textContent }, itemContext.value),\n      [itemContext.disabled, itemContext.value, textContent]\n    );\n    const { onNativeOptionAdd, onNativeOptionRemove } = nativeOptionsContext;\n    useLayoutEffect2(() => {\n      onNativeOptionAdd(nativeOption);\n      return () => onNativeOptionRemove(nativeOption);\n    }, [onNativeOptionAdd, onNativeOptionRemove, nativeOption]);\n    return (0, import_jsx_runtime3.jsxs)(import_jsx_runtime3.Fragment, { children: [\n      (0, import_jsx_runtime3.jsx)(Primitive.span, { id: itemContext.textId, ...itemTextProps, ref: composedRefs }),\n      itemContext.isSelected && context.valueNode && !context.valueNodeHasChildren ? ReactDOM.createPortal(itemTextProps.children, context.valueNode) : null\n    ] });\n  }\n);\nSelectItemText.displayName = ITEM_TEXT_NAME;\nvar ITEM_INDICATOR_NAME = \"SelectItemIndicator\";\nvar SelectItemIndicator = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, ...itemIndicatorProps } = props;\n    const itemContext = useSelectItemContext(ITEM_INDICATOR_NAME, __scopeSelect);\n    return itemContext.isSelected ? (0, import_jsx_runtime3.jsx)(Primitive.span, { \"aria-hidden\": true, ...itemIndicatorProps, ref: forwardedRef }) : null;\n  }\n);\nSelectItemIndicator.displayName = ITEM_INDICATOR_NAME;\nvar SCROLL_UP_BUTTON_NAME = \"SelectScrollUpButton\";\nvar SelectScrollUpButton = React4.forwardRef((props, forwardedRef) => {\n  const contentContext = useSelectContentContext(SCROLL_UP_BUTTON_NAME, props.__scopeSelect);\n  const viewportContext = useSelectViewportContext(SCROLL_UP_BUTTON_NAME, props.__scopeSelect);\n  const [canScrollUp, setCanScrollUp] = React4.useState(false);\n  const composedRefs = useComposedRefs(forwardedRef, viewportContext.onScrollButtonChange);\n  useLayoutEffect2(() => {\n    if (contentContext.viewport && contentContext.isPositioned) {\n      let handleScroll2 = function() {\n        const canScrollUp2 = viewport.scrollTop > 0;\n        setCanScrollUp(canScrollUp2);\n      };\n      var handleScroll = handleScroll2;\n      const viewport = contentContext.viewport;\n      handleScroll2();\n      viewport.addEventListener(\"scroll\", handleScroll2);\n      return () => viewport.removeEventListener(\"scroll\", handleScroll2);\n    }\n  }, [contentContext.viewport, contentContext.isPositioned]);\n  return canScrollUp ? (0, import_jsx_runtime3.jsx)(\n    SelectScrollButtonImpl,\n    {\n      ...props,\n      ref: composedRefs,\n      onAutoScroll: () => {\n        const { viewport, selectedItem } = contentContext;\n        if (viewport && selectedItem) {\n          viewport.scrollTop = viewport.scrollTop - selectedItem.offsetHeight;\n        }\n      }\n    }\n  ) : null;\n});\nSelectScrollUpButton.displayName = SCROLL_UP_BUTTON_NAME;\nvar SCROLL_DOWN_BUTTON_NAME = \"SelectScrollDownButton\";\nvar SelectScrollDownButton = React4.forwardRef((props, forwardedRef) => {\n  const contentContext = useSelectContentContext(SCROLL_DOWN_BUTTON_NAME, props.__scopeSelect);\n  const viewportContext = useSelectViewportContext(SCROLL_DOWN_BUTTON_NAME, props.__scopeSelect);\n  const [canScrollDown, setCanScrollDown] = React4.useState(false);\n  const composedRefs = useComposedRefs(forwardedRef, viewportContext.onScrollButtonChange);\n  useLayoutEffect2(() => {\n    if (contentContext.viewport && contentContext.isPositioned) {\n      let handleScroll2 = function() {\n        const maxScroll = viewport.scrollHeight - viewport.clientHeight;\n        const canScrollDown2 = Math.ceil(viewport.scrollTop) < maxScroll;\n        setCanScrollDown(canScrollDown2);\n      };\n      var handleScroll = handleScroll2;\n      const viewport = contentContext.viewport;\n      handleScroll2();\n      viewport.addEventListener(\"scroll\", handleScroll2);\n      return () => viewport.removeEventListener(\"scroll\", handleScroll2);\n    }\n  }, [contentContext.viewport, contentContext.isPositioned]);\n  return canScrollDown ? (0, import_jsx_runtime3.jsx)(\n    SelectScrollButtonImpl,\n    {\n      ...props,\n      ref: composedRefs,\n      onAutoScroll: () => {\n        const { viewport, selectedItem } = contentContext;\n        if (viewport && selectedItem) {\n          viewport.scrollTop = viewport.scrollTop + selectedItem.offsetHeight;\n        }\n      }\n    }\n  ) : null;\n});\nSelectScrollDownButton.displayName = SCROLL_DOWN_BUTTON_NAME;\nvar SelectScrollButtonImpl = React4.forwardRef((props, forwardedRef) => {\n  const { __scopeSelect, onAutoScroll, ...scrollIndicatorProps } = props;\n  const contentContext = useSelectContentContext(\"SelectScrollButton\", __scopeSelect);\n  const autoScrollTimerRef = React4.useRef(null);\n  const getItems = useCollection(__scopeSelect);\n  const clearAutoScrollTimer = React4.useCallback(() => {\n    if (autoScrollTimerRef.current !== null) {\n      window.clearInterval(autoScrollTimerRef.current);\n      autoScrollTimerRef.current = null;\n    }\n  }, []);\n  React4.useEffect(() => {\n    return () => clearAutoScrollTimer();\n  }, [clearAutoScrollTimer]);\n  useLayoutEffect2(() => {\n    const activeItem = getItems().find((item) => item.ref.current === document.activeElement);\n    activeItem?.ref.current?.scrollIntoView({ block: \"nearest\" });\n  }, [getItems]);\n  return (0, import_jsx_runtime3.jsx)(\n    Primitive.div,\n    {\n      \"aria-hidden\": true,\n      ...scrollIndicatorProps,\n      ref: forwardedRef,\n      style: { flexShrink: 0, ...scrollIndicatorProps.style },\n      onPointerDown: composeEventHandlers(scrollIndicatorProps.onPointerDown, () => {\n        if (autoScrollTimerRef.current === null) {\n          autoScrollTimerRef.current = window.setInterval(onAutoScroll, 50);\n        }\n      }),\n      onPointerMove: composeEventHandlers(scrollIndicatorProps.onPointerMove, () => {\n        contentContext.onItemLeave?.();\n        if (autoScrollTimerRef.current === null) {\n          autoScrollTimerRef.current = window.setInterval(onAutoScroll, 50);\n        }\n      }),\n      onPointerLeave: composeEventHandlers(scrollIndicatorProps.onPointerLeave, () => {\n        clearAutoScrollTimer();\n      })\n    }\n  );\n});\nvar SEPARATOR_NAME = \"SelectSeparator\";\nvar SelectSeparator = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, ...separatorProps } = props;\n    return (0, import_jsx_runtime3.jsx)(Primitive.div, { \"aria-hidden\": true, ...separatorProps, ref: forwardedRef });\n  }\n);\nSelectSeparator.displayName = SEPARATOR_NAME;\nvar ARROW_NAME = \"SelectArrow\";\nvar SelectArrow = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSelect, ...arrowProps } = props;\n    const popperScope = usePopperScope(__scopeSelect);\n    const context = useSelectContext(ARROW_NAME, __scopeSelect);\n    const contentContext = useSelectContentContext(ARROW_NAME, __scopeSelect);\n    return context.open && contentContext.position === \"popper\" ? (0, import_jsx_runtime3.jsx)(Arrow, { ...popperScope, ...arrowProps, ref: forwardedRef }) : null;\n  }\n);\nSelectArrow.displayName = ARROW_NAME;\nvar BUBBLE_INPUT_NAME = \"SelectBubbleInput\";\nvar SelectBubbleInput = React4.forwardRef(\n  ({ __scopeSelect, value, ...props }, forwardedRef) => {\n    const ref = React4.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    const prevValue = usePrevious(value);\n    React4.useEffect(() => {\n      const select = ref.current;\n      if (!select) return;\n      const selectProto = window.HTMLSelectElement.prototype;\n      const descriptor = Object.getOwnPropertyDescriptor(\n        selectProto,\n        \"value\"\n      );\n      const setValue = descriptor.set;\n      if (prevValue !== value && setValue) {\n        const event = new Event(\"change\", { bubbles: true });\n        setValue.call(select, value);\n        select.dispatchEvent(event);\n      }\n    }, [prevValue, value]);\n    return (0, import_jsx_runtime3.jsx)(\n      Primitive.select,\n      {\n        ...props,\n        style: { ...VISUALLY_HIDDEN_STYLES, ...props.style },\n        ref: composedRefs,\n        defaultValue: value\n      }\n    );\n  }\n);\nSelectBubbleInput.displayName = BUBBLE_INPUT_NAME;\nfunction shouldShowPlaceholder(value) {\n  return value === \"\" || value === void 0;\n}\nfunction useTypeaheadSearch(onSearchChange) {\n  const handleSearchChange = useCallbackRef(onSearchChange);\n  const searchRef = React4.useRef(\"\");\n  const timerRef = React4.useRef(0);\n  const handleTypeaheadSearch = React4.useCallback(\n    (key) => {\n      const search = searchRef.current + key;\n      handleSearchChange(search);\n      (function updateSearch(value) {\n        searchRef.current = value;\n        window.clearTimeout(timerRef.current);\n        if (value !== \"\") timerRef.current = window.setTimeout(() => updateSearch(\"\"), 1e3);\n      })(search);\n    },\n    [handleSearchChange]\n  );\n  const resetTypeahead = React4.useCallback(() => {\n    searchRef.current = \"\";\n    window.clearTimeout(timerRef.current);\n  }, []);\n  React4.useEffect(() => {\n    return () => window.clearTimeout(timerRef.current);\n  }, []);\n  return [searchRef, handleTypeaheadSearch, resetTypeahead];\n}\nfunction findNextItem(items, search, currentItem) {\n  const isRepeated = search.length > 1 && Array.from(search).every((char) => char === search[0]);\n  const normalizedSearch = isRepeated ? search[0] : search;\n  const currentItemIndex = currentItem ? items.indexOf(currentItem) : -1;\n  let wrappedItems = wrapArray(items, Math.max(currentItemIndex, 0));\n  const excludeCurrentItem = normalizedSearch.length === 1;\n  if (excludeCurrentItem) wrappedItems = wrappedItems.filter((v) => v !== currentItem);\n  const nextItem = wrappedItems.find(\n    (item) => item.textValue.toLowerCase().startsWith(normalizedSearch.toLowerCase())\n  );\n  return nextItem !== currentItem ? nextItem : void 0;\n}\nfunction wrapArray(array, startIndex) {\n  return array.map((_, index) => array[(startIndex + index) % array.length]);\n}\nvar Root22 = Select;\nvar Trigger = SelectTrigger;\nvar Value = SelectValue;\nvar Icon = SelectIcon;\nvar Portal2 = SelectPortal;\nvar Content2 = SelectContent;\nvar Viewport = SelectViewport;\nvar Group = SelectGroup;\nvar Label = SelectLabel;\nvar Item = SelectItem;\nvar ItemText = SelectItemText;\nvar ItemIndicator = SelectItemIndicator;\nvar ScrollUpButton = SelectScrollUpButton;\nvar ScrollDownButton = SelectScrollDownButton;\nvar Separator = SelectSeparator;\nvar Arrow2 = SelectArrow;\nexport {\n  Arrow2 as Arrow,\n  Content2 as Content,\n  Group,\n  Icon,\n  Item,\n  ItemIndicator,\n  ItemText,\n  Label,\n  Portal2 as Portal,\n  Root22 as Root,\n  ScrollDownButton,\n  ScrollUpButton,\n  Select,\n  SelectArrow,\n  SelectContent,\n  SelectGroup,\n  SelectIcon,\n  SelectItem,\n  SelectItemIndicator,\n  SelectItemText,\n  SelectLabel,\n  SelectPortal,\n  SelectScrollDownButton,\n  SelectScrollUpButton,\n  SelectSeparator,\n  SelectTrigger,\n  SelectValue,\n  SelectViewport,\n  Separator,\n  Trigger,\n  Value,\n  Viewport,\n  createSelectScope\n};\n//# sourceMappingURL=@radix-ui_react-select.js.map\n","path":null,"size_bytes":57509,"size_tokens":null},"node_modules/.vite/deps/@radix-ui_react-dropdown-menu.js":{"content":"\"use client\";\nimport {\n  Anchor,\n  Arrow,\n  Content,\n  Root2,\n  createPopperScope\n} from \"./chunk-E7BRGGVV.js\";\nimport \"./chunk-JTRY5A5K.js\";\nimport {\n  Item,\n  Root,\n  createRovingFocusGroupScope\n} from \"./chunk-5333UELP.js\";\nimport {\n  createCollection,\n  useDirection\n} from \"./chunk-NSDROFPJ.js\";\nimport {\n  Combination_default,\n  DismissableLayer,\n  FocusScope,\n  Portal,\n  hideOthers,\n  useFocusGuards\n} from \"./chunk-R3YZKR5V.js\";\nimport \"./chunk-734E7IPH.js\";\nimport {\n  useCallbackRef\n} from \"./chunk-QANW4NWU.js\";\nimport {\n  Presence\n} from \"./chunk-5FCDBCET.js\";\nimport {\n  useId\n} from \"./chunk-JB42X4KE.js\";\nimport {\n  Primitive,\n  dispatchDiscreteCustomEvent\n} from \"./chunk-YRTNRKIT.js\";\nimport {\n  createContextScope,\n  useLayoutEffect2\n} from \"./chunk-6KE3XZZ5.js\";\nimport {\n  composeRefs,\n  useComposedRefs\n} from \"./chunk-WGRQAFEQ.js\";\nimport {\n  require_jsx_runtime\n} from \"./chunk-FXVZLN7E.js\";\nimport \"./chunk-F5X6INBZ.js\";\nimport {\n  require_react\n} from \"./chunk-KMU3Z7QX.js\";\nimport {\n  __toESM\n} from \"./chunk-G3PMV62Z.js\";\n\n// node_modules/@radix-ui/react-dropdown-menu/dist/index.mjs\nvar React5 = __toESM(require_react(), 1);\n\n// node_modules/@radix-ui/react-dropdown-menu/node_modules/@radix-ui/primitive/dist/index.mjs\nvar canUseDOM = !!(typeof window !== \"undefined\" && window.document && window.document.createElement);\nfunction composeEventHandlers(originalEventHandler, ourEventHandler, { checkForDefaultPrevented = true } = {}) {\n  return function handleEvent(event) {\n    originalEventHandler?.(event);\n    if (checkForDefaultPrevented === false || !event.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n}\n\n// node_modules/@radix-ui/react-dropdown-menu/node_modules/@radix-ui/react-use-controllable-state/dist/index.mjs\nvar React = __toESM(require_react(), 1);\nvar React2 = __toESM(require_react(), 1);\nvar useInsertionEffect = React[\" useInsertionEffect \".trim().toString()] || useLayoutEffect2;\nfunction useControllableState({\n  prop,\n  defaultProp,\n  onChange = () => {\n  },\n  caller\n}) {\n  const [uncontrolledProp, setUncontrolledProp, onChangeRef] = useUncontrolledState({\n    defaultProp,\n    onChange\n  });\n  const isControlled = prop !== void 0;\n  const value = isControlled ? prop : uncontrolledProp;\n  if (true) {\n    const isControlledRef = React.useRef(prop !== void 0);\n    React.useEffect(() => {\n      const wasControlled = isControlledRef.current;\n      if (wasControlled !== isControlled) {\n        const from = wasControlled ? \"controlled\" : \"uncontrolled\";\n        const to = isControlled ? \"controlled\" : \"uncontrolled\";\n        console.warn(\n          `${caller} is changing from ${from} to ${to}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`\n        );\n      }\n      isControlledRef.current = isControlled;\n    }, [isControlled, caller]);\n  }\n  const setValue = React.useCallback(\n    (nextValue) => {\n      if (isControlled) {\n        const value2 = isFunction(nextValue) ? nextValue(prop) : nextValue;\n        if (value2 !== prop) {\n          onChangeRef.current?.(value2);\n        }\n      } else {\n        setUncontrolledProp(nextValue);\n      }\n    },\n    [isControlled, prop, setUncontrolledProp, onChangeRef]\n  );\n  return [value, setValue];\n}\nfunction useUncontrolledState({\n  defaultProp,\n  onChange\n}) {\n  const [value, setValue] = React.useState(defaultProp);\n  const prevValueRef = React.useRef(value);\n  const onChangeRef = React.useRef(onChange);\n  useInsertionEffect(() => {\n    onChangeRef.current = onChange;\n  }, [onChange]);\n  React.useEffect(() => {\n    if (prevValueRef.current !== value) {\n      onChangeRef.current?.(value);\n      prevValueRef.current = value;\n    }\n  }, [value, prevValueRef]);\n  return [value, setValue, onChangeRef];\n}\nfunction isFunction(value) {\n  return typeof value === \"function\";\n}\nvar SYNC_STATE = Symbol(\"RADIX:SYNC_STATE\");\n\n// node_modules/@radix-ui/react-menu/dist/index.mjs\nvar React4 = __toESM(require_react(), 1);\n\n// node_modules/@radix-ui/react-menu/node_modules/@radix-ui/primitive/dist/index.mjs\nvar canUseDOM2 = !!(typeof window !== \"undefined\" && window.document && window.document.createElement);\nfunction composeEventHandlers2(originalEventHandler, ourEventHandler, { checkForDefaultPrevented = true } = {}) {\n  return function handleEvent(event) {\n    originalEventHandler?.(event);\n    if (checkForDefaultPrevented === false || !event.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n}\n\n// node_modules/@radix-ui/react-menu/node_modules/@radix-ui/react-slot/dist/index.mjs\nvar React3 = __toESM(require_react(), 1);\nvar import_jsx_runtime = __toESM(require_jsx_runtime(), 1);\nfunction createSlot(ownerName) {\n  const SlotClone = createSlotClone(ownerName);\n  const Slot22 = React3.forwardRef((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n    const childrenArray = React3.Children.toArray(children);\n    const slottable = childrenArray.find(isSlottable);\n    if (slottable) {\n      const newElement = slottable.props.children;\n      const newChildren = childrenArray.map((child) => {\n        if (child === slottable) {\n          if (React3.Children.count(newElement) > 1) return React3.Children.only(null);\n          return React3.isValidElement(newElement) ? newElement.props.children : null;\n        } else {\n          return child;\n        }\n      });\n      return (0, import_jsx_runtime.jsx)(SlotClone, { ...slotProps, ref: forwardedRef, children: React3.isValidElement(newElement) ? React3.cloneElement(newElement, void 0, newChildren) : null });\n    }\n    return (0, import_jsx_runtime.jsx)(SlotClone, { ...slotProps, ref: forwardedRef, children });\n  });\n  Slot22.displayName = `${ownerName}.Slot`;\n  return Slot22;\n}\nvar Slot = createSlot(\"Slot\");\nfunction createSlotClone(ownerName) {\n  const SlotClone = React3.forwardRef((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n    if (React3.isValidElement(children)) {\n      const childrenRef = getElementRef(children);\n      const props2 = mergeProps(slotProps, children.props);\n      if (children.type !== React3.Fragment) {\n        props2.ref = forwardedRef ? composeRefs(forwardedRef, childrenRef) : childrenRef;\n      }\n      return React3.cloneElement(children, props2);\n    }\n    return React3.Children.count(children) > 1 ? React3.Children.only(null) : null;\n  });\n  SlotClone.displayName = `${ownerName}.SlotClone`;\n  return SlotClone;\n}\nvar SLOTTABLE_IDENTIFIER = Symbol(\"radix.slottable\");\nfunction createSlottable(ownerName) {\n  const Slottable2 = ({ children }) => {\n    return (0, import_jsx_runtime.jsx)(import_jsx_runtime.Fragment, { children });\n  };\n  Slottable2.displayName = `${ownerName}.Slottable`;\n  Slottable2.__radixId = SLOTTABLE_IDENTIFIER;\n  return Slottable2;\n}\nvar Slottable = createSlottable(\"Slottable\");\nfunction isSlottable(child) {\n  return React3.isValidElement(child) && typeof child.type === \"function\" && \"__radixId\" in child.type && child.type.__radixId === SLOTTABLE_IDENTIFIER;\n}\nfunction mergeProps(slotProps, childProps) {\n  const overrideProps = { ...childProps };\n  for (const propName in childProps) {\n    const slotPropValue = slotProps[propName];\n    const childPropValue = childProps[propName];\n    const isHandler = /^on[A-Z]/.test(propName);\n    if (isHandler) {\n      if (slotPropValue && childPropValue) {\n        overrideProps[propName] = (...args) => {\n          const result = childPropValue(...args);\n          slotPropValue(...args);\n          return result;\n        };\n      } else if (slotPropValue) {\n        overrideProps[propName] = slotPropValue;\n      }\n    } else if (propName === \"style\") {\n      overrideProps[propName] = { ...slotPropValue, ...childPropValue };\n    } else if (propName === \"className\") {\n      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(\" \");\n    }\n  }\n  return { ...slotProps, ...overrideProps };\n}\nfunction getElementRef(element) {\n  let getter = Object.getOwnPropertyDescriptor(element.props, \"ref\")?.get;\n  let mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.ref;\n  }\n  getter = Object.getOwnPropertyDescriptor(element, \"ref\")?.get;\n  mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.props.ref;\n  }\n  return element.props.ref || element.ref;\n}\n\n// node_modules/@radix-ui/react-menu/dist/index.mjs\nvar import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);\nvar SELECTION_KEYS = [\"Enter\", \" \"];\nvar FIRST_KEYS = [\"ArrowDown\", \"PageUp\", \"Home\"];\nvar LAST_KEYS = [\"ArrowUp\", \"PageDown\", \"End\"];\nvar FIRST_LAST_KEYS = [...FIRST_KEYS, ...LAST_KEYS];\nvar SUB_OPEN_KEYS = {\n  ltr: [...SELECTION_KEYS, \"ArrowRight\"],\n  rtl: [...SELECTION_KEYS, \"ArrowLeft\"]\n};\nvar SUB_CLOSE_KEYS = {\n  ltr: [\"ArrowLeft\"],\n  rtl: [\"ArrowRight\"]\n};\nvar MENU_NAME = \"Menu\";\nvar [Collection, useCollection, createCollectionScope] = createCollection(MENU_NAME);\nvar [createMenuContext, createMenuScope] = createContextScope(MENU_NAME, [\n  createCollectionScope,\n  createPopperScope,\n  createRovingFocusGroupScope\n]);\nvar usePopperScope = createPopperScope();\nvar useRovingFocusGroupScope = createRovingFocusGroupScope();\nvar [MenuProvider, useMenuContext] = createMenuContext(MENU_NAME);\nvar [MenuRootProvider, useMenuRootContext] = createMenuContext(MENU_NAME);\nvar Menu = (props) => {\n  const { __scopeMenu, open = false, children, dir, onOpenChange, modal = true } = props;\n  const popperScope = usePopperScope(__scopeMenu);\n  const [content, setContent] = React4.useState(null);\n  const isUsingKeyboardRef = React4.useRef(false);\n  const handleOpenChange = useCallbackRef(onOpenChange);\n  const direction = useDirection(dir);\n  React4.useEffect(() => {\n    const handleKeyDown = () => {\n      isUsingKeyboardRef.current = true;\n      document.addEventListener(\"pointerdown\", handlePointer, { capture: true, once: true });\n      document.addEventListener(\"pointermove\", handlePointer, { capture: true, once: true });\n    };\n    const handlePointer = () => isUsingKeyboardRef.current = false;\n    document.addEventListener(\"keydown\", handleKeyDown, { capture: true });\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyDown, { capture: true });\n      document.removeEventListener(\"pointerdown\", handlePointer, { capture: true });\n      document.removeEventListener(\"pointermove\", handlePointer, { capture: true });\n    };\n  }, []);\n  return (0, import_jsx_runtime2.jsx)(Root2, { ...popperScope, children: (0, import_jsx_runtime2.jsx)(\n    MenuProvider,\n    {\n      scope: __scopeMenu,\n      open,\n      onOpenChange: handleOpenChange,\n      content,\n      onContentChange: setContent,\n      children: (0, import_jsx_runtime2.jsx)(\n        MenuRootProvider,\n        {\n          scope: __scopeMenu,\n          onClose: React4.useCallback(() => handleOpenChange(false), [handleOpenChange]),\n          isUsingKeyboardRef,\n          dir: direction,\n          modal,\n          children\n        }\n      )\n    }\n  ) });\n};\nMenu.displayName = MENU_NAME;\nvar ANCHOR_NAME = \"MenuAnchor\";\nvar MenuAnchor = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenu, ...anchorProps } = props;\n    const popperScope = usePopperScope(__scopeMenu);\n    return (0, import_jsx_runtime2.jsx)(Anchor, { ...popperScope, ...anchorProps, ref: forwardedRef });\n  }\n);\nMenuAnchor.displayName = ANCHOR_NAME;\nvar PORTAL_NAME = \"MenuPortal\";\nvar [PortalProvider, usePortalContext] = createMenuContext(PORTAL_NAME, {\n  forceMount: void 0\n});\nvar MenuPortal = (props) => {\n  const { __scopeMenu, forceMount, children, container } = props;\n  const context = useMenuContext(PORTAL_NAME, __scopeMenu);\n  return (0, import_jsx_runtime2.jsx)(PortalProvider, { scope: __scopeMenu, forceMount, children: (0, import_jsx_runtime2.jsx)(Presence, { present: forceMount || context.open, children: (0, import_jsx_runtime2.jsx)(Portal, { asChild: true, container, children }) }) });\n};\nMenuPortal.displayName = PORTAL_NAME;\nvar CONTENT_NAME = \"MenuContent\";\nvar [MenuContentProvider, useMenuContentContext] = createMenuContext(CONTENT_NAME);\nvar MenuContent = React4.forwardRef(\n  (props, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopeMenu);\n    const { forceMount = portalContext.forceMount, ...contentProps } = props;\n    const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n    const rootContext = useMenuRootContext(CONTENT_NAME, props.__scopeMenu);\n    return (0, import_jsx_runtime2.jsx)(Collection.Provider, { scope: props.__scopeMenu, children: (0, import_jsx_runtime2.jsx)(Presence, { present: forceMount || context.open, children: (0, import_jsx_runtime2.jsx)(Collection.Slot, { scope: props.__scopeMenu, children: rootContext.modal ? (0, import_jsx_runtime2.jsx)(MenuRootContentModal, { ...contentProps, ref: forwardedRef }) : (0, import_jsx_runtime2.jsx)(MenuRootContentNonModal, { ...contentProps, ref: forwardedRef }) }) }) });\n  }\n);\nvar MenuRootContentModal = React4.forwardRef(\n  (props, forwardedRef) => {\n    const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n    const ref = React4.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    React4.useEffect(() => {\n      const content = ref.current;\n      if (content) return hideOthers(content);\n    }, []);\n    return (0, import_jsx_runtime2.jsx)(\n      MenuContentImpl,\n      {\n        ...props,\n        ref: composedRefs,\n        trapFocus: context.open,\n        disableOutsidePointerEvents: context.open,\n        disableOutsideScroll: true,\n        onFocusOutside: composeEventHandlers2(\n          props.onFocusOutside,\n          (event) => event.preventDefault(),\n          { checkForDefaultPrevented: false }\n        ),\n        onDismiss: () => context.onOpenChange(false)\n      }\n    );\n  }\n);\nvar MenuRootContentNonModal = React4.forwardRef((props, forwardedRef) => {\n  const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n  return (0, import_jsx_runtime2.jsx)(\n    MenuContentImpl,\n    {\n      ...props,\n      ref: forwardedRef,\n      trapFocus: false,\n      disableOutsidePointerEvents: false,\n      disableOutsideScroll: false,\n      onDismiss: () => context.onOpenChange(false)\n    }\n  );\n});\nvar Slot2 = createSlot(\"MenuContent.ScrollLock\");\nvar MenuContentImpl = React4.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeMenu,\n      loop = false,\n      trapFocus,\n      onOpenAutoFocus,\n      onCloseAutoFocus,\n      disableOutsidePointerEvents,\n      onEntryFocus,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      onFocusOutside,\n      onInteractOutside,\n      onDismiss,\n      disableOutsideScroll,\n      ...contentProps\n    } = props;\n    const context = useMenuContext(CONTENT_NAME, __scopeMenu);\n    const rootContext = useMenuRootContext(CONTENT_NAME, __scopeMenu);\n    const popperScope = usePopperScope(__scopeMenu);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenu);\n    const getItems = useCollection(__scopeMenu);\n    const [currentItemId, setCurrentItemId] = React4.useState(null);\n    const contentRef = React4.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef, context.onContentChange);\n    const timerRef = React4.useRef(0);\n    const searchRef = React4.useRef(\"\");\n    const pointerGraceTimerRef = React4.useRef(0);\n    const pointerGraceIntentRef = React4.useRef(null);\n    const pointerDirRef = React4.useRef(\"right\");\n    const lastPointerXRef = React4.useRef(0);\n    const ScrollLockWrapper = disableOutsideScroll ? Combination_default : React4.Fragment;\n    const scrollLockWrapperProps = disableOutsideScroll ? { as: Slot2, allowPinchZoom: true } : void 0;\n    const handleTypeaheadSearch = (key) => {\n      const search = searchRef.current + key;\n      const items = getItems().filter((item) => !item.disabled);\n      const currentItem = document.activeElement;\n      const currentMatch = items.find((item) => item.ref.current === currentItem)?.textValue;\n      const values = items.map((item) => item.textValue);\n      const nextMatch = getNextMatch(values, search, currentMatch);\n      const newItem = items.find((item) => item.textValue === nextMatch)?.ref.current;\n      (function updateSearch(value) {\n        searchRef.current = value;\n        window.clearTimeout(timerRef.current);\n        if (value !== \"\") timerRef.current = window.setTimeout(() => updateSearch(\"\"), 1e3);\n      })(search);\n      if (newItem) {\n        setTimeout(() => newItem.focus());\n      }\n    };\n    React4.useEffect(() => {\n      return () => window.clearTimeout(timerRef.current);\n    }, []);\n    useFocusGuards();\n    const isPointerMovingToSubmenu = React4.useCallback((event) => {\n      const isMovingTowards = pointerDirRef.current === pointerGraceIntentRef.current?.side;\n      return isMovingTowards && isPointerInGraceArea(event, pointerGraceIntentRef.current?.area);\n    }, []);\n    return (0, import_jsx_runtime2.jsx)(\n      MenuContentProvider,\n      {\n        scope: __scopeMenu,\n        searchRef,\n        onItemEnter: React4.useCallback(\n          (event) => {\n            if (isPointerMovingToSubmenu(event)) event.preventDefault();\n          },\n          [isPointerMovingToSubmenu]\n        ),\n        onItemLeave: React4.useCallback(\n          (event) => {\n            if (isPointerMovingToSubmenu(event)) return;\n            contentRef.current?.focus();\n            setCurrentItemId(null);\n          },\n          [isPointerMovingToSubmenu]\n        ),\n        onTriggerLeave: React4.useCallback(\n          (event) => {\n            if (isPointerMovingToSubmenu(event)) event.preventDefault();\n          },\n          [isPointerMovingToSubmenu]\n        ),\n        pointerGraceTimerRef,\n        onPointerGraceIntentChange: React4.useCallback((intent) => {\n          pointerGraceIntentRef.current = intent;\n        }, []),\n        children: (0, import_jsx_runtime2.jsx)(ScrollLockWrapper, { ...scrollLockWrapperProps, children: (0, import_jsx_runtime2.jsx)(\n          FocusScope,\n          {\n            asChild: true,\n            trapped: trapFocus,\n            onMountAutoFocus: composeEventHandlers2(onOpenAutoFocus, (event) => {\n              event.preventDefault();\n              contentRef.current?.focus({ preventScroll: true });\n            }),\n            onUnmountAutoFocus: onCloseAutoFocus,\n            children: (0, import_jsx_runtime2.jsx)(\n              DismissableLayer,\n              {\n                asChild: true,\n                disableOutsidePointerEvents,\n                onEscapeKeyDown,\n                onPointerDownOutside,\n                onFocusOutside,\n                onInteractOutside,\n                onDismiss,\n                children: (0, import_jsx_runtime2.jsx)(\n                  Root,\n                  {\n                    asChild: true,\n                    ...rovingFocusGroupScope,\n                    dir: rootContext.dir,\n                    orientation: \"vertical\",\n                    loop,\n                    currentTabStopId: currentItemId,\n                    onCurrentTabStopIdChange: setCurrentItemId,\n                    onEntryFocus: composeEventHandlers2(onEntryFocus, (event) => {\n                      if (!rootContext.isUsingKeyboardRef.current) event.preventDefault();\n                    }),\n                    preventScrollOnEntryFocus: true,\n                    children: (0, import_jsx_runtime2.jsx)(\n                      Content,\n                      {\n                        role: \"menu\",\n                        \"aria-orientation\": \"vertical\",\n                        \"data-state\": getOpenState(context.open),\n                        \"data-radix-menu-content\": \"\",\n                        dir: rootContext.dir,\n                        ...popperScope,\n                        ...contentProps,\n                        ref: composedRefs,\n                        style: { outline: \"none\", ...contentProps.style },\n                        onKeyDown: composeEventHandlers2(contentProps.onKeyDown, (event) => {\n                          const target = event.target;\n                          const isKeyDownInside = target.closest(\"[data-radix-menu-content]\") === event.currentTarget;\n                          const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;\n                          const isCharacterKey = event.key.length === 1;\n                          if (isKeyDownInside) {\n                            if (event.key === \"Tab\") event.preventDefault();\n                            if (!isModifierKey && isCharacterKey) handleTypeaheadSearch(event.key);\n                          }\n                          const content = contentRef.current;\n                          if (event.target !== content) return;\n                          if (!FIRST_LAST_KEYS.includes(event.key)) return;\n                          event.preventDefault();\n                          const items = getItems().filter((item) => !item.disabled);\n                          const candidateNodes = items.map((item) => item.ref.current);\n                          if (LAST_KEYS.includes(event.key)) candidateNodes.reverse();\n                          focusFirst(candidateNodes);\n                        }),\n                        onBlur: composeEventHandlers2(props.onBlur, (event) => {\n                          if (!event.currentTarget.contains(event.target)) {\n                            window.clearTimeout(timerRef.current);\n                            searchRef.current = \"\";\n                          }\n                        }),\n                        onPointerMove: composeEventHandlers2(\n                          props.onPointerMove,\n                          whenMouse((event) => {\n                            const target = event.target;\n                            const pointerXHasChanged = lastPointerXRef.current !== event.clientX;\n                            if (event.currentTarget.contains(target) && pointerXHasChanged) {\n                              const newDir = event.clientX > lastPointerXRef.current ? \"right\" : \"left\";\n                              pointerDirRef.current = newDir;\n                              lastPointerXRef.current = event.clientX;\n                            }\n                          })\n                        )\n                      }\n                    )\n                  }\n                )\n              }\n            )\n          }\n        ) })\n      }\n    );\n  }\n);\nMenuContent.displayName = CONTENT_NAME;\nvar GROUP_NAME = \"MenuGroup\";\nvar MenuGroup = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenu, ...groupProps } = props;\n    return (0, import_jsx_runtime2.jsx)(Primitive.div, { role: \"group\", ...groupProps, ref: forwardedRef });\n  }\n);\nMenuGroup.displayName = GROUP_NAME;\nvar LABEL_NAME = \"MenuLabel\";\nvar MenuLabel = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenu, ...labelProps } = props;\n    return (0, import_jsx_runtime2.jsx)(Primitive.div, { ...labelProps, ref: forwardedRef });\n  }\n);\nMenuLabel.displayName = LABEL_NAME;\nvar ITEM_NAME = \"MenuItem\";\nvar ITEM_SELECT = \"menu.itemSelect\";\nvar MenuItem = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { disabled = false, onSelect, ...itemProps } = props;\n    const ref = React4.useRef(null);\n    const rootContext = useMenuRootContext(ITEM_NAME, props.__scopeMenu);\n    const contentContext = useMenuContentContext(ITEM_NAME, props.__scopeMenu);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    const isPointerDownRef = React4.useRef(false);\n    const handleSelect = () => {\n      const menuItem = ref.current;\n      if (!disabled && menuItem) {\n        const itemSelectEvent = new CustomEvent(ITEM_SELECT, { bubbles: true, cancelable: true });\n        menuItem.addEventListener(ITEM_SELECT, (event) => onSelect?.(event), { once: true });\n        dispatchDiscreteCustomEvent(menuItem, itemSelectEvent);\n        if (itemSelectEvent.defaultPrevented) {\n          isPointerDownRef.current = false;\n        } else {\n          rootContext.onClose();\n        }\n      }\n    };\n    return (0, import_jsx_runtime2.jsx)(\n      MenuItemImpl,\n      {\n        ...itemProps,\n        ref: composedRefs,\n        disabled,\n        onClick: composeEventHandlers2(props.onClick, handleSelect),\n        onPointerDown: (event) => {\n          props.onPointerDown?.(event);\n          isPointerDownRef.current = true;\n        },\n        onPointerUp: composeEventHandlers2(props.onPointerUp, (event) => {\n          if (!isPointerDownRef.current) event.currentTarget?.click();\n        }),\n        onKeyDown: composeEventHandlers2(props.onKeyDown, (event) => {\n          const isTypingAhead = contentContext.searchRef.current !== \"\";\n          if (disabled || isTypingAhead && event.key === \" \") return;\n          if (SELECTION_KEYS.includes(event.key)) {\n            event.currentTarget.click();\n            event.preventDefault();\n          }\n        })\n      }\n    );\n  }\n);\nMenuItem.displayName = ITEM_NAME;\nvar MenuItemImpl = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenu, disabled = false, textValue, ...itemProps } = props;\n    const contentContext = useMenuContentContext(ITEM_NAME, __scopeMenu);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenu);\n    const ref = React4.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    const [isFocused, setIsFocused] = React4.useState(false);\n    const [textContent, setTextContent] = React4.useState(\"\");\n    React4.useEffect(() => {\n      const menuItem = ref.current;\n      if (menuItem) {\n        setTextContent((menuItem.textContent ?? \"\").trim());\n      }\n    }, [itemProps.children]);\n    return (0, import_jsx_runtime2.jsx)(\n      Collection.ItemSlot,\n      {\n        scope: __scopeMenu,\n        disabled,\n        textValue: textValue ?? textContent,\n        children: (0, import_jsx_runtime2.jsx)(Item, { asChild: true, ...rovingFocusGroupScope, focusable: !disabled, children: (0, import_jsx_runtime2.jsx)(\n          Primitive.div,\n          {\n            role: \"menuitem\",\n            \"data-highlighted\": isFocused ? \"\" : void 0,\n            \"aria-disabled\": disabled || void 0,\n            \"data-disabled\": disabled ? \"\" : void 0,\n            ...itemProps,\n            ref: composedRefs,\n            onPointerMove: composeEventHandlers2(\n              props.onPointerMove,\n              whenMouse((event) => {\n                if (disabled) {\n                  contentContext.onItemLeave(event);\n                } else {\n                  contentContext.onItemEnter(event);\n                  if (!event.defaultPrevented) {\n                    const item = event.currentTarget;\n                    item.focus({ preventScroll: true });\n                  }\n                }\n              })\n            ),\n            onPointerLeave: composeEventHandlers2(\n              props.onPointerLeave,\n              whenMouse((event) => contentContext.onItemLeave(event))\n            ),\n            onFocus: composeEventHandlers2(props.onFocus, () => setIsFocused(true)),\n            onBlur: composeEventHandlers2(props.onBlur, () => setIsFocused(false))\n          }\n        ) })\n      }\n    );\n  }\n);\nvar CHECKBOX_ITEM_NAME = \"MenuCheckboxItem\";\nvar MenuCheckboxItem = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { checked = false, onCheckedChange, ...checkboxItemProps } = props;\n    return (0, import_jsx_runtime2.jsx)(ItemIndicatorProvider, { scope: props.__scopeMenu, checked, children: (0, import_jsx_runtime2.jsx)(\n      MenuItem,\n      {\n        role: \"menuitemcheckbox\",\n        \"aria-checked\": isIndeterminate(checked) ? \"mixed\" : checked,\n        ...checkboxItemProps,\n        ref: forwardedRef,\n        \"data-state\": getCheckedState(checked),\n        onSelect: composeEventHandlers2(\n          checkboxItemProps.onSelect,\n          () => onCheckedChange?.(isIndeterminate(checked) ? true : !checked),\n          { checkForDefaultPrevented: false }\n        )\n      }\n    ) });\n  }\n);\nMenuCheckboxItem.displayName = CHECKBOX_ITEM_NAME;\nvar RADIO_GROUP_NAME = \"MenuRadioGroup\";\nvar [RadioGroupProvider, useRadioGroupContext] = createMenuContext(\n  RADIO_GROUP_NAME,\n  { value: void 0, onValueChange: () => {\n  } }\n);\nvar MenuRadioGroup = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { value, onValueChange, ...groupProps } = props;\n    const handleValueChange = useCallbackRef(onValueChange);\n    return (0, import_jsx_runtime2.jsx)(RadioGroupProvider, { scope: props.__scopeMenu, value, onValueChange: handleValueChange, children: (0, import_jsx_runtime2.jsx)(MenuGroup, { ...groupProps, ref: forwardedRef }) });\n  }\n);\nMenuRadioGroup.displayName = RADIO_GROUP_NAME;\nvar RADIO_ITEM_NAME = \"MenuRadioItem\";\nvar MenuRadioItem = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { value, ...radioItemProps } = props;\n    const context = useRadioGroupContext(RADIO_ITEM_NAME, props.__scopeMenu);\n    const checked = value === context.value;\n    return (0, import_jsx_runtime2.jsx)(ItemIndicatorProvider, { scope: props.__scopeMenu, checked, children: (0, import_jsx_runtime2.jsx)(\n      MenuItem,\n      {\n        role: \"menuitemradio\",\n        \"aria-checked\": checked,\n        ...radioItemProps,\n        ref: forwardedRef,\n        \"data-state\": getCheckedState(checked),\n        onSelect: composeEventHandlers2(\n          radioItemProps.onSelect,\n          () => context.onValueChange?.(value),\n          { checkForDefaultPrevented: false }\n        )\n      }\n    ) });\n  }\n);\nMenuRadioItem.displayName = RADIO_ITEM_NAME;\nvar ITEM_INDICATOR_NAME = \"MenuItemIndicator\";\nvar [ItemIndicatorProvider, useItemIndicatorContext] = createMenuContext(\n  ITEM_INDICATOR_NAME,\n  { checked: false }\n);\nvar MenuItemIndicator = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenu, forceMount, ...itemIndicatorProps } = props;\n    const indicatorContext = useItemIndicatorContext(ITEM_INDICATOR_NAME, __scopeMenu);\n    return (0, import_jsx_runtime2.jsx)(\n      Presence,\n      {\n        present: forceMount || isIndeterminate(indicatorContext.checked) || indicatorContext.checked === true,\n        children: (0, import_jsx_runtime2.jsx)(\n          Primitive.span,\n          {\n            ...itemIndicatorProps,\n            ref: forwardedRef,\n            \"data-state\": getCheckedState(indicatorContext.checked)\n          }\n        )\n      }\n    );\n  }\n);\nMenuItemIndicator.displayName = ITEM_INDICATOR_NAME;\nvar SEPARATOR_NAME = \"MenuSeparator\";\nvar MenuSeparator = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenu, ...separatorProps } = props;\n    return (0, import_jsx_runtime2.jsx)(\n      Primitive.div,\n      {\n        role: \"separator\",\n        \"aria-orientation\": \"horizontal\",\n        ...separatorProps,\n        ref: forwardedRef\n      }\n    );\n  }\n);\nMenuSeparator.displayName = SEPARATOR_NAME;\nvar ARROW_NAME = \"MenuArrow\";\nvar MenuArrow = React4.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenu, ...arrowProps } = props;\n    const popperScope = usePopperScope(__scopeMenu);\n    return (0, import_jsx_runtime2.jsx)(Arrow, { ...popperScope, ...arrowProps, ref: forwardedRef });\n  }\n);\nMenuArrow.displayName = ARROW_NAME;\nvar SUB_NAME = \"MenuSub\";\nvar [MenuSubProvider, useMenuSubContext] = createMenuContext(SUB_NAME);\nvar MenuSub = (props) => {\n  const { __scopeMenu, children, open = false, onOpenChange } = props;\n  const parentMenuContext = useMenuContext(SUB_NAME, __scopeMenu);\n  const popperScope = usePopperScope(__scopeMenu);\n  const [trigger, setTrigger] = React4.useState(null);\n  const [content, setContent] = React4.useState(null);\n  const handleOpenChange = useCallbackRef(onOpenChange);\n  React4.useEffect(() => {\n    if (parentMenuContext.open === false) handleOpenChange(false);\n    return () => handleOpenChange(false);\n  }, [parentMenuContext.open, handleOpenChange]);\n  return (0, import_jsx_runtime2.jsx)(Root2, { ...popperScope, children: (0, import_jsx_runtime2.jsx)(\n    MenuProvider,\n    {\n      scope: __scopeMenu,\n      open,\n      onOpenChange: handleOpenChange,\n      content,\n      onContentChange: setContent,\n      children: (0, import_jsx_runtime2.jsx)(\n        MenuSubProvider,\n        {\n          scope: __scopeMenu,\n          contentId: useId(),\n          triggerId: useId(),\n          trigger,\n          onTriggerChange: setTrigger,\n          children\n        }\n      )\n    }\n  ) });\n};\nMenuSub.displayName = SUB_NAME;\nvar SUB_TRIGGER_NAME = \"MenuSubTrigger\";\nvar MenuSubTrigger = React4.forwardRef(\n  (props, forwardedRef) => {\n    const context = useMenuContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const rootContext = useMenuRootContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const subContext = useMenuSubContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const contentContext = useMenuContentContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const openTimerRef = React4.useRef(null);\n    const { pointerGraceTimerRef, onPointerGraceIntentChange } = contentContext;\n    const scope = { __scopeMenu: props.__scopeMenu };\n    const clearOpenTimer = React4.useCallback(() => {\n      if (openTimerRef.current) window.clearTimeout(openTimerRef.current);\n      openTimerRef.current = null;\n    }, []);\n    React4.useEffect(() => clearOpenTimer, [clearOpenTimer]);\n    React4.useEffect(() => {\n      const pointerGraceTimer = pointerGraceTimerRef.current;\n      return () => {\n        window.clearTimeout(pointerGraceTimer);\n        onPointerGraceIntentChange(null);\n      };\n    }, [pointerGraceTimerRef, onPointerGraceIntentChange]);\n    return (0, import_jsx_runtime2.jsx)(MenuAnchor, { asChild: true, ...scope, children: (0, import_jsx_runtime2.jsx)(\n      MenuItemImpl,\n      {\n        id: subContext.triggerId,\n        \"aria-haspopup\": \"menu\",\n        \"aria-expanded\": context.open,\n        \"aria-controls\": subContext.contentId,\n        \"data-state\": getOpenState(context.open),\n        ...props,\n        ref: composeRefs(forwardedRef, subContext.onTriggerChange),\n        onClick: (event) => {\n          props.onClick?.(event);\n          if (props.disabled || event.defaultPrevented) return;\n          event.currentTarget.focus();\n          if (!context.open) context.onOpenChange(true);\n        },\n        onPointerMove: composeEventHandlers2(\n          props.onPointerMove,\n          whenMouse((event) => {\n            contentContext.onItemEnter(event);\n            if (event.defaultPrevented) return;\n            if (!props.disabled && !context.open && !openTimerRef.current) {\n              contentContext.onPointerGraceIntentChange(null);\n              openTimerRef.current = window.setTimeout(() => {\n                context.onOpenChange(true);\n                clearOpenTimer();\n              }, 100);\n            }\n          })\n        ),\n        onPointerLeave: composeEventHandlers2(\n          props.onPointerLeave,\n          whenMouse((event) => {\n            clearOpenTimer();\n            const contentRect = context.content?.getBoundingClientRect();\n            if (contentRect) {\n              const side = context.content?.dataset.side;\n              const rightSide = side === \"right\";\n              const bleed = rightSide ? -5 : 5;\n              const contentNearEdge = contentRect[rightSide ? \"left\" : \"right\"];\n              const contentFarEdge = contentRect[rightSide ? \"right\" : \"left\"];\n              contentContext.onPointerGraceIntentChange({\n                area: [\n                  // Apply a bleed on clientX to ensure that our exit point is\n                  // consistently within polygon bounds\n                  { x: event.clientX + bleed, y: event.clientY },\n                  { x: contentNearEdge, y: contentRect.top },\n                  { x: contentFarEdge, y: contentRect.top },\n                  { x: contentFarEdge, y: contentRect.bottom },\n                  { x: contentNearEdge, y: contentRect.bottom }\n                ],\n                side\n              });\n              window.clearTimeout(pointerGraceTimerRef.current);\n              pointerGraceTimerRef.current = window.setTimeout(\n                () => contentContext.onPointerGraceIntentChange(null),\n                300\n              );\n            } else {\n              contentContext.onTriggerLeave(event);\n              if (event.defaultPrevented) return;\n              contentContext.onPointerGraceIntentChange(null);\n            }\n          })\n        ),\n        onKeyDown: composeEventHandlers2(props.onKeyDown, (event) => {\n          const isTypingAhead = contentContext.searchRef.current !== \"\";\n          if (props.disabled || isTypingAhead && event.key === \" \") return;\n          if (SUB_OPEN_KEYS[rootContext.dir].includes(event.key)) {\n            context.onOpenChange(true);\n            context.content?.focus();\n            event.preventDefault();\n          }\n        })\n      }\n    ) });\n  }\n);\nMenuSubTrigger.displayName = SUB_TRIGGER_NAME;\nvar SUB_CONTENT_NAME = \"MenuSubContent\";\nvar MenuSubContent = React4.forwardRef(\n  (props, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopeMenu);\n    const { forceMount = portalContext.forceMount, ...subContentProps } = props;\n    const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n    const rootContext = useMenuRootContext(CONTENT_NAME, props.__scopeMenu);\n    const subContext = useMenuSubContext(SUB_CONTENT_NAME, props.__scopeMenu);\n    const ref = React4.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    return (0, import_jsx_runtime2.jsx)(Collection.Provider, { scope: props.__scopeMenu, children: (0, import_jsx_runtime2.jsx)(Presence, { present: forceMount || context.open, children: (0, import_jsx_runtime2.jsx)(Collection.Slot, { scope: props.__scopeMenu, children: (0, import_jsx_runtime2.jsx)(\n      MenuContentImpl,\n      {\n        id: subContext.contentId,\n        \"aria-labelledby\": subContext.triggerId,\n        ...subContentProps,\n        ref: composedRefs,\n        align: \"start\",\n        side: rootContext.dir === \"rtl\" ? \"left\" : \"right\",\n        disableOutsidePointerEvents: false,\n        disableOutsideScroll: false,\n        trapFocus: false,\n        onOpenAutoFocus: (event) => {\n          if (rootContext.isUsingKeyboardRef.current) ref.current?.focus();\n          event.preventDefault();\n        },\n        onCloseAutoFocus: (event) => event.preventDefault(),\n        onFocusOutside: composeEventHandlers2(props.onFocusOutside, (event) => {\n          if (event.target !== subContext.trigger) context.onOpenChange(false);\n        }),\n        onEscapeKeyDown: composeEventHandlers2(props.onEscapeKeyDown, (event) => {\n          rootContext.onClose();\n          event.preventDefault();\n        }),\n        onKeyDown: composeEventHandlers2(props.onKeyDown, (event) => {\n          const isKeyDownInside = event.currentTarget.contains(event.target);\n          const isCloseKey = SUB_CLOSE_KEYS[rootContext.dir].includes(event.key);\n          if (isKeyDownInside && isCloseKey) {\n            context.onOpenChange(false);\n            subContext.trigger?.focus();\n            event.preventDefault();\n          }\n        })\n      }\n    ) }) }) });\n  }\n);\nMenuSubContent.displayName = SUB_CONTENT_NAME;\nfunction getOpenState(open) {\n  return open ? \"open\" : \"closed\";\n}\nfunction isIndeterminate(checked) {\n  return checked === \"indeterminate\";\n}\nfunction getCheckedState(checked) {\n  return isIndeterminate(checked) ? \"indeterminate\" : checked ? \"checked\" : \"unchecked\";\n}\nfunction focusFirst(candidates) {\n  const PREVIOUSLY_FOCUSED_ELEMENT = document.activeElement;\n  for (const candidate of candidates) {\n    if (candidate === PREVIOUSLY_FOCUSED_ELEMENT) return;\n    candidate.focus();\n    if (document.activeElement !== PREVIOUSLY_FOCUSED_ELEMENT) return;\n  }\n}\nfunction wrapArray(array, startIndex) {\n  return array.map((_, index) => array[(startIndex + index) % array.length]);\n}\nfunction getNextMatch(values, search, currentMatch) {\n  const isRepeated = search.length > 1 && Array.from(search).every((char) => char === search[0]);\n  const normalizedSearch = isRepeated ? search[0] : search;\n  const currentMatchIndex = currentMatch ? values.indexOf(currentMatch) : -1;\n  let wrappedValues = wrapArray(values, Math.max(currentMatchIndex, 0));\n  const excludeCurrentMatch = normalizedSearch.length === 1;\n  if (excludeCurrentMatch) wrappedValues = wrappedValues.filter((v) => v !== currentMatch);\n  const nextMatch = wrappedValues.find(\n    (value) => value.toLowerCase().startsWith(normalizedSearch.toLowerCase())\n  );\n  return nextMatch !== currentMatch ? nextMatch : void 0;\n}\nfunction isPointInPolygon(point, polygon) {\n  const { x, y } = point;\n  let inside = false;\n  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n    const ii = polygon[i];\n    const jj = polygon[j];\n    const xi = ii.x;\n    const yi = ii.y;\n    const xj = jj.x;\n    const yj = jj.y;\n    const intersect = yi > y !== yj > y && x < (xj - xi) * (y - yi) / (yj - yi) + xi;\n    if (intersect) inside = !inside;\n  }\n  return inside;\n}\nfunction isPointerInGraceArea(event, area) {\n  if (!area) return false;\n  const cursorPos = { x: event.clientX, y: event.clientY };\n  return isPointInPolygon(cursorPos, area);\n}\nfunction whenMouse(handler) {\n  return (event) => event.pointerType === \"mouse\" ? handler(event) : void 0;\n}\nvar Root3 = Menu;\nvar Anchor2 = MenuAnchor;\nvar Portal2 = MenuPortal;\nvar Content2 = MenuContent;\nvar Group = MenuGroup;\nvar Label = MenuLabel;\nvar Item2 = MenuItem;\nvar CheckboxItem = MenuCheckboxItem;\nvar RadioGroup = MenuRadioGroup;\nvar RadioItem = MenuRadioItem;\nvar ItemIndicator = MenuItemIndicator;\nvar Separator = MenuSeparator;\nvar Arrow2 = MenuArrow;\nvar Sub = MenuSub;\nvar SubTrigger = MenuSubTrigger;\nvar SubContent = MenuSubContent;\n\n// node_modules/@radix-ui/react-dropdown-menu/dist/index.mjs\nvar import_jsx_runtime3 = __toESM(require_jsx_runtime(), 1);\nvar DROPDOWN_MENU_NAME = \"DropdownMenu\";\nvar [createDropdownMenuContext, createDropdownMenuScope] = createContextScope(\n  DROPDOWN_MENU_NAME,\n  [createMenuScope]\n);\nvar useMenuScope = createMenuScope();\nvar [DropdownMenuProvider, useDropdownMenuContext] = createDropdownMenuContext(DROPDOWN_MENU_NAME);\nvar DropdownMenu = (props) => {\n  const {\n    __scopeDropdownMenu,\n    children,\n    dir,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    modal = true\n  } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  const triggerRef = React5.useRef(null);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen ?? false,\n    onChange: onOpenChange,\n    caller: DROPDOWN_MENU_NAME\n  });\n  return (0, import_jsx_runtime3.jsx)(\n    DropdownMenuProvider,\n    {\n      scope: __scopeDropdownMenu,\n      triggerId: useId(),\n      triggerRef,\n      contentId: useId(),\n      open,\n      onOpenChange: setOpen,\n      onOpenToggle: React5.useCallback(() => setOpen((prevOpen) => !prevOpen), [setOpen]),\n      modal,\n      children: (0, import_jsx_runtime3.jsx)(Root3, { ...menuScope, open, onOpenChange: setOpen, dir, modal, children })\n    }\n  );\n};\nDropdownMenu.displayName = DROPDOWN_MENU_NAME;\nvar TRIGGER_NAME = \"DropdownMenuTrigger\";\nvar DropdownMenuTrigger = React5.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeDropdownMenu, disabled = false, ...triggerProps } = props;\n    const context = useDropdownMenuContext(TRIGGER_NAME, __scopeDropdownMenu);\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return (0, import_jsx_runtime3.jsx)(Anchor2, { asChild: true, ...menuScope, children: (0, import_jsx_runtime3.jsx)(\n      Primitive.button,\n      {\n        type: \"button\",\n        id: context.triggerId,\n        \"aria-haspopup\": \"menu\",\n        \"aria-expanded\": context.open,\n        \"aria-controls\": context.open ? context.contentId : void 0,\n        \"data-state\": context.open ? \"open\" : \"closed\",\n        \"data-disabled\": disabled ? \"\" : void 0,\n        disabled,\n        ...triggerProps,\n        ref: composeRefs(forwardedRef, context.triggerRef),\n        onPointerDown: composeEventHandlers(props.onPointerDown, (event) => {\n          if (!disabled && event.button === 0 && event.ctrlKey === false) {\n            context.onOpenToggle();\n            if (!context.open) event.preventDefault();\n          }\n        }),\n        onKeyDown: composeEventHandlers(props.onKeyDown, (event) => {\n          if (disabled) return;\n          if ([\"Enter\", \" \"].includes(event.key)) context.onOpenToggle();\n          if (event.key === \"ArrowDown\") context.onOpenChange(true);\n          if ([\"Enter\", \" \", \"ArrowDown\"].includes(event.key)) event.preventDefault();\n        })\n      }\n    ) });\n  }\n);\nDropdownMenuTrigger.displayName = TRIGGER_NAME;\nvar PORTAL_NAME2 = \"DropdownMenuPortal\";\nvar DropdownMenuPortal = (props) => {\n  const { __scopeDropdownMenu, ...portalProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return (0, import_jsx_runtime3.jsx)(Portal2, { ...menuScope, ...portalProps });\n};\nDropdownMenuPortal.displayName = PORTAL_NAME2;\nvar CONTENT_NAME2 = \"DropdownMenuContent\";\nvar DropdownMenuContent = React5.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeDropdownMenu, ...contentProps } = props;\n    const context = useDropdownMenuContext(CONTENT_NAME2, __scopeDropdownMenu);\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    const hasInteractedOutsideRef = React5.useRef(false);\n    return (0, import_jsx_runtime3.jsx)(\n      Content2,\n      {\n        id: context.contentId,\n        \"aria-labelledby\": context.triggerId,\n        ...menuScope,\n        ...contentProps,\n        ref: forwardedRef,\n        onCloseAutoFocus: composeEventHandlers(props.onCloseAutoFocus, (event) => {\n          if (!hasInteractedOutsideRef.current) context.triggerRef.current?.focus();\n          hasInteractedOutsideRef.current = false;\n          event.preventDefault();\n        }),\n        onInteractOutside: composeEventHandlers(props.onInteractOutside, (event) => {\n          const originalEvent = event.detail.originalEvent;\n          const ctrlLeftClick = originalEvent.button === 0 && originalEvent.ctrlKey === true;\n          const isRightClick = originalEvent.button === 2 || ctrlLeftClick;\n          if (!context.modal || isRightClick) hasInteractedOutsideRef.current = true;\n        }),\n        style: {\n          ...props.style,\n          // re-namespace exposed content custom properties\n          ...{\n            \"--radix-dropdown-menu-content-transform-origin\": \"var(--radix-popper-transform-origin)\",\n            \"--radix-dropdown-menu-content-available-width\": \"var(--radix-popper-available-width)\",\n            \"--radix-dropdown-menu-content-available-height\": \"var(--radix-popper-available-height)\",\n            \"--radix-dropdown-menu-trigger-width\": \"var(--radix-popper-anchor-width)\",\n            \"--radix-dropdown-menu-trigger-height\": \"var(--radix-popper-anchor-height)\"\n          }\n        }\n      }\n    );\n  }\n);\nDropdownMenuContent.displayName = CONTENT_NAME2;\nvar GROUP_NAME2 = \"DropdownMenuGroup\";\nvar DropdownMenuGroup = React5.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeDropdownMenu, ...groupProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return (0, import_jsx_runtime3.jsx)(Group, { ...menuScope, ...groupProps, ref: forwardedRef });\n  }\n);\nDropdownMenuGroup.displayName = GROUP_NAME2;\nvar LABEL_NAME2 = \"DropdownMenuLabel\";\nvar DropdownMenuLabel = React5.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeDropdownMenu, ...labelProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return (0, import_jsx_runtime3.jsx)(Label, { ...menuScope, ...labelProps, ref: forwardedRef });\n  }\n);\nDropdownMenuLabel.displayName = LABEL_NAME2;\nvar ITEM_NAME2 = \"DropdownMenuItem\";\nvar DropdownMenuItem = React5.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeDropdownMenu, ...itemProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return (0, import_jsx_runtime3.jsx)(Item2, { ...menuScope, ...itemProps, ref: forwardedRef });\n  }\n);\nDropdownMenuItem.displayName = ITEM_NAME2;\nvar CHECKBOX_ITEM_NAME2 = \"DropdownMenuCheckboxItem\";\nvar DropdownMenuCheckboxItem = React5.forwardRef((props, forwardedRef) => {\n  const { __scopeDropdownMenu, ...checkboxItemProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return (0, import_jsx_runtime3.jsx)(CheckboxItem, { ...menuScope, ...checkboxItemProps, ref: forwardedRef });\n});\nDropdownMenuCheckboxItem.displayName = CHECKBOX_ITEM_NAME2;\nvar RADIO_GROUP_NAME2 = \"DropdownMenuRadioGroup\";\nvar DropdownMenuRadioGroup = React5.forwardRef((props, forwardedRef) => {\n  const { __scopeDropdownMenu, ...radioGroupProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return (0, import_jsx_runtime3.jsx)(RadioGroup, { ...menuScope, ...radioGroupProps, ref: forwardedRef });\n});\nDropdownMenuRadioGroup.displayName = RADIO_GROUP_NAME2;\nvar RADIO_ITEM_NAME2 = \"DropdownMenuRadioItem\";\nvar DropdownMenuRadioItem = React5.forwardRef((props, forwardedRef) => {\n  const { __scopeDropdownMenu, ...radioItemProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return (0, import_jsx_runtime3.jsx)(RadioItem, { ...menuScope, ...radioItemProps, ref: forwardedRef });\n});\nDropdownMenuRadioItem.displayName = RADIO_ITEM_NAME2;\nvar INDICATOR_NAME = \"DropdownMenuItemIndicator\";\nvar DropdownMenuItemIndicator = React5.forwardRef((props, forwardedRef) => {\n  const { __scopeDropdownMenu, ...itemIndicatorProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return (0, import_jsx_runtime3.jsx)(ItemIndicator, { ...menuScope, ...itemIndicatorProps, ref: forwardedRef });\n});\nDropdownMenuItemIndicator.displayName = INDICATOR_NAME;\nvar SEPARATOR_NAME2 = \"DropdownMenuSeparator\";\nvar DropdownMenuSeparator = React5.forwardRef((props, forwardedRef) => {\n  const { __scopeDropdownMenu, ...separatorProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return (0, import_jsx_runtime3.jsx)(Separator, { ...menuScope, ...separatorProps, ref: forwardedRef });\n});\nDropdownMenuSeparator.displayName = SEPARATOR_NAME2;\nvar ARROW_NAME2 = \"DropdownMenuArrow\";\nvar DropdownMenuArrow = React5.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeDropdownMenu, ...arrowProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return (0, import_jsx_runtime3.jsx)(Arrow2, { ...menuScope, ...arrowProps, ref: forwardedRef });\n  }\n);\nDropdownMenuArrow.displayName = ARROW_NAME2;\nvar DropdownMenuSub = (props) => {\n  const { __scopeDropdownMenu, children, open: openProp, onOpenChange, defaultOpen } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen ?? false,\n    onChange: onOpenChange,\n    caller: \"DropdownMenuSub\"\n  });\n  return (0, import_jsx_runtime3.jsx)(Sub, { ...menuScope, open, onOpenChange: setOpen, children });\n};\nvar SUB_TRIGGER_NAME2 = \"DropdownMenuSubTrigger\";\nvar DropdownMenuSubTrigger = React5.forwardRef((props, forwardedRef) => {\n  const { __scopeDropdownMenu, ...subTriggerProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return (0, import_jsx_runtime3.jsx)(SubTrigger, { ...menuScope, ...subTriggerProps, ref: forwardedRef });\n});\nDropdownMenuSubTrigger.displayName = SUB_TRIGGER_NAME2;\nvar SUB_CONTENT_NAME2 = \"DropdownMenuSubContent\";\nvar DropdownMenuSubContent = React5.forwardRef((props, forwardedRef) => {\n  const { __scopeDropdownMenu, ...subContentProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return (0, import_jsx_runtime3.jsx)(\n    SubContent,\n    {\n      ...menuScope,\n      ...subContentProps,\n      ref: forwardedRef,\n      style: {\n        ...props.style,\n        // re-namespace exposed content custom properties\n        ...{\n          \"--radix-dropdown-menu-content-transform-origin\": \"var(--radix-popper-transform-origin)\",\n          \"--radix-dropdown-menu-content-available-width\": \"var(--radix-popper-available-width)\",\n          \"--radix-dropdown-menu-content-available-height\": \"var(--radix-popper-available-height)\",\n          \"--radix-dropdown-menu-trigger-width\": \"var(--radix-popper-anchor-width)\",\n          \"--radix-dropdown-menu-trigger-height\": \"var(--radix-popper-anchor-height)\"\n        }\n      }\n    }\n  );\n});\nDropdownMenuSubContent.displayName = SUB_CONTENT_NAME2;\nvar Root22 = DropdownMenu;\nvar Trigger = DropdownMenuTrigger;\nvar Portal22 = DropdownMenuPortal;\nvar Content22 = DropdownMenuContent;\nvar Group2 = DropdownMenuGroup;\nvar Label2 = DropdownMenuLabel;\nvar Item22 = DropdownMenuItem;\nvar CheckboxItem2 = DropdownMenuCheckboxItem;\nvar RadioGroup2 = DropdownMenuRadioGroup;\nvar RadioItem2 = DropdownMenuRadioItem;\nvar ItemIndicator2 = DropdownMenuItemIndicator;\nvar Separator2 = DropdownMenuSeparator;\nvar Arrow22 = DropdownMenuArrow;\nvar Sub2 = DropdownMenuSub;\nvar SubTrigger2 = DropdownMenuSubTrigger;\nvar SubContent2 = DropdownMenuSubContent;\nexport {\n  Arrow22 as Arrow,\n  CheckboxItem2 as CheckboxItem,\n  Content22 as Content,\n  DropdownMenu,\n  DropdownMenuArrow,\n  DropdownMenuCheckboxItem,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuItem,\n  DropdownMenuItemIndicator,\n  DropdownMenuLabel,\n  DropdownMenuPortal,\n  DropdownMenuRadioGroup,\n  DropdownMenuRadioItem,\n  DropdownMenuSeparator,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuTrigger,\n  Group2 as Group,\n  Item22 as Item,\n  ItemIndicator2 as ItemIndicator,\n  Label2 as Label,\n  Portal22 as Portal,\n  RadioGroup2 as RadioGroup,\n  RadioItem2 as RadioItem,\n  Root22 as Root,\n  Separator2 as Separator,\n  Sub2 as Sub,\n  SubContent2 as SubContent,\n  SubTrigger2 as SubTrigger,\n  Trigger,\n  createDropdownMenuScope\n};\n//# sourceMappingURL=@radix-ui_react-dropdown-menu.js.map\n","path":null,"size_bytes":54030,"size_tokens":null},"node_modules/.vite/deps/@radix-ui_react-toast.js":{"content":"\"use client\";\nimport {\n  useEscapeKeydown\n} from \"./chunk-734E7IPH.js\";\nimport {\n  useCallbackRef\n} from \"./chunk-QANW4NWU.js\";\nimport {\n  createContextScope,\n  useLayoutEffect2\n} from \"./chunk-6KE3XZZ5.js\";\nimport {\n  composeRefs,\n  useComposedRefs\n} from \"./chunk-WGRQAFEQ.js\";\nimport {\n  require_jsx_runtime\n} from \"./chunk-FXVZLN7E.js\";\nimport {\n  require_react_dom\n} from \"./chunk-F5X6INBZ.js\";\nimport {\n  require_react\n} from \"./chunk-KMU3Z7QX.js\";\nimport {\n  __toESM\n} from \"./chunk-G3PMV62Z.js\";\n\n// node_modules/@radix-ui/react-toast/dist/index.mjs\nvar React9 = __toESM(require_react(), 1);\nvar ReactDOM3 = __toESM(require_react_dom(), 1);\n\n// node_modules/@radix-ui/primitive/dist/index.mjs\nfunction composeEventHandlers(originalEventHandler, ourEventHandler, { checkForDefaultPrevented = true } = {}) {\n  return function handleEvent(event) {\n    originalEventHandler?.(event);\n    if (checkForDefaultPrevented === false || !event.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n}\n\n// node_modules/@radix-ui/react-toast/node_modules/@radix-ui/react-collection/dist/index.mjs\nvar import_react = __toESM(require_react(), 1);\n\n// node_modules/@radix-ui/react-toast/node_modules/@radix-ui/react-slot/dist/index.mjs\nvar React = __toESM(require_react(), 1);\nvar import_jsx_runtime = __toESM(require_jsx_runtime(), 1);\nfunction createSlot(ownerName) {\n  const SlotClone = createSlotClone(ownerName);\n  const Slot2 = React.forwardRef((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n    const childrenArray = React.Children.toArray(children);\n    const slottable = childrenArray.find(isSlottable);\n    if (slottable) {\n      const newElement = slottable.props.children;\n      const newChildren = childrenArray.map((child) => {\n        if (child === slottable) {\n          if (React.Children.count(newElement) > 1) return React.Children.only(null);\n          return React.isValidElement(newElement) ? newElement.props.children : null;\n        } else {\n          return child;\n        }\n      });\n      return (0, import_jsx_runtime.jsx)(SlotClone, { ...slotProps, ref: forwardedRef, children: React.isValidElement(newElement) ? React.cloneElement(newElement, void 0, newChildren) : null });\n    }\n    return (0, import_jsx_runtime.jsx)(SlotClone, { ...slotProps, ref: forwardedRef, children });\n  });\n  Slot2.displayName = `${ownerName}.Slot`;\n  return Slot2;\n}\nvar Slot = createSlot(\"Slot\");\nfunction createSlotClone(ownerName) {\n  const SlotClone = React.forwardRef((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n    if (React.isValidElement(children)) {\n      const childrenRef = getElementRef(children);\n      const props2 = mergeProps(slotProps, children.props);\n      if (children.type !== React.Fragment) {\n        props2.ref = forwardedRef ? composeRefs(forwardedRef, childrenRef) : childrenRef;\n      }\n      return React.cloneElement(children, props2);\n    }\n    return React.Children.count(children) > 1 ? React.Children.only(null) : null;\n  });\n  SlotClone.displayName = `${ownerName}.SlotClone`;\n  return SlotClone;\n}\nvar SLOTTABLE_IDENTIFIER = Symbol(\"radix.slottable\");\nfunction createSlottable(ownerName) {\n  const Slottable2 = ({ children }) => {\n    return (0, import_jsx_runtime.jsx)(import_jsx_runtime.Fragment, { children });\n  };\n  Slottable2.displayName = `${ownerName}.Slottable`;\n  Slottable2.__radixId = SLOTTABLE_IDENTIFIER;\n  return Slottable2;\n}\nvar Slottable = createSlottable(\"Slottable\");\nfunction isSlottable(child) {\n  return React.isValidElement(child) && typeof child.type === \"function\" && \"__radixId\" in child.type && child.type.__radixId === SLOTTABLE_IDENTIFIER;\n}\nfunction mergeProps(slotProps, childProps) {\n  const overrideProps = { ...childProps };\n  for (const propName in childProps) {\n    const slotPropValue = slotProps[propName];\n    const childPropValue = childProps[propName];\n    const isHandler = /^on[A-Z]/.test(propName);\n    if (isHandler) {\n      if (slotPropValue && childPropValue) {\n        overrideProps[propName] = (...args) => {\n          childPropValue(...args);\n          slotPropValue(...args);\n        };\n      } else if (slotPropValue) {\n        overrideProps[propName] = slotPropValue;\n      }\n    } else if (propName === \"style\") {\n      overrideProps[propName] = { ...slotPropValue, ...childPropValue };\n    } else if (propName === \"className\") {\n      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(\" \");\n    }\n  }\n  return { ...slotProps, ...overrideProps };\n}\nfunction getElementRef(element) {\n  let getter = Object.getOwnPropertyDescriptor(element.props, \"ref\")?.get;\n  let mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.ref;\n  }\n  getter = Object.getOwnPropertyDescriptor(element, \"ref\")?.get;\n  mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.props.ref;\n  }\n  return element.props.ref || element.ref;\n}\n\n// node_modules/@radix-ui/react-toast/node_modules/@radix-ui/react-collection/dist/index.mjs\nvar import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);\nfunction createCollection(name) {\n  const PROVIDER_NAME2 = name + \"CollectionProvider\";\n  const [createCollectionContext, createCollectionScope2] = createContextScope(PROVIDER_NAME2);\n  const [CollectionProviderImpl, useCollectionContext] = createCollectionContext(\n    PROVIDER_NAME2,\n    { collectionRef: { current: null }, itemMap: /* @__PURE__ */ new Map() }\n  );\n  const CollectionProvider = (props) => {\n    const { scope, children } = props;\n    const ref = import_react.default.useRef(null);\n    const itemMap = import_react.default.useRef(/* @__PURE__ */ new Map()).current;\n    return (0, import_jsx_runtime2.jsx)(CollectionProviderImpl, { scope, itemMap, collectionRef: ref, children });\n  };\n  CollectionProvider.displayName = PROVIDER_NAME2;\n  const COLLECTION_SLOT_NAME = name + \"CollectionSlot\";\n  const CollectionSlotImpl = createSlot(COLLECTION_SLOT_NAME);\n  const CollectionSlot = import_react.default.forwardRef(\n    (props, forwardedRef) => {\n      const { scope, children } = props;\n      const context = useCollectionContext(COLLECTION_SLOT_NAME, scope);\n      const composedRefs = useComposedRefs(forwardedRef, context.collectionRef);\n      return (0, import_jsx_runtime2.jsx)(CollectionSlotImpl, { ref: composedRefs, children });\n    }\n  );\n  CollectionSlot.displayName = COLLECTION_SLOT_NAME;\n  const ITEM_SLOT_NAME = name + \"CollectionItemSlot\";\n  const ITEM_DATA_ATTR = \"data-radix-collection-item\";\n  const CollectionItemSlotImpl = createSlot(ITEM_SLOT_NAME);\n  const CollectionItemSlot = import_react.default.forwardRef(\n    (props, forwardedRef) => {\n      const { scope, children, ...itemData } = props;\n      const ref = import_react.default.useRef(null);\n      const composedRefs = useComposedRefs(forwardedRef, ref);\n      const context = useCollectionContext(ITEM_SLOT_NAME, scope);\n      import_react.default.useEffect(() => {\n        context.itemMap.set(ref, { ref, ...itemData });\n        return () => void context.itemMap.delete(ref);\n      });\n      return (0, import_jsx_runtime2.jsx)(CollectionItemSlotImpl, { ...{ [ITEM_DATA_ATTR]: \"\" }, ref: composedRefs, children });\n    }\n  );\n  CollectionItemSlot.displayName = ITEM_SLOT_NAME;\n  function useCollection2(scope) {\n    const context = useCollectionContext(name + \"CollectionConsumer\", scope);\n    const getItems = import_react.default.useCallback(() => {\n      const collectionNode = context.collectionRef.current;\n      if (!collectionNode) return [];\n      const orderedNodes = Array.from(collectionNode.querySelectorAll(`[${ITEM_DATA_ATTR}]`));\n      const items = Array.from(context.itemMap.values());\n      const orderedItems = items.sort(\n        (a, b) => orderedNodes.indexOf(a.ref.current) - orderedNodes.indexOf(b.ref.current)\n      );\n      return orderedItems;\n    }, [context.collectionRef, context.itemMap]);\n    return getItems;\n  }\n  return [\n    { Provider: CollectionProvider, Slot: CollectionSlot, ItemSlot: CollectionItemSlot },\n    useCollection2,\n    createCollectionScope2\n  ];\n}\n\n// node_modules/@radix-ui/react-toast/node_modules/@radix-ui/react-dismissable-layer/dist/index.mjs\nvar React4 = __toESM(require_react(), 1);\n\n// node_modules/@radix-ui/react-toast/node_modules/@radix-ui/react-primitive/dist/index.mjs\nvar React3 = __toESM(require_react(), 1);\nvar ReactDOM = __toESM(require_react_dom(), 1);\nvar import_jsx_runtime3 = __toESM(require_jsx_runtime(), 1);\nvar NODES = [\n  \"a\",\n  \"button\",\n  \"div\",\n  \"form\",\n  \"h2\",\n  \"h3\",\n  \"img\",\n  \"input\",\n  \"label\",\n  \"li\",\n  \"nav\",\n  \"ol\",\n  \"p\",\n  \"span\",\n  \"svg\",\n  \"ul\"\n];\nvar Primitive = NODES.reduce((primitive, node) => {\n  const Slot2 = createSlot(`Primitive.${node}`);\n  const Node = React3.forwardRef((props, forwardedRef) => {\n    const { asChild, ...primitiveProps } = props;\n    const Comp = asChild ? Slot2 : node;\n    if (typeof window !== \"undefined\") {\n      window[Symbol.for(\"radix-ui\")] = true;\n    }\n    return (0, import_jsx_runtime3.jsx)(Comp, { ...primitiveProps, ref: forwardedRef });\n  });\n  Node.displayName = `Primitive.${node}`;\n  return { ...primitive, [node]: Node };\n}, {});\nfunction dispatchDiscreteCustomEvent(target, event) {\n  if (target) ReactDOM.flushSync(() => target.dispatchEvent(event));\n}\n\n// node_modules/@radix-ui/react-toast/node_modules/@radix-ui/react-dismissable-layer/dist/index.mjs\nvar import_jsx_runtime4 = __toESM(require_jsx_runtime(), 1);\nvar DISMISSABLE_LAYER_NAME = \"DismissableLayer\";\nvar CONTEXT_UPDATE = \"dismissableLayer.update\";\nvar POINTER_DOWN_OUTSIDE = \"dismissableLayer.pointerDownOutside\";\nvar FOCUS_OUTSIDE = \"dismissableLayer.focusOutside\";\nvar originalBodyPointerEvents;\nvar DismissableLayerContext = React4.createContext({\n  layers: /* @__PURE__ */ new Set(),\n  layersWithOutsidePointerEventsDisabled: /* @__PURE__ */ new Set(),\n  branches: /* @__PURE__ */ new Set()\n});\nvar DismissableLayer = React4.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      disableOutsidePointerEvents = false,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      onFocusOutside,\n      onInteractOutside,\n      onDismiss,\n      ...layerProps\n    } = props;\n    const context = React4.useContext(DismissableLayerContext);\n    const [node, setNode] = React4.useState(null);\n    const ownerDocument = node?.ownerDocument ?? globalThis?.document;\n    const [, force] = React4.useState({});\n    const composedRefs = useComposedRefs(forwardedRef, (node2) => setNode(node2));\n    const layers = Array.from(context.layers);\n    const [highestLayerWithOutsidePointerEventsDisabled] = [...context.layersWithOutsidePointerEventsDisabled].slice(-1);\n    const highestLayerWithOutsidePointerEventsDisabledIndex = layers.indexOf(highestLayerWithOutsidePointerEventsDisabled);\n    const index = node ? layers.indexOf(node) : -1;\n    const isBodyPointerEventsDisabled = context.layersWithOutsidePointerEventsDisabled.size > 0;\n    const isPointerEventsEnabled = index >= highestLayerWithOutsidePointerEventsDisabledIndex;\n    const pointerDownOutside = usePointerDownOutside((event) => {\n      const target = event.target;\n      const isPointerDownOnBranch = [...context.branches].some((branch) => branch.contains(target));\n      if (!isPointerEventsEnabled || isPointerDownOnBranch) return;\n      onPointerDownOutside?.(event);\n      onInteractOutside?.(event);\n      if (!event.defaultPrevented) onDismiss?.();\n    }, ownerDocument);\n    const focusOutside = useFocusOutside((event) => {\n      const target = event.target;\n      const isFocusInBranch = [...context.branches].some((branch) => branch.contains(target));\n      if (isFocusInBranch) return;\n      onFocusOutside?.(event);\n      onInteractOutside?.(event);\n      if (!event.defaultPrevented) onDismiss?.();\n    }, ownerDocument);\n    useEscapeKeydown((event) => {\n      const isHighestLayer = index === context.layers.size - 1;\n      if (!isHighestLayer) return;\n      onEscapeKeyDown?.(event);\n      if (!event.defaultPrevented && onDismiss) {\n        event.preventDefault();\n        onDismiss();\n      }\n    }, ownerDocument);\n    React4.useEffect(() => {\n      if (!node) return;\n      if (disableOutsidePointerEvents) {\n        if (context.layersWithOutsidePointerEventsDisabled.size === 0) {\n          originalBodyPointerEvents = ownerDocument.body.style.pointerEvents;\n          ownerDocument.body.style.pointerEvents = \"none\";\n        }\n        context.layersWithOutsidePointerEventsDisabled.add(node);\n      }\n      context.layers.add(node);\n      dispatchUpdate();\n      return () => {\n        if (disableOutsidePointerEvents && context.layersWithOutsidePointerEventsDisabled.size === 1) {\n          ownerDocument.body.style.pointerEvents = originalBodyPointerEvents;\n        }\n      };\n    }, [node, ownerDocument, disableOutsidePointerEvents, context]);\n    React4.useEffect(() => {\n      return () => {\n        if (!node) return;\n        context.layers.delete(node);\n        context.layersWithOutsidePointerEventsDisabled.delete(node);\n        dispatchUpdate();\n      };\n    }, [node, context]);\n    React4.useEffect(() => {\n      const handleUpdate = () => force({});\n      document.addEventListener(CONTEXT_UPDATE, handleUpdate);\n      return () => document.removeEventListener(CONTEXT_UPDATE, handleUpdate);\n    }, []);\n    return (0, import_jsx_runtime4.jsx)(\n      Primitive.div,\n      {\n        ...layerProps,\n        ref: composedRefs,\n        style: {\n          pointerEvents: isBodyPointerEventsDisabled ? isPointerEventsEnabled ? \"auto\" : \"none\" : void 0,\n          ...props.style\n        },\n        onFocusCapture: composeEventHandlers(props.onFocusCapture, focusOutside.onFocusCapture),\n        onBlurCapture: composeEventHandlers(props.onBlurCapture, focusOutside.onBlurCapture),\n        onPointerDownCapture: composeEventHandlers(\n          props.onPointerDownCapture,\n          pointerDownOutside.onPointerDownCapture\n        )\n      }\n    );\n  }\n);\nDismissableLayer.displayName = DISMISSABLE_LAYER_NAME;\nvar BRANCH_NAME = \"DismissableLayerBranch\";\nvar DismissableLayerBranch = React4.forwardRef((props, forwardedRef) => {\n  const context = React4.useContext(DismissableLayerContext);\n  const ref = React4.useRef(null);\n  const composedRefs = useComposedRefs(forwardedRef, ref);\n  React4.useEffect(() => {\n    const node = ref.current;\n    if (node) {\n      context.branches.add(node);\n      return () => {\n        context.branches.delete(node);\n      };\n    }\n  }, [context.branches]);\n  return (0, import_jsx_runtime4.jsx)(Primitive.div, { ...props, ref: composedRefs });\n});\nDismissableLayerBranch.displayName = BRANCH_NAME;\nfunction usePointerDownOutside(onPointerDownOutside, ownerDocument = globalThis?.document) {\n  const handlePointerDownOutside = useCallbackRef(onPointerDownOutside);\n  const isPointerInsideReactTreeRef = React4.useRef(false);\n  const handleClickRef = React4.useRef(() => {\n  });\n  React4.useEffect(() => {\n    const handlePointerDown = (event) => {\n      if (event.target && !isPointerInsideReactTreeRef.current) {\n        let handleAndDispatchPointerDownOutsideEvent2 = function() {\n          handleAndDispatchCustomEvent(\n            POINTER_DOWN_OUTSIDE,\n            handlePointerDownOutside,\n            eventDetail,\n            { discrete: true }\n          );\n        };\n        var handleAndDispatchPointerDownOutsideEvent = handleAndDispatchPointerDownOutsideEvent2;\n        const eventDetail = { originalEvent: event };\n        if (event.pointerType === \"touch\") {\n          ownerDocument.removeEventListener(\"click\", handleClickRef.current);\n          handleClickRef.current = handleAndDispatchPointerDownOutsideEvent2;\n          ownerDocument.addEventListener(\"click\", handleClickRef.current, { once: true });\n        } else {\n          handleAndDispatchPointerDownOutsideEvent2();\n        }\n      } else {\n        ownerDocument.removeEventListener(\"click\", handleClickRef.current);\n      }\n      isPointerInsideReactTreeRef.current = false;\n    };\n    const timerId = window.setTimeout(() => {\n      ownerDocument.addEventListener(\"pointerdown\", handlePointerDown);\n    }, 0);\n    return () => {\n      window.clearTimeout(timerId);\n      ownerDocument.removeEventListener(\"pointerdown\", handlePointerDown);\n      ownerDocument.removeEventListener(\"click\", handleClickRef.current);\n    };\n  }, [ownerDocument, handlePointerDownOutside]);\n  return {\n    // ensures we check React component tree (not just DOM tree)\n    onPointerDownCapture: () => isPointerInsideReactTreeRef.current = true\n  };\n}\nfunction useFocusOutside(onFocusOutside, ownerDocument = globalThis?.document) {\n  const handleFocusOutside = useCallbackRef(onFocusOutside);\n  const isFocusInsideReactTreeRef = React4.useRef(false);\n  React4.useEffect(() => {\n    const handleFocus = (event) => {\n      if (event.target && !isFocusInsideReactTreeRef.current) {\n        const eventDetail = { originalEvent: event };\n        handleAndDispatchCustomEvent(FOCUS_OUTSIDE, handleFocusOutside, eventDetail, {\n          discrete: false\n        });\n      }\n    };\n    ownerDocument.addEventListener(\"focusin\", handleFocus);\n    return () => ownerDocument.removeEventListener(\"focusin\", handleFocus);\n  }, [ownerDocument, handleFocusOutside]);\n  return {\n    onFocusCapture: () => isFocusInsideReactTreeRef.current = true,\n    onBlurCapture: () => isFocusInsideReactTreeRef.current = false\n  };\n}\nfunction dispatchUpdate() {\n  const event = new CustomEvent(CONTEXT_UPDATE);\n  document.dispatchEvent(event);\n}\nfunction handleAndDispatchCustomEvent(name, handler, detail, { discrete }) {\n  const target = detail.originalEvent.target;\n  const event = new CustomEvent(name, { bubbles: false, cancelable: true, detail });\n  if (handler) target.addEventListener(name, handler, { once: true });\n  if (discrete) {\n    dispatchDiscreteCustomEvent(target, event);\n  } else {\n    target.dispatchEvent(event);\n  }\n}\nvar Root = DismissableLayer;\nvar Branch = DismissableLayerBranch;\n\n// node_modules/@radix-ui/react-toast/node_modules/@radix-ui/react-portal/dist/index.mjs\nvar React5 = __toESM(require_react(), 1);\nvar import_react_dom = __toESM(require_react_dom(), 1);\nvar import_jsx_runtime5 = __toESM(require_jsx_runtime(), 1);\nvar PORTAL_NAME = \"Portal\";\nvar Portal = React5.forwardRef((props, forwardedRef) => {\n  const { container: containerProp, ...portalProps } = props;\n  const [mounted, setMounted] = React5.useState(false);\n  useLayoutEffect2(() => setMounted(true), []);\n  const container = containerProp || mounted && globalThis?.document?.body;\n  return container ? import_react_dom.default.createPortal((0, import_jsx_runtime5.jsx)(Primitive.div, { ...portalProps, ref: forwardedRef }), container) : null;\n});\nPortal.displayName = PORTAL_NAME;\n\n// node_modules/@radix-ui/react-toast/node_modules/@radix-ui/react-presence/dist/index.mjs\nvar React22 = __toESM(require_react(), 1);\nvar React6 = __toESM(require_react(), 1);\nfunction useStateMachine(initialState, machine) {\n  return React6.useReducer((state, event) => {\n    const nextState = machine[state][event];\n    return nextState ?? state;\n  }, initialState);\n}\nvar Presence = (props) => {\n  const { present, children } = props;\n  const presence = usePresence(present);\n  const child = typeof children === \"function\" ? children({ present: presence.isPresent }) : React22.Children.only(children);\n  const ref = useComposedRefs(presence.ref, getElementRef2(child));\n  const forceMount = typeof children === \"function\";\n  return forceMount || presence.isPresent ? React22.cloneElement(child, { ref }) : null;\n};\nPresence.displayName = \"Presence\";\nfunction usePresence(present) {\n  const [node, setNode] = React22.useState();\n  const stylesRef = React22.useRef({});\n  const prevPresentRef = React22.useRef(present);\n  const prevAnimationNameRef = React22.useRef(\"none\");\n  const initialState = present ? \"mounted\" : \"unmounted\";\n  const [state, send] = useStateMachine(initialState, {\n    mounted: {\n      UNMOUNT: \"unmounted\",\n      ANIMATION_OUT: \"unmountSuspended\"\n    },\n    unmountSuspended: {\n      MOUNT: \"mounted\",\n      ANIMATION_END: \"unmounted\"\n    },\n    unmounted: {\n      MOUNT: \"mounted\"\n    }\n  });\n  React22.useEffect(() => {\n    const currentAnimationName = getAnimationName(stylesRef.current);\n    prevAnimationNameRef.current = state === \"mounted\" ? currentAnimationName : \"none\";\n  }, [state]);\n  useLayoutEffect2(() => {\n    const styles = stylesRef.current;\n    const wasPresent = prevPresentRef.current;\n    const hasPresentChanged = wasPresent !== present;\n    if (hasPresentChanged) {\n      const prevAnimationName = prevAnimationNameRef.current;\n      const currentAnimationName = getAnimationName(styles);\n      if (present) {\n        send(\"MOUNT\");\n      } else if (currentAnimationName === \"none\" || styles?.display === \"none\") {\n        send(\"UNMOUNT\");\n      } else {\n        const isAnimating = prevAnimationName !== currentAnimationName;\n        if (wasPresent && isAnimating) {\n          send(\"ANIMATION_OUT\");\n        } else {\n          send(\"UNMOUNT\");\n        }\n      }\n      prevPresentRef.current = present;\n    }\n  }, [present, send]);\n  useLayoutEffect2(() => {\n    if (node) {\n      let timeoutId;\n      const ownerWindow = node.ownerDocument.defaultView ?? window;\n      const handleAnimationEnd = (event) => {\n        const currentAnimationName = getAnimationName(stylesRef.current);\n        const isCurrentAnimation = currentAnimationName.includes(event.animationName);\n        if (event.target === node && isCurrentAnimation) {\n          send(\"ANIMATION_END\");\n          if (!prevPresentRef.current) {\n            const currentFillMode = node.style.animationFillMode;\n            node.style.animationFillMode = \"forwards\";\n            timeoutId = ownerWindow.setTimeout(() => {\n              if (node.style.animationFillMode === \"forwards\") {\n                node.style.animationFillMode = currentFillMode;\n              }\n            });\n          }\n        }\n      };\n      const handleAnimationStart = (event) => {\n        if (event.target === node) {\n          prevAnimationNameRef.current = getAnimationName(stylesRef.current);\n        }\n      };\n      node.addEventListener(\"animationstart\", handleAnimationStart);\n      node.addEventListener(\"animationcancel\", handleAnimationEnd);\n      node.addEventListener(\"animationend\", handleAnimationEnd);\n      return () => {\n        ownerWindow.clearTimeout(timeoutId);\n        node.removeEventListener(\"animationstart\", handleAnimationStart);\n        node.removeEventListener(\"animationcancel\", handleAnimationEnd);\n        node.removeEventListener(\"animationend\", handleAnimationEnd);\n      };\n    } else {\n      send(\"ANIMATION_END\");\n    }\n  }, [node, send]);\n  return {\n    isPresent: [\"mounted\", \"unmountSuspended\"].includes(state),\n    ref: React22.useCallback((node2) => {\n      if (node2) stylesRef.current = getComputedStyle(node2);\n      setNode(node2);\n    }, [])\n  };\n}\nfunction getAnimationName(styles) {\n  return styles?.animationName || \"none\";\n}\nfunction getElementRef2(element) {\n  let getter = Object.getOwnPropertyDescriptor(element.props, \"ref\")?.get;\n  let mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.ref;\n  }\n  getter = Object.getOwnPropertyDescriptor(element, \"ref\")?.get;\n  mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.props.ref;\n  }\n  return element.props.ref || element.ref;\n}\n\n// node_modules/@radix-ui/react-use-controllable-state/dist/index.mjs\nvar React7 = __toESM(require_react(), 1);\nfunction useControllableState({\n  prop,\n  defaultProp,\n  onChange = () => {\n  }\n}) {\n  const [uncontrolledProp, setUncontrolledProp] = useUncontrolledState({ defaultProp, onChange });\n  const isControlled = prop !== void 0;\n  const value = isControlled ? prop : uncontrolledProp;\n  const handleChange = useCallbackRef(onChange);\n  const setValue = React7.useCallback(\n    (nextValue) => {\n      if (isControlled) {\n        const setter = nextValue;\n        const value2 = typeof nextValue === \"function\" ? setter(prop) : nextValue;\n        if (value2 !== prop) handleChange(value2);\n      } else {\n        setUncontrolledProp(nextValue);\n      }\n    },\n    [isControlled, prop, setUncontrolledProp, handleChange]\n  );\n  return [value, setValue];\n}\nfunction useUncontrolledState({\n  defaultProp,\n  onChange\n}) {\n  const uncontrolledState = React7.useState(defaultProp);\n  const [value] = uncontrolledState;\n  const prevValueRef = React7.useRef(value);\n  const handleChange = useCallbackRef(onChange);\n  React7.useEffect(() => {\n    if (prevValueRef.current !== value) {\n      handleChange(value);\n      prevValueRef.current = value;\n    }\n  }, [value, prevValueRef, handleChange]);\n  return uncontrolledState;\n}\n\n// node_modules/@radix-ui/react-toast/node_modules/@radix-ui/react-visually-hidden/dist/index.mjs\nvar React8 = __toESM(require_react(), 1);\nvar import_jsx_runtime6 = __toESM(require_jsx_runtime(), 1);\nvar NAME = \"VisuallyHidden\";\nvar VisuallyHidden = React8.forwardRef(\n  (props, forwardedRef) => {\n    return (0, import_jsx_runtime6.jsx)(\n      Primitive.span,\n      {\n        ...props,\n        ref: forwardedRef,\n        style: {\n          // See: https://github.com/twbs/bootstrap/blob/main/scss/mixins/_visually-hidden.scss\n          position: \"absolute\",\n          border: 0,\n          width: 1,\n          height: 1,\n          padding: 0,\n          margin: -1,\n          overflow: \"hidden\",\n          clip: \"rect(0, 0, 0, 0)\",\n          whiteSpace: \"nowrap\",\n          wordWrap: \"normal\",\n          ...props.style\n        }\n      }\n    );\n  }\n);\nVisuallyHidden.displayName = NAME;\n\n// node_modules/@radix-ui/react-toast/dist/index.mjs\nvar import_jsx_runtime7 = __toESM(require_jsx_runtime(), 1);\nvar PROVIDER_NAME = \"ToastProvider\";\nvar [Collection, useCollection, createCollectionScope] = createCollection(\"Toast\");\nvar [createToastContext, createToastScope] = createContextScope(\"Toast\", [createCollectionScope]);\nvar [ToastProviderProvider, useToastProviderContext] = createToastContext(PROVIDER_NAME);\nvar ToastProvider = (props) => {\n  const {\n    __scopeToast,\n    label = \"Notification\",\n    duration = 5e3,\n    swipeDirection = \"right\",\n    swipeThreshold = 50,\n    children\n  } = props;\n  const [viewport, setViewport] = React9.useState(null);\n  const [toastCount, setToastCount] = React9.useState(0);\n  const isFocusedToastEscapeKeyDownRef = React9.useRef(false);\n  const isClosePausedRef = React9.useRef(false);\n  if (!label.trim()) {\n    console.error(\n      `Invalid prop \\`label\\` supplied to \\`${PROVIDER_NAME}\\`. Expected non-empty \\`string\\`.`\n    );\n  }\n  return (0, import_jsx_runtime7.jsx)(Collection.Provider, { scope: __scopeToast, children: (0, import_jsx_runtime7.jsx)(\n    ToastProviderProvider,\n    {\n      scope: __scopeToast,\n      label,\n      duration,\n      swipeDirection,\n      swipeThreshold,\n      toastCount,\n      viewport,\n      onViewportChange: setViewport,\n      onToastAdd: React9.useCallback(() => setToastCount((prevCount) => prevCount + 1), []),\n      onToastRemove: React9.useCallback(() => setToastCount((prevCount) => prevCount - 1), []),\n      isFocusedToastEscapeKeyDownRef,\n      isClosePausedRef,\n      children\n    }\n  ) });\n};\nToastProvider.displayName = PROVIDER_NAME;\nvar VIEWPORT_NAME = \"ToastViewport\";\nvar VIEWPORT_DEFAULT_HOTKEY = [\"F8\"];\nvar VIEWPORT_PAUSE = \"toast.viewportPause\";\nvar VIEWPORT_RESUME = \"toast.viewportResume\";\nvar ToastViewport = React9.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeToast,\n      hotkey = VIEWPORT_DEFAULT_HOTKEY,\n      label = \"Notifications ({hotkey})\",\n      ...viewportProps\n    } = props;\n    const context = useToastProviderContext(VIEWPORT_NAME, __scopeToast);\n    const getItems = useCollection(__scopeToast);\n    const wrapperRef = React9.useRef(null);\n    const headFocusProxyRef = React9.useRef(null);\n    const tailFocusProxyRef = React9.useRef(null);\n    const ref = React9.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref, context.onViewportChange);\n    const hotkeyLabel = hotkey.join(\"+\").replace(/Key/g, \"\").replace(/Digit/g, \"\");\n    const hasToasts = context.toastCount > 0;\n    React9.useEffect(() => {\n      const handleKeyDown = (event) => {\n        const isHotkeyPressed = hotkey.length !== 0 && hotkey.every((key) => event[key] || event.code === key);\n        if (isHotkeyPressed) ref.current?.focus();\n      };\n      document.addEventListener(\"keydown\", handleKeyDown);\n      return () => document.removeEventListener(\"keydown\", handleKeyDown);\n    }, [hotkey]);\n    React9.useEffect(() => {\n      const wrapper = wrapperRef.current;\n      const viewport = ref.current;\n      if (hasToasts && wrapper && viewport) {\n        const handlePause = () => {\n          if (!context.isClosePausedRef.current) {\n            const pauseEvent = new CustomEvent(VIEWPORT_PAUSE);\n            viewport.dispatchEvent(pauseEvent);\n            context.isClosePausedRef.current = true;\n          }\n        };\n        const handleResume = () => {\n          if (context.isClosePausedRef.current) {\n            const resumeEvent = new CustomEvent(VIEWPORT_RESUME);\n            viewport.dispatchEvent(resumeEvent);\n            context.isClosePausedRef.current = false;\n          }\n        };\n        const handleFocusOutResume = (event) => {\n          const isFocusMovingOutside = !wrapper.contains(event.relatedTarget);\n          if (isFocusMovingOutside) handleResume();\n        };\n        const handlePointerLeaveResume = () => {\n          const isFocusInside = wrapper.contains(document.activeElement);\n          if (!isFocusInside) handleResume();\n        };\n        wrapper.addEventListener(\"focusin\", handlePause);\n        wrapper.addEventListener(\"focusout\", handleFocusOutResume);\n        wrapper.addEventListener(\"pointermove\", handlePause);\n        wrapper.addEventListener(\"pointerleave\", handlePointerLeaveResume);\n        window.addEventListener(\"blur\", handlePause);\n        window.addEventListener(\"focus\", handleResume);\n        return () => {\n          wrapper.removeEventListener(\"focusin\", handlePause);\n          wrapper.removeEventListener(\"focusout\", handleFocusOutResume);\n          wrapper.removeEventListener(\"pointermove\", handlePause);\n          wrapper.removeEventListener(\"pointerleave\", handlePointerLeaveResume);\n          window.removeEventListener(\"blur\", handlePause);\n          window.removeEventListener(\"focus\", handleResume);\n        };\n      }\n    }, [hasToasts, context.isClosePausedRef]);\n    const getSortedTabbableCandidates = React9.useCallback(\n      ({ tabbingDirection }) => {\n        const toastItems = getItems();\n        const tabbableCandidates = toastItems.map((toastItem) => {\n          const toastNode = toastItem.ref.current;\n          const toastTabbableCandidates = [toastNode, ...getTabbableCandidates(toastNode)];\n          return tabbingDirection === \"forwards\" ? toastTabbableCandidates : toastTabbableCandidates.reverse();\n        });\n        return (tabbingDirection === \"forwards\" ? tabbableCandidates.reverse() : tabbableCandidates).flat();\n      },\n      [getItems]\n    );\n    React9.useEffect(() => {\n      const viewport = ref.current;\n      if (viewport) {\n        const handleKeyDown = (event) => {\n          const isMetaKey = event.altKey || event.ctrlKey || event.metaKey;\n          const isTabKey = event.key === \"Tab\" && !isMetaKey;\n          if (isTabKey) {\n            const focusedElement = document.activeElement;\n            const isTabbingBackwards = event.shiftKey;\n            const targetIsViewport = event.target === viewport;\n            if (targetIsViewport && isTabbingBackwards) {\n              headFocusProxyRef.current?.focus();\n              return;\n            }\n            const tabbingDirection = isTabbingBackwards ? \"backwards\" : \"forwards\";\n            const sortedCandidates = getSortedTabbableCandidates({ tabbingDirection });\n            const index = sortedCandidates.findIndex((candidate) => candidate === focusedElement);\n            if (focusFirst(sortedCandidates.slice(index + 1))) {\n              event.preventDefault();\n            } else {\n              isTabbingBackwards ? headFocusProxyRef.current?.focus() : tailFocusProxyRef.current?.focus();\n            }\n          }\n        };\n        viewport.addEventListener(\"keydown\", handleKeyDown);\n        return () => viewport.removeEventListener(\"keydown\", handleKeyDown);\n      }\n    }, [getItems, getSortedTabbableCandidates]);\n    return (0, import_jsx_runtime7.jsxs)(\n      Branch,\n      {\n        ref: wrapperRef,\n        role: \"region\",\n        \"aria-label\": label.replace(\"{hotkey}\", hotkeyLabel),\n        tabIndex: -1,\n        style: { pointerEvents: hasToasts ? void 0 : \"none\" },\n        children: [\n          hasToasts && (0, import_jsx_runtime7.jsx)(\n            FocusProxy,\n            {\n              ref: headFocusProxyRef,\n              onFocusFromOutsideViewport: () => {\n                const tabbableCandidates = getSortedTabbableCandidates({\n                  tabbingDirection: \"forwards\"\n                });\n                focusFirst(tabbableCandidates);\n              }\n            }\n          ),\n          (0, import_jsx_runtime7.jsx)(Collection.Slot, { scope: __scopeToast, children: (0, import_jsx_runtime7.jsx)(Primitive.ol, { tabIndex: -1, ...viewportProps, ref: composedRefs }) }),\n          hasToasts && (0, import_jsx_runtime7.jsx)(\n            FocusProxy,\n            {\n              ref: tailFocusProxyRef,\n              onFocusFromOutsideViewport: () => {\n                const tabbableCandidates = getSortedTabbableCandidates({\n                  tabbingDirection: \"backwards\"\n                });\n                focusFirst(tabbableCandidates);\n              }\n            }\n          )\n        ]\n      }\n    );\n  }\n);\nToastViewport.displayName = VIEWPORT_NAME;\nvar FOCUS_PROXY_NAME = \"ToastFocusProxy\";\nvar FocusProxy = React9.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeToast, onFocusFromOutsideViewport, ...proxyProps } = props;\n    const context = useToastProviderContext(FOCUS_PROXY_NAME, __scopeToast);\n    return (0, import_jsx_runtime7.jsx)(\n      VisuallyHidden,\n      {\n        \"aria-hidden\": true,\n        tabIndex: 0,\n        ...proxyProps,\n        ref: forwardedRef,\n        style: { position: \"fixed\" },\n        onFocus: (event) => {\n          const prevFocusedElement = event.relatedTarget;\n          const isFocusFromOutsideViewport = !context.viewport?.contains(prevFocusedElement);\n          if (isFocusFromOutsideViewport) onFocusFromOutsideViewport();\n        }\n      }\n    );\n  }\n);\nFocusProxy.displayName = FOCUS_PROXY_NAME;\nvar TOAST_NAME = \"Toast\";\nvar TOAST_SWIPE_START = \"toast.swipeStart\";\nvar TOAST_SWIPE_MOVE = \"toast.swipeMove\";\nvar TOAST_SWIPE_CANCEL = \"toast.swipeCancel\";\nvar TOAST_SWIPE_END = \"toast.swipeEnd\";\nvar Toast = React9.forwardRef(\n  (props, forwardedRef) => {\n    const { forceMount, open: openProp, defaultOpen, onOpenChange, ...toastProps } = props;\n    const [open = true, setOpen] = useControllableState({\n      prop: openProp,\n      defaultProp: defaultOpen,\n      onChange: onOpenChange\n    });\n    return (0, import_jsx_runtime7.jsx)(Presence, { present: forceMount || open, children: (0, import_jsx_runtime7.jsx)(\n      ToastImpl,\n      {\n        open,\n        ...toastProps,\n        ref: forwardedRef,\n        onClose: () => setOpen(false),\n        onPause: useCallbackRef(props.onPause),\n        onResume: useCallbackRef(props.onResume),\n        onSwipeStart: composeEventHandlers(props.onSwipeStart, (event) => {\n          event.currentTarget.setAttribute(\"data-swipe\", \"start\");\n        }),\n        onSwipeMove: composeEventHandlers(props.onSwipeMove, (event) => {\n          const { x, y } = event.detail.delta;\n          event.currentTarget.setAttribute(\"data-swipe\", \"move\");\n          event.currentTarget.style.setProperty(\"--radix-toast-swipe-move-x\", `${x}px`);\n          event.currentTarget.style.setProperty(\"--radix-toast-swipe-move-y\", `${y}px`);\n        }),\n        onSwipeCancel: composeEventHandlers(props.onSwipeCancel, (event) => {\n          event.currentTarget.setAttribute(\"data-swipe\", \"cancel\");\n          event.currentTarget.style.removeProperty(\"--radix-toast-swipe-move-x\");\n          event.currentTarget.style.removeProperty(\"--radix-toast-swipe-move-y\");\n          event.currentTarget.style.removeProperty(\"--radix-toast-swipe-end-x\");\n          event.currentTarget.style.removeProperty(\"--radix-toast-swipe-end-y\");\n        }),\n        onSwipeEnd: composeEventHandlers(props.onSwipeEnd, (event) => {\n          const { x, y } = event.detail.delta;\n          event.currentTarget.setAttribute(\"data-swipe\", \"end\");\n          event.currentTarget.style.removeProperty(\"--radix-toast-swipe-move-x\");\n          event.currentTarget.style.removeProperty(\"--radix-toast-swipe-move-y\");\n          event.currentTarget.style.setProperty(\"--radix-toast-swipe-end-x\", `${x}px`);\n          event.currentTarget.style.setProperty(\"--radix-toast-swipe-end-y\", `${y}px`);\n          setOpen(false);\n        })\n      }\n    ) });\n  }\n);\nToast.displayName = TOAST_NAME;\nvar [ToastInteractiveProvider, useToastInteractiveContext] = createToastContext(TOAST_NAME, {\n  onClose() {\n  }\n});\nvar ToastImpl = React9.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeToast,\n      type = \"foreground\",\n      duration: durationProp,\n      open,\n      onClose,\n      onEscapeKeyDown,\n      onPause,\n      onResume,\n      onSwipeStart,\n      onSwipeMove,\n      onSwipeCancel,\n      onSwipeEnd,\n      ...toastProps\n    } = props;\n    const context = useToastProviderContext(TOAST_NAME, __scopeToast);\n    const [node, setNode] = React9.useState(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node2) => setNode(node2));\n    const pointerStartRef = React9.useRef(null);\n    const swipeDeltaRef = React9.useRef(null);\n    const duration = durationProp || context.duration;\n    const closeTimerStartTimeRef = React9.useRef(0);\n    const closeTimerRemainingTimeRef = React9.useRef(duration);\n    const closeTimerRef = React9.useRef(0);\n    const { onToastAdd, onToastRemove } = context;\n    const handleClose = useCallbackRef(() => {\n      const isFocusInToast = node?.contains(document.activeElement);\n      if (isFocusInToast) context.viewport?.focus();\n      onClose();\n    });\n    const startTimer = React9.useCallback(\n      (duration2) => {\n        if (!duration2 || duration2 === Infinity) return;\n        window.clearTimeout(closeTimerRef.current);\n        closeTimerStartTimeRef.current = (/* @__PURE__ */ new Date()).getTime();\n        closeTimerRef.current = window.setTimeout(handleClose, duration2);\n      },\n      [handleClose]\n    );\n    React9.useEffect(() => {\n      const viewport = context.viewport;\n      if (viewport) {\n        const handleResume = () => {\n          startTimer(closeTimerRemainingTimeRef.current);\n          onResume?.();\n        };\n        const handlePause = () => {\n          const elapsedTime = (/* @__PURE__ */ new Date()).getTime() - closeTimerStartTimeRef.current;\n          closeTimerRemainingTimeRef.current = closeTimerRemainingTimeRef.current - elapsedTime;\n          window.clearTimeout(closeTimerRef.current);\n          onPause?.();\n        };\n        viewport.addEventListener(VIEWPORT_PAUSE, handlePause);\n        viewport.addEventListener(VIEWPORT_RESUME, handleResume);\n        return () => {\n          viewport.removeEventListener(VIEWPORT_PAUSE, handlePause);\n          viewport.removeEventListener(VIEWPORT_RESUME, handleResume);\n        };\n      }\n    }, [context.viewport, duration, onPause, onResume, startTimer]);\n    React9.useEffect(() => {\n      if (open && !context.isClosePausedRef.current) startTimer(duration);\n    }, [open, duration, context.isClosePausedRef, startTimer]);\n    React9.useEffect(() => {\n      onToastAdd();\n      return () => onToastRemove();\n    }, [onToastAdd, onToastRemove]);\n    const announceTextContent = React9.useMemo(() => {\n      return node ? getAnnounceTextContent(node) : null;\n    }, [node]);\n    if (!context.viewport) return null;\n    return (0, import_jsx_runtime7.jsxs)(import_jsx_runtime7.Fragment, { children: [\n      announceTextContent && (0, import_jsx_runtime7.jsx)(\n        ToastAnnounce,\n        {\n          __scopeToast,\n          role: \"status\",\n          \"aria-live\": type === \"foreground\" ? \"assertive\" : \"polite\",\n          \"aria-atomic\": true,\n          children: announceTextContent\n        }\n      ),\n      (0, import_jsx_runtime7.jsx)(ToastInteractiveProvider, { scope: __scopeToast, onClose: handleClose, children: ReactDOM3.createPortal(\n        (0, import_jsx_runtime7.jsx)(Collection.ItemSlot, { scope: __scopeToast, children: (0, import_jsx_runtime7.jsx)(\n          Root,\n          {\n            asChild: true,\n            onEscapeKeyDown: composeEventHandlers(onEscapeKeyDown, () => {\n              if (!context.isFocusedToastEscapeKeyDownRef.current) handleClose();\n              context.isFocusedToastEscapeKeyDownRef.current = false;\n            }),\n            children: (0, import_jsx_runtime7.jsx)(\n              Primitive.li,\n              {\n                role: \"status\",\n                \"aria-live\": \"off\",\n                \"aria-atomic\": true,\n                tabIndex: 0,\n                \"data-state\": open ? \"open\" : \"closed\",\n                \"data-swipe-direction\": context.swipeDirection,\n                ...toastProps,\n                ref: composedRefs,\n                style: { userSelect: \"none\", touchAction: \"none\", ...props.style },\n                onKeyDown: composeEventHandlers(props.onKeyDown, (event) => {\n                  if (event.key !== \"Escape\") return;\n                  onEscapeKeyDown?.(event.nativeEvent);\n                  if (!event.nativeEvent.defaultPrevented) {\n                    context.isFocusedToastEscapeKeyDownRef.current = true;\n                    handleClose();\n                  }\n                }),\n                onPointerDown: composeEventHandlers(props.onPointerDown, (event) => {\n                  if (event.button !== 0) return;\n                  pointerStartRef.current = { x: event.clientX, y: event.clientY };\n                }),\n                onPointerMove: composeEventHandlers(props.onPointerMove, (event) => {\n                  if (!pointerStartRef.current) return;\n                  const x = event.clientX - pointerStartRef.current.x;\n                  const y = event.clientY - pointerStartRef.current.y;\n                  const hasSwipeMoveStarted = Boolean(swipeDeltaRef.current);\n                  const isHorizontalSwipe = [\"left\", \"right\"].includes(context.swipeDirection);\n                  const clamp = [\"left\", \"up\"].includes(context.swipeDirection) ? Math.min : Math.max;\n                  const clampedX = isHorizontalSwipe ? clamp(0, x) : 0;\n                  const clampedY = !isHorizontalSwipe ? clamp(0, y) : 0;\n                  const moveStartBuffer = event.pointerType === \"touch\" ? 10 : 2;\n                  const delta = { x: clampedX, y: clampedY };\n                  const eventDetail = { originalEvent: event, delta };\n                  if (hasSwipeMoveStarted) {\n                    swipeDeltaRef.current = delta;\n                    handleAndDispatchCustomEvent2(TOAST_SWIPE_MOVE, onSwipeMove, eventDetail, {\n                      discrete: false\n                    });\n                  } else if (isDeltaInDirection(delta, context.swipeDirection, moveStartBuffer)) {\n                    swipeDeltaRef.current = delta;\n                    handleAndDispatchCustomEvent2(TOAST_SWIPE_START, onSwipeStart, eventDetail, {\n                      discrete: false\n                    });\n                    event.target.setPointerCapture(event.pointerId);\n                  } else if (Math.abs(x) > moveStartBuffer || Math.abs(y) > moveStartBuffer) {\n                    pointerStartRef.current = null;\n                  }\n                }),\n                onPointerUp: composeEventHandlers(props.onPointerUp, (event) => {\n                  const delta = swipeDeltaRef.current;\n                  const target = event.target;\n                  if (target.hasPointerCapture(event.pointerId)) {\n                    target.releasePointerCapture(event.pointerId);\n                  }\n                  swipeDeltaRef.current = null;\n                  pointerStartRef.current = null;\n                  if (delta) {\n                    const toast = event.currentTarget;\n                    const eventDetail = { originalEvent: event, delta };\n                    if (isDeltaInDirection(delta, context.swipeDirection, context.swipeThreshold)) {\n                      handleAndDispatchCustomEvent2(TOAST_SWIPE_END, onSwipeEnd, eventDetail, {\n                        discrete: true\n                      });\n                    } else {\n                      handleAndDispatchCustomEvent2(\n                        TOAST_SWIPE_CANCEL,\n                        onSwipeCancel,\n                        eventDetail,\n                        {\n                          discrete: true\n                        }\n                      );\n                    }\n                    toast.addEventListener(\"click\", (event2) => event2.preventDefault(), {\n                      once: true\n                    });\n                  }\n                })\n              }\n            )\n          }\n        ) }),\n        context.viewport\n      ) })\n    ] });\n  }\n);\nvar ToastAnnounce = (props) => {\n  const { __scopeToast, children, ...announceProps } = props;\n  const context = useToastProviderContext(TOAST_NAME, __scopeToast);\n  const [renderAnnounceText, setRenderAnnounceText] = React9.useState(false);\n  const [isAnnounced, setIsAnnounced] = React9.useState(false);\n  useNextFrame(() => setRenderAnnounceText(true));\n  React9.useEffect(() => {\n    const timer = window.setTimeout(() => setIsAnnounced(true), 1e3);\n    return () => window.clearTimeout(timer);\n  }, []);\n  return isAnnounced ? null : (0, import_jsx_runtime7.jsx)(Portal, { asChild: true, children: (0, import_jsx_runtime7.jsx)(VisuallyHidden, { ...announceProps, children: renderAnnounceText && (0, import_jsx_runtime7.jsxs)(import_jsx_runtime7.Fragment, { children: [\n    context.label,\n    \" \",\n    children\n  ] }) }) });\n};\nvar TITLE_NAME = \"ToastTitle\";\nvar ToastTitle = React9.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeToast, ...titleProps } = props;\n    return (0, import_jsx_runtime7.jsx)(Primitive.div, { ...titleProps, ref: forwardedRef });\n  }\n);\nToastTitle.displayName = TITLE_NAME;\nvar DESCRIPTION_NAME = \"ToastDescription\";\nvar ToastDescription = React9.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeToast, ...descriptionProps } = props;\n    return (0, import_jsx_runtime7.jsx)(Primitive.div, { ...descriptionProps, ref: forwardedRef });\n  }\n);\nToastDescription.displayName = DESCRIPTION_NAME;\nvar ACTION_NAME = \"ToastAction\";\nvar ToastAction = React9.forwardRef(\n  (props, forwardedRef) => {\n    const { altText, ...actionProps } = props;\n    if (!altText.trim()) {\n      console.error(\n        `Invalid prop \\`altText\\` supplied to \\`${ACTION_NAME}\\`. Expected non-empty \\`string\\`.`\n      );\n      return null;\n    }\n    return (0, import_jsx_runtime7.jsx)(ToastAnnounceExclude, { altText, asChild: true, children: (0, import_jsx_runtime7.jsx)(ToastClose, { ...actionProps, ref: forwardedRef }) });\n  }\n);\nToastAction.displayName = ACTION_NAME;\nvar CLOSE_NAME = \"ToastClose\";\nvar ToastClose = React9.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeToast, ...closeProps } = props;\n    const interactiveContext = useToastInteractiveContext(CLOSE_NAME, __scopeToast);\n    return (0, import_jsx_runtime7.jsx)(ToastAnnounceExclude, { asChild: true, children: (0, import_jsx_runtime7.jsx)(\n      Primitive.button,\n      {\n        type: \"button\",\n        ...closeProps,\n        ref: forwardedRef,\n        onClick: composeEventHandlers(props.onClick, interactiveContext.onClose)\n      }\n    ) });\n  }\n);\nToastClose.displayName = CLOSE_NAME;\nvar ToastAnnounceExclude = React9.forwardRef((props, forwardedRef) => {\n  const { __scopeToast, altText, ...announceExcludeProps } = props;\n  return (0, import_jsx_runtime7.jsx)(\n    Primitive.div,\n    {\n      \"data-radix-toast-announce-exclude\": \"\",\n      \"data-radix-toast-announce-alt\": altText || void 0,\n      ...announceExcludeProps,\n      ref: forwardedRef\n    }\n  );\n});\nfunction getAnnounceTextContent(container) {\n  const textContent = [];\n  const childNodes = Array.from(container.childNodes);\n  childNodes.forEach((node) => {\n    if (node.nodeType === node.TEXT_NODE && node.textContent) textContent.push(node.textContent);\n    if (isHTMLElement(node)) {\n      const isHidden = node.ariaHidden || node.hidden || node.style.display === \"none\";\n      const isExcluded = node.dataset.radixToastAnnounceExclude === \"\";\n      if (!isHidden) {\n        if (isExcluded) {\n          const altText = node.dataset.radixToastAnnounceAlt;\n          if (altText) textContent.push(altText);\n        } else {\n          textContent.push(...getAnnounceTextContent(node));\n        }\n      }\n    }\n  });\n  return textContent;\n}\nfunction handleAndDispatchCustomEvent2(name, handler, detail, { discrete }) {\n  const currentTarget = detail.originalEvent.currentTarget;\n  const event = new CustomEvent(name, { bubbles: true, cancelable: true, detail });\n  if (handler) currentTarget.addEventListener(name, handler, { once: true });\n  if (discrete) {\n    dispatchDiscreteCustomEvent(currentTarget, event);\n  } else {\n    currentTarget.dispatchEvent(event);\n  }\n}\nvar isDeltaInDirection = (delta, direction, threshold = 0) => {\n  const deltaX = Math.abs(delta.x);\n  const deltaY = Math.abs(delta.y);\n  const isDeltaX = deltaX > deltaY;\n  if (direction === \"left\" || direction === \"right\") {\n    return isDeltaX && deltaX > threshold;\n  } else {\n    return !isDeltaX && deltaY > threshold;\n  }\n};\nfunction useNextFrame(callback = () => {\n}) {\n  const fn = useCallbackRef(callback);\n  useLayoutEffect2(() => {\n    let raf1 = 0;\n    let raf2 = 0;\n    raf1 = window.requestAnimationFrame(() => raf2 = window.requestAnimationFrame(fn));\n    return () => {\n      window.cancelAnimationFrame(raf1);\n      window.cancelAnimationFrame(raf2);\n    };\n  }, [fn]);\n}\nfunction isHTMLElement(node) {\n  return node.nodeType === node.ELEMENT_NODE;\n}\nfunction getTabbableCandidates(container) {\n  const nodes = [];\n  const walker = document.createTreeWalker(container, NodeFilter.SHOW_ELEMENT, {\n    acceptNode: (node) => {\n      const isHiddenInput = node.tagName === \"INPUT\" && node.type === \"hidden\";\n      if (node.disabled || node.hidden || isHiddenInput) return NodeFilter.FILTER_SKIP;\n      return node.tabIndex >= 0 ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\n    }\n  });\n  while (walker.nextNode()) nodes.push(walker.currentNode);\n  return nodes;\n}\nfunction focusFirst(candidates) {\n  const previouslyFocusedElement = document.activeElement;\n  return candidates.some((candidate) => {\n    if (candidate === previouslyFocusedElement) return true;\n    candidate.focus();\n    return document.activeElement !== previouslyFocusedElement;\n  });\n}\nvar Provider = ToastProvider;\nvar Viewport = ToastViewport;\nvar Root2 = Toast;\nvar Title = ToastTitle;\nvar Description = ToastDescription;\nvar Action = ToastAction;\nvar Close = ToastClose;\nexport {\n  Action,\n  Close,\n  Description,\n  Provider,\n  Root2 as Root,\n  Title,\n  Toast,\n  ToastAction,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n  Viewport,\n  createToastScope\n};\n//# sourceMappingURL=@radix-ui_react-toast.js.map\n","path":null,"size_bytes":51734,"size_tokens":null},"node_modules/.vite/deps/@radix-ui_react-dialog.js":{"content":"\"use client\";\nimport {\n  Close,\n  Content,\n  Description,\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogDescription,\n  DialogOverlay,\n  DialogPortal,\n  DialogTitle,\n  DialogTrigger,\n  Overlay,\n  Portal,\n  Root,\n  Title,\n  Trigger,\n  WarningProvider,\n  createDialogScope\n} from \"./chunk-LVLQUKSV.js\";\nimport \"./chunk-R3YZKR5V.js\";\nimport \"./chunk-734E7IPH.js\";\nimport \"./chunk-QANW4NWU.js\";\nimport \"./chunk-5FCDBCET.js\";\nimport \"./chunk-JB42X4KE.js\";\nimport \"./chunk-YRTNRKIT.js\";\nimport \"./chunk-6KE3XZZ5.js\";\nimport \"./chunk-WGRQAFEQ.js\";\nimport \"./chunk-FXVZLN7E.js\";\nimport \"./chunk-F5X6INBZ.js\";\nimport \"./chunk-KMU3Z7QX.js\";\nimport \"./chunk-G3PMV62Z.js\";\nexport {\n  Close,\n  Content,\n  Description,\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogDescription,\n  DialogOverlay,\n  DialogPortal,\n  DialogTitle,\n  DialogTrigger,\n  Overlay,\n  Portal,\n  Root,\n  Title,\n  Trigger,\n  WarningProvider,\n  createDialogScope\n};\n","path":null,"size_bytes":927,"size_tokens":null},"node_modules/.vite/deps/@radix-ui_react-tabs.js":{"content":"\"use client\";\nimport {\n  Item,\n  Root,\n  createRovingFocusGroupScope\n} from \"./chunk-5333UELP.js\";\nimport {\n  useDirection\n} from \"./chunk-NSDROFPJ.js\";\nimport \"./chunk-QANW4NWU.js\";\nimport {\n  Presence\n} from \"./chunk-5FCDBCET.js\";\nimport {\n  useId\n} from \"./chunk-JB42X4KE.js\";\nimport {\n  Primitive\n} from \"./chunk-YRTNRKIT.js\";\nimport {\n  createContextScope,\n  useLayoutEffect2\n} from \"./chunk-6KE3XZZ5.js\";\nimport \"./chunk-WGRQAFEQ.js\";\nimport {\n  require_jsx_runtime\n} from \"./chunk-FXVZLN7E.js\";\nimport \"./chunk-F5X6INBZ.js\";\nimport {\n  require_react\n} from \"./chunk-KMU3Z7QX.js\";\nimport {\n  __toESM\n} from \"./chunk-G3PMV62Z.js\";\n\n// node_modules/@radix-ui/react-tabs/dist/index.mjs\nvar React3 = __toESM(require_react(), 1);\n\n// node_modules/@radix-ui/react-tabs/node_modules/@radix-ui/primitive/dist/index.mjs\nvar canUseDOM = !!(typeof window !== \"undefined\" && window.document && window.document.createElement);\nfunction composeEventHandlers(originalEventHandler, ourEventHandler, { checkForDefaultPrevented = true } = {}) {\n  return function handleEvent(event) {\n    originalEventHandler?.(event);\n    if (checkForDefaultPrevented === false || !event.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n}\n\n// node_modules/@radix-ui/react-tabs/node_modules/@radix-ui/react-use-controllable-state/dist/index.mjs\nvar React = __toESM(require_react(), 1);\nvar React2 = __toESM(require_react(), 1);\nvar useInsertionEffect = React[\" useInsertionEffect \".trim().toString()] || useLayoutEffect2;\nfunction useControllableState({\n  prop,\n  defaultProp,\n  onChange = () => {\n  },\n  caller\n}) {\n  const [uncontrolledProp, setUncontrolledProp, onChangeRef] = useUncontrolledState({\n    defaultProp,\n    onChange\n  });\n  const isControlled = prop !== void 0;\n  const value = isControlled ? prop : uncontrolledProp;\n  if (true) {\n    const isControlledRef = React.useRef(prop !== void 0);\n    React.useEffect(() => {\n      const wasControlled = isControlledRef.current;\n      if (wasControlled !== isControlled) {\n        const from = wasControlled ? \"controlled\" : \"uncontrolled\";\n        const to = isControlled ? \"controlled\" : \"uncontrolled\";\n        console.warn(\n          `${caller} is changing from ${from} to ${to}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`\n        );\n      }\n      isControlledRef.current = isControlled;\n    }, [isControlled, caller]);\n  }\n  const setValue = React.useCallback(\n    (nextValue) => {\n      if (isControlled) {\n        const value2 = isFunction(nextValue) ? nextValue(prop) : nextValue;\n        if (value2 !== prop) {\n          onChangeRef.current?.(value2);\n        }\n      } else {\n        setUncontrolledProp(nextValue);\n      }\n    },\n    [isControlled, prop, setUncontrolledProp, onChangeRef]\n  );\n  return [value, setValue];\n}\nfunction useUncontrolledState({\n  defaultProp,\n  onChange\n}) {\n  const [value, setValue] = React.useState(defaultProp);\n  const prevValueRef = React.useRef(value);\n  const onChangeRef = React.useRef(onChange);\n  useInsertionEffect(() => {\n    onChangeRef.current = onChange;\n  }, [onChange]);\n  React.useEffect(() => {\n    if (prevValueRef.current !== value) {\n      onChangeRef.current?.(value);\n      prevValueRef.current = value;\n    }\n  }, [value, prevValueRef]);\n  return [value, setValue, onChangeRef];\n}\nfunction isFunction(value) {\n  return typeof value === \"function\";\n}\nvar SYNC_STATE = Symbol(\"RADIX:SYNC_STATE\");\n\n// node_modules/@radix-ui/react-tabs/dist/index.mjs\nvar import_jsx_runtime = __toESM(require_jsx_runtime(), 1);\nvar TABS_NAME = \"Tabs\";\nvar [createTabsContext, createTabsScope] = createContextScope(TABS_NAME, [\n  createRovingFocusGroupScope\n]);\nvar useRovingFocusGroupScope = createRovingFocusGroupScope();\nvar [TabsProvider, useTabsContext] = createTabsContext(TABS_NAME);\nvar Tabs = React3.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeTabs,\n      value: valueProp,\n      onValueChange,\n      defaultValue,\n      orientation = \"horizontal\",\n      dir,\n      activationMode = \"automatic\",\n      ...tabsProps\n    } = props;\n    const direction = useDirection(dir);\n    const [value, setValue] = useControllableState({\n      prop: valueProp,\n      onChange: onValueChange,\n      defaultProp: defaultValue ?? \"\",\n      caller: TABS_NAME\n    });\n    return (0, import_jsx_runtime.jsx)(\n      TabsProvider,\n      {\n        scope: __scopeTabs,\n        baseId: useId(),\n        value,\n        onValueChange: setValue,\n        orientation,\n        dir: direction,\n        activationMode,\n        children: (0, import_jsx_runtime.jsx)(\n          Primitive.div,\n          {\n            dir: direction,\n            \"data-orientation\": orientation,\n            ...tabsProps,\n            ref: forwardedRef\n          }\n        )\n      }\n    );\n  }\n);\nTabs.displayName = TABS_NAME;\nvar TAB_LIST_NAME = \"TabsList\";\nvar TabsList = React3.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeTabs, loop = true, ...listProps } = props;\n    const context = useTabsContext(TAB_LIST_NAME, __scopeTabs);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeTabs);\n    return (0, import_jsx_runtime.jsx)(\n      Root,\n      {\n        asChild: true,\n        ...rovingFocusGroupScope,\n        orientation: context.orientation,\n        dir: context.dir,\n        loop,\n        children: (0, import_jsx_runtime.jsx)(\n          Primitive.div,\n          {\n            role: \"tablist\",\n            \"aria-orientation\": context.orientation,\n            ...listProps,\n            ref: forwardedRef\n          }\n        )\n      }\n    );\n  }\n);\nTabsList.displayName = TAB_LIST_NAME;\nvar TRIGGER_NAME = \"TabsTrigger\";\nvar TabsTrigger = React3.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeTabs, value, disabled = false, ...triggerProps } = props;\n    const context = useTabsContext(TRIGGER_NAME, __scopeTabs);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeTabs);\n    const triggerId = makeTriggerId(context.baseId, value);\n    const contentId = makeContentId(context.baseId, value);\n    const isSelected = value === context.value;\n    return (0, import_jsx_runtime.jsx)(\n      Item,\n      {\n        asChild: true,\n        ...rovingFocusGroupScope,\n        focusable: !disabled,\n        active: isSelected,\n        children: (0, import_jsx_runtime.jsx)(\n          Primitive.button,\n          {\n            type: \"button\",\n            role: \"tab\",\n            \"aria-selected\": isSelected,\n            \"aria-controls\": contentId,\n            \"data-state\": isSelected ? \"active\" : \"inactive\",\n            \"data-disabled\": disabled ? \"\" : void 0,\n            disabled,\n            id: triggerId,\n            ...triggerProps,\n            ref: forwardedRef,\n            onMouseDown: composeEventHandlers(props.onMouseDown, (event) => {\n              if (!disabled && event.button === 0 && event.ctrlKey === false) {\n                context.onValueChange(value);\n              } else {\n                event.preventDefault();\n              }\n            }),\n            onKeyDown: composeEventHandlers(props.onKeyDown, (event) => {\n              if ([\" \", \"Enter\"].includes(event.key)) context.onValueChange(value);\n            }),\n            onFocus: composeEventHandlers(props.onFocus, () => {\n              const isAutomaticActivation = context.activationMode !== \"manual\";\n              if (!isSelected && !disabled && isAutomaticActivation) {\n                context.onValueChange(value);\n              }\n            })\n          }\n        )\n      }\n    );\n  }\n);\nTabsTrigger.displayName = TRIGGER_NAME;\nvar CONTENT_NAME = \"TabsContent\";\nvar TabsContent = React3.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeTabs, value, forceMount, children, ...contentProps } = props;\n    const context = useTabsContext(CONTENT_NAME, __scopeTabs);\n    const triggerId = makeTriggerId(context.baseId, value);\n    const contentId = makeContentId(context.baseId, value);\n    const isSelected = value === context.value;\n    const isMountAnimationPreventedRef = React3.useRef(isSelected);\n    React3.useEffect(() => {\n      const rAF = requestAnimationFrame(() => isMountAnimationPreventedRef.current = false);\n      return () => cancelAnimationFrame(rAF);\n    }, []);\n    return (0, import_jsx_runtime.jsx)(Presence, { present: forceMount || isSelected, children: ({ present }) => (0, import_jsx_runtime.jsx)(\n      Primitive.div,\n      {\n        \"data-state\": isSelected ? \"active\" : \"inactive\",\n        \"data-orientation\": context.orientation,\n        role: \"tabpanel\",\n        \"aria-labelledby\": triggerId,\n        hidden: !present,\n        id: contentId,\n        tabIndex: 0,\n        ...contentProps,\n        ref: forwardedRef,\n        style: {\n          ...props.style,\n          animationDuration: isMountAnimationPreventedRef.current ? \"0s\" : void 0\n        },\n        children: present && children\n      }\n    ) });\n  }\n);\nTabsContent.displayName = CONTENT_NAME;\nfunction makeTriggerId(baseId, value) {\n  return `${baseId}-trigger-${value}`;\n}\nfunction makeContentId(baseId, value) {\n  return `${baseId}-content-${value}`;\n}\nvar Root2 = Tabs;\nvar List = TabsList;\nvar Trigger = TabsTrigger;\nvar Content = TabsContent;\nexport {\n  Content,\n  List,\n  Root2 as Root,\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n  Trigger,\n  createTabsScope\n};\n//# sourceMappingURL=@radix-ui_react-tabs.js.map\n","path":null,"size_bytes":9471,"size_tokens":null},"node_modules/.vite/deps/@radix-ui_react-alert-dialog.js":{"content":"\"use client\";\nimport {\n  Close,\n  Content,\n  Description,\n  Overlay,\n  Portal,\n  Root,\n  Title,\n  Trigger,\n  WarningProvider,\n  createDialogScope\n} from \"./chunk-LVLQUKSV.js\";\nimport \"./chunk-R3YZKR5V.js\";\nimport \"./chunk-734E7IPH.js\";\nimport \"./chunk-QANW4NWU.js\";\nimport \"./chunk-5FCDBCET.js\";\nimport \"./chunk-JB42X4KE.js\";\nimport \"./chunk-YRTNRKIT.js\";\nimport {\n  createContextScope\n} from \"./chunk-6KE3XZZ5.js\";\nimport {\n  composeRefs,\n  useComposedRefs\n} from \"./chunk-WGRQAFEQ.js\";\nimport {\n  require_jsx_runtime\n} from \"./chunk-FXVZLN7E.js\";\nimport \"./chunk-F5X6INBZ.js\";\nimport {\n  require_react\n} from \"./chunk-KMU3Z7QX.js\";\nimport {\n  __toESM\n} from \"./chunk-G3PMV62Z.js\";\n\n// node_modules/@radix-ui/react-alert-dialog/dist/index.mjs\nvar React2 = __toESM(require_react(), 1);\n\n// node_modules/@radix-ui/react-alert-dialog/node_modules/@radix-ui/primitive/dist/index.mjs\nvar canUseDOM = !!(typeof window !== \"undefined\" && window.document && window.document.createElement);\nfunction composeEventHandlers(originalEventHandler, ourEventHandler, { checkForDefaultPrevented = true } = {}) {\n  return function handleEvent(event) {\n    originalEventHandler?.(event);\n    if (checkForDefaultPrevented === false || !event.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n}\n\n// node_modules/@radix-ui/react-alert-dialog/node_modules/@radix-ui/react-slot/dist/index.mjs\nvar React = __toESM(require_react(), 1);\nvar import_jsx_runtime = __toESM(require_jsx_runtime(), 1);\nfunction createSlot(ownerName) {\n  const SlotClone = createSlotClone(ownerName);\n  const Slot2 = React.forwardRef((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n    const childrenArray = React.Children.toArray(children);\n    const slottable = childrenArray.find(isSlottable);\n    if (slottable) {\n      const newElement = slottable.props.children;\n      const newChildren = childrenArray.map((child) => {\n        if (child === slottable) {\n          if (React.Children.count(newElement) > 1) return React.Children.only(null);\n          return React.isValidElement(newElement) ? newElement.props.children : null;\n        } else {\n          return child;\n        }\n      });\n      return (0, import_jsx_runtime.jsx)(SlotClone, { ...slotProps, ref: forwardedRef, children: React.isValidElement(newElement) ? React.cloneElement(newElement, void 0, newChildren) : null });\n    }\n    return (0, import_jsx_runtime.jsx)(SlotClone, { ...slotProps, ref: forwardedRef, children });\n  });\n  Slot2.displayName = `${ownerName}.Slot`;\n  return Slot2;\n}\nvar Slot = createSlot(\"Slot\");\nfunction createSlotClone(ownerName) {\n  const SlotClone = React.forwardRef((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n    if (React.isValidElement(children)) {\n      const childrenRef = getElementRef(children);\n      const props2 = mergeProps(slotProps, children.props);\n      if (children.type !== React.Fragment) {\n        props2.ref = forwardedRef ? composeRefs(forwardedRef, childrenRef) : childrenRef;\n      }\n      return React.cloneElement(children, props2);\n    }\n    return React.Children.count(children) > 1 ? React.Children.only(null) : null;\n  });\n  SlotClone.displayName = `${ownerName}.SlotClone`;\n  return SlotClone;\n}\nvar SLOTTABLE_IDENTIFIER = Symbol(\"radix.slottable\");\nfunction createSlottable(ownerName) {\n  const Slottable22 = ({ children }) => {\n    return (0, import_jsx_runtime.jsx)(import_jsx_runtime.Fragment, { children });\n  };\n  Slottable22.displayName = `${ownerName}.Slottable`;\n  Slottable22.__radixId = SLOTTABLE_IDENTIFIER;\n  return Slottable22;\n}\nvar Slottable = createSlottable(\"Slottable\");\nfunction isSlottable(child) {\n  return React.isValidElement(child) && typeof child.type === \"function\" && \"__radixId\" in child.type && child.type.__radixId === SLOTTABLE_IDENTIFIER;\n}\nfunction mergeProps(slotProps, childProps) {\n  const overrideProps = { ...childProps };\n  for (const propName in childProps) {\n    const slotPropValue = slotProps[propName];\n    const childPropValue = childProps[propName];\n    const isHandler = /^on[A-Z]/.test(propName);\n    if (isHandler) {\n      if (slotPropValue && childPropValue) {\n        overrideProps[propName] = (...args) => {\n          const result = childPropValue(...args);\n          slotPropValue(...args);\n          return result;\n        };\n      } else if (slotPropValue) {\n        overrideProps[propName] = slotPropValue;\n      }\n    } else if (propName === \"style\") {\n      overrideProps[propName] = { ...slotPropValue, ...childPropValue };\n    } else if (propName === \"className\") {\n      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(\" \");\n    }\n  }\n  return { ...slotProps, ...overrideProps };\n}\nfunction getElementRef(element) {\n  let getter = Object.getOwnPropertyDescriptor(element.props, \"ref\")?.get;\n  let mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.ref;\n  }\n  getter = Object.getOwnPropertyDescriptor(element, \"ref\")?.get;\n  mayWarn = getter && \"isReactWarning\" in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.props.ref;\n  }\n  return element.props.ref || element.ref;\n}\n\n// node_modules/@radix-ui/react-alert-dialog/dist/index.mjs\nvar import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);\nvar ROOT_NAME = \"AlertDialog\";\nvar [createAlertDialogContext, createAlertDialogScope] = createContextScope(ROOT_NAME, [\n  createDialogScope\n]);\nvar useDialogScope = createDialogScope();\nvar AlertDialog = (props) => {\n  const { __scopeAlertDialog, ...alertDialogProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return (0, import_jsx_runtime2.jsx)(Root, { ...dialogScope, ...alertDialogProps, modal: true });\n};\nAlertDialog.displayName = ROOT_NAME;\nvar TRIGGER_NAME = \"AlertDialogTrigger\";\nvar AlertDialogTrigger = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...triggerProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return (0, import_jsx_runtime2.jsx)(Trigger, { ...dialogScope, ...triggerProps, ref: forwardedRef });\n  }\n);\nAlertDialogTrigger.displayName = TRIGGER_NAME;\nvar PORTAL_NAME = \"AlertDialogPortal\";\nvar AlertDialogPortal = (props) => {\n  const { __scopeAlertDialog, ...portalProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return (0, import_jsx_runtime2.jsx)(Portal, { ...dialogScope, ...portalProps });\n};\nAlertDialogPortal.displayName = PORTAL_NAME;\nvar OVERLAY_NAME = \"AlertDialogOverlay\";\nvar AlertDialogOverlay = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...overlayProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return (0, import_jsx_runtime2.jsx)(Overlay, { ...dialogScope, ...overlayProps, ref: forwardedRef });\n  }\n);\nAlertDialogOverlay.displayName = OVERLAY_NAME;\nvar CONTENT_NAME = \"AlertDialogContent\";\nvar [AlertDialogContentProvider, useAlertDialogContentContext] = createAlertDialogContext(CONTENT_NAME);\nvar Slottable2 = createSlottable(\"AlertDialogContent\");\nvar AlertDialogContent = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, children, ...contentProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    const contentRef = React2.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef);\n    const cancelRef = React2.useRef(null);\n    return (0, import_jsx_runtime2.jsx)(\n      WarningProvider,\n      {\n        contentName: CONTENT_NAME,\n        titleName: TITLE_NAME,\n        docsSlug: \"alert-dialog\",\n        children: (0, import_jsx_runtime2.jsx)(AlertDialogContentProvider, { scope: __scopeAlertDialog, cancelRef, children: (0, import_jsx_runtime2.jsxs)(\n          Content,\n          {\n            role: \"alertdialog\",\n            ...dialogScope,\n            ...contentProps,\n            ref: composedRefs,\n            onOpenAutoFocus: composeEventHandlers(contentProps.onOpenAutoFocus, (event) => {\n              event.preventDefault();\n              cancelRef.current?.focus({ preventScroll: true });\n            }),\n            onPointerDownOutside: (event) => event.preventDefault(),\n            onInteractOutside: (event) => event.preventDefault(),\n            children: [\n              (0, import_jsx_runtime2.jsx)(Slottable2, { children }),\n              (0, import_jsx_runtime2.jsx)(DescriptionWarning, { contentRef })\n            ]\n          }\n        ) })\n      }\n    );\n  }\n);\nAlertDialogContent.displayName = CONTENT_NAME;\nvar TITLE_NAME = \"AlertDialogTitle\";\nvar AlertDialogTitle = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...titleProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return (0, import_jsx_runtime2.jsx)(Title, { ...dialogScope, ...titleProps, ref: forwardedRef });\n  }\n);\nAlertDialogTitle.displayName = TITLE_NAME;\nvar DESCRIPTION_NAME = \"AlertDialogDescription\";\nvar AlertDialogDescription = React2.forwardRef((props, forwardedRef) => {\n  const { __scopeAlertDialog, ...descriptionProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return (0, import_jsx_runtime2.jsx)(Description, { ...dialogScope, ...descriptionProps, ref: forwardedRef });\n});\nAlertDialogDescription.displayName = DESCRIPTION_NAME;\nvar ACTION_NAME = \"AlertDialogAction\";\nvar AlertDialogAction = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...actionProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return (0, import_jsx_runtime2.jsx)(Close, { ...dialogScope, ...actionProps, ref: forwardedRef });\n  }\n);\nAlertDialogAction.displayName = ACTION_NAME;\nvar CANCEL_NAME = \"AlertDialogCancel\";\nvar AlertDialogCancel = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...cancelProps } = props;\n    const { cancelRef } = useAlertDialogContentContext(CANCEL_NAME, __scopeAlertDialog);\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    const ref = useComposedRefs(forwardedRef, cancelRef);\n    return (0, import_jsx_runtime2.jsx)(Close, { ...dialogScope, ...cancelProps, ref });\n  }\n);\nAlertDialogCancel.displayName = CANCEL_NAME;\nvar DescriptionWarning = ({ contentRef }) => {\n  const MESSAGE = `\\`${CONTENT_NAME}\\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \\`${CONTENT_NAME}\\` by passing a \\`${DESCRIPTION_NAME}\\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \\`id\\` and passing the same value to the \\`aria-describedby\\` prop in \\`${CONTENT_NAME}\\`. If the description is confusing or duplicative for sighted users, you can use the \\`@radix-ui/react-visually-hidden\\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;\n  React2.useEffect(() => {\n    const hasDescription = document.getElementById(\n      contentRef.current?.getAttribute(\"aria-describedby\")\n    );\n    if (!hasDescription) console.warn(MESSAGE);\n  }, [MESSAGE, contentRef]);\n  return null;\n};\nvar Root2 = AlertDialog;\nvar Trigger2 = AlertDialogTrigger;\nvar Portal2 = AlertDialogPortal;\nvar Overlay2 = AlertDialogOverlay;\nvar Content2 = AlertDialogContent;\nvar Action = AlertDialogAction;\nvar Cancel = AlertDialogCancel;\nvar Title2 = AlertDialogTitle;\nvar Description2 = AlertDialogDescription;\nexport {\n  Action,\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogOverlay,\n  AlertDialogPortal,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n  Cancel,\n  Content2 as Content,\n  Description2 as Description,\n  Overlay2 as Overlay,\n  Portal2 as Portal,\n  Root2 as Root,\n  Title2 as Title,\n  Trigger2 as Trigger,\n  createAlertDialogScope\n};\n//# sourceMappingURL=@radix-ui_react-alert-dialog.js.map\n","path":null,"size_bytes":12060,"size_tokens":null},"node_modules/.vite/deps/@radix-ui_react-label.js":{"content":"\"use client\";\nimport {\n  createSlot\n} from \"./chunk-IZJL53QL.js\";\nimport \"./chunk-WGRQAFEQ.js\";\nimport {\n  require_jsx_runtime\n} from \"./chunk-FXVZLN7E.js\";\nimport {\n  require_react_dom\n} from \"./chunk-F5X6INBZ.js\";\nimport {\n  require_react\n} from \"./chunk-KMU3Z7QX.js\";\nimport {\n  __toESM\n} from \"./chunk-G3PMV62Z.js\";\n\n// node_modules/@radix-ui/react-label/dist/index.mjs\nvar React2 = __toESM(require_react(), 1);\n\n// node_modules/@radix-ui/react-label/node_modules/@radix-ui/react-primitive/dist/index.mjs\nvar React = __toESM(require_react(), 1);\nvar ReactDOM = __toESM(require_react_dom(), 1);\nvar import_jsx_runtime = __toESM(require_jsx_runtime(), 1);\nvar NODES = [\n  \"a\",\n  \"button\",\n  \"div\",\n  \"form\",\n  \"h2\",\n  \"h3\",\n  \"img\",\n  \"input\",\n  \"label\",\n  \"li\",\n  \"nav\",\n  \"ol\",\n  \"p\",\n  \"select\",\n  \"span\",\n  \"svg\",\n  \"ul\"\n];\nvar Primitive = NODES.reduce((primitive, node) => {\n  const Slot = createSlot(`Primitive.${node}`);\n  const Node = React.forwardRef((props, forwardedRef) => {\n    const { asChild, ...primitiveProps } = props;\n    const Comp = asChild ? Slot : node;\n    if (typeof window !== \"undefined\") {\n      window[Symbol.for(\"radix-ui\")] = true;\n    }\n    return (0, import_jsx_runtime.jsx)(Comp, { ...primitiveProps, ref: forwardedRef });\n  });\n  Node.displayName = `Primitive.${node}`;\n  return { ...primitive, [node]: Node };\n}, {});\n\n// node_modules/@radix-ui/react-label/dist/index.mjs\nvar import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);\nvar NAME = \"Label\";\nvar Label = React2.forwardRef((props, forwardedRef) => {\n  return (0, import_jsx_runtime2.jsx)(\n    Primitive.label,\n    {\n      ...props,\n      ref: forwardedRef,\n      onMouseDown: (event) => {\n        const target = event.target;\n        if (target.closest(\"button, input, select, textarea\")) return;\n        props.onMouseDown?.(event);\n        if (!event.defaultPrevented && event.detail > 1) event.preventDefault();\n      }\n    }\n  );\n});\nLabel.displayName = NAME;\nvar Root = Label;\nexport {\n  Label,\n  Root\n};\n//# sourceMappingURL=@radix-ui_react-label.js.map\n","path":null,"size_bytes":2057,"size_tokens":null},"node_modules/.vite/deps/@radix-ui_react-switch.js":{"content":"\"use client\";\nimport {\n  usePrevious\n} from \"./chunk-3GL6P6IT.js\";\nimport {\n  useSize\n} from \"./chunk-JTRY5A5K.js\";\nimport {\n  Primitive\n} from \"./chunk-YRTNRKIT.js\";\nimport {\n  createContextScope,\n  useLayoutEffect2\n} from \"./chunk-6KE3XZZ5.js\";\nimport {\n  useComposedRefs\n} from \"./chunk-WGRQAFEQ.js\";\nimport {\n  require_jsx_runtime\n} from \"./chunk-FXVZLN7E.js\";\nimport \"./chunk-F5X6INBZ.js\";\nimport {\n  require_react\n} from \"./chunk-KMU3Z7QX.js\";\nimport {\n  __toESM\n} from \"./chunk-G3PMV62Z.js\";\n\n// node_modules/@radix-ui/react-switch/dist/index.mjs\nvar React3 = __toESM(require_react(), 1);\n\n// node_modules/@radix-ui/react-switch/node_modules/@radix-ui/primitive/dist/index.mjs\nvar canUseDOM = !!(typeof window !== \"undefined\" && window.document && window.document.createElement);\nfunction composeEventHandlers(originalEventHandler, ourEventHandler, { checkForDefaultPrevented = true } = {}) {\n  return function handleEvent(event) {\n    originalEventHandler?.(event);\n    if (checkForDefaultPrevented === false || !event.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n}\n\n// node_modules/@radix-ui/react-switch/node_modules/@radix-ui/react-use-controllable-state/dist/index.mjs\nvar React = __toESM(require_react(), 1);\nvar React2 = __toESM(require_react(), 1);\nvar useInsertionEffect = React[\" useInsertionEffect \".trim().toString()] || useLayoutEffect2;\nfunction useControllableState({\n  prop,\n  defaultProp,\n  onChange = () => {\n  },\n  caller\n}) {\n  const [uncontrolledProp, setUncontrolledProp, onChangeRef] = useUncontrolledState({\n    defaultProp,\n    onChange\n  });\n  const isControlled = prop !== void 0;\n  const value = isControlled ? prop : uncontrolledProp;\n  if (true) {\n    const isControlledRef = React.useRef(prop !== void 0);\n    React.useEffect(() => {\n      const wasControlled = isControlledRef.current;\n      if (wasControlled !== isControlled) {\n        const from = wasControlled ? \"controlled\" : \"uncontrolled\";\n        const to = isControlled ? \"controlled\" : \"uncontrolled\";\n        console.warn(\n          `${caller} is changing from ${from} to ${to}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`\n        );\n      }\n      isControlledRef.current = isControlled;\n    }, [isControlled, caller]);\n  }\n  const setValue = React.useCallback(\n    (nextValue) => {\n      if (isControlled) {\n        const value2 = isFunction(nextValue) ? nextValue(prop) : nextValue;\n        if (value2 !== prop) {\n          onChangeRef.current?.(value2);\n        }\n      } else {\n        setUncontrolledProp(nextValue);\n      }\n    },\n    [isControlled, prop, setUncontrolledProp, onChangeRef]\n  );\n  return [value, setValue];\n}\nfunction useUncontrolledState({\n  defaultProp,\n  onChange\n}) {\n  const [value, setValue] = React.useState(defaultProp);\n  const prevValueRef = React.useRef(value);\n  const onChangeRef = React.useRef(onChange);\n  useInsertionEffect(() => {\n    onChangeRef.current = onChange;\n  }, [onChange]);\n  React.useEffect(() => {\n    if (prevValueRef.current !== value) {\n      onChangeRef.current?.(value);\n      prevValueRef.current = value;\n    }\n  }, [value, prevValueRef]);\n  return [value, setValue, onChangeRef];\n}\nfunction isFunction(value) {\n  return typeof value === \"function\";\n}\nvar SYNC_STATE = Symbol(\"RADIX:SYNC_STATE\");\n\n// node_modules/@radix-ui/react-switch/dist/index.mjs\nvar import_jsx_runtime = __toESM(require_jsx_runtime(), 1);\nvar SWITCH_NAME = \"Switch\";\nvar [createSwitchContext, createSwitchScope] = createContextScope(SWITCH_NAME);\nvar [SwitchProvider, useSwitchContext] = createSwitchContext(SWITCH_NAME);\nvar Switch = React3.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeSwitch,\n      name,\n      checked: checkedProp,\n      defaultChecked,\n      required,\n      disabled,\n      value = \"on\",\n      onCheckedChange,\n      form,\n      ...switchProps\n    } = props;\n    const [button, setButton] = React3.useState(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setButton(node));\n    const hasConsumerStoppedPropagationRef = React3.useRef(false);\n    const isFormControl = button ? form || !!button.closest(\"form\") : true;\n    const [checked, setChecked] = useControllableState({\n      prop: checkedProp,\n      defaultProp: defaultChecked ?? false,\n      onChange: onCheckedChange,\n      caller: SWITCH_NAME\n    });\n    return (0, import_jsx_runtime.jsxs)(SwitchProvider, { scope: __scopeSwitch, checked, disabled, children: [\n      (0, import_jsx_runtime.jsx)(\n        Primitive.button,\n        {\n          type: \"button\",\n          role: \"switch\",\n          \"aria-checked\": checked,\n          \"aria-required\": required,\n          \"data-state\": getState(checked),\n          \"data-disabled\": disabled ? \"\" : void 0,\n          disabled,\n          value,\n          ...switchProps,\n          ref: composedRefs,\n          onClick: composeEventHandlers(props.onClick, (event) => {\n            setChecked((prevChecked) => !prevChecked);\n            if (isFormControl) {\n              hasConsumerStoppedPropagationRef.current = event.isPropagationStopped();\n              if (!hasConsumerStoppedPropagationRef.current) event.stopPropagation();\n            }\n          })\n        }\n      ),\n      isFormControl && (0, import_jsx_runtime.jsx)(\n        SwitchBubbleInput,\n        {\n          control: button,\n          bubbles: !hasConsumerStoppedPropagationRef.current,\n          name,\n          value,\n          checked,\n          required,\n          disabled,\n          form,\n          style: { transform: \"translateX(-100%)\" }\n        }\n      )\n    ] });\n  }\n);\nSwitch.displayName = SWITCH_NAME;\nvar THUMB_NAME = \"SwitchThumb\";\nvar SwitchThumb = React3.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeSwitch, ...thumbProps } = props;\n    const context = useSwitchContext(THUMB_NAME, __scopeSwitch);\n    return (0, import_jsx_runtime.jsx)(\n      Primitive.span,\n      {\n        \"data-state\": getState(context.checked),\n        \"data-disabled\": context.disabled ? \"\" : void 0,\n        ...thumbProps,\n        ref: forwardedRef\n      }\n    );\n  }\n);\nSwitchThumb.displayName = THUMB_NAME;\nvar BUBBLE_INPUT_NAME = \"SwitchBubbleInput\";\nvar SwitchBubbleInput = React3.forwardRef(\n  ({\n    __scopeSwitch,\n    control,\n    checked,\n    bubbles = true,\n    ...props\n  }, forwardedRef) => {\n    const ref = React3.useRef(null);\n    const composedRefs = useComposedRefs(ref, forwardedRef);\n    const prevChecked = usePrevious(checked);\n    const controlSize = useSize(control);\n    React3.useEffect(() => {\n      const input = ref.current;\n      if (!input) return;\n      const inputProto = window.HTMLInputElement.prototype;\n      const descriptor = Object.getOwnPropertyDescriptor(\n        inputProto,\n        \"checked\"\n      );\n      const setChecked = descriptor.set;\n      if (prevChecked !== checked && setChecked) {\n        const event = new Event(\"click\", { bubbles });\n        setChecked.call(input, checked);\n        input.dispatchEvent(event);\n      }\n    }, [prevChecked, checked, bubbles]);\n    return (0, import_jsx_runtime.jsx)(\n      \"input\",\n      {\n        type: \"checkbox\",\n        \"aria-hidden\": true,\n        defaultChecked: checked,\n        ...props,\n        tabIndex: -1,\n        ref: composedRefs,\n        style: {\n          ...props.style,\n          ...controlSize,\n          position: \"absolute\",\n          pointerEvents: \"none\",\n          opacity: 0,\n          margin: 0\n        }\n      }\n    );\n  }\n);\nSwitchBubbleInput.displayName = BUBBLE_INPUT_NAME;\nfunction getState(checked) {\n  return checked ? \"checked\" : \"unchecked\";\n}\nvar Root = Switch;\nvar Thumb = SwitchThumb;\nexport {\n  Root,\n  Switch,\n  SwitchThumb,\n  Thumb,\n  createSwitchScope\n};\n//# sourceMappingURL=@radix-ui_react-switch.js.map\n","path":null,"size_bytes":7861,"size_tokens":null},"client/src/pages/archive.tsx":{"content":"import { useState, useMemo, useEffect, useCallback } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter, DialogClose } from \"@/components/ui/dialog\";\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription } from \"@/components/ui/sheet\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { \n  Archive,\n  MessageSquare,\n  Calendar as CalendarIcon,\n  Pin,\n  Flag,\n  Search,\n  Filter,\n  ExternalLink,\n  Edit,\n  Trash2,\n  Eye,\n  ChevronLeft,\n  ChevronRight,\n  Loader,\n  TrendingUp,\n  TrendingDown,\n  Clock,\n  X,\n  Save,\n  RefreshCw,\n  FileText,\n  MapPin,\n  Tag,\n  User,\n  Newspaper,\n  Hash,\n  LayoutGrid,\n  LayoutList,\n  Download,\n  Printer,\n  Share2,\n  Copy,\n  CheckCircle,\n  AlertCircle,\n  BarChart3,\n  Sparkles,\n  Zap,\n  BookOpen,\n  FolderOpen,\n  ArrowUpRight,\n  ArrowDownRight,\n  CheckCheck,\n  XCircle,\n  MoreHorizontal,\n  Image,\n  Video,\n  FileAudio,\n  File,\n  Star,\n  Activity,\n  Volume2,\n  Play,\n  Pause,\n  StopCircle,\n  Settings,\n  ChevronDown,\n  ChevronUp,\n  Maximize2,\n  Minimize2\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { format, startOfDay, endOfDay, subDays, startOfWeek, endOfWeek, differenceInDays, parseISO } from \"date-fns\";\nimport { ar } from \"date-fns/locale\";\nimport { cn } from \"@/lib/utils\";\nimport { AreaChart, Area, ResponsiveContainer, XAxis, YAxis, Tooltip as RechartsTooltip, BarChart, Bar } from \"recharts\";\nimport { startOfMonth, endOfMonth } from \"date-fns\";\n\ninterface ArchiveMessage {\n  id: number;\n  taskId: number;\n  serialNumber: number;\n  title: string | null;\n  originalText: string | null;\n  processedText: string | null;\n  publishedText: string | null;\n  telegraphUrl: string | null;\n  telegraphTitle: string | null;\n  classification: string | null;\n  newsType: string | null;\n  province: string | null;\n  specialist: string | null;\n  tags: string[] | null;\n  extractedFields: any | null;\n  hasMedia: boolean;\n  mediaType: string | null;\n  mediaCount: number | null;\n  status: string;\n  isPinned: boolean;\n  isFlagged: boolean;\n  flagReason: string | null;\n  notes: string | null;\n  sourceChannelTitle: string | null;\n  targetChannelTitle: string | null;\n  createdAt: string;\n  updatedAt: string;\n  editedAt: string | null;\n}\n\ninterface ArchiveFilters {\n  taskId?: number;\n  search: string;\n  classification: string;\n  province: string;\n  newsType: string;\n  specialist: string;\n  sourceChannelTitle: string;\n  dateFrom: string;\n  dateTo: string;\n  isPinned?: boolean;\n  isFlagged?: boolean;\n  hasMedia?: boolean;\n  sortBy: string;\n  sortOrder: 'asc' | 'desc';\n}\n\ntype ViewMode = 'list' | 'grid' | 'compact';\n\nconst ITEMS_PER_PAGE = 20;\nconst STORAGE_KEY = 'archive-filters';\n\nexport default function ArchivePage() {\n  const queryClient = useQueryClient();\n  const [page, setPage] = useState(1);\n  const [viewMode, setViewMode] = useState<ViewMode>('list');\n  const [selectedIds, setSelectedIds] = useState<Set<number>>(new Set());\n  const [selectAll, setSelectAll] = useState(false);\n  const [copiedId, setCopiedId] = useState<number | null>(null);\n  const [showAdvancedStats, setShowAdvancedStats] = useState(false);\n\n  // TTS States\n  const [ttsDialogOpen, setTtsDialogOpen] = useState(false);\n  const [selectedVoice, setSelectedVoice] = useState(\"Nasser-PlayAI\");\n  const [audioUrl, setAudioUrl] = useState<string | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [audioElement, setAudioElement] = useState<HTMLAudioElement | null>(null);\n  const [ttsMessage, setTtsMessage] = useState<ArchiveMessage | null>(null);\n\n  // HTML Export States\n  const [htmlExportDialogOpen, setHtmlExportDialogOpen] = useState(false);\n  const [htmlExportType, setHtmlExportType] = useState<'day' | 'range' | 'month'>('day');\n  const [htmlExportDate, setHtmlExportDate] = useState<Date>(new Date());\n  const [htmlExportDateFrom, setHtmlExportDateFrom] = useState<Date>(new Date());\n  const [htmlExportDateTo, setHtmlExportDateTo] = useState<Date>(new Date());\n  const [htmlExportMonth, setHtmlExportMonth] = useState<Date>(new Date());\n  const [htmlExportLoading, setHtmlExportLoading] = useState(false);\n  const [htmlDatePickerOpen, setHtmlDatePickerOpen] = useState<'day' | 'from' | 'to' | 'month' | null>(null);\n\n  const [filters, setFilters] = useState<ArchiveFilters>(() => {\n    const saved = localStorage.getItem(STORAGE_KEY);\n    if (saved) {\n      try {\n        return JSON.parse(saved);\n      } catch {\n        return getDefaultFilters();\n      }\n    }\n    return getDefaultFilters();\n  });\n\n  const [showFilters, setShowFilters] = useState(false);\n  const [selectedMessage, setSelectedMessage] = useState<ArchiveMessage | null>(null);\n  const [previewMessageId, setPreviewMessageId] = useState<number | null>(null);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [bulkDeleteDialogOpen, setBulkDeleteDialogOpen] = useState(false);\n  const [messageToDelete, setMessageToDelete] = useState<ArchiveMessage | null>(null);\n  const [editForm, setEditForm] = useState({ \n    title: '',\n    classification: '',\n    newsType: '',\n    province: '',\n    specialist: '',\n    originalText: '',\n    summary: '',\n    sourceChannelTitle: ''\n  });\n  const [datePickerOpen, setDatePickerOpen] = useState<'from' | 'to' | null>(null);\n  const [searchDebounce, setSearchDebounce] = useState('');\n\n  function getDefaultFilters(): ArchiveFilters {\n    return {\n      search: '',\n      classification: '',\n      province: '',\n      newsType: '',\n      specialist: '',\n      sourceChannelTitle: '',\n      dateFrom: '',\n      dateTo: '',\n      sortBy: 'createdAt',\n      sortOrder: 'desc'\n    };\n  }\n\n  useEffect(() => {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(filters));\n  }, [filters]);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setFilters(f => ({ ...f, search: searchDebounce }));\n      setPage(1);\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [searchDebounce]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        setEditDialogOpen(false);\n        setSelectedIds(new Set());\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'f') {\n        e.preventDefault();\n        setShowFilters(true);\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'a' && selectedIds.size > 0) {\n        e.preventDefault();\n        setSelectAll(!selectAll);\n      }\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [selectAll, selectedIds]);\n\n  const { data: tasks = [] } = useQuery({\n    queryKey: [\"tasks\"],\n    queryFn: () => api.getTasks(),\n  });\n\n  const { data: stats, isLoading: loadingStats } = useQuery({\n    queryKey: [\"archive-stats\", filters.taskId],\n    queryFn: () => api.getArchiveStats(filters.taskId),\n    refetchInterval: 30000,\n  });\n\n  const { data: filterOptions } = useQuery({\n    queryKey: [\"archive-filter-options\", filters.taskId],\n    queryFn: () => api.getArchiveFilterOptions(filters.taskId),\n  });\n\n  const { data: ttsVoices } = useQuery({\n    queryKey: [\"tts-voices\"],\n    queryFn: () => api.getTTSVoices(),\n  });\n\n  const { data: ttsStatus } = useQuery({\n    queryKey: [\"tts-status\"],\n    queryFn: () => api.getTTSStatus(),\n  });\n\n  const textToSpeechMutation = useMutation({\n    mutationFn: ({ text, voice }: { text: string; voice: string }) => \n      api.textToSpeech(text, voice),\n    onSuccess: (data) => {\n      if (data.needsApiKey) {\n        toast.error(\"Ÿäÿ¨ÿ® ÿ™ŸÉŸàŸäŸÜ GROQ_API_KEY ŸÅŸä ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ©\");\n        return;\n      }\n\n      // Convert base64 to audio URL\n      const audioBlob = new Blob(\n        [Uint8Array.from(atob(data.audio), c => c.charCodeAt(0))],\n        { type: 'audio/mpeg' }\n      );\n      const url = URL.createObjectURL(audioBlob);\n      setAudioUrl(url);\n\n      // Create audio element\n      const audio = new Audio(url);\n      audio.onended = () => setIsPlaying(false);\n      setAudioElement(audio);\n\n      toast.success(\"ÿ™ŸÖ ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿµŸàÿ™ ÿ®ŸÜÿ¨ÿßÿ≠\");\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"ŸÅÿ¥ŸÑ ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿµŸàÿ™\");\n    },\n  });\n\n  const { data: archiveData, isLoading: loadingArchive, refetch: refetchArchive } = useQuery({\n    queryKey: [\"archive-messages\", filters, page],\n    queryFn: () => api.getArchiveMessages({\n      ...filters,\n      taskId: filters.taskId,\n      limit: ITEMS_PER_PAGE,\n      offset: (page - 1) * ITEMS_PER_PAGE,\n    }),\n  });\n\n  const messages = archiveData?.messages || [];\n  const totalMessages = archiveData?.total || 0;\n  const totalPages = Math.ceil(totalMessages / ITEMS_PER_PAGE);\n\n  const activityData = useMemo(() => {\n    if (!stats?.recentActivity) return [];\n    return stats.recentActivity.slice(0, 7).reverse().map((item: any) => ({\n      date: format(parseISO(item.date), 'EEE', { locale: ar }),\n      count: item.count,\n      fullDate: item.date\n    }));\n  }, [stats]);\n\n  const updateMessageMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => api.updateArchiveMessage(id, data),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ®ŸÜÿ¨ÿßÿ≠\");\n      queryClient.invalidateQueries({ queryKey: [\"archive-messages\"] });\n      setEditDialogOpen(false);\n    },\n    onError: () => {\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©\");\n    },\n  });\n\n  const deleteMessageMutation = useMutation({\n    mutationFn: (id: number) => api.deleteArchiveMessage(id),\n    onSuccess: () => {\n      toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"archive-messages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"archive-stats\"] });\n      setDeleteDialogOpen(false);\n      setMessageToDelete(null);\n    },\n    onError: () => {\n      toast.error(\"ŸÅÿ¥ŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©\");\n    },\n  });\n\n  const togglePinMutation = useMutation({\n    mutationFn: (id: number) => api.toggleArchivePin(id),\n    onSuccess: (data) => {\n      toast.success(data.isPinned ? \"ÿ™ŸÖ ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©\" : \"ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"archive-messages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"archive-stats\"] });\n    },\n  });\n\n  const toggleFlagMutation = useMutation({\n    mutationFn: (id: number) => api.toggleArchiveFlag(id),\n    onSuccess: (data) => {\n      toast.success(data.isFlagged ? \"ÿ™ŸÖ ÿ™ÿπŸÑŸäŸÖ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©\" : \"ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿ™ÿπŸÑŸäŸÖ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©\");\n      queryClient.invalidateQueries({ queryKey: [\"archive-messages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"archive-stats\"] });\n    },\n  });\n\n  const handleTogglePreview = (message: ArchiveMessage) => {\n    if (previewMessageId === message.id) {\n      setPreviewMessageId(null);\n      setSelectedMessage(null);\n    } else {\n      setPreviewMessageId(message.id);\n      setSelectedMessage(message);\n    }\n  };\n\n  const handleOpenEdit = (message: ArchiveMessage) => {\n    setSelectedMessage(message);\n    const ef = message.extractedFields || {};\n    setEditForm({\n      title: message.title || ef.title || ef.ÿßŸÑÿπŸÜŸàÿßŸÜ || '',\n      classification: message.classification || ef.category || ef.ÿßŸÑÿ™ÿµŸÜŸäŸÅ || ef.classification || '',\n      newsType: message.newsType || ef.news_type || ef.ŸÜŸàÿπ_ÿßŸÑÿÆÿ®ÿ± || ef.newsType || '',\n      province: message.province || ef.governorate || ef.ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© || ef.province || '',\n      specialist: message.specialist || ef.specialist || ef.ÿßŸÑŸÖÿÆÿ™ÿµ || '',\n      originalText: message.originalText || '',\n      summary: ef.summary || ef.ŸÖŸÑÿÆÿµ || ef.ÿßŸÑÿ™ŸÑÿÆŸäÿµ || message.processedText || '',\n      sourceChannelTitle: message.sourceChannelTitle || ef.source_channel_title || ef.ÿßŸÑŸÖÿµÿØÿ± || ''\n    });\n    setEditDialogOpen(true);\n  };\n\n  const handleSaveEdit = () => {\n    if (!selectedMessage) return;\n    updateMessageMutation.mutate({\n      id: selectedMessage.id,\n      data: editForm\n    });\n  };\n\n  const handleOpenDelete = (message: ArchiveMessage) => {\n    setMessageToDelete(message);\n    setDeleteDialogOpen(true);\n  };\n\n  const handleConfirmDelete = () => {\n    if (!messageToDelete) return;\n    deleteMessageMutation.mutate(messageToDelete.id);\n  };\n\n  const handleBulkDelete = async () => {\n    const idsToDelete = Array.from(selectedIds);\n    for (const id of idsToDelete) {\n      await api.deleteArchiveMessage(id);\n    }\n    toast.success(`ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ${idsToDelete.length} ÿ±ÿ≥ÿßŸÑÿ©`);\n    setSelectedIds(new Set());\n    setBulkDeleteDialogOpen(false);\n    queryClient.invalidateQueries({ queryKey: [\"archive-messages\"] });\n    queryClient.invalidateQueries({ queryKey: [\"archive-stats\"] });\n  };\n\n  const handleBulkPin = async () => {\n    const idsToPin = Array.from(selectedIds);\n    for (const id of idsToPin) {\n      await api.toggleArchivePin(id);\n    }\n    toast.success(`ÿ™ŸÖ ÿ™ÿ´ÿ®Ÿäÿ™ ${idsToPin.length} ÿ±ÿ≥ÿßŸÑÿ©`);\n    setSelectedIds(new Set());\n    queryClient.invalidateQueries({ queryKey: [\"archive-messages\"] });\n  };\n\n  const handleBulkFlag = async () => {\n    const idsToFlag = Array.from(selectedIds);\n    for (const id of idsToFlag) {\n      await api.toggleArchiveFlag(id);\n    }\n    toast.success(`ÿ™ŸÖ ÿ™ÿπŸÑŸäŸÖ ${idsToFlag.length} ÿ±ÿ≥ÿßŸÑÿ©`);\n    setSelectedIds(new Set());\n    queryClient.invalidateQueries({ queryKey: [\"archive-messages\"] });\n  };\n\n  const handleCopyText = async (text: string, id: number) => {\n    await navigator.clipboard.writeText(text);\n    setCopiedId(id);\n    toast.success(\"ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑŸÜÿµ\");\n    setTimeout(() => setCopiedId(null), 2000);\n  };\n\n  const handleExportCSV = () => {\n    const headers = ['ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ', 'ÿßŸÑÿπŸÜŸàÿßŸÜ', 'ÿßŸÑÿ™ÿµŸÜŸäŸÅ', 'ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©', 'ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±', 'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ', 'ÿßŸÑŸÖÿµÿØÿ±'];\n    const rows = messages.map(m => [\n      m.serialNumber,\n      m.title || '',\n      m.classification || '',\n      m.province || '',\n      m.newsType || '',\n      format(new Date(m.createdAt), 'yyyy-MM-dd HH:mm'),\n      m.sourceChannelTitle || ''\n    ]);\n\n    const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\\n');\n    const blob = new Blob(['\\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `archive-${format(new Date(), 'yyyy-MM-dd')}.csv`;\n    link.click();\n    toast.success(\"ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\");\n  };\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  const handleExportHTML = async () => {\n    setHtmlExportLoading(true);\n    try {\n      let dateFrom: string;\n      let dateTo: string;\n      let periodLabel: string;\n\n      if (htmlExportType === 'day') {\n        dateFrom = format(htmlExportDate, 'yyyy-MM-dd');\n        dateTo = format(htmlExportDate, 'yyyy-MM-dd');\n        periodLabel = format(htmlExportDate, 'dd MMMM yyyy', { locale: ar });\n      } else if (htmlExportType === 'range') {\n        dateFrom = format(startOfDay(htmlExportDateFrom), 'yyyy-MM-dd');\n        dateTo = format(endOfDay(htmlExportDateTo), 'yyyy-MM-dd');\n        periodLabel = `${format(htmlExportDateFrom, 'dd/MM/yyyy')} - ${format(htmlExportDateTo, 'dd/MM/yyyy')}`;\n      } else {\n        dateFrom = format(startOfMonth(htmlExportMonth), 'yyyy-MM-dd');\n        dateTo = format(endOfMonth(htmlExportMonth), 'yyyy-MM-dd');\n        periodLabel = format(htmlExportMonth, 'MMMM yyyy', { locale: ar });\n      }\n\n      const response = await api.getArchiveMessages({\n        taskId: filters.taskId,\n        dateFrom,\n        dateTo,\n        classification: filters.classification,\n        province: filters.province,\n        newsType: filters.newsType,\n        specialist: filters.specialist,\n        sourceChannelTitle: filters.sourceChannelTitle,\n        search: filters.search,\n        sortBy: 'serialNumber',\n        sortOrder: 'asc',\n        limit: 1000,\n        offset: 0\n      });\n\n      const exportMessages = response?.messages || [];\n      \n      if (!exportMessages || exportMessages.length === 0) {\n        toast.error(\"ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ±ÿ≥ÿßÿ¶ŸÑ ŸÅŸä ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©\");\n        setHtmlExportDialogOpen(false);\n        setHtmlExportLoading(false);\n        return;\n      }\n\n      // Create HTML content with compact view style\n      let htmlContent = `<!DOCTYPE html>\n<html lang=\"ar\" dir=\"rtl\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    html, body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n      background-color: #f8fafc;\n      direction: rtl;\n      text-align: right;\n    }\n    body {\n      padding: 20px;\n    }\n    .container {\n      max-width: 1000px;\n      margin: 0 auto;\n      background: white;\n      padding: 30px;\n      border-radius: 8px;\n      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 30px;\n      border-bottom: 3px solid #2563eb;\n      padding-bottom: 20px;\n    }\n    h1 {\n      font-size: 28px;\n      color: #1e293b;\n      margin-bottom: 10px;\n      font-weight: 700;\n    }\n    .period-info {\n      font-size: 14px;\n      color: #475569;\n      margin: 5px 0;\n    }\n    .messages-container {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      margin-top: 20px;\n    }\n    .message-card {\n      border: 1px solid #e2e8f0;\n      border-radius: 6px;\n      background: white;\n      transition: all 0.2s;\n      overflow: hidden;\n    }\n    .message-card:hover {\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n    }\n    .message-header {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      padding: 12px;\n      border-bottom: 1px solid #f1f5f9;\n      cursor: pointer;\n      transition: background-color 0.2s;\n    }\n    .message-header:hover {\n      background-color: #f9fafb;\n    }\n    .serial-badge {\n      background-color: #f1f5f9;\n      border: 1px solid #cbd5e1;\n      padding: 4px 8px;\n      border-radius: 4px;\n      font-weight: 600;\n      font-size: 12px;\n      font-family: 'Courier New', monospace;\n      flex-shrink: 0;\n      min-width: 50px;\n      text-align: center;\n      color: #1e293b;\n    }\n    .message-title {\n      flex: 1;\n      font-weight: 600;\n      font-size: 14px;\n      color: #1e293b;\n      word-break: break-word;\n    }\n    .message-date {\n      font-size: 12px;\n      color: #64748b;\n      flex-shrink: 0;\n    }\n    .message-content {\n      padding: 16px;\n      background-color: #f9fafb;\n      border-top: 1px solid #f1f5f9;\n    }\n    .message-text {\n      font-size: 13px;\n      color: #475569;\n      line-height: 1.6;\n      word-break: break-word;\n      white-space: pre-wrap;\n      max-height: 300px;\n      overflow-y: auto;\n      margin-bottom: 12px;\n      padding: 12px;\n      background: white;\n      border-radius: 4px;\n      border: 1px solid #e2e8f0;\n    }\n    .badges-container {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 6px;\n    }\n    .badge {\n      display: inline-block;\n      background-color: #e2e8f0;\n      color: #1e293b;\n      padding: 4px 10px;\n      border-radius: 4px;\n      font-size: 11px;\n      font-weight: 500;\n      border: 1px solid #cbd5e1;\n    }\n    .badge.primary {\n      background-color: #dbeafe;\n      border-color: #93c5fd;\n      color: #1e40af;\n    }\n    .badge.outline {\n      background-color: white;\n      border-color: #cbd5e1;\n      color: #475569;\n    }\n    .footer {\n      text-align: center;\n      margin-top: 30px;\n      padding-top: 20px;\n      border-top: 1px solid #e2e8f0;\n      color: #64748b;\n      font-size: 12px;\n    }\n    .message-meta {\n      font-size: 12px;\n      color: #64748b;\n      padding-top: 8px;\n      border-top: 1px solid #e2e8f0;\n      display: flex;\n      justify-content: space-between;\n    }\n    @media print {\n      body {\n        padding: 0;\n        background: white;\n      }\n      .container {\n        box-shadow: none;\n        padding: 20px;\n      }\n      .message-card {\n        page-break-inside: avoid;\n        break-inside: avoid;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ</h1>\n      <div class=\"period-info\">ÿßŸÑŸÅÿ™ÿ±ÿ©: ${periodLabel}</div>\n      <div class=\"period-info\">ÿπÿØÿØ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ: ${exportMessages.length}</div>\n    </div>\n    \n    <div class=\"messages-container\">\n      ${exportMessages.map((msg, idx) => `\n        <div class=\"message-card\" data-msg-id=\"${idx}\">\n          <div class=\"message-header\" style=\"cursor: pointer;\" onclick=\"toggleMessage(this)\">\n            <div class=\"serial-badge\">#${msg.serialNumber}</div>\n            <div class=\"message-title\">${msg.title || 'ÿ®ÿØŸàŸÜ ÿπŸÜŸàÿßŸÜ'}</div>\n            <div class=\"message-date\">${format(new Date(msg.createdAt), 'MM/dd', { locale: ar })}</div>\n          </div>\n          <div class=\"message-content\" style=\"display: none;\">\n            <div class=\"message-text\">${msg.processedText || msg.originalText || 'ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≠ÿ™ŸàŸâ'}</div>\n            ${msg.originalText && msg.originalText !== (msg.processedText || msg.originalText) ? `\n              <div style=\"margin-top: 12px; padding-top: 12px; border-top: 1px solid #e2e8f0;\">\n                <div style=\"font-size: 12px; color: #64748b; margin-bottom: 6px; font-weight: 500;\">ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä:</div>\n                <div style=\"font-size: 12px; color: #475569; line-height: 1.6; word-break: break-word; white-space: pre-wrap; padding: 10px; background: white; border: 1px solid #e2e8f0; border-radius: 4px; max-height: 200px; overflow-y: auto;\">\n                  ${msg.originalText}\n                </div>\n              </div>\n            ` : ''}\n            <div class=\"badges-container\">\n              ${msg.classification ? `<div class=\"badge primary\">${msg.classification}</div>` : ''}\n              ${msg.newsType ? `<div class=\"badge outline\">${msg.newsType}</div>` : ''}\n              ${msg.province ? `<div class=\"badge outline\">${msg.province}</div>` : ''}\n              ${msg.sourceChannelTitle ? `<div class=\"badge outline\">${msg.sourceChannelTitle}</div>` : ''}\n            </div>\n            <div class=\"message-meta\">\n              <span>${format(new Date(msg.createdAt), 'PPpp', { locale: ar })}</span>\n            </div>\n          </div>\n        </div>\n      `).join('')}\n    </div>\n    \n    <script>\n      function toggleMessage(headerElement) {\n        const card = headerElement.closest('.message-card');\n        const content = card.querySelector('.message-content');\n        const isVisible = content.style.display !== 'none';\n        content.style.display = isVisible ? 'none' : 'block';\n        card.style.borderColor = !isVisible ? '#2563eb' : '#e2e8f0';\n      }\n    </script>\n    \n    <div class=\"footer\">\n      ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ±: ${format(new Date(), 'yyyy-MM-dd HH:mm')}\n    </div>\n  </div>\n</body>\n</html>`;\n\n      // Create and download HTML file\n      const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8;' });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `archive-report-${format(new Date(), 'yyyy-MM-dd-HHmm')}.html`;\n      link.click();\n      URL.revokeObjectURL(url);\n\n      toast.success(`ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ${exportMessages.length} ÿ±ÿ≥ÿßŸÑÿ© ÿ®ŸÜÿ¨ÿßÿ≠`);\n      setHtmlExportDialogOpen(false);\n    } catch (error) {\n      console.error('HTML export error:', error);\n      toast.error(\"ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿµÿØŸäÿ± HTML\");\n    } finally {\n      setHtmlExportLoading(false);\n    }\n  };\n\n  const handleOpenTTS = (message: ArchiveMessage) => {\n    setTtsMessage(message);\n    setTtsDialogOpen(true);\n\n    // Clean up previous audio\n    if (audioElement) {\n      audioElement.pause();\n      audioElement.src = '';\n    }\n    if (audioUrl) {\n      URL.revokeObjectURL(audioUrl);\n    }\n    setAudioUrl(null);\n    setIsPlaying(false);\n  };\n\n  const handleGenerateSpeech = () => {\n    if (!ttsMessage) return;\n\n    const text = ttsMessage.processedText || ttsMessage.originalText || '';\n    if (!text || text.trim().length === 0) {\n      toast.error(\"ŸÑÿß ŸäŸàÿ¨ÿØ ŸÜÿµ ŸÑŸÑŸÇÿ±ÿßÿ°ÿ©\");\n      return;\n    }\n\n    // Limit to 4000 characters\n    const trimmedText = text.slice(0, 4000);\n    if (text.length > 4000) {\n      toast.info(\"ÿ™ŸÖ ÿßŸÇÿ™ÿµÿßÿµ ÿßŸÑŸÜÿµ ÿ•ŸÑŸâ 4000 ÿ≠ÿ±ŸÅ\");\n    }\n\n    // Save preferred voice\n    localStorage.setItem('preferred-tts-voice', selectedVoice);\n\n    textToSpeechMutation.mutate({ text: trimmedText, voice: selectedVoice });\n  };\n\n  const handlePlayPause = () => {\n    if (!audioElement) return;\n\n    if (isPlaying) {\n      audioElement.pause();\n      setIsPlaying(false);\n    } else {\n      audioElement.play();\n      setIsPlaying(true);\n    }\n  };\n\n  const handleStopAudio = () => {\n    if (audioElement) {\n      audioElement.pause();\n      audioElement.currentTime = 0;\n      setIsPlaying(false);\n    }\n  };\n\n  const handleDownloadAudio = () => {\n    if (!audioUrl) return;\n\n    const link = document.createElement('a');\n    link.href = audioUrl;\n    link.download = `archive-${ttsMessage?.serialNumber || 'audio'}.mp3`;\n    link.click();\n    toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿµŸàÿ™Ÿä\");\n  };\n\n  const toggleSelectMessage = (id: number) => {\n    const newSelected = new Set(selectedIds);\n    if (newSelected.has(id)) {\n      newSelected.delete(id);\n    } else {\n      newSelected.add(id);\n    }\n    setSelectedIds(newSelected);\n  };\n\n  const handleSelectAll = () => {\n    if (selectAll) {\n      setSelectedIds(new Set());\n    } else {\n      setSelectedIds(new Set(messages.map(m => m.id)));\n    }\n    setSelectAll(!selectAll);\n  };\n\n  const setQuickFilter = (type: 'today' | 'week' | 'month' | 'pinned' | 'flagged' | 'media') => {\n    const today = new Date();\n    switch (type) {\n      case 'today':\n        setFilters(f => ({\n          ...f,\n          dateFrom: format(startOfDay(today), 'yyyy-MM-dd'),\n          dateTo: format(endOfDay(today), 'yyyy-MM-dd'),\n          isPinned: undefined,\n          isFlagged: undefined,\n          hasMedia: undefined\n        }));\n        break;\n      case 'week':\n        setFilters(f => ({\n          ...f,\n          dateFrom: format(startOfWeek(today, { locale: ar }), 'yyyy-MM-dd'),\n          dateTo: format(endOfWeek(today, { locale: ar }), 'yyyy-MM-dd'),\n          isPinned: undefined,\n          isFlagged: undefined,\n          hasMedia: undefined\n        }));\n        break;\n      case 'month':\n        setFilters(f => ({\n          ...f,\n          dateFrom: format(subDays(today, 30), 'yyyy-MM-dd'),\n          dateTo: format(today, 'yyyy-MM-dd'),\n          isPinned: undefined,\n          isFlagged: undefined,\n          hasMedia: undefined\n        }));\n        break;\n      case 'pinned':\n        setFilters(f => ({\n          ...f,\n          isPinned: true,\n          isFlagged: undefined,\n          hasMedia: undefined,\n          dateFrom: '',\n          dateTo: ''\n        }));\n        break;\n      case 'flagged':\n        setFilters(f => ({\n          ...f,\n          isFlagged: true,\n          isPinned: undefined,\n          hasMedia: undefined,\n          dateFrom: '',\n          dateTo: ''\n        }));\n        break;\n      case 'media':\n        setFilters(f => ({\n          ...f,\n          hasMedia: true,\n          isPinned: undefined,\n          isFlagged: undefined\n        }));\n        break;\n    }\n    setPage(1);\n  };\n\n  const clearFilters = () => {\n    setFilters(getDefaultFilters());\n    setSearchDebounce('');\n    setPage(1);\n  };\n\n  const getMediaIcon = (type: string | null) => {\n    switch (type) {\n      case 'photo': return Image;\n      case 'video': return Video;\n      case 'audio': return FileAudio;\n      default: return File;\n    }\n  };\n\n  const getTaskName = (taskId: number) => {\n    const task = tasks.find((t: any) => t.id === taskId);\n    return task?.name || `ŸÖŸáŸÖÿ© #${taskId}`;\n  };\n\n  const todayChange = useMemo(() => {\n    if (!stats?.recentActivity || stats.recentActivity.length < 2) return 0;\n    const today = stats.recentActivity[0]?.count || 0;\n    const yesterday = stats.recentActivity[1]?.count || 0;\n    if (yesterday === 0) return today > 0 ? 100 : 0;\n    return Math.round(((today - yesterday) / yesterday) * 100);\n  }, [stats]);\n\n  const statCards = [\n    {\n      title: \"ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ\",\n      value: stats?.totalMessages || 0,\n      icon: Archive,\n      color: \"text-blue-600 dark:text-blue-400\",\n      bgColor: \"bg-gradient-to-br from-blue-500/20 to-blue-600/10\",\n      borderColor: \"border-blue-500/20\",\n      trend: null,\n      onClick: () => clearFilters()\n    },\n    {\n      title: \"ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸäŸàŸÖ\",\n      value: stats?.todayMessages || 0,\n      icon: Zap,\n      color: \"text-emerald-600 dark:text-emerald-400\",\n      bgColor: \"bg-gradient-to-br from-emerald-500/20 to-emerald-600/10\",\n      borderColor: \"border-emerald-500/20\",\n      trend: todayChange,\n      onClick: () => setQuickFilter('today')\n    },\n    {\n      title: \"ÿßŸÑŸÖÿ´ÿ®ÿ™ÿ©\",\n      value: stats?.pinnedMessages || 0,\n      icon: Star,\n      color: \"text-amber-600 dark:text-amber-400\",\n      bgColor: \"bg-gradient-to-br from-amber-500/20 to-amber-600/10\",\n      borderColor: \"border-amber-500/20\",\n      trend: null,\n      onClick: () => setQuickFilter('pinned')\n    },\n    {\n      title: \"ÿßŸÑŸÖŸèÿπŸÑŸéŸëŸÖÿ©\",\n      value: stats?.flaggedMessages || 0,\n      icon: AlertCircle,\n      color: \"text-rose-600 dark:text-rose-400\",\n      bgColor: \"bg-gradient-to-br from-rose-500/20 to-rose-600/10\",\n      borderColor: \"border-rose-500/20\",\n      trend: null,\n      onClick: () => setQuickFilter('flagged')\n    }\n  ];\n\n  if (loadingStats && loadingArchive) {\n    return (\n      <div className=\"flex flex-col items-center justify-center p-12 gap-4\">\n        <div className=\"relative\">\n          <div className=\"absolute inset-0 bg-primary/20 rounded-full blur-xl animate-pulse\" />\n          <Loader className=\"h-12 w-12 animate-spin text-primary relative\" />\n        </div>\n        <p className=\"text-muted-foreground animate-pulse\">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ...</p>\n      </div>\n    );\n  }\n\n  return (\n    <TooltipProvider>\n      <div className=\"space-y-6 print:space-y-4\" dir=\"rtl\">\n        {/* Header */}\n        <div className=\"flex flex-col lg:flex-row lg:items-end justify-between gap-4\">\n          <div className=\"text-right\">\n            <motion.div\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              className=\"flex items-center gap-3\"\n            >\n              <div className=\"p-3 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/5 border border-primary/20\">\n                <Archive className=\"h-8 w-8 text-primary\" />\n              </div>\n              <div>\n                <h2 className=\"text-2xl md:text-3xl font-display font-bold text-foreground tracking-wide\">\n                  ÿ£ÿ±ÿ¥ŸäŸÅ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ\n                </h2>\n                <p className=\"text-muted-foreground mt-0.5 text-sm flex items-center gap-2\">\n                  <Activity className=\"h-3.5 w-3.5\" />\n                  {totalMessages.toLocaleString('ar-EG')} ÿ±ÿ≥ÿßŸÑÿ© ŸÖÿ§ÿ±ÿ¥ŸÅÿ©\n                  {filters.taskId && (\n                    <Badge variant=\"secondary\" className=\"mr-2\">\n                      {getTaskName(filters.taskId)}\n                    </Badge>\n                  )}\n                </p>\n              </div>\n            </motion.div>\n          </div>\n\n          {/* Toolbar */}\n          <motion.div \n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"flex flex-wrap items-center gap-2 print:hidden\"\n          >\n            {/* View Mode Toggle */}\n            <div className=\"flex items-center border rounded-lg p-1 bg-muted/50\">\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant={viewMode === 'list' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className=\"h-8 px-2\"\n                    onClick={() => setViewMode('list')}\n                  >\n                    <LayoutList className=\"h-4 w-4\" />\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>ÿπÿ±ÿ∂ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©</TooltipContent>\n              </Tooltip>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant={viewMode === 'grid' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className=\"h-8 px-2\"\n                    onClick={() => setViewMode('grid')}\n                  >\n                    <LayoutGrid className=\"h-4 w-4\" />\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>ÿπÿ±ÿ∂ ÿßŸÑÿ¥ÿ®ŸÉÿ©</TooltipContent>\n              </Tooltip>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant={viewMode === 'compact' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className=\"h-8 px-2\"\n                    onClick={() => setViewMode('compact')}\n                  >\n                    <MoreHorizontal className=\"h-4 w-4\" />\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>ÿπÿ±ÿ∂ ŸÖÿ∂ÿ∫Ÿàÿ∑</TooltipContent>\n              </Tooltip>\n            </div>\n\n            <Separator orientation=\"vertical\" className=\"h-8\" />\n\n            {/* Action Buttons */}\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleExportCSV}\n                  className=\"gap-2\"\n                >\n                  <Download className=\"h-4 w-4\" />\n                  <span className=\"hidden sm:inline\">CSV</span>\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿµÿØŸäÿ± CSV</TooltipContent>\n            </Tooltip>\n\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setHtmlExportDialogOpen(true)}\n                  className=\"gap-2\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                  <span className=\"hidden sm:inline\">HTML</span>\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿµÿØŸäÿ± HTML</TooltipContent>\n            </Tooltip>\n\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handlePrint}\n                  className=\"gap-2\"\n                >\n                  <Printer className=\"h-4 w-4\" />\n                  <span className=\"hidden sm:inline\">ÿ∑ÿ®ÿßÿπÿ©</span>\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ∑ÿ®ÿßÿπÿ©</TooltipContent>\n            </Tooltip>\n\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => refetchArchive()}\n                  className=\"gap-2\"\n                >\n                  <RefreshCw className=\"h-4 w-4\" />\n                  <span className=\"hidden sm:inline\">ÿ™ÿ≠ÿØŸäÿ´</span>\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</TooltipContent>\n            </Tooltip>\n\n            <Button\n              variant={showFilters ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setShowFilters(!showFilters)}\n              className=\"gap-2\"\n            >\n              <Filter className=\"h-4 w-4\" />\n              ÿßŸÑŸÅŸÑÿßÿ™ÿ±\n              {Object.values(filters).some(v => v && v !== 'createdAt' && v !== 'desc') && (\n                <Badge variant=\"secondary\" className=\"mr-1 h-5 px-1.5\">\n                  {Object.values(filters).filter(v => v && v !== 'createdAt' && v !== 'desc').length}\n                </Badge>\n              )}\n            </Button>\n          </motion.div>\n        </div>\n\n        {/* Stats Cards with Charts */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {statCards.map((stat, i) => (\n            <motion.div\n              key={i}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: i * 0.1 }}\n              whileHover={{ scale: 1.02, y: -2 }}\n              whileTap={{ scale: 0.98 }}\n            >\n              <Card \n                className={cn(\n                  \"border cursor-pointer transition-all duration-300 overflow-hidden group\",\n                  stat.borderColor,\n                  \"hover:shadow-lg hover:shadow-primary/5\"\n                )}\n                onClick={stat.onClick}\n              >\n                <CardContent className={cn(\"p-4 relative\", stat.bgColor)}>\n                  <div className=\"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\n                  <div className=\"relative\">\n                    <div className=\"flex justify-between items-start mb-3\">\n                      <div className={cn(\"p-2.5 rounded-xl bg-background/80 shadow-sm\")}>\n                        <stat.icon className={cn(\"h-5 w-5\", stat.color)} />\n                      </div>\n                      {stat.trend !== null && (\n                        <div className={cn(\n                          \"flex items-center gap-1 text-xs font-medium px-2 py-1 rounded-full\",\n                          stat.trend >= 0 \n                            ? \"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400\" \n                            : \"bg-rose-500/10 text-rose-600 dark:text-rose-400\"\n                        )}>\n                          {stat.trend >= 0 ? (\n                            <ArrowUpRight className=\"h-3 w-3\" />\n                          ) : (\n                            <ArrowDownRight className=\"h-3 w-3\" />\n                          )}\n                          {Math.abs(stat.trend)}%\n                        </div>\n                      )}\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-muted-foreground font-medium uppercase tracking-wider\">\n                        {stat.title}\n                      </p>\n                      <h3 className=\"text-3xl font-bold text-foreground mt-1 tabular-nums\">\n                        {stat.value.toLocaleString('ar-EG')}\n                      </h3>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </motion.div>\n          ))}\n        </div>\n\n        {/* Activity Chart */}\n        {activityData.length > 0 && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.3 }}\n          >\n            <Card className=\"border shadow-sm overflow-hidden\">\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <BarChart3 className=\"h-5 w-5 text-primary\" />\n                    <CardTitle className=\"text-lg\">ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ</CardTitle>\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setShowAdvancedStats(!showAdvancedStats)}\n                  >\n                    {showAdvancedStats ? 'ÿ•ÿÆŸÅÿßÿ°' : 'ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≤ŸäÿØ'}\n                  </Button>\n                </div>\n                <CardDescription>\n                  ÿ¢ÿÆÿ± 7 ÿ£ŸäÿßŸÖ ŸÖŸÜ ÿßŸÑŸÜÿ¥ÿßÿ∑\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"pt-0\">\n                <div className=\"h-[120px] w-full\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <AreaChart data={activityData}>\n                      <defs>\n                        <linearGradient id=\"colorCount\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                          <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3}/>\n                          <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0}/>\n                        </linearGradient>\n                      </defs>\n                      <XAxis \n                        dataKey=\"date\" \n                        axisLine={false}\n                        tickLine={false}\n                        tick={{ fontSize: 12, fill: 'hsl(var(--muted-foreground))' }}\n                      />\n                      <RechartsTooltip \n                        contentStyle={{ \n                          background: 'hsl(var(--popover))',\n                          border: '1px solid hsl(var(--border))',\n                          borderRadius: '8px',\n                          fontSize: '12px'\n                        }}\n                        formatter={(value: number) => [value, 'ÿ±ÿ≥ÿßÿ¶ŸÑ']}\n                      />\n                      <Area \n                        type=\"monotone\" \n                        dataKey=\"count\" \n                        stroke=\"hsl(var(--primary))\" \n                        strokeWidth={2}\n                        fillOpacity={1} \n                        fill=\"url(#colorCount)\" \n                      />\n                    </AreaChart>\n                  </ResponsiveContainer>\n                </div>\n              </CardContent>\n            </Card>\n          </motion.div>\n        )}\n\n        {/* Bulk Actions Bar */}\n        <AnimatePresence>\n          {selectedIds.size > 0 && (\n            <motion.div\n              initial={{ opacity: 0, y: -20 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -20 }}\n              className=\"sticky top-0 z-20\"\n            >\n              <Card className=\"border-primary/50 bg-primary/5 shadow-lg\">\n                <CardContent className=\"p-3\">\n                  <div className=\"flex items-center justify-between gap-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <Badge variant=\"default\" className=\"px-3 py-1\">\n                        {selectedIds.size} ŸÖÿ≠ÿØÿØ\n                      </Badge>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => setSelectedIds(new Set())}\n                      >\n                        <X className=\"h-4 w-4 ml-1\" />\n                        ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸäÿØ\n                      </Button>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={handleBulkPin}\n                        className=\"gap-1\"\n                      >\n                        <Pin className=\"h-4 w-4\" />\n                        ÿ™ÿ´ÿ®Ÿäÿ™\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={handleBulkFlag}\n                        className=\"gap-1\"\n                      >\n                        <Flag className=\"h-4 w-4\" />\n                        ÿ™ÿπŸÑŸäŸÖ\n                      </Button>\n                      <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        onClick={() => setBulkDeleteDialogOpen(true)}\n                        className=\"gap-1\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                        ÿ≠ÿ∞ŸÅ\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Filters Section */}\n        <AnimatePresence>\n          {showFilters && (\n            <motion.div\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: 'auto' }}\n              exit={{ opacity: 0, height: 0 }}\n              className=\"overflow-hidden\"\n            >\n              <Card className=\"border shadow-sm\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-lg flex items-center gap-2\">\n                      <Filter className=\"h-5 w-5 text-primary\" />\n                      ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ®ÿ≠ÿ´\n                    </CardTitle>\n                    <div className=\"flex items-center gap-2\">\n                      <Button variant=\"ghost\" size=\"sm\" onClick={clearFilters}>\n                        <X className=\"h-4 w-4 ml-1\" />\n                        ŸÖÿ≥ÿ≠ ÿßŸÑŸÅŸÑÿßÿ™ÿ±\n                      </Button>\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowFilters(false)}>\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {/* First Row: Task, Search */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ÿßŸÑŸÖŸáŸÖÿ©</Label>\n                      <Select\n                        value={filters.taskId?.toString() || \"all\"}\n                        onValueChange={(v) => {\n                          setFilters(f => ({ ...f, taskId: v === \"all\" ? undefined : parseInt(v) }));\n                          setPage(1);\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸáÿßŸÖ\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸáÿßŸÖ</SelectItem>\n                          {tasks.map((task: any) => (\n                            <SelectItem key={task.id} value={task.id.toString()}>\n                              {task.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div className=\"md:col-span-2\">\n                      <Label className=\"text-sm mb-2 block\">ÿ®ÿ≠ÿ´</Label>\n                      <div className=\"relative\">\n                        <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                          placeholder=\"ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿπŸÜŸàÿßŸÜ ŸàÿßŸÑŸÖÿ≠ÿ™ŸàŸâ... (Ctrl+F)\"\n                          value={searchDebounce}\n                          onChange={(e) => setSearchDebounce(e.target.value)}\n                          className=\"pr-10\"\n                        />\n                        {searchDebounce && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"absolute left-1 top-1/2 -translate-y-1/2 h-7 w-7 p-0\"\n                            onClick={() => setSearchDebounce('')}\n                          >\n                            <X className=\"h-3 w-3\" />\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Second Row: Date Range & Classification */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ</Label>\n                      <Popover open={datePickerOpen === 'from'} onOpenChange={(open) => setDatePickerOpen(open ? 'from' : null)}>\n                        <PopoverTrigger asChild>\n                          <Button variant=\"outline\" className=\"w-full justify-start text-right font-normal\">\n                            <CalendarIcon className=\"ml-2 h-4 w-4\" />\n                            {filters.dateFrom ? format(new Date(filters.dateFrom), 'PPP', { locale: ar }) : 'ÿßÿÆÿ™ÿ± ÿ™ÿßÿ±ŸäÿÆ'}\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                          <Calendar\n                            mode=\"single\"\n                            selected={filters.dateFrom ? new Date(filters.dateFrom) : undefined}\n                            onSelect={(date) => {\n                              setFilters(f => ({ ...f, dateFrom: date ? format(date, 'yyyy-MM-dd') : '' }));\n                              setDatePickerOpen(null);\n                              setPage(1);\n                            }}\n                            locale={ar}\n                          />\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ</Label>\n                      <Popover open={datePickerOpen === 'to'} onOpenChange={(open) => setDatePickerOpen(open ? 'to' : null)}>\n                        <PopoverTrigger asChild>\n                          <Button variant=\"outline\" className=\"w-full justify-start text-right font-normal\">\n                            <CalendarIcon className=\"ml-2 h-4 w-4\" />\n                            {filters.dateTo ? format(new Date(filters.dateTo), 'PPP', { locale: ar }) : 'ÿßÿÆÿ™ÿ± ÿ™ÿßÿ±ŸäÿÆ'}\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                          <Calendar\n                            mode=\"single\"\n                            selected={filters.dateTo ? new Date(filters.dateTo) : undefined}\n                            onSelect={(date) => {\n                              setFilters(f => ({ ...f, dateTo: date ? format(date, 'yyyy-MM-dd') : '' }));\n                              setDatePickerOpen(null);\n                              setPage(1);\n                            }}\n                            locale={ar}\n                          />\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ÿßŸÑÿ™ÿµŸÜŸäŸÅ</Label>\n                      <Select\n                        value={filters.classification || \"all\"}\n                        onValueChange={(v) => {\n                          setFilters(f => ({ ...f, classification: v === \"all\" ? \"\" : v }));\n                          setPage(1);\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"ÿßŸÑŸÉŸÑ\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">ÿßŸÑŸÉŸÑ</SelectItem>\n                          {filterOptions?.classifications?.map((c: string) => (\n                            <SelectItem key={c} value={c}>{c}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©</Label>\n                      <Select\n                        value={filters.province || \"all\"}\n                        onValueChange={(v) => {\n                          setFilters(f => ({ ...f, province: v === \"all\" ? \"\" : v }));\n                          setPage(1);\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"ÿßŸÑŸÉŸÑ\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">ÿßŸÑŸÉŸÑ</SelectItem>\n                          {filterOptions?.provinces?.map((p: string) => (\n                            <SelectItem key={p} value={p}>{p}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  {/* Third Row: More Filters & Sort */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±</Label>\n                      <Select\n                        value={filters.newsType || \"all\"}\n                        onValueChange={(v) => {\n                          setFilters(f => ({ ...f, newsType: v === \"all\" ? \"\" : v }));\n                          setPage(1);\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"ÿßŸÑŸÉŸÑ\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">ÿßŸÑŸÉŸÑ</SelectItem>\n                          {filterOptions?.newsTypes?.map((n: string) => (\n                            <SelectItem key={n} value={n}>{n}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ÿßŸÑŸÖÿÆÿ™ÿµ</Label>\n                      <Select\n                        value={filters.specialist || \"all\"}\n                        onValueChange={(v) => {\n                          setFilters(f => ({ ...f, specialist: v === \"all\" ? \"\" : v }));\n                          setPage(1);\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"ÿßŸÑŸÉŸÑ\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">ÿßŸÑŸÉŸÑ</SelectItem>\n                          {filterOptions?.specialists?.map((s: string) => (\n                            <SelectItem key={s} value={s}>{s}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ÿßŸÑŸÖÿµÿØÿ±</Label>\n                      <Select\n                        value={filters.sourceChannelTitle || \"all\"}\n                        onValueChange={(v) => {\n                          setFilters(f => ({ ...f, sourceChannelTitle: v === \"all\" ? \"\" : v }));\n                          setPage(1);\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"ÿßŸÑŸÉŸÑ\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">ÿßŸÑŸÉŸÑ</SelectItem>\n                          {filterOptions?.sources?.map((s: string) => (\n                            <SelectItem key={s} value={s}>{s}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  {/* Sort Options */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2 border-t\">\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ÿ≠ŸÇŸÑ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®</Label>\n                      <Select\n                        value={filters.sortBy}\n                        onValueChange={(v) => {\n                          setFilters(f => ({ ...f, sortBy: v }));\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"createdAt\">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</SelectItem>\n                          <SelectItem value=\"serialNumber\">ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ</SelectItem>\n                          <SelectItem value=\"title\">ÿßŸÑÿπŸÜŸàÿßŸÜ</SelectItem>\n                          <SelectItem value=\"classification\">ÿßŸÑÿ™ÿµŸÜŸäŸÅ</SelectItem>\n                          <SelectItem value=\"newsType\">ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±</SelectItem>\n                          <SelectItem value=\"province\">ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©</SelectItem>\n                          <SelectItem value=\"specialist\">ÿßŸÑŸÖÿÆÿ™ÿµ</SelectItem>\n                          <SelectItem value=\"sourceChannelTitle\">ÿßŸÑŸÖÿµÿØÿ±</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <Label className=\"text-sm mb-2 block\">ÿßÿ™ÿ¨ÿßŸá ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®</Label>\n                      <Select\n                        value={filters.sortOrder}\n                        onValueChange={(v) => {\n                          setFilters(f => ({ ...f, sortOrder: v as 'asc' | 'desc' }));\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"asc\">ÿ™ÿµÿßÿπÿØŸä</SelectItem>\n                          <SelectItem value=\"desc\">ÿ™ŸÜÿßÿ≤ŸÑŸä</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  {/* Quick Filters */}\n                  <div className=\"flex flex-wrap gap-2 pt-3\">\n                    <span className=\"text-sm text-muted-foreground ml-2 self-center\">ŸÅŸÑÿßÿ™ÿ± ÿ≥ÿ±Ÿäÿπÿ©:</span>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setQuickFilter('today')}\n                      className=\"gap-1\"\n                    >\n                      <Zap className=\"h-3 w-3\" />\n                      ÿßŸÑŸäŸàŸÖ\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setQuickFilter('week')}\n                      className=\"gap-1\"\n                    >\n                      <CalendarIcon className=\"h-3 w-3\" />\n                      Ÿáÿ∞ÿß ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setQuickFilter('month')}\n                      className=\"gap-1\"\n                    >\n                      <CalendarIcon className=\"h-3 w-3\" />\n                      ÿ¢ÿÆÿ± 30 ŸäŸàŸÖ\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setQuickFilter('pinned')}\n                      className=\"gap-1\"\n                    >\n                      <Star className=\"h-3 w-3\" />\n                      ÿßŸÑŸÖÿ´ÿ®ÿ™ÿ©\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setQuickFilter('flagged')}\n                      className=\"gap-1\"\n                    >\n                      <Flag className=\"h-3 w-3\" />\n                      ÿßŸÑŸÖŸèÿπŸÑŸéŸëŸÖÿ©\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setQuickFilter('media')}\n                      className=\"gap-1\"\n                    >\n                      <Image className=\"h-3 w-3\" />\n                      ŸÖÿπ Ÿàÿ≥ÿßÿ¶ÿ∑\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Archive Messages List */}\n        <div className=\"space-y-4\">\n          {loadingArchive ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          ) : messages.length === 0 ? (\n            <Card className=\"border shadow-sm\">\n              <CardContent className=\"flex flex-col items-center justify-center py-16 text-center\">\n                <div className=\"p-4 rounded-full bg-muted mb-4\">\n                  <FolderOpen className=\"h-12 w-12 text-muted-foreground\" />\n                </div>\n                <h3 className=\"text-lg font-medium text-foreground mb-2\">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ±ÿ≥ÿßÿ¶ŸÑ</h3>\n                <p className=\"text-muted-foreground text-sm max-w-sm\">\n                  ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ±ÿ≥ÿßÿ¶ŸÑ ŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÑŸÑŸÅŸÑÿßÿ™ÿ± ÿßŸÑŸÖÿ≠ÿØÿØÿ©. ÿ¨ÿ±ÿ® ÿ™ÿ∫ŸäŸäÿ± ŸÖÿπÿßŸäŸäÿ± ÿßŸÑÿ®ÿ≠ÿ´.\n                </p>\n                {Object.values(filters).some(v => v && v !== 'createdAt' && v !== 'desc') && (\n                  <Button variant=\"outline\" className=\"mt-4\" onClick={clearFilters}>\n                    ŸÖÿ≥ÿ≠ ÿßŸÑŸÅŸÑÿßÿ™ÿ±\n                  </Button>\n                )}\n              </CardContent>\n            </Card>\n          ) : (\n            <>\n              {/* Select All */}\n              <div className=\"flex items-center gap-2 print:hidden\">\n                <Checkbox\n                  checked={selectAll}\n                  onCheckedChange={handleSelectAll}\n                  id=\"select-all\"\n                />\n                <Label htmlFor=\"select-all\" className=\"text-sm text-muted-foreground cursor-pointer\">\n                  ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ ({messages.length})\n                </Label>\n              </div>\n\n              {/* Messages Grid/List */}\n              <div className={cn(\n                \"grid gap-4\",\n                viewMode === 'grid' && \"grid-cols-1 md:grid-cols-2 lg:grid-cols-3\",\n                viewMode === 'compact' && \"gap-2\"\n              )}>\n                {messages.map((message, index) => (\n                  <motion.div\n                    key={message.id}\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    transition={{ delay: index * 0.03 }}\n                    layout\n                  >\n                    {viewMode === 'compact' ? (\n                      /* Compact View */\n                      <Collapsible open={previewMessageId === message.id}>\n                        <div className={cn(\n                          \"rounded-lg border bg-card transition-colors\",\n                          selectedIds.has(message.id) && \"bg-primary/5 border-primary/30\",\n                          message.isPinned && \"border-amber-500/30\",\n                          message.isFlagged && \"border-rose-500/30\",\n                          previewMessageId === message.id && \"ring-2 ring-primary\"\n                        )}>\n                          <div className={cn(\n                            \"flex items-center gap-3 p-3 hover:bg-accent/50 transition-colors cursor-pointer\",\n                            previewMessageId === message.id && \"border-b\"\n                          )}\n                          onClick={() => handleTogglePreview(message)}\n                          >\n                            <Checkbox\n                              checked={selectedIds.has(message.id)}\n                              onCheckedChange={() => toggleSelectMessage(message.id)}\n                              onClick={(e) => e.stopPropagation()}\n                              className=\"print:hidden\"\n                            />\n                            <Badge variant=\"outline\" className=\"font-mono shrink-0\">\n                              {message.serialNumber}\n                            </Badge>\n                            <span className=\"flex-1 truncate text-sm font-medium\">\n                              {message.title || 'ÿ®ÿØŸàŸÜ ÿπŸÜŸàÿßŸÜ'}\n                            </span>\n                            <div className=\"flex items-center gap-1 shrink-0\">\n                              {message.isPinned && <Star className=\"h-3.5 w-3.5 text-amber-500 fill-amber-500\" />}\n                              {message.isFlagged && <Flag className=\"h-3.5 w-3.5 text-rose-500 fill-rose-500\" />}\n                            </div>\n                            <span className=\"text-xs text-muted-foreground shrink-0\">\n                              {format(new Date(message.createdAt), 'MM/dd', { locale: ar })}\n                            </span>\n                            <div className=\"flex items-center gap-1 shrink-0 print:hidden\">\n                              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 w-7 p-0\" onClick={(e) => { e.stopPropagation(); handleTogglePreview(message); }}>\n                                {previewMessageId === message.id ? <ChevronUp className=\"h-3.5 w-3.5\" /> : <ChevronDown className=\"h-3.5 w-3.5\" />}\n                              </Button>\n                              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 w-7 p-0\" onClick={(e) => { e.stopPropagation(); handleOpenEdit(message); }}>\n                                <Edit className=\"h-3.5 w-3.5\" />\n                              </Button>\n                            </div>\n                          </div>\n                          <CollapsibleContent>\n                            <motion.div\n                              initial={{ opacity: 0, height: 0 }}\n                              animate={{ opacity: 1, height: \"auto\" }}\n                              exit={{ opacity: 0, height: 0 }}\n                              transition={{ duration: 0.2 }}\n                              className=\"p-4 space-y-3 bg-muted/20\"\n                            >\n                              <div className=\"text-sm whitespace-pre-wrap leading-relaxed\">\n                                {message.processedText || message.originalText || 'ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≠ÿ™ŸàŸâ'}\n                              </div>\n                              \n                              {message.originalText && message.originalText !== message.processedText && (\n                                <div className=\"pt-3 border-t\">\n                                  <Label className=\"text-xs text-muted-foreground mb-2 block\">ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä:</Label>\n                                  <div className=\"text-xs text-muted-foreground whitespace-pre-wrap max-h-32 overflow-y-auto bg-muted/30 p-2 rounded\">\n                                    {message.originalText}\n                                  </div>\n                                </div>\n                              )}\n                              \n                              <div className=\"flex flex-wrap items-center gap-1.5 pt-2\">\n                                {message.classification && (\n                                  <Badge variant=\"secondary\" className=\"gap-1 text-xs\">\n                                    <Tag className=\"h-2.5 w-2.5\" />\n                                    {message.classification}\n                                  </Badge>\n                                )}\n                                {message.province && (\n                                  <Badge variant=\"outline\" className=\"gap-1 text-xs\">\n                                    <MapPin className=\"h-2.5 w-2.5\" />\n                                    {message.province}\n                                  </Badge>\n                                )}\n                                {message.newsType && (\n                                  <Badge variant=\"outline\" className=\"gap-1 text-xs\">\n                                    <Newspaper className=\"h-2.5 w-2.5\" />\n                                    {message.newsType}\n                                  </Badge>\n                                )}\n                              </div>\n                              \n                              <div className=\"flex items-center justify-between pt-2 border-t\">\n                                <span className=\"text-xs text-muted-foreground\">\n                                  {format(new Date(message.createdAt), 'PPpp', { locale: ar })}\n                                </span>\n                                <div className=\"flex items-center gap-2\">\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-7 text-xs\"\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      handleCopyText(message.processedText || message.originalText || '', message.id);\n                                    }}\n                                  >\n                                    <Copy className=\"h-3 w-3 ml-1\" />\n                                    ŸÜÿ≥ÿÆ\n                                  </Button>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-7 text-xs\"\n                                    onClick={(e) => { e.stopPropagation(); handleOpenEdit(message); }}\n                                  >\n                                    <Edit className=\"h-3 w-3 ml-1\" />\n                                    ÿ™ÿπÿØŸäŸÑ\n                                  </Button>\n                                </div>\n                              </div>\n                            </motion.div>\n                          </CollapsibleContent>\n                        </div>\n                      </Collapsible>\n                    ) : (\n                      /* List/Grid View */\n                      <Card className={cn(\n                        \"border shadow-sm hover:shadow-md transition-all group overflow-hidden\",\n                        selectedIds.has(message.id) && \"ring-2 ring-primary/50 bg-primary/5\",\n                        message.isPinned && \"border-amber-500/50 bg-gradient-to-r from-amber-500/5 to-transparent\",\n                        message.isFlagged && \"border-rose-500/50 bg-gradient-to-r from-rose-500/5 to-transparent\",\n                        previewMessageId === message.id && \"ring-2 ring-primary\"\n                      )}>\n                        <Collapsible open={previewMessageId === message.id}>\n                          <CardContent className=\"p-4\">\n                            <div className=\"flex flex-col gap-3\">\n                              {/* Header Row */}\n                              <div className=\"flex items-start justify-between gap-3\">\n                                <div className=\"flex items-center gap-3\">\n                                  <Checkbox\n                                    checked={selectedIds.has(message.id)}\n                                    onCheckedChange={() => toggleSelectMessage(message.id)}\n                                    className=\"print:hidden\"\n                                  />\n                                  <Tooltip>\n                                    <TooltipTrigger asChild>\n                                      <Badge \n                                        variant=\"outline\" \n                                        className=\"text-base font-mono px-3 py-1.5 cursor-pointer hover:bg-primary/10\"\n                                        onClick={() => handleCopyText(message.serialNumber.toString(), message.id)}\n                                      >\n                                        <Hash className=\"h-4 w-4 ml-1\" />\n                                        {message.serialNumber}\n                                      </Badge>\n                                    </TooltipTrigger>\n                                    <TooltipContent>ÿßŸÜŸÇÿ± ŸÑŸÜÿ≥ÿÆ ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ</TooltipContent>\n                                  </Tooltip>\n                                  {message.hasMedia && (\n                                    <Badge variant=\"secondary\" className=\"gap-1\">\n                                      {(() => {\n                                        const MediaIcon = getMediaIcon(message.mediaType);\n                                        return <MediaIcon className=\"h-3 w-3\" />;\n                                      })()}\n                                      {message.mediaCount}\n                                    </Badge>\n                                  )}\n                                </div>\n                                <div className=\"flex items-center gap-1.5\">\n                                  {message.isPinned && (\n                                    <Star className=\"h-4 w-4 text-amber-500 fill-amber-500\" />\n                                  )}\n                                  {message.isFlagged && (\n                                    <Flag className=\"h-4 w-4 text-rose-500 fill-rose-500\" />\n                                  )}\n                                </div>\n                              </div>\n\n                              {/* Title & Content */}\n                              <div \n                                className=\"cursor-pointer\" \n                                onClick={() => handleTogglePreview(message)}\n                              >\n                                <h3 className=\"font-semibold text-foreground line-clamp-2 mb-1.5 group-hover:text-primary transition-colors\">\n                                  {message.title || 'ÿ®ÿØŸàŸÜ ÿπŸÜŸàÿßŸÜ'}\n                                </h3>\n                                <p className={cn(\n                                  \"text-sm text-muted-foreground transition-all whitespace-pre-wrap\",\n                                  previewMessageId === message.id ? \"line-clamp-none\" : \"line-clamp-4\"\n                                )}>\n                                  {message.processedText || message.originalText || 'ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≠ÿ™ŸàŸâ'}\n                                </p>\n                                {/* Text length indicator */}\n                                {(message.originalText || message.processedText) && \n                                  (message.originalText?.length || 0) > 200 && \n                                  previewMessageId !== message.id && (\n                                  <div className=\"flex items-center gap-2 mt-2 text-xs text-muted-foreground\">\n                                    <FileText className=\"h-3 w-3\" />\n                                    <span>{(message.originalText || message.processedText || '').length} ÿ≠ÿ±ŸÅ</span>\n                                    <span className=\"text-primary hover:underline\">ÿßŸÜŸÇÿ± ŸÑÿπÿ±ÿ∂ ÿßŸÑŸÜÿµ ŸÉÿßŸÖŸÑÿßŸã</span>\n                                  </div>\n                                )}\n                              </div>\n\n                            {/* Tags */}\n                            <div className=\"flex flex-wrap items-center gap-1.5\">\n                              {message.classification && (\n                                <Badge variant=\"secondary\" className=\"gap-1 text-xs\">\n                                  <Tag className=\"h-2.5 w-2.5\" />\n                                  {message.classification}\n                                </Badge>\n                              )}\n                              {message.province && (\n                                <Badge variant=\"outline\" className=\"gap-1 text-xs\">\n                                  <MapPin className=\"h-2.5 w-2.5\" />\n                                  {message.province}\n                                </Badge>\n                              )}\n                              {message.newsType && (\n                                <Badge variant=\"outline\" className=\"gap-1 text-xs\">\n                                  <Newspaper className=\"h-2.5 w-2.5\" />\n                                  {message.newsType}\n                                </Badge>\n                              )}\n                              {message.specialist && (\n                                <Badge variant=\"outline\" className=\"gap-1 text-xs\">\n                                  <User className=\"h-2.5 w-2.5\" />\n                                  {message.specialist}\n                                </Badge>\n                              )}\n                            </div>\n\n                            {/* Expanded Content */}\n                            <CollapsibleContent>\n                              <motion.div\n                                initial={{ opacity: 0, height: 0 }}\n                                animate={{ opacity: 1, height: \"auto\" }}\n                                exit={{ opacity: 0, height: 0 }}\n                                transition={{ duration: 0.3 }}\n                                className=\"space-y-4 pt-4\"\n                              >\n                                <Separator />\n                                \n                                {/* Original Text */}\n                                <div>\n                                  <div className=\"flex items-center justify-between mb-2\">\n                                    <Label className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                                      <FileText className=\"h-4 w-4\" />\n                                      ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä\n                                    </Label>\n                                    {message.originalText && (\n                                      <Badge variant=\"outline\" className=\"text-xs\">\n                                        {message.originalText.length} ÿ≠ÿ±ŸÅ\n                                      </Badge>\n                                    )}\n                                  </div>\n                                  <Card className=\"bg-muted/30 border-primary/20\">\n                                    <CardContent className=\"p-4\">\n                                      <div className=\"text-sm whitespace-pre-wrap leading-relaxed max-h-[500px] overflow-y-auto\">\n                                        {message.originalText || 'ŸÑÿß ŸäŸàÿ¨ÿØ ŸÜÿµ ÿ£ÿµŸÑŸä'}\n                                      </div>\n                                      {message.originalText && message.originalText.length > 500 && (\n                                        <div className=\"mt-3 pt-3 border-t flex justify-end\">\n                                          <Button\n                                            variant=\"ghost\"\n                                            size=\"sm\"\n                                            className=\"text-xs\"\n                                            onClick={(e) => {\n                                              e.stopPropagation();\n                                              handleCopyText(message.originalText || '', message.id);\n                                            }}\n                                          >\n                                            <Copy className=\"h-3 w-3 ml-1\" />\n                                            ŸÜÿ≥ÿÆ ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä\n                                          </Button>\n                                        </div>\n                                      )}\n                                    </CardContent>\n                                  </Card>\n                                </div>\n\n\n                                {/* Metadata */}\n                                <div className=\"grid grid-cols-2 gap-3\">\n                                  <div className=\"p-3 rounded-lg bg-muted/30\">\n                                    <Label className=\"text-xs text-muted-foreground\">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°</Label>\n                                    <p className=\"text-sm font-medium mt-1\">\n                                      {format(new Date(message.createdAt), 'PPpp', { locale: ar })}\n                                    </p>\n                                  </div>\n                                  {message.editedAt && (\n                                    <div className=\"p-3 rounded-lg bg-muted/30\">\n                                      <Label className=\"text-xs text-muted-foreground\">ÿ¢ÿÆÿ± ÿ™ÿπÿØŸäŸÑ</Label>\n                                      <p className=\"text-sm font-medium mt-1\">\n                                        {format(new Date(message.editedAt), 'PPpp', { locale: ar })}\n                                      </p>\n                                    </div>\n                                  )}\n                                </div>\n\n                                {/* Notes */}\n                                {message.notes && (\n                                  <div>\n                                    <Label className=\"text-sm font-medium text-muted-foreground mb-2 block\">\n                                      ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™\n                                    </Label>\n                                    <Card className=\"bg-muted/30\">\n                                      <CardContent className=\"p-3\">\n                                        <p className=\"text-sm\">{message.notes}</p>\n                                      </CardContent>\n                                    </Card>\n                                  </div>\n                                )}\n                              </motion.div>\n                            </CollapsibleContent>\n\n                            {/* Footer */}\n                            <div className=\"flex flex-wrap items-center justify-between gap-2 pt-2 border-t\">\n                              <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                                <Clock className=\"h-3 w-3\" />\n                                {format(new Date(message.createdAt), 'PPp', { locale: ar })}\n                                {message.sourceChannelTitle && (\n                                  <>\n                                    <span className=\"mx-1\">‚Ä¢</span>\n                                    <span className=\"truncate max-w-[100px]\">{message.sourceChannelTitle}</span>\n                                  </>\n                                )}\n                              </div>\n\n                              <div className=\"flex items-center gap-0.5 print:hidden\">\n                                {message.telegraphUrl && (\n                                  <Tooltip>\n                                    <TooltipTrigger asChild>\n                                      <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\" asChild>\n                                        <a href={message.telegraphUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                                          <ExternalLink className=\"h-4 w-4\" />\n                                        </a>\n                                      </Button>\n                                    </TooltipTrigger>\n                                    <TooltipContent>ŸÅÿ™ÿ≠ ŸÅŸä Telegraph</TooltipContent>\n                                  </Tooltip>\n                                )}\n                                <Tooltip>\n                                  <TooltipTrigger asChild>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      className=\"h-8 w-8 p-0\"\n                                      onClick={() => handleOpenTTS(message)}\n                                    >\n                                      <Volume2 className=\"h-4 w-4\" />\n                                    </Button>\n                                  </TooltipTrigger>\n                                  <TooltipContent>ŸÇÿ±ÿßÿ°ÿ© ÿµŸàÿ™Ÿäÿ©</TooltipContent>\n                                </Tooltip>\n                                <Tooltip>\n                                  <TooltipTrigger asChild>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      className=\"h-8 w-8 p-0\"\n                                      onClick={() => handleCopyText(message.processedText || message.originalText || '', message.id)}\n                                    >\n                                      {copiedId === message.id ? (\n                                        <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                                      ) : (\n                                        <Copy className=\"h-4 w-4\" />\n                                      )}\n                                    </Button>\n                                  </TooltipTrigger>\n                                  <TooltipContent>ŸÜÿ≥ÿÆ ÿßŸÑŸÜÿµ</TooltipContent>\n                                </Tooltip>\n                                <CollapsibleTrigger asChild>\n                                  <Tooltip>\n                                    <TooltipTrigger asChild>\n                                      <Button\n                                        variant=\"ghost\"\n                                        size=\"sm\"\n                                        className=\"h-8 w-8 p-0\"\n                                      >\n                                        {previewMessageId === message.id ? (\n                                          <Minimize2 className=\"h-4 w-4\" />\n                                        ) : (\n                                          <Maximize2 className=\"h-4 w-4\" />\n                                        )}\n                                      </Button>\n                                    </TooltipTrigger>\n                                    <TooltipContent>\n                                      {previewMessageId === message.id ? 'ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ' : 'ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ'}\n                                    </TooltipContent>\n                                  </Tooltip>\n                                </CollapsibleTrigger>\n                                <Tooltip>\n                                  <TooltipTrigger asChild>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      className=\"h-8 w-8 p-0\"\n                                      onClick={() => handleOpenEdit(message)}\n                                    >\n                                      <Edit className=\"h-4 w-4\" />\n                                    </Button>\n                                  </TooltipTrigger>\n                                  <TooltipContent>ÿ™ÿπÿØŸäŸÑ</TooltipContent>\n                                </Tooltip>\n                                <Tooltip>\n                                  <TooltipTrigger asChild>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      className={cn(\"h-8 w-8 p-0\", message.isPinned && \"text-amber-500\")}\n                                      onClick={() => togglePinMutation.mutate(message.id)}\n                                    >\n                                      <Star className={cn(\"h-4 w-4\", message.isPinned && \"fill-current\")} />\n                                    </Button>\n                                  </TooltipTrigger>\n                                  <TooltipContent>{message.isPinned ? 'ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™' : 'ÿ™ÿ´ÿ®Ÿäÿ™'}</TooltipContent>\n                                </Tooltip>\n                                <Tooltip>\n                                  <TooltipTrigger asChild>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      className={cn(\"h-8 w-8 p-0\", message.isFlagged && \"text-rose-500\")}\n                                      onClick={() => toggleFlagMutation.mutate(message.id)}\n                                    >\n                                      <Flag className={cn(\"h-4 w-4\", message.isFlagged && \"fill-current\")} />\n                                    </Button>\n                                  </TooltipTrigger>\n                                  <TooltipContent>{message.isFlagged ? 'ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿπŸÑŸäŸÖ' : 'ÿ™ÿπŸÑŸäŸÖ'}</TooltipContent>\n                                </Tooltip>\n                                <Tooltip>\n                                  <TooltipTrigger asChild>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      className=\"h-8 w-8 p-0 text-destructive hover:text-destructive\"\n                                      onClick={() => handleOpenDelete(message)}\n                                    >\n                                      <Trash2 className=\"h-4 w-4\" />\n                                    </Button>\n                                  </TooltipTrigger>\n                                  <TooltipContent>ÿ≠ÿ∞ŸÅ</TooltipContent>\n                                </Tooltip>\n                              </div>\n                            </div>\n                          </div>\n                        </CardContent>\n                        </Collapsible>\n                      </Card>\n                    )}\n                  </motion.div>\n                ))}\n              </div>\n\n              {/* Pagination */}\n              {totalPages > 1 && (\n                <div className=\"flex items-center justify-center gap-4 pt-6 print:hidden\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    disabled={page <= 1}\n                    onClick={() => setPage(p => p - 1)}\n                    className=\"gap-1\"\n                  >\n                    <ChevronRight className=\"h-4 w-4\" />\n                    ÿßŸÑÿ≥ÿßÿ®ŸÇ\n                  </Button>\n\n                  <div className=\"flex items-center gap-2\">\n                    {page > 2 && (\n                      <>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setPage(1)}>1</Button>\n                        {page > 3 && <span className=\"text-muted-foreground\">...</span>}\n                      </>\n                    )}\n                    {page > 1 && (\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => setPage(page - 1)}>\n                        {page - 1}\n                      </Button>\n                    )}\n                    <Button variant=\"default\" size=\"sm\" className=\"pointer-events-none\">\n                      {page}\n                    </Button>\n                    {page < totalPages && (\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => setPage(page + 1)}>\n                        {page + 1}\n                      </Button>\n                    )}\n                    {page < totalPages - 1 && (\n                      <>\n                        {page < totalPages - 2 && <span className=\"text-muted-foreground\">...</span>}\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setPage(totalPages)}>\n                          {totalPages}\n                        </Button>\n                      </>\n                    )}\n                  </div>\n\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    disabled={page >= totalPages}\n                    onClick={() => setPage(p => p + 1)}\n                    className=\"gap-1\"\n                  >\n                    ÿßŸÑÿ™ÿßŸÑŸä\n                    <ChevronLeft className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              )}\n\n              {/* Results Info */}\n              <div className=\"text-center text-sm text-muted-foreground pt-2\">\n                ÿπÿ±ÿ∂ {((page - 1) * ITEMS_PER_PAGE) + 1} - {Math.min(page * ITEMS_PER_PAGE, totalMessages)} ŸÖŸÜ {totalMessages.toLocaleString('ar-EG')} ÿ±ÿ≥ÿßŸÑÿ©\n              </div>\n            </>\n          )}\n        </div>\n\n        \n\n        {/* Edit Dialog */}\n        <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n          <DialogContent className=\"sm:max-w-lg\" dir=\"rtl\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Edit className=\"h-5 w-5 text-primary\" />\n                ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©\n                {selectedMessage && (\n                  <Badge variant=\"outline\" className=\"font-mono\">\n                    {selectedMessage.serialNumber}\n                  </Badge>\n                )}\n              </DialogTitle>\n              <DialogDescription>\n                ÿ™ÿπÿØŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ŸàÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ§ÿ±ÿ¥ŸÅÿ©\n              </DialogDescription>\n            </DialogHeader>\n\n            <ScrollArea className=\"h-[500px] pr-4\">\n              <div className=\"space-y-4 py-4\">\n                {/* Title */}\n                <div>\n                  <Label htmlFor=\"edit-title\" className=\"mb-2 block font-semibold\">ÿßŸÑÿπŸÜŸàÿßŸÜ</Label>\n                  <Input\n                    id=\"edit-title\"\n                    value={editForm.title}\n                    onChange={(e) => setEditForm(f => ({ ...f, title: e.target.value }))}\n                    placeholder=\"ÿ£ÿØÿÆŸÑ ÿßŸÑÿπŸÜŸàÿßŸÜ\"\n                  />\n                </div>\n\n                {/* Classification */}\n                <div>\n                  <Label htmlFor=\"edit-classification\" className=\"mb-2 block\">ÿßŸÑÿ™ÿµŸÜŸäŸÅ</Label>\n                  <Input\n                    id=\"edit-classification\"\n                    value={editForm.classification}\n                    onChange={(e) => setEditForm(f => ({ ...f, classification: e.target.value }))}\n                    placeholder=\"ÿßŸÑÿ™ÿµŸÜŸäŸÅ\"\n                  />\n                </div>\n\n                {/* News Type */}\n                <div>\n                  <Label htmlFor=\"edit-news-type\" className=\"mb-2 block\">ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±</Label>\n                  <Input\n                    id=\"edit-news-type\"\n                    value={editForm.newsType}\n                    onChange={(e) => setEditForm(f => ({ ...f, newsType: e.target.value }))}\n                    placeholder=\"ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±\"\n                  />\n                </div>\n\n                {/* Province */}\n                <div>\n                  <Label htmlFor=\"edit-province\" className=\"mb-2 block\">ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©</Label>\n                  <Input\n                    id=\"edit-province\"\n                    value={editForm.province}\n                    onChange={(e) => setEditForm(f => ({ ...f, province: e.target.value }))}\n                    placeholder=\"ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©\"\n                  />\n                </div>\n\n                {/* Date - Read Only */}\n                {selectedMessage && (\n                  <div>\n                    <Label className=\"mb-2 block text-xs text-muted-foreground\">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</Label>\n                    <div className=\"p-2 rounded border bg-muted/50 text-sm\">\n                      {format(parseISO(selectedMessage.createdAt), 'dd MMM yyyy', { locale: ar })}\n                    </div>\n                  </div>\n                )}\n\n                {/* Specialist */}\n                <div>\n                  <Label htmlFor=\"edit-specialist\" className=\"mb-2 block\">ÿßŸÑŸÖÿÆÿ™ÿµ</Label>\n                  <Input\n                    id=\"edit-specialist\"\n                    value={editForm.specialist}\n                    onChange={(e) => setEditForm(f => ({ ...f, specialist: e.target.value }))}\n                    placeholder=\"ÿßŸÑŸÖÿÆÿ™ÿµ\"\n                  />\n                </div>\n\n                {/* Source */}\n                <div>\n                  <Label htmlFor=\"edit-source\" className=\"mb-2 block\">ÿßŸÑŸÖÿµÿØÿ±</Label>\n                  <Input\n                    id=\"edit-source\"\n                    value={editForm.sourceChannelTitle}\n                    onChange={(e) => setEditForm(f => ({ ...f, sourceChannelTitle: e.target.value }))}\n                    placeholder=\"ÿßŸÑŸÖÿµÿØÿ±\"\n                  />\n                </div>\n\n                {/* Summary */}\n                <div>\n                  <Label htmlFor=\"edit-summary\" className=\"mb-2 block\">ÿßŸÑŸÖŸÑÿÆÿµ</Label>\n                  <Textarea\n                    id=\"edit-summary\"\n                    value={editForm.summary}\n                    onChange={(e) => setEditForm(f => ({ ...f, summary: e.target.value }))}\n                    placeholder=\"ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖŸÑÿÆÿµ...\"\n                    rows={2}\n                  />\n                </div>\n\n                {/* Original Text */}\n                <div>\n                  <Label htmlFor=\"edit-original-text\" className=\"mb-2 block\">ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä</Label>\n                  <Textarea\n                    id=\"edit-original-text\"\n                    value={editForm.originalText}\n                    onChange={(e) => setEditForm(f => ({ ...f, originalText: e.target.value }))}\n                    placeholder=\"ÿ£ÿØÿÆŸÑ ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä...\"\n                    rows={4}\n                  />\n                </div>\n              </div>\n            </ScrollArea>\n\n            <DialogFooter className=\"gap-2\">\n              <DialogClose asChild>\n                <Button variant=\"outline\">ÿ•ŸÑÿ∫ÿßÿ°</Button>\n              </DialogClose>\n              <Button\n                onClick={handleSaveEdit}\n                disabled={updateMessageMutation.isPending}\n              >\n                {updateMessageMutation.isPending ? (\n                  <Loader className=\"h-4 w-4 animate-spin ml-2\" />\n                ) : (\n                  <Save className=\"h-4 w-4 ml-2\" />\n                )}\n                ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* Delete Confirmation Dialog */}\n        <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n          <AlertDialogContent dir=\"rtl\">\n            <AlertDialogHeader>\n              <AlertDialogTitle className=\"flex items-center gap-2\">\n                <Trash2 className=\"h-5 w-5 text-destructive\" />\n                ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅ\n              </AlertDialogTitle>\n              <AlertDialogDescription>\n                ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©ÿü ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°.\n                {messageToDelete && (\n                  <div className=\"mt-3 p-3 rounded-lg bg-muted\">\n                    <Badge variant=\"outline\" className=\"font-mono\">{messageToDelete.serialNumber}</Badge>\n                    <p className=\"text-sm mt-2 line-clamp-2\">{messageToDelete.title || 'ÿ®ÿØŸàŸÜ ÿπŸÜŸàÿßŸÜ'}</p>\n                  </div>\n                )}\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter className=\"gap-2\">\n              <AlertDialogCancel>ÿ•ŸÑÿ∫ÿßÿ°</AlertDialogCancel>\n              <AlertDialogAction\n                onClick={handleConfirmDelete}\n                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              >\n                {deleteMessageMutation.isPending ? (\n                  <Loader className=\"h-4 w-4 animate-spin ml-2\" />\n                ) : (\n                  <Trash2 className=\"h-4 w-4 ml-2\" />\n                )}\n                ÿ≠ÿ∞ŸÅ\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n\n        {/* Bulk Delete Confirmation Dialog */}\n        <AlertDialog open={bulkDeleteDialogOpen} onOpenChange={setBulkDeleteDialogOpen}>\n          <AlertDialogContent dir=\"rtl\">\n            <AlertDialogHeader>\n              <AlertDialogTitle className=\"flex items-center gap-2\">\n                <Trash2 className=\"h-5 w-5 text-destructive\" />\n                ÿ™ÿ£ŸÉŸäÿØ ÿ≠ÿ∞ŸÅ ŸÖÿ™ÿπÿØÿØ\n              </AlertDialogTitle>\n              <AlertDialogDescription>\n                ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ {selectedIds.size} ÿ±ÿ≥ÿßŸÑÿ© ŸÖÿ≠ÿØÿØÿ©ÿü ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter className=\"gap-2\">\n              <AlertDialogCancel>ÿ•ŸÑÿ∫ÿßÿ°</AlertDialogCancel>\n              <AlertDialogAction\n                onClick={handleBulkDelete}\n                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              >\n                <Trash2 className=\"h-4 w-4 ml-2\" />\n                ÿ≠ÿ∞ŸÅ {selectedIds.size} ÿ±ÿ≥ÿßŸÑÿ©\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n\n        {/* Text-to-Speech Dialog */}\n        <Dialog open={ttsDialogOpen} onOpenChange={setTtsDialogOpen}>\n          <DialogContent className=\"sm:max-w-lg\" dir=\"rtl\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Volume2 className=\"h-5 w-5 text-primary\" />\n                ÿßŸÑŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿµŸàÿ™Ÿäÿ©\n                {ttsMessage && (\n                  <Badge variant=\"outline\" className=\"font-mono\">\n                    {ttsMessage.serialNumber}\n                  </Badge>\n                )}\n              </DialogTitle>\n              <DialogDescription>\n                ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜÿµ ÿ•ŸÑŸâ ÿµŸàÿ™ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ™ŸÇŸÜŸäÿ© Groq PlayAI\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"space-y-4 py-4\">\n              {/* TTS Status Check */}\n              {!ttsStatus?.configured && (\n                <div className=\"p-4 rounded-lg bg-amber-500/10 border border-amber-500/20\">\n                  <div className=\"flex items-start gap-2\">\n                    <AlertCircle className=\"h-5 w-5 text-amber-600 mt-0.5\" />\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-medium text-amber-900 dark:text-amber-100\">\n                        ÿ™ÿ≠ÿ∞Ÿäÿ±\n                      </h4>\n                      <p className=\"text-sm text-amber-800 dark:text-amber-200 mt-1\">\n                        Ÿäÿ¨ÿ® ÿ™ŸÉŸàŸäŸÜ GROQ_API_KEY ŸÅŸä ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ© ŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿµŸàÿ™Ÿäÿ©\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Voice Selection */}\n              <div>\n                <Label htmlFor=\"tts-voice\" className=\"mb-2 block\">\n                  ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸàÿ™\n                </Label>\n                <Select value={selectedVoice} onValueChange={setSelectedVoice}>\n                  <SelectTrigger id=\"tts-voice\">\n                    <SelectValue placeholder=\"ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸàÿ™\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {ttsVoices?.map((voice) => (\n                      <SelectItem key={voice.id} value={voice.id}>\n                        <div className=\"flex items-center gap-2\">\n                          <span>{voice.name}</span>\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            {voice.language}\n                          </Badge>\n                          {voice.gender && (\n                            <span className=\"text-xs text-muted-foreground\">\n                              ({voice.gender === 'male' ? 'ÿ∞ŸÉÿ±' : 'ÿ£ŸÜÿ´Ÿâ'})\n                            </span>\n                          )}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  ÿ≥Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßÿÆÿ™Ÿäÿßÿ±ŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã\n                </p>\n              </div>\n\n              {/* Text Preview */}\n              {ttsMessage && (\n                <div>\n                  <Label className=\"mb-2 block\">ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÜÿµ</Label>\n                  <ScrollArea className=\"h-32 rounded-md border p-3 bg-muted/30\">\n                    <p className=\"text-sm whitespace-pre-wrap\">\n                      {(ttsMessage.processedText || ttsMessage.originalText || '').slice(0, 500)}\n                      {(ttsMessage.processedText || ttsMessage.originalText || '').length > 500 && '...'}\n                    </p>\n                  </ScrollArea>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    ÿπÿØÿØ ÿßŸÑÿ£ÿ≠ÿ±ŸÅ: {(ttsMessage.processedText || ttsMessage.originalText || '').length}\n                    {(ttsMessage.processedText || ttsMessage.originalText || '').length > 4000 && (\n                      <span className=\"text-amber-600 mr-2\">\n                        (ÿ≥Ÿäÿ™ŸÖ ÿßŸÇÿ™ÿµÿßÿµ ÿßŸÑŸÜÿµ ÿ•ŸÑŸâ 4000 ÿ≠ÿ±ŸÅ)\n                      </span>\n                    )}\n                  </p>\n                </div>\n              )}\n\n              {/* Audio Player */}\n              {audioUrl && (\n                <Card className=\"bg-muted/30\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between gap-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={handlePlayPause}\n                          className=\"gap-1\"\n                        >\n                          {isPlaying ? (\n                            <>\n                              <Pause className=\"h-4 w-4\" />\n                              ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™\n                            </>\n                          ) : (\n                            <>\n                              <Play className=\"h-4 w-4\" />\n                              ÿ™ÿ¥ÿ∫ŸäŸÑ\n                            </>\n                          )}\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={handleStopAudio}\n                          className=\"gap-1\"\n                        >\n                          <StopCircle className=\"h-4 w-4\" />\n                          ÿ•ŸäŸÇÿßŸÅ\n                        </Button>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={handleDownloadAudio}\n                        className=\"gap-1\"\n                      >\n                        <Download className=\"h-4 w-4\" />\n                        ÿ™ÿ≠ŸÖŸäŸÑ\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n\n            <DialogFooter className=\"gap-2\">\n              <DialogClose asChild>\n                <Button variant=\"outline\">ÿ•ÿ∫ŸÑÿßŸÇ</Button>\n              </DialogClose>\n              <Button\n                onClick={handleGenerateSpeech}\n                disabled={textToSpeechMutation.isPending || !ttsStatus?.configured}\n              >\n                {textToSpeechMutation.isPending ? (\n                  <>\n                    <Loader className=\"h-4 w-4 animate-spin ml-2\" />\n                    ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ŸàŸÑŸäÿØ...\n                  </>\n                ) : (\n                  <>\n                    <Sparkles className=\"h-4 w-4 ml-2\" />\n                    ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿµŸàÿ™\n                  </>\n                )}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* HTML Export Dialog */}\n        <Dialog open={htmlExportDialogOpen} onOpenChange={setHtmlExportDialogOpen}>\n          <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5 text-primary\" />\n                ÿ™ÿµÿØŸäÿ± HTML\n              </DialogTitle>\n              <DialogDescription>\n                ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ŸÑÿ™ÿµÿØŸäÿ± ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ŸÉŸÖŸÑŸÅ HTML\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"space-y-4 py-4\">\n              <div>\n                <Label className=\"mb-3 block\">ŸÜŸàÿπ ÿßŸÑÿ™ÿµÿØŸäÿ±</Label>\n                <div className=\"grid grid-cols-3 gap-2\">\n                  <Button\n                    variant={htmlExportType === 'day' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setHtmlExportType('day')}\n                    className=\"flex flex-col h-auto py-3\"\n                  >\n                    <CalendarIcon className=\"h-5 w-5 mb-1\" />\n                    ŸäŸàŸÖ ŸÖÿ≠ÿØÿØ\n                  </Button>\n                  <Button\n                    variant={htmlExportType === 'range' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setHtmlExportType('range')}\n                    className=\"flex flex-col h-auto py-3\"\n                  >\n                    <CalendarIcon className=\"h-5 w-5 mb-1\" />\n                    ŸÜÿ∑ÿßŸÇ ÿ™Ÿàÿßÿ±ŸäÿÆ\n                  </Button>\n                  <Button\n                    variant={htmlExportType === 'month' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setHtmlExportType('month')}\n                    className=\"flex flex-col h-auto py-3\"\n                  >\n                    <CalendarIcon className=\"h-5 w-5 mb-1\" />\n                    ÿ¥Ÿáÿ± ŸÉÿßŸÖŸÑ\n                  </Button>\n                </div>\n              </div>\n\n              {htmlExportType === 'day' && (\n                <div>\n                  <Label className=\"mb-2 block\">ÿßÿÆÿ™ÿ± ÿßŸÑŸäŸàŸÖ</Label>\n                  <Popover open={htmlDatePickerOpen === 'day'} onOpenChange={(open) => setHtmlDatePickerOpen(open ? 'day' : null)}>\n                    <PopoverTrigger asChild>\n                      <Button variant=\"outline\" className=\"w-full justify-start text-right\">\n                        <CalendarIcon className=\"ml-2 h-4 w-4\" />\n                        {format(htmlExportDate, 'dd MMMM yyyy', { locale: ar })}\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                      <Calendar\n                        mode=\"single\"\n                        selected={htmlExportDate}\n                        onSelect={(date) => {\n                          if (date) setHtmlExportDate(date);\n                          setHtmlDatePickerOpen(null);\n                        }}\n                        locale={ar}\n                      />\n                    </PopoverContent>\n                  </Popover>\n                </div>\n              )}\n\n              {htmlExportType === 'range' && (\n                <div className=\"space-y-3\">\n                  <div>\n                    <Label className=\"mb-2 block\">ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ</Label>\n                    <Popover open={htmlDatePickerOpen === 'from'} onOpenChange={(open) => setHtmlDatePickerOpen(open ? 'from' : null)}>\n                      <PopoverTrigger asChild>\n                        <Button variant=\"outline\" className=\"w-full justify-start text-right\">\n                          <CalendarIcon className=\"ml-2 h-4 w-4\" />\n                          {format(htmlExportDateFrom, 'dd MMMM yyyy', { locale: ar })}\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                        <Calendar\n                          mode=\"single\"\n                          selected={htmlExportDateFrom}\n                          onSelect={(date) => {\n                            if (date) setHtmlExportDateFrom(date);\n                            setHtmlDatePickerOpen(null);\n                          }}\n                          locale={ar}\n                        />\n                      </PopoverContent>\n                    </Popover>\n                  </div>\n                  <div>\n                    <Label className=\"mb-2 block\">ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ</Label>\n                    <Popover open={htmlDatePickerOpen === 'to'} onOpenChange={(open) => setHtmlDatePickerOpen(open ? 'to' : null)}>\n                      <PopoverTrigger asChild>\n                        <Button variant=\"outline\" className=\"w-full justify-start text-right\">\n                          <CalendarIcon className=\"ml-2 h-4 w-4\" />\n                          {format(htmlExportDateTo, 'dd MMMM yyyy', { locale: ar })}\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                        <Calendar\n                          mode=\"single\"\n                          selected={htmlExportDateTo}\n                          onSelect={(date) => {\n                            if (date) setHtmlExportDateTo(date);\n                            setHtmlDatePickerOpen(null);\n                          }}\n                          locale={ar}\n                        />\n                      </PopoverContent>\n                    </Popover>\n                  </div>\n                </div>\n              )}\n\n              {htmlExportType === 'month' && (\n                <div>\n                  <Label className=\"mb-2 block\">ÿßÿÆÿ™ÿ± ÿßŸÑÿ¥Ÿáÿ±</Label>\n                  <Popover open={htmlDatePickerOpen === 'month'} onOpenChange={(open) => setHtmlDatePickerOpen(open ? 'month' : null)}>\n                    <PopoverTrigger asChild>\n                      <Button variant=\"outline\" className=\"w-full justify-start text-right\">\n                        <CalendarIcon className=\"ml-2 h-4 w-4\" />\n                        {format(htmlExportMonth, 'MMMM yyyy', { locale: ar })}\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                      <Calendar\n                        mode=\"single\"\n                        selected={htmlExportMonth}\n                        onSelect={(date) => {\n                          if (date) setHtmlExportMonth(date);\n                          setHtmlDatePickerOpen(null);\n                        }}\n                        locale={ar}\n                      />\n                    </PopoverContent>\n                  </Popover>\n                </div>\n              )}\n\n              <div className=\"p-3 rounded-lg bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800\">\n                <p className=\"text-sm text-blue-800 dark:text-blue-200\">\n                  ÿ≥Ÿäÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿ®ÿ™ŸÜÿ≥ŸäŸÇ HTML ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä ŸÖÿπ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÅŸÑÿßÿ™ÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ© Ÿäÿ™ÿ∂ŸÖŸÜ:\n                </p>\n                <ul className=\"text-xs text-blue-600 dark:text-blue-300 mt-2 space-y-1 list-disc list-inside\">\n                  <li>ÿßŸÑÿπŸÜŸàÿßŸÜ Ÿàÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ</li>\n                  <li>ÿßŸÑÿ™ÿµŸÜŸäŸÅ ŸàŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±</li>\n                  <li>ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© ŸàÿßŸÑÿ™ÿßÿ±ŸäÿÆ</li>\n                  <li>ÿßŸÑŸÖÿµÿØÿ± ŸàÿßŸÑŸÖÿÆÿ™ÿµ</li>\n                  <li>ÿ™ÿ∑ÿ®ŸäŸÇ ŸÅŸÑÿßÿ™ÿ± ÿßŸÑÿ®ÿ≠ÿ´ ŸàÿßŸÑÿ™ÿµŸÜŸäŸÅ ŸàÿßŸÑŸÖÿµÿØÿ±</li>\n                </ul>\n                {(filters.classification || filters.newsType || filters.province || filters.specialist || filters.sourceChannelTitle) && (\n                  <div className=\"mt-2 pt-2 border-t border-blue-200 dark:border-blue-700\">\n                    <p className=\"text-xs text-blue-700 dark:text-blue-300 font-medium\">ÿßŸÑŸÅŸÑÿßÿ™ÿ± ÿßŸÑŸÖŸÅÿπŸÑÿ©:</p>\n                    <div className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\n                      {filters.classification && <div>‚Ä¢ ÿßŸÑÿ™ÿµŸÜŸäŸÅ: {filters.classification}</div>}\n                      {filters.newsType && <div>‚Ä¢ ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±: {filters.newsType}</div>}\n                      {filters.province && <div>‚Ä¢ ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©: {filters.province}</div>}\n                      {filters.specialist && <div>‚Ä¢ ÿßŸÑŸÖÿÆÿ™ÿµ: {filters.specialist}</div>}\n                      {filters.sourceChannelTitle && <div>‚Ä¢ ÿßŸÑŸÖÿµÿØÿ±: {filters.sourceChannelTitle}</div>}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <DialogFooter className=\"gap-2\">\n              <DialogClose asChild>\n                <Button variant=\"outline\">ÿ•ŸÑÿ∫ÿßÿ°</Button>\n              </DialogClose>\n              <Button\n                onClick={handleExportHTML}\n                disabled={htmlExportLoading}\n              >\n                {htmlExportLoading ? (\n                  <>\n                    <Loader className=\"h-4 w-4 animate-spin ml-2\" />\n                    ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿµÿØŸäÿ±...\n                  </>\n                ) : (\n                  <>\n                    <Download className=\"h-4 w-4 ml-2\" />\n                    ÿ™ÿµÿØŸäÿ± HTML\n                  </>\n                )}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </TooltipProvider>\n  );\n}","path":null,"size_bytes":119464,"size_tokens":null},"client/src/components/ai-rules/SummarizationDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Loader, FileText, Sparkles, ListChecks, Hash, Zap, AlignLeft, Settings2, BookOpen } from \"lucide-react\";\nimport { SummarizationRule, summarizationStyles } from \"./types\";\n\ninterface SummarizationDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: Partial<SummarizationRule>) => void;\n  editingData?: SummarizationRule | null;\n  isLoading?: boolean;\n}\n\nconst defaultForm: Partial<SummarizationRule> = {\n  name: '',\n  prompt: '',\n  maxLength: 300,\n  style: 'balanced',\n  keyPointsCount: 3,\n  isActive: true,\n  priority: 0\n};\n\nconst styleIcons: Record<string, { icon: string; color: string; bgColor: string }> = {\n  brief: { icon: '‚ö°', color: 'text-blue-500', bgColor: 'bg-blue-500' },\n  balanced: { icon: '‚öñÔ∏è', color: 'text-purple-500', bgColor: 'bg-purple-500' },\n  detailed: { icon: 'üìö', color: 'text-emerald-500', bgColor: 'bg-emerald-500' },\n  technical: { icon: 'üîß', color: 'text-orange-500', bgColor: 'bg-orange-500' },\n};\n\nexport function SummarizationDialog({ open, onOpenChange, onSubmit, editingData, isLoading }: SummarizationDialogProps) {\n  const [form, setForm] = useState<Partial<SummarizationRule>>(defaultForm);\n\n  useEffect(() => {\n    if (editingData) {\n      setForm(editingData);\n    } else {\n      setForm(defaultForm);\n    }\n  }, [editingData, open]);\n\n  const handleSubmit = () => {\n    onSubmit(form);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[650px] p-0 overflow-hidden bg-gradient-to-b from-background to-background/95\">\n        <div className=\"bg-gradient-to-l from-amber-500/10 via-orange-500/10 to-yellow-500/10 dark:from-amber-500/20 dark:via-orange-500/15 dark:to-yellow-500/10\">\n          <DialogHeader className=\"p-6 pb-4\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"p-3 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-600 shadow-lg shadow-amber-500/25\">\n                <FileText className=\"h-6 w-6 text-white\" />\n              </div>\n              <div>\n                <DialogTitle className=\"text-xl font-bold bg-gradient-to-l from-amber-600 to-orange-600 dark:from-amber-400 dark:to-orange-400 bg-clip-text text-transparent\">\n                  {editingData ? \"ÿ™ÿπÿØŸäŸÑ ŸÇÿßÿπÿØÿ© ÿ™ŸÑÿÆŸäÿµ\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿ™ŸÑÿÆŸäÿµ ŸÜÿµŸàÿµ\"}\n                </DialogTitle>\n                <DialogDescription className=\"text-sm mt-1 text-muted-foreground\">\n                  ŸÇŸÖ ÿ®ÿ•ÿπÿØÿßÿØ ŸÇÿßÿπÿØÿ© ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµŸàÿµ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ŸÉ\n                </DialogDescription>\n              </div>\n            </div>\n          </DialogHeader>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <Sparkles className=\"h-4 w-4 text-amber-500\" />\n              ÿßÿ≥ŸÖ ÿßŸÑŸÇÿßÿπÿØÿ©\n            </Label>\n            <Input\n              value={form.name}\n              onChange={(e) => setForm({ ...form, name: e.target.value })}\n              placeholder=\"ŸÖÿ´ÿßŸÑ: ŸÖŸÑÿÆÿµ ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ÿßŸÑŸÖÿÆÿ™ÿµÿ±\"\n              className=\"h-12 text-base border-2 focus:border-primary/50 transition-all rounded-xl bg-muted/30\"\n            />\n          </div>\n\n          <div className=\"space-y-3\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <BookOpen className=\"h-4 w-4 text-purple-500\" />\n              ÿ£ÿ≥ŸÑŸàÿ® ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n            </Label>\n            <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-2\">\n              {summarizationStyles.map((style) => {\n                const styleInfo = styleIcons[style.value] || styleIcons.balanced;\n                const isSelected = form.style === style.value;\n                return (\n                  <button\n                    key={style.value}\n                    type=\"button\"\n                    onClick={() => setForm({ ...form, style: style.value })}\n                    className={`p-3 rounded-xl border-2 transition-all duration-200 text-center ${\n                      isSelected\n                        ? `border-primary/50 bg-primary/10 dark:bg-primary/20 ring-2 ring-primary/20`\n                        : 'border-border hover:border-primary/30 hover:bg-muted/50'\n                    }`}\n                  >\n                    <div className=\"text-2xl mb-1\">{styleInfo.icon}</div>\n                    <div className=\"font-semibold text-xs\">{style.label}</div>\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n            <div className=\"space-y-3\">\n              <Label className=\"text-sm font-semibold flex items-center gap-2\">\n                <Hash className=\"h-4 w-4 text-blue-500\" />\n                ÿßŸÑÿ∑ŸàŸÑ ÿßŸÑÿ£ŸÇÿµŸâ: <span className=\"text-primary font-bold\">{form.maxLength} ÿ≠ÿ±ŸÅ</span>\n              </Label>\n              <div className=\"px-2\">\n                <Slider\n                  value={[form.maxLength || 300]}\n                  onValueChange={([value]) => setForm({ ...form, maxLength: value })}\n                  min={100}\n                  max={2000}\n                  step={50}\n                  className=\"w-full\"\n                />\n                <div className=\"flex justify-between text-xs text-muted-foreground mt-2\">\n                  <span>100</span>\n                  <span>2000</span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label className=\"text-sm font-semibold flex items-center gap-2\">\n                <ListChecks className=\"h-4 w-4 text-emerald-500\" />\n                ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©: <span className=\"text-primary font-bold\">{form.keyPointsCount}</span>\n              </Label>\n              <div className=\"px-2\">\n                <Slider\n                  value={[form.keyPointsCount || 3]}\n                  onValueChange={([value]) => setForm({ ...form, keyPointsCount: value })}\n                  min={1}\n                  max={10}\n                  step={1}\n                  className=\"w-full\"\n                />\n                <div className=\"flex justify-between text-xs text-muted-foreground mt-2\">\n                  <span>1</span>\n                  <span>10</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <Settings2 className=\"h-4 w-4 text-purple-500\" />\n              ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©\n            </Label>\n            <Input\n              type=\"number\"\n              value={form.priority}\n              onChange={(e) => setForm({ ...form, priority: parseInt(e.target.value) || 0 })}\n              className=\"h-12 border-2 rounded-xl bg-muted/30\"\n              min={0}\n              max={100}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <AlignLeft className=\"h-4 w-4 text-cyan-500\" />\n              ÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÖÿÆÿµÿµÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)\n            </Label>\n            <Textarea\n              value={form.prompt}\n              onChange={(e) => setForm({ ...form, prompt: e.target.value })}\n              placeholder=\"ÿ£ÿ∂ŸÅ ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿÆÿßÿµÿ© ŸÑŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿπŸÜÿØ ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµŸàÿµ...\"\n              className=\"min-h-[100px] border-2 rounded-xl bg-muted/30 resize-none\"\n            />\n          </div>\n\n          <div className=\"p-4 rounded-xl border-2 border-amber-500/30 bg-gradient-to-l from-amber-500/5 to-orange-500/5 dark:from-amber-500/10 dark:to-orange-500/10\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className={`p-2 rounded-xl ${form.isActive ? 'bg-amber-500 text-white' : 'bg-muted'}`}>\n                  <Zap className=\"h-5 w-5\" />\n                </div>\n                <div>\n                  <div className=\"font-semibold\">ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÇÿßÿπÿØÿ©</div>\n                  <div className=\"text-xs text-muted-foreground\">ÿßŸÑŸÇÿßÿπÿØÿ© {form.isActive ? 'ŸÖŸÅÿπŸÑÿ©' : 'ŸÖÿπÿ∑ŸÑÿ©'}</div>\n                </div>\n              </div>\n              <Switch\n                checked={form.isActive}\n                onCheckedChange={(checked) => setForm({ ...form, isActive: checked })}\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 p-6 pt-0\">\n          <Button\n            onClick={handleSubmit}\n            disabled={isLoading || !form.name}\n            className=\"flex-1 h-12 rounded-xl bg-gradient-to-l from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-bold shadow-lg shadow-amber-500/25\"\n          >\n            {isLoading && <Loader className=\"h-5 w-5 ml-2 animate-spin\" />}\n            {editingData ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            className=\"h-12 px-8 rounded-xl border-2\"\n            onClick={() => onOpenChange(false)}\n          >\n            ÿ•ŸÑÿ∫ÿßÿ°\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9979,"size_tokens":null},"client/src/components/ai-rules/FilterDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Loader, Filter } from \"lucide-react\";\nimport { ContentFilter, filterTypes, matchTypes, filterActions, sentimentTargets } from \"./types\";\n\ninterface FilterDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: Partial<ContentFilter>) => void;\n  editingData?: ContentFilter | null;\n  isLoading?: boolean;\n}\n\nconst defaultForm: Partial<ContentFilter> = {\n  name: '',\n  filterType: 'allow',\n  matchType: 'contains',\n  pattern: '',\n  contextDescription: '',\n  sentimentTarget: 'any',\n  action: 'forward',\n  modifyInstructions: '',\n  priority: 0,\n  isActive: true\n};\n\nexport function FilterDialog({ open, onOpenChange, onSubmit, editingData, isLoading }: FilterDialogProps) {\n  const [form, setForm] = useState<Partial<ContentFilter>>(defaultForm);\n\n  useEffect(() => {\n    if (editingData) {\n      setForm(editingData);\n    } else {\n      setForm(defaultForm);\n    }\n  }, [editingData, open]);\n\n  const handleSubmit = () => {\n    onSubmit(form);\n  };\n\n  const showContextFields = form.matchType === 'sentiment' || form.matchType === 'context';\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px] max-h-[90vh] overflow-y-auto\">\n        <DialogHeader className=\"pb-4 border-b\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-orange-500/20 to-amber-500/20\">\n              <Filter className=\"h-5 w-5 text-orange-600\" />\n            </div>\n            <div>\n              <DialogTitle className=\"text-lg\">{editingData ? \"ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÅŸÑÿ™ÿ±\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÅŸÑÿ™ÿ± ŸÖÿ≠ÿ™ŸàŸâ\"}</DialogTitle>\n              <DialogDescription className=\"text-sm mt-0.5\">ÿ™ÿµŸÅŸäÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿ£ŸÜŸÖÿßÿ∑ ÿ£Ÿà ÿ≥ŸäÿßŸÇ</DialogDescription>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className=\"space-y-5 py-4\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">ÿßÿ≥ŸÖ ÿßŸÑŸÅŸÑÿ™ÿ±</Label>\n            <Input\n              value={form.name}\n              onChange={(e) => setForm({ ...form, name: e.target.value })}\n              placeholder=\"ŸÖÿ´ÿßŸÑ: ŸÅŸÑÿ™ÿ± ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ÿßŸÑÿ≥Ÿäÿßÿ≥Ÿäÿ©\"\n              className=\"h-10\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">ŸÜŸàÿπ ÿßŸÑŸÅŸÑÿ™ÿ±</Label>\n              <Select\n                value={form.filterType}\n                onValueChange={(value) => setForm({ ...form, filterType: value })}\n              >\n                <SelectTrigger className=\"h-10\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {filterTypes.map((type) => (\n                    <SelectItem key={type.value} value={type.value}>\n                      <div className=\"py-1\">\n                        <div className=\"font-medium\">{type.label}</div>\n                        <div className=\"text-xs text-muted-foreground\">{type.description}</div>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">ŸÜŸàÿπ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ©</Label>\n              <Select\n                value={form.matchType}\n                onValueChange={(value) => setForm({ ...form, matchType: value })}\n              >\n                <SelectTrigger className=\"h-10\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {matchTypes.map((type) => (\n                    <SelectItem key={type.value} value={type.value}>\n                      <div className=\"py-1\">\n                        <div className=\"font-medium\">{type.label}</div>\n                        <div className=\"text-xs text-muted-foreground\">{type.description}</div>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">ÿßŸÑŸÜŸÖÿ∑ / ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠Ÿäÿ©</Label>\n            <Input\n              value={form.pattern}\n              onChange={(e) => setForm({ ...form, pattern: e.target.value })}\n              placeholder={form.matchType === 'regex' ? \"ÿ™ÿπÿ®Ÿäÿ± ŸÜŸÖÿ∑Ÿä...\" : \"ŸÉŸÑŸÖÿßÿ™ ŸÖŸÅÿ™ÿßÿ≠Ÿäÿ©...\"}\n              className=\"h-10 font-mono\"\n              dir=\"ltr\"\n            />\n          </div>\n\n          {showContextFields && (\n            <>\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium\">ŸàÿµŸÅ ÿßŸÑÿ≥ŸäÿßŸÇ</Label>\n                <Textarea\n                  value={form.contextDescription}\n                  onChange={(e) => setForm({ ...form, contextDescription: e.target.value })}\n                  placeholder=\"ÿµŸÅ ÿßŸÑÿ≥ŸäÿßŸÇ ÿßŸÑÿ∞Ÿä ÿ™ÿ±ŸäÿØ ÿ™ÿµŸÅŸäÿ™Ÿá...\"\n                  className=\"min-h-[80px] resize-none\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium\">ÿßŸÑŸÖÿ¥ÿßÿπÿ± ÿßŸÑŸÖÿ≥ÿ™ŸáÿØŸÅÿ©</Label>\n                <Select\n                  value={form.sentimentTarget}\n                  onValueChange={(value) => setForm({ ...form, sentimentTarget: value })}\n                >\n                  <SelectTrigger className=\"h-10\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {sentimentTargets.map((type) => (\n                      <SelectItem key={type.value} value={type.value}>\n                        {type.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </>\n          )}\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°</Label>\n            <Select\n              value={form.action}\n              onValueChange={(value) => setForm({ ...form, action: value })}\n            >\n              <SelectTrigger className=\"h-10\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {filterActions.map((type) => (\n                  <SelectItem key={type.value} value={type.value}>\n                    <div className=\"py-1\">\n                      <div className=\"font-medium\">{type.label}</div>\n                      <div className=\"text-xs text-muted-foreground\">{type.description}</div>\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {form.action === 'modify' && (\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿ™ÿπÿØŸäŸÑ</Label>\n              <Textarea\n                value={form.modifyInstructions}\n                onChange={(e) => setForm({ ...form, modifyInstructions: e.target.value })}\n                placeholder=\"ŸÉŸäŸÅ ÿ™ÿ±ŸäÿØ ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ...\"\n                className=\"min-h-[80px] resize-none\"\n              />\n            </div>\n          )}\n\n          <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-xl\">\n            <div className=\"flex items-center gap-2\">\n              <Switch\n                checked={form.isActive}\n                onCheckedChange={(checked) => setForm({ ...form, isActive: checked })}\n              />\n              <Label className=\"text-sm cursor-pointer\">ŸÖŸÅÿπŸëŸÑ</Label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Label className=\"text-sm text-muted-foreground\">ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©:</Label>\n              <Input\n                type=\"number\"\n                value={form.priority}\n                onChange={(e) => setForm({ ...form, priority: parseInt(e.target.value) || 0 })}\n                className=\"w-20 h-9\"\n                min={0}\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 pt-4 border-t\">\n          <Button\n            onClick={handleSubmit}\n            disabled={isLoading || !form.name || !form.pattern}\n            className=\"flex-1 h-11\"\n          >\n            {isLoading && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n            {editingData ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅŸÑÿ™ÿ±\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            className=\"h-11 px-6\"\n            onClick={() => onOpenChange(false)}\n          >\n            ÿ•ŸÑÿ∫ÿßÿ°\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9418,"size_tokens":null},"client/src/components/ai-rules/TrainingDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Loader, Brain } from \"lucide-react\";\nimport { TrainingExample, exampleTypes } from \"./types\";\n\ninterface TrainingDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: Partial<TrainingExample>) => void;\n  editingData?: TrainingExample | null;\n  isLoading?: boolean;\n}\n\nconst defaultForm: Partial<TrainingExample> = {\n  exampleType: 'correction',\n  inputText: '',\n  expectedOutput: '',\n  explanation: '',\n  tags: [],\n  isActive: true\n};\n\nexport function TrainingDialog({ open, onOpenChange, onSubmit, editingData, isLoading }: TrainingDialogProps) {\n  const [form, setForm] = useState<Partial<TrainingExample>>(defaultForm);\n\n  useEffect(() => {\n    if (editingData) {\n      setForm(editingData);\n    } else {\n      setForm(defaultForm);\n    }\n  }, [editingData, open]);\n\n  const handleSubmit = () => {\n    if (!form.inputText || !form.expectedOutput) {\n      return;\n    }\n    onSubmit(form);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px]\">\n        <DialogHeader className=\"pb-4 border-b\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-violet-500/20 to-purple-500/20\">\n              <Brain className=\"h-5 w-5 text-violet-600\" />\n            </div>\n            <div>\n              <DialogTitle className=\"text-lg\">{editingData ? \"ÿ™ÿπÿØŸäŸÑ ŸÖÿ´ÿßŸÑ ÿßŸÑÿ™ÿØÿ±Ÿäÿ®\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ´ÿßŸÑ ÿ™ÿØÿ±Ÿäÿ®\"}</DialogTitle>\n              <DialogDescription className=\"text-sm mt-0.5\">ÿπŸÑŸëŸÖ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿ£ÿ≥ŸÑŸàÿ®ŸÉ ÿßŸÑŸÖŸÅÿ∂ŸÑ ÿ®ÿ£ŸÖÿ´ŸÑÿ© ÿπŸÖŸÑŸäÿ©</DialogDescription>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className=\"space-y-5 py-4\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">ŸÜŸàÿπ ÿßŸÑŸÖÿ´ÿßŸÑ</Label>\n            <Select\n              value={form.exampleType}\n              onValueChange={(value) => setForm({ ...form, exampleType: value })}\n            >\n              <SelectTrigger className=\"h-10\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {exampleTypes.map((type) => (\n                  <SelectItem key={type.value} value={type.value}>\n                    <div className=\"py-1\">\n                      <div className=\"font-medium\">{type.label}</div>\n                      <div className=\"text-xs text-muted-foreground\">{type.description}</div>\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">ÿßŸÑŸÜÿµ ÿßŸÑŸÖŸèÿØÿÆŸÑ</Label>\n            <Textarea\n              value={form.inputText}\n              onChange={(e) => setForm({ ...form, inputText: e.target.value })}\n              placeholder=\"ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä ÿ£Ÿà ŸÖÿÆÿ±ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑÿÆÿßÿ∑ÿ¶...\"\n              className=\"min-h-[80px] resize-none\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">ÿßŸÑŸÖÿÆÿ±ÿ¨ ÿßŸÑŸÖÿ™ŸàŸÇÿπ</Label>\n            <Textarea\n              value={form.expectedOutput}\n              onChange={(e) => setForm({ ...form, expectedOutput: e.target.value })}\n              placeholder=\"ÿßŸÑÿµŸäÿßÿ∫ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ÿßŸÑÿ™Ÿä ÿ™ŸÅÿ∂ŸÑŸáÿß...\"\n              className=\"min-h-[80px] resize-none\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">ÿ¥ÿ±ÿ≠ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</Label>\n            <Input\n              value={form.explanation}\n              onChange={(e) => setForm({ ...form, explanation: e.target.value })}\n              placeholder=\"ŸÑŸÖÿßÿ∞ÿß Ÿáÿ∞Ÿá ÿßŸÑÿµŸäÿßÿ∫ÿ© ÿ£ŸÅÿ∂ŸÑÿü\"\n              className=\"h-10\"\n            />\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 pt-4 border-t\">\n          <Button\n            onClick={handleSubmit}\n            disabled={isLoading || !form.inputText || !form.expectedOutput}\n            className=\"flex-1 h-11\"\n          >\n            {isLoading && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n            {editingData ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ´ÿßŸÑ\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            className=\"h-11 px-6\"\n            onClick={() => onOpenChange(false)}\n          >\n            ÿ•ŸÑÿ∫ÿßÿ°\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":5078,"size_tokens":null},"client/src/components/ai-rules/EntityDialog.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Loader, ArrowRightLeft, X } from \"lucide-react\";\nimport { EntityReplacement, entityTypes } from \"./types\";\n\ninterface EntityDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: Partial<EntityReplacement>) => void;\n  editingData?: EntityReplacement | null;\n  isLoading?: boolean;\n}\n\nconst defaultForm: Partial<EntityReplacement> = {\n  entityType: 'person',\n  originalText: '',\n  replacementText: '',\n  caseSensitive: false,\n  useContext: true,\n  isActive: true,\n  priority: 0\n};\n\nexport function EntityDialog({ open, onOpenChange, onSubmit, editingData, isLoading }: EntityDialogProps) {\n  const [form, setForm] = useState<Partial<EntityReplacement>>(defaultForm);\n  const [originalTexts, setOriginalTexts] = useState<string[]>([]);\n  const [replacementTexts, setReplacementTexts] = useState<string[]>([]);\n  const [currentOriginal, setCurrentOriginal] = useState('');\n  const [currentReplacement, setCurrentReplacement] = useState('');\n  const originalInputRef = useRef<HTMLInputElement>(null);\n  const replacementInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (editingData) {\n      setForm(editingData);\n      if (editingData.originalText) {\n        const originals = editingData.originalText.split('|').map(t => t.trim()).filter(Boolean);\n        setOriginalTexts(originals);\n      } else {\n        setOriginalTexts([]);\n      }\n      if (editingData.replacementText) {\n        const replacements = editingData.replacementText.split('|').map(t => t.trim()).filter(Boolean);\n        setReplacementTexts(replacements);\n      } else {\n        setReplacementTexts([]);\n      }\n    } else {\n      setForm(defaultForm);\n      setOriginalTexts([]);\n      setReplacementTexts([]);\n    }\n    setCurrentOriginal('');\n    setCurrentReplacement('');\n  }, [editingData, open]);\n\n  const handleAddOriginal = (clearInput: boolean = true) => {\n    const trimmed = currentOriginal.trim();\n    if (trimmed && !originalTexts.includes(trimmed)) {\n      setOriginalTexts([...originalTexts, trimmed]);\n      if (clearInput) {\n        setCurrentOriginal('');\n      }\n      originalInputRef.current?.focus();\n      return true;\n    }\n    return false;\n  };\n\n  const handleAddReplacement = (clearInput: boolean = true) => {\n    const trimmed = currentReplacement.trim();\n    if (trimmed && !replacementTexts.includes(trimmed)) {\n      setReplacementTexts([...replacementTexts, trimmed]);\n      if (clearInput) {\n        setCurrentReplacement('');\n      }\n      replacementInputRef.current?.focus();\n      return true;\n    }\n    return false;\n  };\n\n  const handleRemoveOriginal = (index: number) => {\n    setOriginalTexts(originalTexts.filter((_, i) => i !== index));\n  };\n\n  const handleRemoveReplacement = (index: number) => {\n    setReplacementTexts(replacementTexts.filter((_, i) => i !== index));\n  };\n\n  const handleOriginalKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleAddOriginal();\n    } else if (e.key === 'Backspace' && currentOriginal === '' && originalTexts.length > 0) {\n      setOriginalTexts(originalTexts.slice(0, -1));\n    }\n  };\n\n  const handleReplacementKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleAddReplacement();\n    } else if (e.key === 'Backspace' && currentReplacement === '' && replacementTexts.length > 0) {\n      setReplacementTexts(replacementTexts.slice(0, -1));\n    }\n  };\n\n  const handleSubmit = () => {\n    const originalText = originalTexts.join('|');\n    const replacementText = replacementTexts.join('|');\n    \n    onSubmit({\n      ...form,\n      originalText,\n      replacementText\n    });\n  };\n\n  const isValid = originalTexts.length > 0 && replacementTexts.length > 0;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px]\">\n        <DialogHeader className=\"pb-4 border-b\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-blue-500/20 to-purple-500/20\">\n              <ArrowRightLeft className=\"h-5 w-5 text-blue-600\" />\n            </div>\n            <div>\n              <DialogTitle className=\"text-lg\">{editingData ? \"ÿ™ÿπÿØŸäŸÑ ŸÇÿßÿπÿØÿ© ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ\"}</DialogTitle>\n              <DialogDescription className=\"text-sm mt-0.5\">ÿßŸÉÿ™ÿ® ÿßŸÑŸÉŸÑŸÖÿ© Ÿàÿßÿ∂ÿ∫ÿ∑ Enter ŸÑÿ•ÿ∂ÿßŸÅÿ™Ÿáÿß ŸÉŸàÿ≥ŸÖ</DialogDescription>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className=\"space-y-5 py-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">ŸÜŸàÿπ ÿßŸÑŸÉŸäÿßŸÜ</Label>\n              <Select\n                value={form.entityType}\n                onValueChange={(value) => setForm({ ...form, entityType: value })}\n              >\n                <SelectTrigger className=\"h-10\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {entityTypes.map((type) => (\n                    <SelectItem key={type.value} value={type.value}>\n                      <span className=\"flex items-center gap-2\">\n                        <span className=\"text-lg\">{type.icon}</span>\n                        {type.label}\n                      </span>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©</Label>\n              <Input\n                type=\"number\"\n                value={form.priority}\n                onChange={(e) => setForm({ ...form, priority: parseInt(e.target.value) || 0 })}\n                className=\"h-10\"\n                min={0}\n                max={100}\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">\n                ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑÿ£ÿµŸÑŸäÿ©\n                <span className=\"text-muted-foreground text-xs mr-2\">(ÿßŸÉÿ™ÿ® Ÿàÿßÿ∂ÿ∫ÿ∑ Enter)</span>\n              </Label>\n              <div \n                className=\"min-h-[60px] p-2 border rounded-lg bg-background flex flex-wrap gap-2 items-start cursor-text\"\n                onClick={() => originalInputRef.current?.focus()}\n              >\n                {originalTexts.map((text, index) => (\n                  <span\n                    key={index}\n                    className=\"inline-flex items-center gap-1 px-2.5 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 rounded-full text-sm\"\n                  >\n                    {text}\n                    <button\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleRemoveOriginal(index);\n                      }}\n                      className=\"hover:bg-blue-200 dark:hover:bg-blue-800 rounded-full p-0.5 transition-colors\"\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </button>\n                  </span>\n                ))}\n                <input\n                  ref={originalInputRef}\n                  type=\"text\"\n                  value={currentOriginal}\n                  onChange={(e) => setCurrentOriginal(e.target.value)}\n                  onKeyDown={handleOriginalKeyDown}\n                  onBlur={() => {\n                    if (currentOriginal.trim()) {\n                      handleAddOriginal();\n                    }\n                  }}\n                  placeholder={originalTexts.length === 0 ? \"ŸÖÿ´ÿßŸÑ: ÿßÿ≠ŸÖÿØÿå ÿµÿßŸÑÿ≠ÿå ÿπŸÑŸä...\" : \"\"}\n                  className=\"flex-1 min-w-[100px] bg-transparent border-none outline-none text-sm py-1\"\n                  enterKeyHint=\"done\"\n                />\n              </div>\n              {originalTexts.length > 0 && (\n                <p className=\"text-xs text-muted-foreground\">\n                  {originalTexts.length} ŸÉŸÑŸÖÿ©/ÿπÿ®ÿßÿ±ÿ© ŸÖÿ∂ÿßŸÅÿ©\n                </p>\n              )}\n            </div>\n\n            <div className=\"flex justify-center\">\n              <ArrowRightLeft className=\"h-5 w-5 text-muted-foreground rotate-90\" />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">\n                ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑÿ®ÿØŸäŸÑÿ©\n                <span className=\"text-muted-foreground text-xs mr-2\">(ÿßŸÉÿ™ÿ® Ÿàÿßÿ∂ÿ∫ÿ∑ Enter)</span>\n              </Label>\n              <div \n                className=\"min-h-[60px] p-2 border rounded-lg bg-background flex flex-wrap gap-2 items-start cursor-text\"\n                onClick={() => replacementInputRef.current?.focus()}\n              >\n                {replacementTexts.map((text, index) => (\n                  <span\n                    key={index}\n                    className=\"inline-flex items-center gap-1 px-2.5 py-1 bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-200 rounded-full text-sm\"\n                  >\n                    {text}\n                    <button\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleRemoveReplacement(index);\n                      }}\n                      className=\"hover:bg-green-200 dark:hover:bg-green-800 rounded-full p-0.5 transition-colors\"\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </button>\n                  </span>\n                ))}\n                <input\n                  ref={replacementInputRef}\n                  type=\"text\"\n                  value={currentReplacement}\n                  onChange={(e) => setCurrentReplacement(e.target.value)}\n                  onKeyDown={handleReplacementKeyDown}\n                  onBlur={() => {\n                    if (currentReplacement.trim()) {\n                      handleAddReplacement();\n                    }\n                  }}\n                  placeholder={replacementTexts.length === 0 ? \"ŸÖÿ´ÿßŸÑ: ÿ∑ŸÅŸÑ\" : \"\"}\n                  className=\"flex-1 min-w-[100px] bg-transparent border-none outline-none text-sm py-1\"\n                  enterKeyHint=\"done\"\n                />\n              </div>\n              {replacementTexts.length > 0 && (\n                <p className=\"text-xs text-muted-foreground\">\n                  {replacementTexts.length} ŸÉŸÑŸÖÿ©/ÿπÿ®ÿßÿ±ÿ© ŸÖÿ∂ÿßŸÅÿ©\n                </p>\n              )}\n            </div>\n          </div>\n\n          {originalTexts.length > 0 && replacementTexts.length > 0 && (\n            <div className=\"p-3 bg-muted/50 rounded-lg border\">\n              <p className=\"text-sm text-muted-foreground mb-2\">ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ:</p>\n              <div className=\"flex flex-wrap items-center gap-2 text-sm\">\n                <span className=\"font-medium text-blue-600 dark:text-blue-400\">\n                  {originalTexts.join('ÿå ')}\n                </span>\n                <ArrowRightLeft className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"font-medium text-green-600 dark:text-green-400\">\n                  {replacementTexts.join('ÿå ')}\n                </span>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex flex-wrap items-center gap-6 p-4 bg-muted/50 rounded-xl\">\n            <div className=\"flex items-center gap-2\">\n              <Switch\n                checked={form.useContext}\n                onCheckedChange={(checked) => setForm({ ...form, useContext: checked })}\n              />\n              <Label className=\"text-sm cursor-pointer\">ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ≥ŸäÿßŸÇ (ŸÖÿ∑ÿßÿ®ŸÇÿ© ÿ∞ŸÉŸäÿ©)</Label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Switch\n                checked={form.caseSensitive}\n                onCheckedChange={(checked) => setForm({ ...form, caseSensitive: checked })}\n              />\n              <Label className=\"text-sm cursor-pointer\">ÿ≠ÿ≥ÿßÿ≥ ŸÑŸÑÿ£ÿ≠ÿ±ŸÅ</Label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Switch\n                checked={form.isActive}\n                onCheckedChange={(checked) => setForm({ ...form, isActive: checked })}\n              />\n              <Label className=\"text-sm cursor-pointer\">ŸÖŸÅÿπŸëŸÑ</Label>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 pt-4 border-t\">\n          <Button\n            onClick={handleSubmit}\n            disabled={isLoading || !isValid}\n            className=\"flex-1 h-11\"\n          >\n            {isLoading && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n            {editingData ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            className=\"h-11 px-6\"\n            onClick={() => onOpenChange(false)}\n          >\n            ÿ•ŸÑÿ∫ÿßÿ°\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":13700,"size_tokens":null},"client/src/components/ai-rules/types.ts":{"content":"export interface EntityReplacement {\n  id?: number;\n  taskId: number;\n  entityType: string;\n  originalText: string;\n  replacementText: string;\n  caseSensitive: boolean;\n  useContext: boolean;\n  isActive: boolean;\n  priority: number;\n}\n\nexport interface ContextRule {\n  id?: number;\n  taskId: number;\n  ruleType: string;\n  triggerPattern: string;\n  targetSentiment: string;\n  instructions: string;\n  examples: any[];\n  isActive: boolean;\n  priority: number;\n}\n\nexport interface TrainingExample {\n  id?: number;\n  taskId: number | null;\n  exampleType: string;\n  inputText: string;\n  expectedOutput: string;\n  explanation: string;\n  tags: string[];\n  isActive: boolean;\n  useCount?: number;\n}\n\nexport interface ContentFilter {\n  id?: number;\n  taskId: number;\n  name: string;\n  filterType: string;\n  matchType: string;\n  pattern: string;\n  contextDescription?: string;\n  sentimentTarget?: string;\n  action: string;\n  modifyInstructions?: string;\n  priority: number;\n  isActive: boolean;\n}\n\nexport interface TemplateCustomField {\n  id?: number;\n  templateId?: number;\n  fieldName: string;\n  fieldLabel: string;\n  extractionInstructions: string;\n  defaultValue?: string;\n  useDefaultIfEmpty: boolean;\n  formatting: string;\n  displayOrder: number;\n  showLabel: boolean;\n  labelSeparator: string;\n  prefix?: string;\n  suffix?: string;\n  fieldType: string;\n  isActive: boolean;\n}\n\nexport interface PublishingTemplate {\n  id?: number;\n  taskId: number;\n  name: string;\n  templateType: string;\n  isDefault: boolean;\n  headerText?: string;\n  headerFormatting?: string;\n  footerText?: string;\n  footerFormatting?: string;\n  fieldSeparator?: string;\n  useNewlineAfterHeader?: boolean;\n  useNewlineBeforeFooter?: boolean;\n  maxLength?: number;\n  extractionPrompt?: string;\n  customFields?: TemplateCustomField[];\n}\n\nexport const entityTypes = [\n  { value: 'person', label: 'ÿ¥ÿÆÿµ', icon: 'üë§' },\n  { value: 'organization', label: 'ŸÖŸÜÿ∏ŸÖÿ©', icon: 'üè¢' },\n  { value: 'location', label: 'ŸÖŸàŸÇÿπ', icon: 'üìç' },\n  { value: 'event', label: 'ÿ≠ÿØÿ´', icon: 'üìÖ' },\n  { value: 'custom', label: 'ŸÖÿÆÿµÿµ', icon: '‚úèÔ∏è' },\n];\n\nexport const contextRuleTypes = [\n  { value: 'neutralize_negative', label: 'ÿ™ÿ≠ŸäŸäÿØ ÿßŸÑÿ≥ŸÑÿ®Ÿäÿ©', description: 'ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≥ŸÑÿ®Ÿäÿ© ÿ•ŸÑŸâ ÿ≠ŸäÿßÿØŸäÿ©' },\n  { value: 'enhance_positive', label: 'ÿ™ÿπÿ≤Ÿäÿ≤ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ©', description: 'ÿ™ÿπÿ≤Ÿäÿ≤ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ©' },\n  { value: 'formal_tone', label: 'ÿµŸäÿßÿ∫ÿ© ÿ±ÿ≥ŸÖŸäÿ©', description: 'ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿßŸÖŸäÿ© ÿ•ŸÑŸâ ÿ±ÿ≥ŸÖŸäÿ©' },\n  { value: 'remove_bias', label: 'ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿ≠Ÿäÿ≤', description: 'ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖÿ™ÿ≠Ÿäÿ≤ÿ©' },\n  { value: 'custom', label: 'ŸÖÿÆÿµÿµ', description: 'ŸÇÿßÿπÿØÿ© ŸÖÿÆÿµÿµÿ© ÿ®ÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÖÿ≠ÿØÿØÿ©' },\n];\n\nexport const exampleTypes = [\n  { value: 'correction', label: 'ÿ™ÿµÿ≠Ÿäÿ≠', description: 'ÿ™ÿµÿ≠Ÿäÿ≠ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿÆÿ±ÿ¨ÿßÿ™' },\n  { value: 'preference', label: 'ÿ™ŸÅÿ∂ŸäŸÑ', description: 'ÿ£ÿ≥ŸÑŸàÿ® ÿ™ŸÅÿ∂ŸÑŸá ŸÅŸä ÿßŸÑÿµŸäÿßÿ∫ÿ©' },\n  { value: 'style', label: 'ÿ£ÿ≥ŸÑŸàÿ®', description: 'ÿ£ÿ≥ŸÑŸàÿ® ŸÉÿ™ÿßÿ®ÿ© ŸÖÿπŸäŸÜ' },\n  { value: 'terminology', label: 'ŸÖÿµÿ∑ŸÑÿ≠ÿßÿ™', description: 'ŸÖÿµÿ∑ŸÑÿ≠ÿßÿ™ ÿ™ŸÅÿ∂ŸÑŸáÿß' },\n];\n\nexport const filterTypes = [\n  { value: 'allow', label: 'ÿ≥ŸÖÿßÿ≠', description: 'ÿßŸÑÿ≥ŸÖÿßÿ≠ ÿ®ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇ' },\n  { value: 'block', label: 'ÿ≠ÿ∏ÿ±', description: 'ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇ' },\n  { value: 'require', label: 'ŸÖÿ∑ŸÑŸàÿ®', description: 'Ÿäÿ™ÿ∑ŸÑÿ® Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ' },\n];\n\nexport const matchTypes = [\n  { value: 'contains', label: 'Ÿäÿ≠ÿ™ŸàŸä', description: 'Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿßŸÑŸÜÿµ' },\n  { value: 'exact', label: 'ŸÖÿ∑ÿßÿ®ŸÇ', description: 'ŸÖÿ∑ÿßÿ®ŸÇÿ© ÿ™ÿßŸÖÿ©' },\n  { value: 'regex', label: 'ÿ™ÿπÿ®Ÿäÿ± ŸÜŸÖÿ∑Ÿä', description: 'ÿ™ÿπÿ®Ÿäÿ± ŸÜŸÖÿ∑Ÿä (Regex)' },\n  { value: 'sentiment', label: 'ŸÖÿ¥ÿßÿπÿ±', description: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿßÿπÿ±' },\n  { value: 'context', label: 'ÿ≥ŸäÿßŸÇ', description: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≥ŸäÿßŸÇ' },\n];\n\nexport const filterActions = [\n  { value: 'skip', label: 'ÿ™ÿÆÿ∑Ÿä', description: 'ÿ™ÿÆÿ∑Ÿä ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©' },\n  { value: 'forward', label: 'ÿ™ŸÖÿ±Ÿäÿ±', description: 'ÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©' },\n  { value: 'modify', label: 'ÿ™ÿπÿØŸäŸÑ', description: 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ' },\n  { value: 'flag', label: 'ÿ™ŸÖŸäŸäÿ≤', description: 'ÿ™ŸÖŸäŸäÿ≤ ŸÑŸÑŸÖÿ±ÿßÿ¨ÿπÿ©' },\n];\n\nexport const sentimentTargets = [\n  { value: 'positive', label: 'ÿ•Ÿäÿ¨ÿßÿ®Ÿä' },\n  { value: 'negative', label: 'ÿ≥ŸÑÿ®Ÿä' },\n  { value: 'neutral', label: 'ŸÖÿ≠ÿßŸäÿØ' },\n  { value: 'any', label: 'ÿ£Ÿä' },\n];\n\nexport const templateTypes = [\n  { value: 'news', label: 'ÿÆÿ®ÿ±', description: 'ŸÇÿßŸÑÿ® ÿßŸÑÿ£ÿÆÿ®ÿßÿ±' },\n  { value: 'report', label: 'ÿ™ŸÇÿ±Ÿäÿ±', description: 'ŸÇÿßŸÑÿ® ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±' },\n  { value: 'interview', label: 'ŸÖŸÇÿßÿ®ŸÑÿ©', description: 'ŸÇÿßŸÑÿ® ÿßŸÑŸÖŸÇÿßÿ®ŸÑÿßÿ™' },\n  { value: 'summary', label: 'ŸÖŸÑÿÆÿµ', description: 'ŸÇÿßŸÑÿ® ÿßŸÑŸÖŸÑÿÆÿµÿßÿ™' },\n  { value: 'custom', label: 'ŸÖÿÆÿµÿµ', description: 'ŸÇÿßŸÑÿ® ŸÖÿÆÿµÿµ' },\n];\n\nexport const formattingOptions = [\n  { value: 'none', label: 'ÿ®ÿØŸàŸÜ ÿ™ŸÜÿ≥ŸäŸÇ', example: 'ŸÜÿµ ÿπÿßÿØŸä' },\n  { value: 'bold', label: 'ÿπÿ±Ÿäÿ∂', example: '**ŸÜÿµ ÿπÿ±Ÿäÿ∂**' },\n  { value: 'italic', label: 'ŸÖÿßÿ¶ŸÑ', example: '__ŸÜÿµ ŸÖÿßÿ¶ŸÑ__' },\n  { value: 'code', label: 'ŸÉŸàÿØ', example: '`ŸÜÿµ ŸÉŸàÿØ`' },\n  { value: 'quote', label: 'ÿßŸÇÿ™ÿ®ÿßÿ≥', example: '> ÿßŸÇÿ™ÿ®ÿßÿ≥' },\n  { value: 'spoiler', label: 'ŸÖÿÆŸÅŸä', example: '||ŸÜÿµ ŸÖÿÆŸÅŸä||' },\n  { value: 'strikethrough', label: 'ŸÖÿ¥ÿ∑Ÿàÿ®', example: '~~ŸÜÿµ ŸÖÿ¥ÿ∑Ÿàÿ®~~' },\n  { value: 'underline', label: 'ÿ™ÿ≠ÿ™Ÿá ÿÆÿ∑', example: '<u>ŸÜÿµ</u>' },\n];\n\nexport const fieldTypes = [\n  { value: 'extracted', label: 'ŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä', description: 'Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨Ÿá ŸÖŸÜ ÿßŸÑŸÜÿµ' },\n  { value: 'summary', label: 'ÿßŸÑŸÖŸÑÿÆÿµ', description: 'ŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑÿ™ŸÑÿÆŸäÿµ ŸÖŸÜ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©' },\n  { value: 'date_today', label: 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸäŸàŸÖ', description: 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸäŸàŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã' },\n  { value: 'static', label: 'ŸÜÿµ ÿ´ÿßÿ®ÿ™', description: 'ŸÇŸäŸÖÿ© ÿ´ÿßÿ®ÿ™ÿ© ÿ™ÿ≠ÿØÿØŸáÿß ÿ£ŸÜÿ™' },\n];\n\nexport interface PresetField {\n  id: string;\n  fieldName: string;\n  fieldLabel: string;\n  fieldType: string;\n  extractionInstructions: string;\n  icon: string;\n  description: string;\n}\n\nexport const presetFields: PresetField[] = [\n  {\n    id: 'date',\n    fieldName: 'date',\n    fieldLabel: 'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ',\n    fieldType: 'date_today',\n    extractionInstructions: '',\n    icon: 'üìÖ',\n    description: 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸäŸàŸÖ ÿßŸÑÿ≠ÿßŸÑŸä'\n  },\n  {\n    id: 'governorate',\n    fieldName: 'governorate',\n    fieldLabel: 'ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©',\n    fieldType: 'extracted',\n    extractionInstructions: 'ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© ÿ£Ÿà ÿßŸÑŸÖÿØŸäŸÜÿ© ŸÖŸÜ ÿßŸÑŸÜÿµ. ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸèÿ∞ŸÉÿ±ÿå ÿßŸÉÿ™ÿ® \"ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ\"',\n    icon: 'üìç',\n    description: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© ÿ£Ÿà ÿßŸÑŸÖÿØŸäŸÜÿ©'\n  },\n  {\n    id: 'news_type',\n    fieldName: 'news_type',\n    fieldLabel: 'ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±',\n    fieldType: 'extracted',\n    extractionInstructions: 'ÿ≠ÿØÿØ ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ± (ÿπÿßÿ¨ŸÑÿå ÿ≥Ÿäÿßÿ≥Ÿäÿå ÿßŸÇÿ™ÿµÿßÿØŸäÿå ÿ±Ÿäÿßÿ∂Ÿäÿå ÿ´ŸÇÿßŸÅŸäÿå ÿßÿ¨ÿ™ŸÖÿßÿπŸäÿå ÿ£ŸÖŸÜŸäÿå ÿ™ŸÇÿ±Ÿäÿ±ÿå ÿ•ÿπŸÑÿßŸÜÿå ÿ£ÿÆÿ±Ÿâ)',\n    icon: 'üì∞',\n    description: 'ÿ™ÿµŸÜŸäŸÅ ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±'\n  },\n  {\n    id: 'summary',\n    fieldName: 'summary',\n    fieldLabel: 'ÿßŸÑÿ™ŸÑÿÆŸäÿµ',\n    fieldType: 'summary',\n    extractionInstructions: '',\n    icon: 'üìù',\n    description: 'ŸÖŸÑÿÆÿµ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸèÿπÿßŸÑÿ¨'\n  },\n  {\n    id: 'specialist',\n    fieldName: 'specialist',\n    fieldLabel: 'ÿßŸÑŸÖÿÆÿ™ÿµ',\n    fieldType: 'extracted',\n    extractionInstructions: 'ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿÆÿ™ÿµ ÿ£Ÿà ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿ£Ÿà ÿßŸÑÿ¨Ÿáÿ© ÿßŸÑŸÖÿπŸÜŸäÿ© ÿ®ÿßŸÑÿÆÿ®ÿ±. ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸèÿ∞ŸÉÿ±ÿå ÿßŸÉÿ™ÿ® \"ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ\"',\n    icon: 'üë§',\n    description: 'ÿßŸÑÿ¥ÿÆÿµ ÿ£Ÿà ÿßŸÑÿ¨Ÿáÿ© ÿßŸÑŸÖÿÆÿ™ÿµÿ©'\n  },\n  {\n    id: 'category',\n    fieldName: 'category',\n    fieldLabel: 'ÿßŸÑÿ™ÿµŸÜŸäŸÅ',\n    fieldType: 'extracted',\n    extractionInstructions: 'ÿ≠ÿØÿØ ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ŸÑŸÑŸÖÿ≠ÿ™ŸàŸâ (ŸÖÿ≠ŸÑŸäÿå ÿØŸàŸÑŸäÿå ÿ•ŸÇŸÑŸäŸÖŸäÿå ÿÆÿßÿµ)',\n    icon: 'üè∑Ô∏è',\n    description: 'ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿπÿßŸÖ ŸÑŸÑŸÖÿ≠ÿ™ŸàŸâ'\n  },\n  {\n    id: 'record_number',\n    fieldName: 'record_number',\n    fieldLabel: 'ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ',\n    fieldType: 'extracted',\n    extractionInstructions: 'ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ ÿ£Ÿà ÿßŸÑŸÖÿ±ÿ¨ÿπ ÿ£Ÿà ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ≥ŸÑÿ≥ŸÑŸä ÿ•ŸÜ ŸàŸèÿ¨ÿØ. ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸèÿ∞ŸÉÿ±ÿå ÿßŸÉÿ™ÿ® \"---\"',\n    icon: 'üî¢',\n    description: 'ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ ÿ£Ÿà ÿßŸÑŸÖÿ±ÿ¨ÿπ'\n  },\n  {\n    id: 'source',\n    fieldName: 'source_channel_title',\n    fieldLabel: 'ÿßŸÑŸÖÿµÿØÿ±',\n    fieldType: 'extracted',\n    extractionInstructions: 'ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿµÿØÿ± ÿ£Ÿà ÿßŸÑŸÇŸÜÿßÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÑŸÑÿÆÿ®ÿ±. ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸèÿ∞ŸÉÿ±ÿå ÿßŸÉÿ™ÿ® \"ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ\"',\n    icon: 'üì°',\n    description: 'ÿßŸÑŸÖÿµÿØÿ± ÿ£Ÿà ÿßŸÑŸÇŸÜÿßÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ©'\n  }\n];\n\n// Text Summarization Rule\nexport interface SummarizationRule {\n  id?: number;\n  taskId: number;\n  name: string;\n  prompt: string;\n  maxLength: number;\n  style: string;\n  keyPointsCount: number;\n  isActive: boolean;\n  priority: number;\n}\n\n// Video Processing Rule\nexport interface VideoProcessingRule {\n  id?: number;\n  taskId: number;\n  name: string;\n  extractFrames: boolean;\n  extractAudio: boolean;\n  maxDuration: number;\n  outputFormat: string;\n  generateSubtitles: boolean;\n  isActive: boolean;\n  priority: number;\n}\n\n// Audio Processing Rule\nexport interface AudioProcessingRule {\n  id?: number;\n  taskId: number;\n  name: string;\n  prompt: string;\n  maxDuration: number;\n  style: string;\n  isActive: boolean;\n  priority: number;\n}\n\nexport const summarizationStyles = [\n  { value: 'concise', label: 'ŸÖŸàÿ¨ÿ≤ ÿ¨ÿØÿßŸã', description: 'ŸÖŸÑÿÆÿµ ŸÇÿµŸäÿ± ÿ¨ÿØÿßŸã' },\n  { value: 'balanced', label: 'ŸÖÿ™Ÿàÿßÿ≤ŸÜ', description: 'ŸÖŸÑÿÆÿµ ŸÖÿ™Ÿàÿßÿ≤ŸÜ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™' },\n  { value: 'detailed', label: 'ÿ™ŸÅÿµŸäŸÑŸä', description: 'ŸÖŸÑÿÆÿµ ÿ™ŸÅÿµŸäŸÑŸä' },\n  { value: 'bullet_points', label: 'ŸÜŸÇÿßÿ∑ ŸÖŸÅÿµŸÑÿ©', description: 'ŸÜŸÇÿßÿ∑ ÿ±ÿ¶Ÿäÿ≥Ÿäÿ©' },\n];\n\nexport const videoOutputFormats = [\n  { value: 'mp4', label: 'MP4' },\n  { value: 'webm', label: 'WebM' },\n  { value: 'avi', label: 'AVI' },\n  { value: 'mov', label: 'MOV' },\n];\n","path":null,"size_bytes":10411,"size_tokens":null},"client/src/components/ai-rules/index.ts":{"content":"export * from './types';\nexport * from './EntityDialog';\nexport * from './ContextDialog';\nexport * from './TrainingDialog';\nexport * from './FilterDialog';\nexport * from './TemplateDialog';\nexport * from './SummarizationDialog';\nexport * from './VideoProcessingDialog';\n","path":null,"size_bytes":270,"size_tokens":null},"client/src/components/ai-rules/ContextDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Loader, Shield } from \"lucide-react\";\nimport { ContextRule, contextRuleTypes } from \"./types\";\n\ninterface ContextDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: Partial<ContextRule>) => void;\n  editingData?: ContextRule | null;\n  isLoading?: boolean;\n}\n\nconst defaultForm: Partial<ContextRule> = {\n  ruleType: 'neutralize_negative',\n  triggerPattern: '',\n  targetSentiment: 'neutral',\n  instructions: '',\n  examples: [],\n  isActive: true,\n  priority: 0\n};\n\nexport function ContextDialog({ open, onOpenChange, onSubmit, editingData, isLoading }: ContextDialogProps) {\n  const [form, setForm] = useState<Partial<ContextRule>>(defaultForm);\n\n  useEffect(() => {\n    if (editingData) {\n      setForm(editingData);\n    } else {\n      setForm(defaultForm);\n    }\n  }, [editingData, open]);\n\n  const handleSubmit = () => {\n    onSubmit(form);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[550px]\">\n        <DialogHeader className=\"pb-4 border-b\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-emerald-500/20 to-teal-500/20\">\n              <Shield className=\"h-5 w-5 text-emerald-600\" />\n            </div>\n            <div>\n              <DialogTitle className=\"text-lg\">{editingData ? \"ÿ™ÿπÿØŸäŸÑ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ≥ŸäÿßŸÇ\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿ≥ŸäÿßŸÇ\"}</DialogTitle>\n              <DialogDescription className=\"text-sm mt-0.5\">ÿ™ÿ≠ŸäŸäÿØ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≥ŸÑÿ®Ÿäÿ© ÿ£Ÿà ÿ™ÿπÿØŸäŸÑ ÿ£ÿ≥ŸÑŸàÿ® ÿßŸÑŸÜÿµ</DialogDescription>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className=\"space-y-5 py-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">ŸÜŸàÿπ ÿßŸÑŸÇÿßÿπÿØÿ©</Label>\n              <Select\n                value={form.ruleType}\n                onValueChange={(value) => setForm({ ...form, ruleType: value })}\n              >\n                <SelectTrigger className=\"h-10\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {contextRuleTypes.map((type) => (\n                    <SelectItem key={type.value} value={type.value}>\n                      <div className=\"py-1\">\n                        <div className=\"font-medium\">{type.label}</div>\n                        <div className=\"text-xs text-muted-foreground\">{type.description}</div>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">ÿßŸÑŸÜÿ®ÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ŸáÿØŸÅÿ©</Label>\n              <Select\n                value={form.targetSentiment}\n                onValueChange={(value) => setForm({ ...form, targetSentiment: value })}\n              >\n                <SelectTrigger className=\"h-10\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"neutral\">ÿ≠ŸäÿßÿØŸä</SelectItem>\n                  <SelectItem value=\"positive\">ÿ•Ÿäÿ¨ÿßÿ®Ÿä</SelectItem>\n                  <SelectItem value=\"formal\">ÿ±ÿ≥ŸÖŸä</SelectItem>\n                  <SelectItem value=\"professional\">ŸÖŸáŸÜŸä</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {form.ruleType === 'custom' && (\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium\">ŸÜŸÖÿ∑ ÿßŸÑÿ™ŸÅÿπŸäŸÑ (Regex)</Label>\n              <Input\n                value={form.triggerPattern}\n                onChange={(e) => setForm({ ...form, triggerPattern: e.target.value })}\n                placeholder=\"ŸÖÿ´ÿßŸÑ: ÿ•ÿ±Ÿáÿßÿ®Ÿä|ÿπŸÖŸäŸÑ|ÿÆÿßÿ¶ŸÜ\"\n                className=\"h-10 font-mono\"\n                dir=\"ltr\"\n              />\n            </div>\n          )}\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium\">ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™</Label>\n            <Textarea\n              value={form.instructions}\n              onChange={(e) => setForm({ ...form, instructions: e.target.value })}\n              placeholder=\"ÿßŸÉÿ™ÿ® ÿ™ÿπŸÑŸäŸÖÿßÿ™ Ÿàÿßÿ∂ÿ≠ÿ© ŸÑŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä...\"\n              className=\"min-h-[100px] resize-none\"\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-xl\">\n            <div className=\"flex items-center gap-6\">\n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  checked={form.isActive}\n                  onCheckedChange={(checked) => setForm({ ...form, isActive: checked })}\n                />\n                <Label className=\"text-sm cursor-pointer\">ŸÖŸÅÿπŸëŸÑ</Label>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Label className=\"text-sm text-muted-foreground\">ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©:</Label>\n              <Input\n                type=\"number\"\n                value={form.priority}\n                onChange={(e) => setForm({ ...form, priority: parseInt(e.target.value) || 0 })}\n                className=\"w-20 h-9\"\n                min={0}\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 pt-4 border-t\">\n          <Button\n            onClick={handleSubmit}\n            disabled={isLoading || !form.instructions}\n            className=\"flex-1 h-11\"\n          >\n            {isLoading && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n            {editingData ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            className=\"h-11 px-6\"\n            onClick={() => onOpenChange(false)}\n          >\n            ÿ•ŸÑÿ∫ÿßÿ°\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":6561,"size_tokens":null},"client/src/components/ai-rules/VideoProcessingDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Loader, Film, Volume2, Image, Subtitles, Zap, Clock, FileVideo, Settings2, Sparkles } from \"lucide-react\";\nimport { VideoProcessingRule, videoOutputFormats } from \"./types\";\n\ninterface VideoProcessingDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: Partial<VideoProcessingRule>) => void;\n  editingData?: VideoProcessingRule | null;\n  isLoading?: boolean;\n}\n\nconst defaultForm: Partial<VideoProcessingRule> = {\n  name: '',\n  extractFrames: false,\n  extractAudio: true,\n  maxDuration: 3600,\n  outputFormat: 'mp4',\n  generateSubtitles: false,\n  isActive: true,\n  priority: 0\n};\n\nexport function VideoProcessingDialog({ open, onOpenChange, onSubmit, editingData, isLoading }: VideoProcessingDialogProps) {\n  const [form, setForm] = useState<Partial<VideoProcessingRule>>(defaultForm);\n\n  useEffect(() => {\n    if (editingData) {\n      setForm(editingData);\n    } else {\n      setForm(defaultForm);\n    }\n  }, [editingData, open]);\n\n  const handleSubmit = () => {\n    onSubmit(form);\n  };\n\n  const formatDuration = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const mins = Math.floor((seconds % 3600) / 60);\n    if (hours > 0) return `${hours} ÿ≥ÿßÿπÿ© ${mins > 0 ? `Ÿà ${mins} ÿØŸÇŸäŸÇÿ©` : ''}`;\n    return `${mins} ÿØŸÇŸäŸÇÿ©`;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[650px] p-0 overflow-hidden bg-gradient-to-b from-background to-background/95\">\n        <div className=\"bg-gradient-to-l from-red-500/10 via-pink-500/10 to-purple-500/10 dark:from-red-500/20 dark:via-pink-500/15 dark:to-purple-500/10\">\n          <DialogHeader className=\"p-6 pb-4\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"p-3 rounded-2xl bg-gradient-to-br from-red-500 to-pink-600 shadow-lg shadow-red-500/25\">\n                <Film className=\"h-6 w-6 text-white\" />\n              </div>\n              <div>\n                <DialogTitle className=\"text-xl font-bold bg-gradient-to-l from-red-600 to-pink-600 dark:from-red-400 dark:to-pink-400 bg-clip-text text-transparent\">\n                  {editingData ? \"ÿ™ÿπÿØŸäŸÑ ŸÇÿßÿπÿØÿ© ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ŸÖÿπÿßŸÑÿ¨ÿ© ŸÅŸäÿØŸäŸà\"}\n                </DialogTitle>\n                <DialogDescription className=\"text-sm mt-1 text-muted-foreground\">\n                  ÿ£ÿπÿØ ŸÇŸàÿßÿπÿØ ŸÖÿπÿßŸÑÿ¨ÿ© ŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÅŸäÿØŸäŸà ŸàÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ®ÿµÿ±Ÿä\n                </DialogDescription>\n              </div>\n            </div>\n          </DialogHeader>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <Sparkles className=\"h-4 w-4 text-amber-500\" />\n              ÿßÿ≥ŸÖ ÿßŸÑŸÇÿßÿπÿØÿ©\n            </Label>\n            <Input\n              value={form.name}\n              onChange={(e) => setForm({ ...form, name: e.target.value })}\n              placeholder=\"ŸÖÿ´ÿßŸÑ: ŸÖÿπÿßŸÑÿ¨ÿ© ŸÅŸäÿØŸäŸàŸáÿßÿ™ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±\"\n              className=\"h-12 text-base border-2 focus:border-primary/50 transition-all rounded-xl bg-muted/30\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-semibold flex items-center gap-2\">\n                <FileVideo className=\"h-4 w-4 text-blue-500\" />\n                ÿµŸäÿ∫ÿ© ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨\n              </Label>\n              <Select\n                value={form.outputFormat}\n                onValueChange={(value) => setForm({ ...form, outputFormat: value })}\n              >\n                <SelectTrigger className=\"h-12 border-2 rounded-xl bg-muted/30 hover:bg-muted/50 transition-all\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {videoOutputFormats.map((format) => (\n                    <SelectItem key={format.value} value={format.value}>\n                      <span className=\"font-medium\">{format.label}</span>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-semibold flex items-center gap-2\">\n                <Settings2 className=\"h-4 w-4 text-purple-500\" />\n                ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©\n              </Label>\n              <Input\n                type=\"number\"\n                value={form.priority}\n                onChange={(e) => setForm({ ...form, priority: parseInt(e.target.value) || 0 })}\n                className=\"h-12 border-2 rounded-xl bg-muted/30\"\n                min={0}\n                max={100}\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-3\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <Clock className=\"h-4 w-4 text-emerald-500\" />\n              ÿ£ŸÇÿµŸâ ŸÖÿØÿ©: <span className=\"text-primary font-bold\">{formatDuration(form.maxDuration || 3600)}</span>\n            </Label>\n            <div className=\"px-2\">\n              <Slider\n                value={[form.maxDuration || 3600]}\n                onValueChange={([value]) => setForm({ ...form, maxDuration: value })}\n                min={60}\n                max={14400}\n                step={60}\n                className=\"w-full\"\n              />\n              <div className=\"flex justify-between text-xs text-muted-foreground mt-2\">\n                <span>1 ÿØŸÇŸäŸÇÿ©</span>\n                <span>4 ÿ≥ÿßÿπÿßÿ™</span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-3\">\n            <Label className=\"text-sm font-semibold\">ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©</Label>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n              <button\n                type=\"button\"\n                onClick={() => setForm({ ...form, extractFrames: !form.extractFrames })}\n                className={`flex items-center gap-3 p-4 rounded-xl border-2 transition-all duration-200 text-right ${\n                  form.extractFrames \n                    ? 'border-blue-500/50 bg-blue-500/10 dark:bg-blue-500/20' \n                    : 'border-border hover:border-primary/30 hover:bg-muted/50'\n                }`}\n              >\n                <div className={`p-2.5 rounded-xl ${form.extractFrames ? 'bg-blue-500 text-white' : 'bg-muted'}`}>\n                  <Image className=\"h-5 w-5\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"font-semibold text-sm\">ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿµŸàÿ±</div>\n                  <div className=\"text-xs text-muted-foreground\">ÿßŸÑÿ™ŸÇÿßÿ∑ ÿ•ÿ∑ÿßÿ±ÿßÿ™ ŸÖŸÜ ÿßŸÑŸÅŸäÿØŸäŸà</div>\n                </div>\n                <Switch checked={form.extractFrames} onCheckedChange={() => {}} className=\"pointer-events-none\" />\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={() => setForm({ ...form, extractAudio: !form.extractAudio })}\n                className={`flex items-center gap-3 p-4 rounded-xl border-2 transition-all duration-200 text-right ${\n                  form.extractAudio \n                    ? 'border-emerald-500/50 bg-emerald-500/10 dark:bg-emerald-500/20' \n                    : 'border-border hover:border-primary/30 hover:bg-muted/50'\n                }`}\n              >\n                <div className={`p-2.5 rounded-xl ${form.extractAudio ? 'bg-emerald-500 text-white' : 'bg-muted'}`}>\n                  <Volume2 className=\"h-5 w-5\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"font-semibold text-sm\">ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿµŸàÿ™</div>\n                  <div className=\"text-xs text-muted-foreground\">ŸÅÿµŸÑ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑÿµŸàÿ™Ÿä</div>\n                </div>\n                <Switch checked={form.extractAudio} onCheckedChange={() => {}} className=\"pointer-events-none\" />\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={() => setForm({ ...form, generateSubtitles: !form.generateSubtitles })}\n                className={`flex items-center gap-3 p-4 rounded-xl border-2 transition-all duration-200 text-right ${\n                  form.generateSubtitles \n                    ? 'border-purple-500/50 bg-purple-500/10 dark:bg-purple-500/20' \n                    : 'border-border hover:border-primary/30 hover:bg-muted/50'\n                }`}\n              >\n                <div className={`p-2.5 rounded-xl ${form.generateSubtitles ? 'bg-purple-500 text-white' : 'bg-muted'}`}>\n                  <Subtitles className=\"h-5 w-5\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"font-semibold text-sm\">ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ±ÿ¨ŸÖÿßÿ™</div>\n                  <div className=\"text-xs text-muted-foreground\">ÿ™ŸàŸÑŸäÿØ ŸÜÿµ ŸÖŸÜ ÿßŸÑŸÉŸÑÿßŸÖ</div>\n                </div>\n                <Switch checked={form.generateSubtitles} onCheckedChange={() => {}} className=\"pointer-events-none\" />\n              </button>\n\n              <button\n                type=\"button\"\n                onClick={() => setForm({ ...form, isActive: !form.isActive })}\n                className={`flex items-center gap-3 p-4 rounded-xl border-2 transition-all duration-200 text-right ${\n                  form.isActive \n                    ? 'border-amber-500/50 bg-amber-500/10 dark:bg-amber-500/20' \n                    : 'border-border hover:border-primary/30 hover:bg-muted/50'\n                }`}\n              >\n                <div className={`p-2.5 rounded-xl ${form.isActive ? 'bg-amber-500 text-white' : 'bg-muted'}`}>\n                  <Zap className=\"h-5 w-5\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"font-semibold text-sm\">ŸÖŸÅÿπŸëŸÑ</div>\n                  <div className=\"text-xs text-muted-foreground\">ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÇÿßÿπÿØÿ©</div>\n                </div>\n                <Switch checked={form.isActive} onCheckedChange={() => {}} className=\"pointer-events-none\" />\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 p-6 pt-0\">\n          <Button\n            onClick={handleSubmit}\n            disabled={isLoading || !form.name}\n            className=\"flex-1 h-12 rounded-xl bg-gradient-to-l from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white font-bold shadow-lg shadow-red-500/25\"\n          >\n            {isLoading && <Loader className=\"h-5 w-5 ml-2 animate-spin\" />}\n            {editingData ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            className=\"h-12 px-8 rounded-xl border-2\"\n            onClick={() => onOpenChange(false)}\n          >\n            ÿ•ŸÑÿ∫ÿßÿ°\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":11568,"size_tokens":null},"client/src/components/ai-rules/TemplateDialog.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Loader, FileText, Plus, Trash2, Edit, ChevronUp, ChevronDown, Zap, X } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { PublishingTemplate, TemplateCustomField, templateTypes, formattingOptions, fieldTypes, presetFields, PresetField } from \"./types\";\n\ninterface TemplateDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: Partial<PublishingTemplate>) => void;\n  editingData?: PublishingTemplate | null;\n  isLoading?: boolean;\n}\n\nconst defaultForm: Partial<PublishingTemplate> = {\n  name: '',\n  templateType: 'custom',\n  isDefault: false,\n  headerText: '',\n  headerFormatting: 'none',\n  footerText: '',\n  footerFormatting: 'none',\n  fieldSeparator: '\\n',\n  useNewlineAfterHeader: true,\n  useNewlineBeforeFooter: true,\n  maxLength: undefined,\n  extractionPrompt: '',\n  customFields: []\n};\n\nconst defaultField: Partial<TemplateCustomField> = {\n  fieldName: '',\n  fieldLabel: '',\n  extractionInstructions: '',\n  defaultValue: '',\n  useDefaultIfEmpty: true,\n  formatting: 'none',\n  displayOrder: 0,\n  showLabel: false,\n  labelSeparator: ': ',\n  prefix: '',\n  suffix: '',\n  fieldType: 'extracted',\n  isActive: true\n};\n\nexport function TemplateDialog({ open, onOpenChange, onSubmit, editingData, isLoading }: TemplateDialogProps) {\n  const [form, setForm] = useState<Partial<PublishingTemplate>>(defaultForm);\n  const [currentField, setCurrentField] = useState<Partial<TemplateCustomField>>(defaultField);\n  const [editingFieldIndex, setEditingFieldIndex] = useState<number | null>(null);\n  const [activeSection, setActiveSection] = useState<'main' | 'fields'>('main');\n  const fieldFormRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (editingData) {\n      setForm({\n        name: editingData.name,\n        templateType: editingData.templateType,\n        isDefault: editingData.isDefault,\n        headerText: editingData.headerText || '',\n        headerFormatting: editingData.headerFormatting || 'none',\n        footerText: editingData.footerText || '',\n        footerFormatting: editingData.footerFormatting || 'none',\n        fieldSeparator: editingData.fieldSeparator || '\\n',\n        useNewlineAfterHeader: editingData.useNewlineAfterHeader ?? true,\n        useNewlineBeforeFooter: editingData.useNewlineBeforeFooter ?? true,\n        maxLength: editingData.maxLength,\n        extractionPrompt: editingData.extractionPrompt || '',\n        customFields: editingData.customFields || []\n      });\n    } else {\n      setForm(defaultForm);\n    }\n    setCurrentField(defaultField);\n    setEditingFieldIndex(null);\n    setActiveSection('main');\n  }, [editingData, open]);\n\n  const handleSubmit = () => {\n    if (!form.customFields || form.customFields.length === 0) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸÇŸÑ Ÿàÿßÿ≠ÿØ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ\");\n      return;\n    }\n    onSubmit(form);\n  };\n\n  const handleAddField = () => {\n    if (!currentField.fieldName || !currentField.fieldLabel) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿßÿ≥ŸÖ ÿßŸÑÿ≠ŸÇŸÑ ŸàÿßŸÑÿπŸÜŸàÿßŸÜ\");\n      return;\n    }\n    if (currentField.fieldType === 'extracted' && !currentField.extractionInstructions) {\n      toast.error(\"Ÿäÿ±ÿ¨Ÿâ ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨\");\n      return;\n    }\n\n    const newField: TemplateCustomField = {\n      fieldName: currentField.fieldName || '',\n      fieldLabel: currentField.fieldLabel || '',\n      extractionInstructions: currentField.extractionInstructions || '',\n      defaultValue: currentField.defaultValue || '',\n      useDefaultIfEmpty: currentField.useDefaultIfEmpty ?? true,\n      formatting: currentField.formatting || 'none',\n      displayOrder: form.customFields?.length || 0,\n      showLabel: currentField.showLabel ?? false,\n      labelSeparator: currentField.labelSeparator || ': ',\n      prefix: currentField.prefix || '',\n      suffix: currentField.suffix || '',\n      fieldType: currentField.fieldType || 'extracted',\n      isActive: true\n    };\n\n    if (editingFieldIndex !== null) {\n      const updatedFields = [...(form.customFields || [])];\n      updatedFields[editingFieldIndex] = newField;\n      setForm({ ...form, customFields: updatedFields });\n      toast.success(\"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ŸÇŸÑ\");\n    } else {\n      setForm({\n        ...form,\n        customFields: [...(form.customFields || []), newField]\n      });\n      toast.success(\"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ≠ŸÇŸÑ\");\n    }\n    \n    setCurrentField(defaultField);\n    setEditingFieldIndex(null);\n  };\n\n  const handleEditField = (index: number) => {\n    const field = form.customFields?.[index];\n    if (field) {\n      setCurrentField(field);\n      setEditingFieldIndex(index);\n      toast.info(`ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ŸÇŸÑ: ${field.fieldLabel}`);\n      setTimeout(() => {\n        fieldFormRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });\n      }, 100);\n    }\n  };\n\n  const handleCancelEdit = () => {\n    setCurrentField(defaultField);\n    setEditingFieldIndex(null);\n  };\n\n  const handleRemoveField = (index: number) => {\n    const newFields = [...(form.customFields || [])];\n    newFields.splice(index, 1);\n    newFields.forEach((f, i) => f.displayOrder = i);\n    setForm({ ...form, customFields: newFields });\n    toast.success(\"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≠ŸÇŸÑ\");\n  };\n\n  const handleMoveField = (index: number, direction: 'up' | 'down') => {\n    const fields = [...(form.customFields || [])];\n    const newIndex = direction === 'up' ? index - 1 : index + 1;\n    if (newIndex < 0 || newIndex >= fields.length) return;\n    [fields[index], fields[newIndex]] = [fields[newIndex], fields[index]];\n    fields.forEach((f, i) => f.displayOrder = i);\n    setForm({ ...form, customFields: fields });\n  };\n\n  const handleAddPresetField = (preset: PresetField) => {\n    const existingField = form.customFields?.find(f => f.fieldName === preset.fieldName);\n    if (existingField) {\n      toast.error(`ÿßŸÑÿ≠ŸÇŸÑ \"${preset.fieldLabel}\" ŸÖŸàÿ¨ŸàÿØ ÿ®ÿßŸÑŸÅÿπŸÑ`);\n      return;\n    }\n\n    const newField: TemplateCustomField = {\n      fieldName: preset.fieldName,\n      fieldLabel: preset.fieldLabel,\n      extractionInstructions: preset.extractionInstructions,\n      defaultValue: '',\n      useDefaultIfEmpty: true,\n      formatting: 'none',\n      displayOrder: form.customFields?.length || 0,\n      showLabel: true,\n      labelSeparator: ': ',\n      prefix: '',\n      suffix: '',\n      fieldType: preset.fieldType,\n      isActive: true\n    };\n\n    setForm({\n      ...form,\n      customFields: [...(form.customFields || []), newField]\n    });\n    toast.success(`ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸÇŸÑ \"${preset.fieldLabel}\"`);\n  };\n\n  const isPresetFieldAdded = (presetId: string) => {\n    const preset = presetFields.find(p => p.id === presetId);\n    if (!preset) return false;\n    return form.customFields?.some(f => f.fieldName === preset.fieldName) || false;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[700px] max-h-[90vh] overflow-hidden flex flex-col\">\n        <DialogHeader className=\"pb-4 border-b flex-shrink-0\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-pink-500/20 to-rose-500/20\">\n              <FileText className=\"h-5 w-5 text-pink-600\" />\n            </div>\n            <div>\n              <DialogTitle className=\"text-lg\">{editingData ? \"ÿ™ÿπÿØŸäŸÑ ŸÇÿßŸÑÿ® ÿßŸÑŸÜÿ¥ÿ±\" : \"ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßŸÑÿ® ŸÜÿ¥ÿ±\"}</DialogTitle>\n              <DialogDescription className=\"text-sm mt-0.5\">ÿ£ŸÜÿ¥ÿ¶ ŸÇÿßŸÑÿ® ŸÜÿ¥ÿ± ŸÖÿπ ÿ≠ŸÇŸàŸÑ ŸÖÿÆÿµÿµÿ©</DialogDescription>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className=\"flex gap-2 py-3 border-b flex-shrink-0\">\n          <Button\n            variant={activeSection === 'main' ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setActiveSection('main')}\n          >\n            ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©\n          </Button>\n          <Button\n            variant={activeSection === 'fields' ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setActiveSection('fields')}\n          >\n            ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿÆÿµÿµÿ©\n            {form.customFields && form.customFields.length > 0 && (\n              <Badge variant=\"secondary\" className=\"mr-2\">{form.customFields.length}</Badge>\n            )}\n          </Button>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto py-4\">\n          {activeSection === 'main' && (\n            <div className=\"space-y-5\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">ÿßÿ≥ŸÖ ÿßŸÑŸÇÿßŸÑÿ® *</Label>\n                  <Input\n                    value={form.name}\n                    onChange={(e) => setForm({ ...form, name: e.target.value })}\n                    placeholder=\"ŸÖÿ´ÿßŸÑ: ŸÇÿßŸÑÿ® ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ÿßŸÑÿπÿßÿ¨ŸÑÿ©\"\n                    className=\"h-10\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">ŸÜŸàÿπ ÿßŸÑŸÇÿßŸÑÿ®</Label>\n                  <Select\n                    value={form.templateType}\n                    onValueChange={(value) => setForm({ ...form, templateType: value })}\n                  >\n                    <SelectTrigger className=\"h-10\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {templateTypes.map((type) => (\n                        <SelectItem key={type.value} value={type.value}>\n                          {type.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"p-4 border rounded-xl bg-muted/30 space-y-4\">\n                <h4 className=\"text-sm font-medium\">ÿ±ÿ£ÿ≥ ÿßŸÑŸÇÿßŸÑÿ® (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</h4>\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div className=\"col-span-2 space-y-2\">\n                    <Label className=\"text-xs text-muted-foreground\">ŸÜÿµ ÿßŸÑÿ±ÿ£ÿ≥</Label>\n                    <Input\n                      value={form.headerText || ''}\n                      onChange={(e) => setForm({ ...form, headerText: e.target.value })}\n                      placeholder=\"ŸÖÿ´ÿßŸÑ: ÿπÿßÿ¨ŸÑ | ÿ£ÿÆÿ®ÿßÿ± ÿßŸÑŸäŸàŸÖ\"\n                      className=\"h-9\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs text-muted-foreground\">ÿ™ŸÜÿ≥ŸäŸÇ</Label>\n                    <Select\n                      value={form.headerFormatting || 'none'}\n                      onValueChange={(value) => setForm({ ...form, headerFormatting: value })}\n                    >\n                      <SelectTrigger className=\"h-9\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {formattingOptions.map((fmt) => (\n                          <SelectItem key={fmt.value} value={fmt.value}>\n                            {fmt.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"p-4 border rounded-xl bg-muted/30 space-y-4\">\n                <h4 className=\"text-sm font-medium\">ÿ™ÿ∞ŸäŸäŸÑ ÿßŸÑŸÇÿßŸÑÿ® (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</h4>\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div className=\"col-span-2 space-y-2\">\n                    <Label className=\"text-xs text-muted-foreground\">ŸÜÿµ ÿßŸÑÿ™ÿ∞ŸäŸäŸÑ</Label>\n                    <Input\n                      value={form.footerText || ''}\n                      onChange={(e) => setForm({ ...form, footerText: e.target.value })}\n                      placeholder=\"ŸÖÿ´ÿßŸÑ: ÿßŸÑŸÖÿµÿØÿ±: ŸÇŸÜÿßÿ™ŸÜÿß ÿßŸÑÿ•ÿÆÿ®ÿßÿ±Ÿäÿ©\"\n                      className=\"h-9\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs text-muted-foreground\">ÿ™ŸÜÿ≥ŸäŸÇ</Label>\n                    <Select\n                      value={form.footerFormatting || 'none'}\n                      onValueChange={(value) => setForm({ ...form, footerFormatting: value })}\n                    >\n                      <SelectTrigger className=\"h-9\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {formattingOptions.map((fmt) => (\n                          <SelectItem key={fmt.value} value={fmt.value}>\n                            {fmt.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">ÿßŸÑŸÅÿßÿµŸÑ ÿ®ŸäŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ</Label>\n                  <Select\n                    value={form.fieldSeparator || '\\n'}\n                    onValueChange={(value) => setForm({ ...form, fieldSeparator: value })}\n                  >\n                    <SelectTrigger className=\"h-10\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value={'\\n'}>ÿ≥ÿ∑ÿ± ÿ¨ÿØŸäÿØ</SelectItem>\n                      <SelectItem value={'\\n\\n'}>ÿ≥ÿ∑ÿ± ŸÅÿßÿ±ÿ∫</SelectItem>\n                      <SelectItem value={'\\n\\n\\n'}>ÿ≥ÿ∑ÿ±ŸäŸÜ ŸÅÿßÿ±ÿ∫ŸäŸÜ</SelectItem>\n                      <SelectItem value={' | '}>ÿ¥ÿ±Ÿäÿ∑ |</SelectItem>\n                      <SelectItem value={' - '}>ÿ¥ÿ±ÿ∑ÿ© -</SelectItem>\n                      <SelectItem value={' '}>ŸÖÿ≥ÿßŸÅÿ©</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑŸÑÿ∑ŸàŸÑ</Label>\n                  <Input\n                    type=\"number\"\n                    value={form.maxLength || ''}\n                    onChange={(e) => setForm({ ...form, maxLength: e.target.value ? parseInt(e.target.value) : undefined })}\n                    placeholder=\"ÿ®ÿØŸàŸÜ ÿ≠ÿØ\"\n                    className=\"h-10\"\n                    min={0}\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2 p-4 bg-muted/50 rounded-xl\">\n                <Switch\n                  checked={form.isDefault ?? false}\n                  onCheckedChange={(checked) => setForm({ ...form, isDefault: checked })}\n                />\n                <Label className=\"text-sm cursor-pointer\">ÿ™ÿπŸäŸäŸÜ ŸÉŸÇÿßŸÑÿ® ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä</Label>\n              </div>\n            </div>\n          )}\n\n          {activeSection === 'fields' && (\n            <div className=\"space-y-5\">\n              {/* ŸÑŸàÿ≠ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ´ÿßÿ®ÿ™ÿ© ÿßŸÑÿ¨ÿßŸáÿ≤ÿ© */}\n              <div className=\"p-4 border rounded-xl bg-gradient-to-br from-blue-50/50 to-indigo-50/50 dark:from-blue-950/20 dark:to-indigo-950/20 space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Plus className=\"h-4 w-4 text-blue-600\" />\n                  <h4 className=\"text-sm font-medium\">ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸÇŸÑ ÿ´ÿßÿ®ÿ™ ÿ¨ÿßŸáÿ≤</h4>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">ÿßÿÆÿ™ÿ± ŸÖŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ¨ÿßŸáÿ≤ÿ© ŸÑÿ•ÿ∂ÿßŸÅÿ™Ÿáÿß ÿ®ÿ≥ÿ±ÿπÿ©</p>\n                <div className=\"grid grid-cols-4 gap-2\">\n                  {presetFields.map((preset) => {\n                    const isAdded = isPresetFieldAdded(preset.id);\n                    return (\n                      <Button\n                        key={preset.id}\n                        variant={isAdded ? \"secondary\" : \"outline\"}\n                        size=\"sm\"\n                        className={`h-auto py-2 px-3 flex flex-col items-center gap-1 ${isAdded ? 'opacity-60' : 'hover:bg-blue-50 dark:hover:bg-blue-950/30'}`}\n                        onClick={() => handleAddPresetField(preset)}\n                        disabled={isAdded}\n                      >\n                        <span className=\"text-lg\">{preset.icon}</span>\n                        <span className=\"text-xs font-medium\">{preset.fieldLabel}</span>\n                        {isAdded && <Badge variant=\"secondary\" className=\"text-[10px] px-1\">ŸÖÿ∂ÿßŸÅ</Badge>}\n                      </Button>\n                    );\n                  })}\n                </div>\n              </div>\n\n              {/* ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸÇŸÑ ŸÖÿÆÿµÿµ */}\n              <div \n                ref={fieldFormRef}\n                className={`p-4 border-2 rounded-xl space-y-4 transition-all duration-300 ${\n                  editingFieldIndex !== null \n                    ? 'bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/30 dark:to-emerald-950/30 border-green-400 dark:border-green-600 ring-2 ring-green-200 dark:ring-green-800' \n                    : 'bg-gradient-to-br from-yellow-50/50 to-amber-50/50 dark:from-yellow-950/20 dark:to-amber-950/20 border-transparent'\n                }`}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    {editingFieldIndex !== null ? (\n                      <Edit className=\"h-4 w-4 text-green-600\" />\n                    ) : (\n                      <Zap className=\"h-4 w-4 text-yellow-600\" />\n                    )}\n                    <h4 className={`text-sm font-medium ${editingFieldIndex !== null ? 'text-green-700 dark:text-green-400' : ''}`}>\n                      {editingFieldIndex !== null ? `ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ŸÇŸÑ: ${currentField.fieldLabel}` : 'ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸÇŸÑ ŸÖÿÆÿµÿµ'}\n                    </h4>\n                  </div>\n                  {editingFieldIndex !== null && (\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"h-7 px-2 text-muted-foreground hover:text-destructive\"\n                      onClick={handleCancelEdit}\n                    >\n                      <X className=\"h-4 w-4 mr-1\" />\n                      ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿπÿØŸäŸÑ\n                    </Button>\n                  )}\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs\">ÿßÿ≥ŸÖ ÿßŸÑÿ≠ŸÇŸÑ (ŸÑŸÑŸÜÿ∏ÿßŸÖ) *</Label>\n                    <Input\n                      value={currentField.fieldName || ''}\n                      onChange={(e) => setCurrentField({ ...currentField, fieldName: e.target.value.replace(/\\s/g, '_') })}\n                      placeholder=\"ŸÖÿ´ÿßŸÑ: news_type\"\n                      className=\"h-9 font-mono\"\n                      dir=\"ltr\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs\">ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ≠ŸÇŸÑ (ŸÑŸÑÿπÿ±ÿ∂) *</Label>\n                    <Input\n                      value={currentField.fieldLabel || ''}\n                      onChange={(e) => setCurrentField({ ...currentField, fieldLabel: e.target.value })}\n                      placeholder=\"ŸÖÿ´ÿßŸÑ: ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±\"\n                      className=\"h-9\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs\">ŸÜŸàÿπ ÿßŸÑÿ≠ŸÇŸÑ</Label>\n                    <Select\n                      value={currentField.fieldType || 'extracted'}\n                      onValueChange={(value) => setCurrentField({ ...currentField, fieldType: value })}\n                    >\n                      <SelectTrigger className=\"h-9\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {fieldTypes.map((ft) => (\n                          <SelectItem key={ft.value} value={ft.value}>\n                            <div className=\"py-0.5\">\n                              <div className=\"font-medium text-sm\">{ft.label}</div>\n                              <div className=\"text-xs text-muted-foreground\">{ft.description}</div>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs\">ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ</Label>\n                    <Select\n                      value={currentField.formatting || 'none'}\n                      onValueChange={(value) => setCurrentField({ ...currentField, formatting: value })}\n                    >\n                      <SelectTrigger className=\"h-9\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {formattingOptions.map((fmt) => (\n                          <SelectItem key={fmt.value} value={fmt.value}>\n                            <div className=\"flex items-center gap-2\">\n                              <span>{fmt.label}</span>\n                              <code className=\"text-xs bg-muted px-1 rounded\">{fmt.example}</code>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                {currentField.fieldType === 'extracted' && (\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs\">ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä *</Label>\n                    <Textarea\n                      value={currentField.extractionInstructions || ''}\n                      onChange={(e) => setCurrentField({ ...currentField, extractionInstructions: e.target.value })}\n                      placeholder=\"ŸÖÿ´ÿßŸÑ: ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ± ŸÖŸÜ ÿßŸÑŸÜÿµ (ÿ≥Ÿäÿßÿ≥Ÿäÿå ÿßŸÇÿ™ÿµÿßÿØŸäÿå ÿ±Ÿäÿßÿ∂Ÿä)\"\n                      className=\"min-h-[60px] resize-none\"\n                    />\n                  </div>\n                )}\n\n                <div className=\"grid grid-cols-3 gap-3\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs\">ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©</Label>\n                    <Input\n                      value={currentField.defaultValue || ''}\n                      onChange={(e) => setCurrentField({ ...currentField, defaultValue: e.target.value })}\n                      placeholder=\"ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨\"\n                      className=\"h-9\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs\">ÿ®ÿßÿØÿ¶ÿ©</Label>\n                    <Input\n                      value={currentField.prefix || ''}\n                      onChange={(e) => setCurrentField({ ...currentField, prefix: e.target.value })}\n                      placeholder=\"ŸÇÿ®ŸÑ ÿßŸÑŸÇŸäŸÖÿ©\"\n                      className=\"h-9\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-xs\">ŸÑÿßÿ≠ŸÇÿ©</Label>\n                    <Input\n                      value={currentField.suffix || ''}\n                      onChange={(e) => setCurrentField({ ...currentField, suffix: e.target.value })}\n                      placeholder=\"ÿ®ÿπÿØ ÿßŸÑŸÇŸäŸÖÿ©\"\n                      className=\"h-9\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"flex items-center gap-6\">\n                  <div className=\"flex items-center gap-2\">\n                    <Switch\n                      checked={currentField.showLabel ?? false}\n                      onCheckedChange={(checked) => setCurrentField({ ...currentField, showLabel: checked })}\n                    />\n                    <Label className=\"text-xs cursor-pointer\">ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿπŸÜŸàÿßŸÜ</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Switch\n                      checked={currentField.useDefaultIfEmpty ?? true}\n                      onCheckedChange={(checked) => setCurrentField({ ...currentField, useDefaultIfEmpty: checked })}\n                    />\n                    <Label className=\"text-xs cursor-pointer\">ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä</Label>\n                  </div>\n                </div>\n\n                <div className=\"flex gap-2\">\n                  <Button\n                    type=\"button\"\n                    onClick={handleAddField}\n                    className={`flex-1 h-9 ${editingFieldIndex !== null ? 'bg-green-600 hover:bg-green-700' : ''}`}\n                    size=\"sm\"\n                  >\n                    {editingFieldIndex !== null ? (\n                      <Edit className=\"h-4 w-4 mr-2\" />\n                    ) : (\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                    )}\n                    {editingFieldIndex !== null ? 'ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™' : 'ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ≠ŸÇŸÑ'}\n                  </Button>\n                  {editingFieldIndex !== null && (\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"h-9\"\n                      onClick={handleCancelEdit}\n                    >\n                      ÿ•ŸÑÿ∫ÿßÿ°\n                    </Button>\n                  )}\n                </div>\n              </div>\n\n              {form.customFields && form.customFields.length > 0 && (\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∂ÿßŸÅÿ© ({form.customFields.length})</Label>\n                  <p className=\"text-xs text-muted-foreground\">ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÇŸÑŸÖ ŸÑÿ™ÿπÿØŸäŸÑ ÿ£Ÿà ÿ≥ŸÑÿ© ÿßŸÑŸÖŸáŸÖŸÑÿßÿ™ ŸÑŸÑÿ≠ÿ∞ŸÅ</p>\n                  <div className=\"space-y-2\">\n                    {form.customFields.map((field, index) => {\n                      const isBeingEdited = editingFieldIndex === index;\n                      return (\n                        <div \n                          key={index} \n                          className={`flex items-center gap-3 p-3 rounded-xl border-2 transition-all duration-200 ${\n                            isBeingEdited \n                              ? 'bg-green-50 dark:bg-green-950/30 border-green-400 dark:border-green-600' \n                              : 'bg-muted/50 border-transparent hover:border-muted-foreground/20'\n                          }`}\n                        >\n                          <div className=\"flex flex-col gap-1\">\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              className=\"h-6 w-6\"\n                              onClick={() => handleMoveField(index, 'up')}\n                              disabled={index === 0}\n                            >\n                              <ChevronUp className=\"h-3 w-3\" />\n                            </Button>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              className=\"h-6 w-6\"\n                              onClick={() => handleMoveField(index, 'down')}\n                              disabled={index === form.customFields!.length - 1}\n                            >\n                              <ChevronDown className=\"h-3 w-3\" />\n                            </Button>\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2 flex-wrap\">\n                              <span className={`font-medium ${isBeingEdited ? 'text-green-700 dark:text-green-400' : ''}`}>\n                                {field.fieldLabel}\n                              </span>\n                              <Badge variant=\"outline\" className=\"text-xs\">{field.fieldName}</Badge>\n                              <Badge variant=\"secondary\" className=\"text-xs\">\n                                {fieldTypes.find(ft => ft.value === field.fieldType)?.label}\n                              </Badge>\n                              {isBeingEdited && (\n                                <Badge className=\"text-xs bg-green-600\">ŸÇŸäÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ</Badge>\n                              )}\n                            </div>\n                          </div>\n                          <div className=\"flex gap-1 flex-shrink-0\">\n                            <Button\n                              size=\"icon\"\n                              variant={isBeingEdited ? \"default\" : \"ghost\"}\n                              className={`h-8 w-8 ${isBeingEdited ? 'bg-green-600 hover:bg-green-700' : 'hover:bg-blue-100 dark:hover:bg-blue-900/30'}`}\n                              onClick={() => handleEditField(index)}\n                              title=\"ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ŸÇŸÑ\"\n                            >\n                              <Edit className={`h-4 w-4 ${isBeingEdited ? 'text-white' : 'text-blue-600'}`} />\n                            </Button>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              className=\"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900/30\"\n                              onClick={() => handleRemoveField(index)}\n                              title=\"ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≠ŸÇŸÑ\"\n                            >\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex gap-3 pt-4 border-t flex-shrink-0\">\n          <Button\n            onClick={handleSubmit}\n            disabled={isLoading || !form.name}\n            className=\"flex-1 h-11\"\n          >\n            {isLoading && <Loader className=\"h-4 w-4 mr-2 animate-spin\" />}\n            {editingData ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÇÿßŸÑÿ®\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            className=\"h-11 px-6\"\n            onClick={() => onOpenChange(false)}\n          >\n            ÿ•ŸÑÿ∫ÿßÿ°\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":31726,"size_tokens":null},"client/src/components/ai-rules/ProviderModelSelector.tsx":{"content":"import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Cpu, Sparkles } from \"lucide-react\";\n\ninterface Provider {\n  id: number;\n  name: string;\n  isActive: boolean;\n}\n\ninterface Model {\n  id: number;\n  providerId?: number;\n  modelName?: string;\n  displayName: string;\n}\n\ninterface ProviderModelSelectorProps {\n  providers: Provider[];\n  models: Model[];\n  selectedProviderId: number | null;\n  selectedModelId: number | null;\n  onProviderChange: (providerId: number | null) => void;\n  onModelChange: (modelId: number | null) => void;\n  providerLabel?: string;\n  modelLabel?: string;\n}\n\nexport function ProviderModelSelector({\n  providers,\n  models,\n  selectedProviderId,\n  selectedModelId,\n  onProviderChange,\n  onModelChange,\n  providerLabel = \"ŸÖÿ≤ŸàÿØ ÿßŸÑÿÆÿØŸÖÿ©\",\n  modelLabel = \"ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨\"\n}: ProviderModelSelectorProps) {\n  const getProviderDisplayName = (name: string) => {\n    switch (name) {\n      case \"groq\": return \"Groq (ÿ≥ÿ±Ÿäÿπ)\";\n      case \"huggingface\": return \"HuggingFace\";\n      case \"openai\": return \"OpenAI\";\n      case \"claude\": return \"Claude\";\n      default: return name;\n    }\n  };\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n      <div className=\"space-y-2\">\n        <Label className=\"text-sm font-semibold flex items-center gap-2\">\n          <Cpu className=\"h-4 w-4 text-muted-foreground\" />\n          {providerLabel}\n        </Label>\n        <Select\n          value={selectedProviderId?.toString() || \"\"}\n          onValueChange={(value) => {\n            onProviderChange(value ? parseInt(value) : null);\n            onModelChange(null);\n          }}\n        >\n          <SelectTrigger className=\"h-11 border rounded-lg bg-background hover:bg-muted/50 transition-colors\">\n            <SelectValue placeholder=\"ÿßÿÆÿ™ÿ± ŸÖÿ≤ŸàÿØ ÿßŸÑÿÆÿØŸÖÿ©\" />\n          </SelectTrigger>\n          <SelectContent>\n            {providers.filter((p) => p.isActive).map((provider) => (\n              <SelectItem \n                key={provider.id} \n                value={provider.id.toString()}\n              >\n                {getProviderDisplayName(provider.name)}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label className=\"text-sm font-semibold flex items-center gap-2\">\n          <Sparkles className=\"h-4 w-4 text-muted-foreground\" />\n          {modelLabel}\n        </Label>\n        <Select\n          value={selectedModelId?.toString() || \"\"}\n          onValueChange={(value) => onModelChange(value ? parseInt(value) : null)}\n          disabled={!selectedProviderId}\n        >\n          <SelectTrigger className=\"h-11 border rounded-lg bg-background hover:bg-muted/50 transition-colors\">\n            <SelectValue placeholder={selectedProviderId ? \"ÿßÿÆÿ™ÿ± ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨\" : \"ÿßÿÆÿ™ÿ± ŸÖÿ≤ŸàÿØ ÿßŸÑÿÆÿØŸÖÿ© ÿ£ŸàŸÑÿßŸã\"} />\n          </SelectTrigger>\n          <SelectContent>\n            {models.filter((model) => !selectedProviderId || model.providerId === selectedProviderId).map((model) => (\n              <SelectItem key={model.id} value={model.id.toString()}>\n                {model.displayName}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3379,"size_tokens":null},"client/src/components/ai-rules/LinkProcessingSettings.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Video, Link2, Download, Sparkles, MonitorPlay, Smartphone, Monitor, Tv } from \"lucide-react\";\n\ninterface LinkProcessingSettingsProps {\n  linkVideoDownloadEnabled: boolean;\n  linkVideoQuality: string;\n  onVideoDownloadChange: (enabled: boolean) => void;\n  onQualityChange: (quality: string) => void;\n}\n\nconst qualityOptions = [\n  { \n    value: 'low', \n    label: 'ŸÖŸÜÿÆŸÅÿ∂ÿ©', \n    resolution: '480p', \n    size: '~15MB',\n    icon: Smartphone,\n    color: 'from-slate-500 to-gray-600',\n    borderColor: 'border-slate-500/40',\n    bgColor: 'bg-slate-500/10 dark:bg-slate-500/20'\n  },\n  { \n    value: 'medium', \n    label: 'ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©', \n    resolution: '720p', \n    size: '~30MB',\n    icon: Monitor,\n    color: 'from-blue-500 to-cyan-600',\n    borderColor: 'border-blue-500/40',\n    bgColor: 'bg-blue-500/10 dark:bg-blue-500/20'\n  },\n  { \n    value: 'high', \n    label: 'ÿπÿßŸÑŸäÿ©', \n    resolution: '1080p', \n    size: '~50MB',\n    icon: MonitorPlay,\n    color: 'from-purple-500 to-pink-600',\n    borderColor: 'border-purple-500/40',\n    bgColor: 'bg-purple-500/10 dark:bg-purple-500/20'\n  },\n  { \n    value: 'best', \n    label: 'ÿ£ŸÅÿ∂ŸÑ ŸÖÿ™ÿßÿ≠', \n    resolution: '4K+', \n    size: '~100MB',\n    icon: Tv,\n    color: 'from-emerald-500 to-teal-600',\n    borderColor: 'border-emerald-500/40',\n    bgColor: 'bg-emerald-500/10 dark:bg-emerald-500/20'\n  },\n];\n\nexport function LinkProcessingSettings({\n  linkVideoDownloadEnabled,\n  linkVideoQuality,\n  onVideoDownloadChange,\n  onQualityChange\n}: LinkProcessingSettingsProps) {\n  return (\n    <div className=\"space-y-5\">\n      <div className=\"p-4 rounded-xl bg-gradient-to-l from-blue-500/5 via-cyan-500/5 to-teal-500/5 dark:from-blue-500/10 dark:via-cyan-500/10 dark:to-teal-500/10 border border-blue-500/20\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"p-2 rounded-lg bg-blue-500/20 mt-0.5\">\n            <Link2 className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n          </div>\n          <p className=\"text-sm text-muted-foreground leading-relaxed\">\n            ÿπŸÜÿØ ÿ™ŸÅÿπŸäŸÑ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ÿå ÿ≥Ÿäÿ™ŸÖ ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖŸÜ ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑŸÖÿ±ÿ≥ŸÑÿ© \n            <span className=\"text-foreground font-medium mx-1\">(YouTube, Twitter, Instagram, TikTok...)</span> \n            ŸàŸÖÿπÿßŸÑÿ¨ÿ™Ÿá ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã. ÿ™ÿπŸÖŸÑ Ÿáÿ∞Ÿá ÿßŸÑŸÖŸäÿ≤ÿ© ŸÅŸÇÿ∑ ÿπŸÜÿØŸÖÿß ÿ™ÿ≠ÿ™ŸàŸä ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿπŸÑŸâ ÿ±ÿßÿ®ÿ∑ ŸÅŸÇÿ∑ ÿ®ÿØŸàŸÜ ŸÜÿµ ÿ•ÿ∂ÿßŸÅŸä.\n          </p>\n        </div>\n      </div>\n\n      <div className={`p-4 rounded-xl border-2 transition-all duration-300 ${\n        linkVideoDownloadEnabled \n          ? 'border-emerald-500/50 bg-gradient-to-l from-emerald-500/10 to-teal-500/5 dark:from-emerald-500/20 dark:to-teal-500/10' \n          : 'border-border bg-muted/30'\n      }`}>\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className={`p-2.5 rounded-xl transition-colors ${\n              linkVideoDownloadEnabled ? 'bg-emerald-500 text-white' : 'bg-muted'\n            }`}>\n              <Download className=\"h-5 w-5\" />\n            </div>\n            <div>\n              <Label className={`font-semibold ${linkVideoDownloadEnabled ? 'text-emerald-600 dark:text-emerald-400' : ''}`}>\n                ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑÿ£ÿµŸÑŸä\n              </Label>\n              <p className=\"text-xs text-muted-foreground mt-0.5\">ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖŸÜ ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑŸÖÿØÿπŸàŸÖÿ©</p>\n            </div>\n          </div>\n          <Switch\n            checked={linkVideoDownloadEnabled}\n            onCheckedChange={onVideoDownloadChange}\n          />\n        </div>\n      </div>\n\n      {linkVideoDownloadEnabled && (\n        <div className=\"space-y-4 animate-in fade-in slide-in-from-top-2 duration-300\">\n          <Label className=\"flex items-center gap-2 text-sm font-semibold\">\n            <Video className=\"h-4 w-4 text-purple-500\" />\n            ÿØŸÇÿ© ÿßŸÑŸÅŸäÿØŸäŸà\n          </Label>\n          <div className=\"grid grid-cols-2 gap-3\">\n            {qualityOptions.map((quality) => {\n              const isSelected = linkVideoQuality === quality.value;\n              const IconComponent = quality.icon;\n              return (\n                <button\n                  key={quality.value}\n                  type=\"button\"\n                  onClick={() => onQualityChange(quality.value)}\n                  className={`group relative p-4 rounded-xl border-2 transition-all duration-200 text-right overflow-hidden ${\n                    isSelected \n                      ? `${quality.borderColor} ${quality.bgColor} ring-2 ring-offset-2 ring-offset-background ring-primary/30`\n                      : 'border-border hover:border-primary/30 hover:bg-muted/50'\n                  }`}\n                >\n                  {isSelected && (\n                    <div className={`absolute top-0 left-0 right-0 h-1 bg-gradient-to-l ${quality.color}`} />\n                  )}\n                  <div className=\"flex items-start justify-between mb-2\">\n                    <div className={`p-2 rounded-lg transition-colors ${\n                      isSelected ? `bg-gradient-to-br ${quality.color} text-white` : 'bg-muted'\n                    }`}>\n                      <IconComponent className=\"h-4 w-4\" />\n                    </div>\n                    <span className={`text-xs font-bold px-2 py-0.5 rounded-full ${\n                      isSelected \n                        ? `bg-gradient-to-l ${quality.color} text-white` \n                        : 'bg-muted text-muted-foreground'\n                    }`}>\n                      {quality.resolution}\n                    </span>\n                  </div>\n                  <div className=\"font-bold text-sm\">{quality.label}</div>\n                  <div className=\"text-xs text-muted-foreground mt-1 flex items-center gap-1\">\n                    <Sparkles className=\"h-3 w-3\" />\n                    {quality.size}\n                  </div>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":6204,"size_tokens":null},"client/src/components/ai-rules/RuleSection.tsx":{"content":"import { useState, ReactNode } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ToggleSwitch } from \"@/components/ui/toggle-switch\";\nimport { ChevronDown, ChevronUp, Plus } from \"lucide-react\";\n\ninterface RuleSectionProps {\n  title: string;\n  description: string;\n  icon: ReactNode;\n  color: string;\n  bgColor: string;\n  isEnabled: boolean;\n  onToggleEnabled: (enabled: boolean) => void;\n  count?: number;\n  onAdd?: () => void;\n  addLabel?: string;\n  children: ReactNode;\n  settingsPanel?: ReactNode;\n}\n\nexport function RuleSection({\n  title,\n  description,\n  icon,\n  color,\n  bgColor,\n  isEnabled,\n  onToggleEnabled,\n  count = 0,\n  onAdd,\n  addLabel = \"ÿ•ÿ∂ÿßŸÅÿ©\",\n  children,\n  settingsPanel\n}: RuleSectionProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  return (\n    <Card className={`overflow-hidden border-2 transition-all duration-300 ${isEnabled ? 'shadow-lg' : ''}`}>\n      <div \n        className={`relative flex items-center justify-between p-5 cursor-pointer transition-all duration-300 ${\n          isEnabled ? `bg-gradient-to-l ${bgColor}` : 'bg-muted/20 hover:bg-muted/30'\n        }`}\n        onClick={() => setIsExpanded(!isExpanded)}\n      >\n        {isEnabled && (\n          <div className=\"absolute top-0 right-0 left-0 h-1 bg-gradient-to-l from-slate-500 to-slate-600 dark:from-slate-400 dark:to-slate-500\" />\n        )}\n        <div className=\"flex items-center gap-4\">\n          <div className={`p-3 rounded-xl transition-all shadow-md ${isEnabled ? 'bg-white/70 dark:bg-black/30' : 'bg-muted'}`}>\n            {icon}\n          </div>\n          <div>\n            <div className=\"flex items-center gap-3\">\n              <h3 className={`font-bold text-base ${isEnabled ? color : 'text-muted-foreground'}`}>{title}</h3>\n              {count > 0 && (\n                <Badge className={`text-xs font-bold ${isEnabled ? 'bg-white/50 dark:bg-black/30 text-foreground' : ''}`}>\n                  {count} ŸÇÿßÿπÿØÿ©\n                </Badge>\n              )}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">{description}</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <div className={`px-3 py-1.5 rounded-full text-xs font-bold transition-all ${\n            isEnabled \n              ? 'bg-white/50 dark:bg-black/30 text-foreground' \n              : 'bg-muted text-muted-foreground'\n          }`}>\n            {isEnabled ? 'ŸÖŸÅÿπŸëŸÑ' : 'ŸÖÿπÿ∑ŸëŸÑ'}\n          </div>\n          <div onClick={(e) => e.stopPropagation()}>\n            <ToggleSwitch\n              checked={isEnabled}\n              onCheckedChange={(checked) => {\n                onToggleEnabled(checked);\n                if (checked) setIsExpanded(true);\n              }}\n              size=\"sm\"\n            />\n          </div>\n          <div className={`p-2 rounded-lg transition-all ${isEnabled ? 'bg-white/50 dark:bg-black/20' : 'bg-muted'}`}>\n            {isExpanded ? (\n              <ChevronUp className={`h-5 w-5 transition-colors ${isEnabled ? color : 'text-muted-foreground'}`} />\n            ) : (\n              <ChevronDown className={`h-5 w-5 transition-colors ${isEnabled ? color : 'text-muted-foreground'}`} />\n            )}\n          </div>\n        </div>\n      </div>\n\n      <AnimatePresence>\n        {isExpanded && isEnabled && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: \"easeInOut\" }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"p-5 border-t-2 space-y-5 bg-gradient-to-b from-muted/20 to-transparent\">\n              {settingsPanel && (\n                <div className=\"p-5 rounded-xl bg-gradient-to-br from-muted/40 to-muted/20 border-2 border-dashed space-y-4\">\n                  {settingsPanel}\n                </div>\n              )}\n              \n              <div className=\"flex items-center justify-between\">\n                <h4 className=\"font-bold text-sm flex items-center gap-2\">\n                  <div className=\"h-2 w-2 rounded-full bg-primary animate-pulse\" />\n                  ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑŸÖÿÆÿµÿµÿ©\n                </h4>\n                {onAdd && (\n                  <Button size=\"sm\" onClick={onAdd} className=\"h-9 gap-2 rounded-xl bg-cyan-600 hover:bg-cyan-700 dark:bg-cyan-500 dark:hover:bg-cyan-600 text-white font-semibold shadow-md\">\n                    <Plus className=\"h-4 w-4\" />\n                    {addLabel}\n                  </Button>\n                )}\n              </div>\n              \n              <div className=\"space-y-3 max-h-[350px] overflow-y-auto pr-2\">\n                {children}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </Card>\n  );\n}\n","path":null,"size_bytes":5027,"size_tokens":null},"telegram_bot/services/audio_processor.py":{"content":"\"\"\"\nAudio Processing Service\nTranscribe audio/voice messages with Whisper and summarize with AI\nEnhanced with file size validation, timeout handling, and retry mechanisms\n\"\"\"\nimport os\nimport asyncio\nimport subprocess\nfrom typing import Dict, Any, Optional, Tuple\nfrom utils.error_handler import handle_errors, ErrorLogger, TaskLogger\nfrom utils.database import db\nfrom services.ai_providers import ai_manager\nfrom services.ai_pipeline import ai_pipeline\nfrom services.telegraph_service import telegraph_manager\n\nerror_logger = ErrorLogger(\"audio_processor\")\n\nMAX_AUDIO_SIZE_MB = 25\nMAX_AUDIO_SIZE_FOR_COMPRESSION_MB = 500\nTRANSCRIPTION_TIMEOUT = 120\nSUPPORTED_AUDIO_EXTENSIONS = {'.mp3', '.wav', '.ogg', '.m4a', '.aac', '.flac', '.opus', '.oga', '.wma', '.alac', '.ape', '.mid', '.midi', '.webm', '.m4b', '.ac3', '.dsd', '.dsf', '.dff', '.iff', '.aiff', '.aifc', '.au', '.snd', '.caf', '.dts', '.dtshd', '.mka', '.mkv', '.mov', '.mp4', '.m4v'}\n\nclass AudioProcessor:\n    \"\"\"Process audio/voice messages with enhanced validation and error handling\"\"\"\n    \n    def __init__(self, temp_dir: str = \"telegram_bot/temp\"):\n        self.temp_dir = temp_dir\n        os.makedirs(temp_dir, exist_ok=True)\n        error_logger.log_info(\"AudioProcessor initialized\")\n    \n    def is_audio_file(self, file_name: str) -> bool:\n        \"\"\"Check if a file is an audio file based on extension\"\"\"\n        if not file_name:\n            return False\n        ext = os.path.splitext(file_name)[1].lower()\n        return ext in SUPPORTED_AUDIO_EXTENSIONS\n    \n    def _get_file_size_mb(self, file_path: str) -> float:\n        \"\"\"Get file size in megabytes\"\"\"\n        if os.path.exists(file_path):\n            return os.path.getsize(file_path) / (1024 * 1024)\n        return 0\n    \n    def _validate_audio_file(self, audio_path: str, skip_size_check: bool = False) -> Tuple[bool, str]:\n        \"\"\"Validate audio file before processing\"\"\"\n        if not audio_path:\n            return False, \"Audio path is empty\"\n        \n        if not os.path.exists(audio_path):\n            return False, f\"Audio file not found: {audio_path}\"\n        \n        file_size_mb = self._get_file_size_mb(audio_path)\n        \n        if file_size_mb < 0.001:\n            return False, \"Audio file is empty or corrupted\"\n        \n        ext = os.path.splitext(audio_path)[1].lower()\n        if ext not in SUPPORTED_AUDIO_EXTENSIONS:\n            error_logger.log_warning(f\"Unsupported audio extension: {ext}, attempting anyway\")\n        \n        return True, \"Valid\"\n    \n    @handle_errors(\"audio_processor\", \"process_audio\")\n    async def process_audio(\n        self,\n        client,\n        message_id: int,\n        chat_id: int,\n        task_id: int,\n        task_config: Dict[str, Any]\n    ) -> Optional[Tuple[str, str, Optional[str]]]:\n        \"\"\"\n        Process audio: download -> transcribe -> summarize -> create Telegraph page\n        Returns tuple of (summary, transcript, telegraph_url)\n        \n        Enhanced with:\n        - File size validation\n        - Timeout handling for all operations\n        - Better error recovery\n        - Comprehensive logging\n        \"\"\"\n        task_logger = TaskLogger(task_id)\n        audio_path = None\n        \n        try:\n            await task_logger.log_info(\"Starting audio processing...\")\n            \n            try:\n                message = await asyncio.wait_for(\n                    client.get_messages(chat_id, message_id),\n                    timeout=30\n                )\n            except asyncio.TimeoutError:\n                await task_logger.log_error(\"Timeout fetching message\")\n                return None\n            \n            if not message:\n                await task_logger.log_warning(\"Message not found\")\n                return None\n            \n            has_audio = message.audio or message.voice\n            audio_obj = None\n            is_document_audio = False\n            \n            # Check if message has audio or voice\n            if has_audio:\n                audio_obj = message.audio or message.voice\n            # Check if message has a document that is an audio file\n            elif message.document and self.is_audio_file(message.document.file_name or \"\"):\n                audio_obj = message.document\n                has_audio = True\n                is_document_audio = True\n                await task_logger.log_info(f\"Detected audio document: {message.document.file_name}\")\n            \n            if not has_audio or not audio_obj:\n                await task_logger.log_warning(\"Audio not found in message\")\n                return None\n            \n            audio_size_mb = (audio_obj.file_size or 0) / (1024 * 1024)\n            \n            # Documents don't have duration attribute, only audio/voice do\n            duration = getattr(audio_obj, 'duration', None) or 0\n            await task_logger.log_info(f\"Audio info: {audio_size_mb:.1f}MB, duration: {duration}s\")\n            \n            # Determine file extension\n            if message.voice:\n                ext = \".ogg\"\n            elif message.document and message.document.file_name:\n                # Use the actual file extension from document\n                ext = os.path.splitext(message.document.file_name)[1].lower() or \".m4a\"\n            else:\n                ext = \".mp3\"\n            \n            audio_path = os.path.join(\n                self.temp_dir,\n                f\"audio_{message_id}_{int(asyncio.get_event_loop().time())}{ext}\"\n            )\n            \n            await task_logger.log_info(\"Downloading audio...\")\n            download_timeout = max(60, int(audio_size_mb * 10))\n            try:\n                await asyncio.wait_for(\n                    message.download(file_name=audio_path),\n                    timeout=download_timeout\n                )\n            except asyncio.TimeoutError:\n                await task_logger.log_error(f\"Audio download timeout after {download_timeout}s\")\n                return None\n            \n            is_valid, validation_msg = self._validate_audio_file(audio_path)\n            if not is_valid:\n                await task_logger.log_warning(f\"Audio validation failed: {validation_msg}\")\n                return None\n            \n            # Always convert audio to MP3 format for Whisper API compatibility\n            # MP3 is widely supported by both Groq and OpenAI Whisper\n            current_size_mb = self._get_file_size_mb(audio_path)\n            current_ext = os.path.splitext(audio_path)[1].lower()\n            \n            # Always convert to MP3 regardless of original format\n            needs_processing = True\n            reason = f\"converting {current_ext} to MP3\"\n            if current_size_mb > MAX_AUDIO_SIZE_MB:\n                reason = f\"{current_size_mb:.1f}MB + converting to MP3\"\n            \n            if needs_processing:\n                await task_logger.log_info(f\"Audio processing: {reason}...\")\n                \n                # Always use MP3 for output (widely supported)\n                compressed_path = os.path.join(\n                    self.temp_dir,\n                    f\"audio_compressed_{message_id}_{int(asyncio.get_event_loop().time())}.mp3\"\n                )\n                \n                # Choose bitrates based on file size\n                # Small files: high quality conversion only\n                # Large files: progressive compression\n                if current_size_mb <= MAX_AUDIO_SIZE_MB:\n                    # File is small, just convert to MP3 with good quality\n                    bitrates = [\"128k\", \"64k\", \"32k\"]\n                else:\n                    # File is large, need aggressive compression\n                    bitrates = [\"32k\", \"16k\", \"8k\", \"4k\"]\n                \n                compression_successful = False\n                for bitrate in bitrates:\n                    await task_logger.log_info(f\"Converting to MP3 with bitrate {bitrate}...\")\n                    if self._compress_audio(audio_path, compressed_path, bitrate=bitrate):\n                        compressed_size = self._get_file_size_mb(compressed_path)\n                        if compressed_size <= MAX_AUDIO_SIZE_MB:\n                            await task_logger.log_info(f\"‚úÖ Audio converted: {current_size_mb:.1f}MB ‚Üí {compressed_size:.1f}MB (bitrate: {bitrate})\")\n                            os.remove(audio_path)\n                            audio_path = compressed_path\n                            compression_successful = True\n                            break\n                        else:\n                            await task_logger.log_info(f\"Bitrate {bitrate} not sufficient: {compressed_size:.1f}MB (trying lower...)\")\n                            os.remove(compressed_path)\n                    else:\n                        await task_logger.log_info(f\"Conversion with {bitrate} failed (trying lower...)\")\n                \n                if not compression_successful:\n                    await task_logger.log_error(f\"Could not convert audio to MP3 under {MAX_AUDIO_SIZE_MB}MB\")\n                    if os.path.exists(compressed_path):\n                        try:\n                            os.remove(compressed_path)\n                        except:\n                            pass\n                    return None\n            \n            await task_logger.log_info(\"Audio downloaded, starting transcription...\")\n            \n            try:\n                transcript = await asyncio.wait_for(\n                    asyncio.get_event_loop().run_in_executor(\n                        None,\n                        lambda: asyncio.run(ai_manager.transcribe_audio(audio_path))\n                    ),\n                    timeout=TRANSCRIPTION_TIMEOUT\n                )\n            except asyncio.TimeoutError:\n                await task_logger.log_error(f\"Transcription timeout after {TRANSCRIPTION_TIMEOUT}s\")\n                return None\n            except Exception as e:\n                await task_logger.log_error(f\"Transcription error: {str(e)}\")\n                return None\n            \n            if not transcript or len(transcript.strip()) < 10:\n                await task_logger.log_warning(\"Transcription too short or empty\")\n                return None\n            \n            await task_logger.log_info(f\"Transcription complete: {len(transcript)} chars\")\n            \n            provider_id = task_config.get(\"audio_ai_provider_id\") or task_config.get(\"ai_provider_id\")\n            model_id = task_config.get(\"audio_ai_model_id\") or task_config.get(\"ai_model_id\")\n            \n            provider_name = None\n            model_name = None\n            \n            if provider_id:\n                # Use configured provider\n                provider = await db.get_ai_provider(provider_id)\n                model = await db.get_ai_model(model_id) if model_id else None\n                \n                if not provider:\n                    await task_logger.log_warning(\"Configured AI provider not found, using fallback\")\n                    provider_name = \"groq\"\n                    model_name = \"whisper-large-v3-turbo\"\n                else:\n                    provider_name = provider.get(\"name\", \"groq\")\n                    model_name = model.get(\"model_name\", \"whisper-large-v3-turbo\") if model else \"whisper-large-v3-turbo\"\n            else:\n                # No provider configured, use fallback (Groq)\n                await task_logger.log_info(\"No audio provider configured, using fallback: Groq\")\n                provider_name = \"groq\"\n                model_name = \"whisper-large-v3-turbo\"\n            \n            await task_logger.log_info(f\"Summarizing with {provider_name}/{model_name}...\")\n            \n            try:\n                # Pass task_config so summarization rules and templates are applied\n                result = await ai_pipeline.process_audio_summary(\n                    transcript=transcript,\n                    task_id=task_id,\n                    provider=provider_name,\n                    model=model_name,\n                    config=task_config\n                )\n                \n                if result.success and result.final_text:\n                    summary = result.final_text\n                    await task_logger.log_info(f\"AI summarization successful: {len(summary)} chars\")\n                else:\n                    summary = self._simple_summarize(transcript)\n                    await task_logger.log_warning(\"AI summarization failed, using simple extraction\")\n            except Exception as e:\n                await task_logger.log_warning(f\"AI summarization error: {str(e)}\")\n                summary = self._simple_summarize(transcript)\n            \n            await task_logger.log_info(f\"Summary generated: {len(summary)} chars\")\n            \n            telegraph_url = None\n            try:\n                telegraph_title = \"ÿ™ŸÅÿ±Ÿäÿ∫ ÿßŸÑŸÖŸÇÿ∑ÿπ ÿßŸÑÿµŸàÿ™Ÿä\"\n                # Format HTML without extra whitespace/indentation\n                telegraph_content = (\n                    \"<h3>üìù ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ ÿßŸÑŸÖŸèŸÅÿ±Ÿëÿ∫ ŸÖŸÜ ÿßŸÑŸÖŸÇÿ∑ÿπ ÿßŸÑÿµŸàÿ™Ÿä</h3>\"\n                    f\"<p>{transcript.replace(chr(10), '<br/>')}</p>\"\n                    \"<hr/>\"\n                    \"<h3>üìã ÿßŸÑŸÖŸÑÿÆÿµ</h3>\"\n                    f\"<p>{summary.replace(chr(10), '<br/>')}</p>\"\n                )\n                telegraph_url = await telegraph_manager.create_page(\n                    title=telegraph_title,\n                    content=telegraph_content\n                )\n                if telegraph_url:\n                    await task_logger.log_info(f\"Telegraph page created: {telegraph_url}\")\n                else:\n                    await task_logger.log_warning(\"Telegraph page creation returned no URL\")\n            except Exception as e:\n                await task_logger.log_warning(f\"Failed to create Telegraph page: {str(e)}\")\n                error_logger.log_warning(f\"Telegraph creation error: {str(e)}\")\n            \n            await task_logger.log_success(\"Audio processing completed successfully\")\n            return summary, transcript, telegraph_url\n            \n        except Exception as e:\n            await task_logger.log_error(f\"Audio processing error: {str(e)}\")\n            error_logger.log_warning(f\"Audio processing error: {str(e)}\")\n            return None\n        finally:\n            if audio_path and os.path.exists(audio_path):\n                try:\n                    os.remove(audio_path)\n                    error_logger.log_info(f\"Cleaned up temp audio: {audio_path}\")\n                except Exception:\n                    pass\n    \n    def _compress_audio(self, audio_path: str, output_path: str, bitrate: str = \"32k\") -> bool:\n        \"\"\"Compress audio file using ffmpeg to reduce size below 25MB limit\"\"\"\n        try:\n            cmd = [\n                \"ffmpeg\",\n                \"-i\", audio_path,\n                \"-b:a\", bitrate,\n                \"-ac\", \"1\",\n                \"-ar\", \"16000\",\n                output_path,\n                \"-y\"\n            ]\n            result = subprocess.run(cmd, capture_output=True, timeout=600)\n            return result.returncode == 0\n        except Exception as e:\n            error_logger.log_warning(f\"Audio compression failed: {str(e)}\")\n            return False\n    \n    def _simple_summarize(self, text: str, max_length: int = 500) -> str:\n        \"\"\"Simple text summarization fallback\"\"\"\n        if len(text) <= max_length:\n            return text\n        \n        sentences = text.replace('ÿü', '.').replace('!', '.').split('.')\n        sentences = [s.strip() for s in sentences if s.strip()]\n        \n        if len(sentences) <= 3:\n            return text[:max_length] + \"...\"\n        \n        result = []\n        current_length = 0\n        for sentence in sentences[:5]:\n            if current_length + len(sentence) > max_length:\n                break\n            result.append(sentence)\n            current_length += len(sentence)\n        \n        return '. '.join(result) + '.'\n\n\naudio_processor = AudioProcessor()\n","path":null,"size_bytes":16045,"size_tokens":null},"server/logger.ts":{"content":"import { storage } from \"./storage\";\n\ninterface LogEntry {\n  component: string;\n  function: string;\n  errorType: \"INFO\" | \"WARN\" | \"ERROR\" | \"SUCCESS\";\n  errorMessage: string;\n  stackTrace?: string;\n  metadata?: any;\n}\n\nclass Logger {\n  private queue: LogEntry[] = [];\n  private flushing = false;\n\n  log(entry: LogEntry) {\n    this.queue.push(entry);\n    if (this.queue.length >= 10) {\n      this.flush();\n    }\n  }\n\n  async flush() {\n    if (this.flushing || this.queue.length === 0) return;\n    this.flushing = true;\n    \n    const entries = this.queue.splice(0, this.queue.length);\n    for (const entry of entries) {\n      try {\n        await storage.createErrorLog(entry);\n      } catch (e) {\n        // Fail silently to avoid infinite loops\n      }\n    }\n    this.flushing = false;\n  }\n\n  info(component: string, fn: string, message: string, metadata?: any) {\n    this.log({ component, function: fn, errorType: \"INFO\", errorMessage: message, metadata });\n  }\n\n  warn(component: string, fn: string, message: string, metadata?: any) {\n    this.log({ component, function: fn, errorType: \"WARN\", errorMessage: message, metadata });\n  }\n\n  error(component: string, fn: string, message: string, stackTrace?: string, metadata?: any) {\n    this.log({ component, function: fn, errorType: \"ERROR\", errorMessage: message, stackTrace, metadata });\n  }\n\n  success(component: string, fn: string, message: string, metadata?: any) {\n    this.log({ component, function: fn, errorType: \"SUCCESS\", errorMessage: message, metadata });\n  }\n}\n\nexport const logger = new Logger();\n\n// Setup periodic flush\nsetInterval(() => {\n  logger.flush();\n}, 5000);\n","path":null,"size_bytes":1636,"size_tokens":null},"telegram_bot/services/rate_limiter.py":{"content":"\"\"\"\nRate Limiting Service for AI Model Requests\nEnforces TPM (Tokens Per Minute), RPM (Requests Per Minute), and TPD (Tokens Per Day) limits\n\"\"\"\n\nimport asyncio\nimport time\nfrom typing import Dict, Optional, Tuple\nfrom datetime import datetime, timedelta\nfrom utils.error_handler import ErrorLogger\n\nerror_logger = ErrorLogger(\"rate_limiter\")\n\n\nclass RateLimiter:\n    \"\"\"Manages rate limits for AI models\"\"\"\n    \n    def __init__(self):\n        self.token_buckets: Dict[str, Dict] = {}  # model_name -> {tokens, last_refill_time}\n        self.request_counters: Dict[str, Dict] = {}  # model_name -> {count, window_start}\n        self.daily_token_counters: Dict[str, Dict] = {}  # model_name -> {tokens, date}\n        self.lock = asyncio.Lock()\n    \n    async def can_request(\n        self,\n        model_name: str,\n        estimated_tokens: int,\n        tpm_limit: Optional[int] = None,\n        rpm_limit: Optional[int] = None,\n        tpd_limit: Optional[int] = None\n    ) -> Tuple[bool, Optional[str]]:\n        \"\"\"\n        Check if a request can be made within rate limits\n        \n        Args:\n            model_name: Name of the AI model\n            estimated_tokens: Estimated tokens for this request\n            tpm_limit: Tokens Per Minute limit\n            rpm_limit: Requests Per Minute limit\n            tpd_limit: Tokens Per Day limit\n            \n        Returns:\n            (can_request, error_message)\n        \"\"\"\n        async with self.lock:\n            # Check RPM (Requests Per Minute)\n            if rpm_limit:\n                can_request, msg = self._check_rpm(model_name, rpm_limit)\n                if not can_request:\n                    error_logger.log_warning(f\"[RateLimiter] RPM limit exceeded for {model_name}: {msg}\")\n                    return False, msg\n            \n            # Check TPM (Tokens Per Minute)\n            if tpm_limit:\n                can_request, msg = self._check_tpm(model_name, estimated_tokens, tpm_limit)\n                if not can_request:\n                    error_logger.log_warning(f\"[RateLimiter] TPM limit exceeded for {model_name}: {msg}\")\n                    return False, msg\n            \n            # Check TPD (Tokens Per Day)\n            if tpd_limit:\n                can_request, msg = self._check_tpd(model_name, estimated_tokens, tpd_limit)\n                if not can_request:\n                    error_logger.log_warning(f\"[RateLimiter] TPD limit exceeded for {model_name}: {msg}\")\n                    return False, msg\n            \n            # All limits OK, record the request\n            self._record_request(model_name, estimated_tokens)\n            return True, None\n    \n    def _check_rpm(self, model_name: str, rpm_limit: int) -> Tuple[bool, Optional[str]]:\n        \"\"\"Check Requests Per Minute limit\"\"\"\n        now = time.time()\n        \n        if model_name not in self.request_counters:\n            self.request_counters[model_name] = {\"count\": 0, \"window_start\": now}\n        \n        counter = self.request_counters[model_name]\n        window_elapsed = now - counter[\"window_start\"]\n        \n        # Reset window if 60 seconds have passed\n        if window_elapsed >= 60:\n            counter[\"count\"] = 0\n            counter[\"window_start\"] = now\n        \n        if counter[\"count\"] >= rpm_limit:\n            seconds_until_reset = 60 - window_elapsed\n            return False, f\"RPM limit {rpm_limit} reached. Reset in {seconds_until_reset:.1f}s\"\n        \n        return True, None\n    \n    def _check_tpm(self, model_name: str, tokens: int, tpm_limit: int) -> Tuple[bool, Optional[str]]:\n        \"\"\"Check Tokens Per Minute limit\"\"\"\n        now = time.time()\n        \n        if model_name not in self.token_buckets:\n            self.token_buckets[model_name] = {\"tokens\": tpm_limit, \"last_refill\": now}\n        \n        bucket = self.token_buckets[model_name]\n        elapsed = now - bucket[\"last_refill\"]\n        \n        # Refill tokens (1 token per (60/tpm_limit) milliseconds)\n        if elapsed > 0:\n            refill_rate = tpm_limit / 60  # tokens per second\n            refill_tokens = refill_rate * elapsed\n            bucket[\"tokens\"] = min(tpm_limit, bucket[\"tokens\"] + refill_tokens)\n            bucket[\"last_refill\"] = now\n        \n        if bucket[\"tokens\"] < tokens:\n            tokens_needed = tokens - bucket[\"tokens\"]\n            wait_time = tokens_needed / (tpm_limit / 60)\n            return False, f\"TPM limit {tpm_limit}. Need {tokens_needed} more tokens. Wait {wait_time:.1f}s\"\n        \n        return True, None\n    \n    def _check_tpd(self, model_name: str, tokens: int, tpd_limit: int) -> Tuple[bool, Optional[str]]:\n        \"\"\"Check Tokens Per Day limit\"\"\"\n        today = datetime.now().date().isoformat()\n        \n        if model_name not in self.daily_token_counters:\n            self.daily_token_counters[model_name] = {\"tokens\": 0, \"date\": today}\n        \n        counter = self.daily_token_counters[model_name]\n        \n        # Reset if day has changed\n        if counter[\"date\"] != today:\n            counter[\"tokens\"] = 0\n            counter[\"date\"] = today\n        \n        if counter[\"tokens\"] + tokens > tpd_limit:\n            remaining = tpd_limit - counter[\"tokens\"]\n            return False, f\"TPD limit {tpd_limit} exceeded. {remaining} tokens remaining today\"\n        \n        return True, None\n    \n    def _record_request(self, model_name: str, tokens: int):\n        \"\"\"Record a successful request\"\"\"\n        # Update RPM counter\n        if model_name in self.request_counters:\n            self.request_counters[model_name][\"count\"] += 1\n        \n        # Update TPD counter\n        today = datetime.now().date().isoformat()\n        if model_name in self.daily_token_counters:\n            if self.daily_token_counters[model_name][\"date\"] == today:\n                self.daily_token_counters[model_name][\"tokens\"] += tokens\n        \n        # Update TPM bucket (already decremented by _check_tpm)\n        if model_name in self.token_buckets:\n            self.token_buckets[model_name][\"tokens\"] -= tokens\n        \n        error_logger.log_info(f\"[RateLimiter] Request recorded for {model_name}: {tokens} tokens\")\n    \n    async def get_wait_time(\n        self,\n        model_name: str,\n        estimated_tokens: int,\n        tpm_limit: Optional[int] = None,\n        rpm_limit: Optional[int] = None,\n        tpd_limit: Optional[int] = None\n    ) -> float:\n        \"\"\"\n        Get the wait time (in seconds) until a request can be made\n        Returns 0 if request can be made immediately\n        \"\"\"\n        async with self.lock:\n            wait_times = []\n            \n            # Check each limit and collect wait times\n            if rpm_limit:\n                now = time.time()\n                if model_name in self.request_counters:\n                    counter = self.request_counters[model_name]\n                    window_elapsed = now - counter[\"window_start\"]\n                    if counter[\"count\"] >= rpm_limit and window_elapsed < 60:\n                        wait_times.append(60 - window_elapsed)\n            \n            if tpm_limit:\n                now = time.time()\n                if model_name in self.token_buckets:\n                    bucket = self.token_buckets[model_name]\n                    if bucket[\"tokens\"] < estimated_tokens:\n                        tokens_needed = estimated_tokens - bucket[\"tokens\"]\n                        wait_time = tokens_needed / (tpm_limit / 60)\n                        wait_times.append(wait_time)\n            \n            if tpd_limit:\n                today = datetime.now().date().isoformat()\n                if model_name in self.daily_token_counters:\n                    counter = self.daily_token_counters[model_name]\n                    if counter[\"date\"] == today and counter[\"tokens\"] + estimated_tokens > tpd_limit:\n                        remaining_tokens = tpd_limit - counter[\"tokens\"]\n                        if remaining_tokens <= 0:\n                            # Wait until tomorrow\n                            now = datetime.now()\n                            tomorrow = (now + timedelta(days=1)).replace(hour=0, minute=0, second=0)\n                            wait_time = (tomorrow - now).total_seconds()\n                            wait_times.append(wait_time)\n            \n            return max(wait_times) if wait_times else 0\n\n\n# Global rate limiter instance\nrate_limiter = RateLimiter()\n","path":null,"size_bytes":8409,"size_tokens":null},"client/src/components/ai-rules/AudioSummarizationDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Loader, Mic, Sparkles, ListChecks, Hash, Zap, AlignLeft, Settings2, BookOpen } from \"lucide-react\";\nimport { SummarizationRule, summarizationStyles } from \"./types\";\n\ninterface AudioSummarizationDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: Partial<SummarizationRule>) => void;\n  editingData?: SummarizationRule | null;\n  isLoading?: boolean;\n}\n\nconst defaultForm: Partial<SummarizationRule> = {\n  name: '',\n  prompt: '',\n  maxLength: 300,\n  style: 'balanced',\n  keyPointsCount: 3,\n  isActive: true,\n  priority: 0\n};\n\nconst styleIcons: Record<string, { icon: string; color: string; bgColor: string }> = {\n  brief: { icon: '‚ö°', color: 'text-blue-500', bgColor: 'bg-blue-500' },\n  balanced: { icon: '‚öñÔ∏è', color: 'text-purple-500', bgColor: 'bg-purple-500' },\n  detailed: { icon: 'üìö', color: 'text-emerald-500', bgColor: 'bg-emerald-500' },\n  technical: { icon: 'üîß', color: 'text-orange-500', bgColor: 'bg-orange-500' },\n};\n\nexport function AudioSummarizationDialog({ open, onOpenChange, onSubmit, editingData, isLoading }: AudioSummarizationDialogProps) {\n  const [form, setForm] = useState<Partial<SummarizationRule>>(defaultForm);\n\n  useEffect(() => {\n    if (editingData) {\n      setForm(editingData);\n    } else {\n      setForm(defaultForm);\n    }\n  }, [editingData, open]);\n\n  const handleSubmit = () => {\n    onSubmit(form);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[650px] p-0 overflow-hidden bg-gradient-to-b from-background to-background/95\">\n        <div className=\"bg-gradient-to-l from-blue-500/10 via-cyan-500/10 to-teal-500/10 dark:from-blue-500/20 dark:via-cyan-500/15 dark:to-teal-500/10\">\n          <DialogHeader className=\"p-6 pb-4\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"p-3 rounded-2xl bg-gradient-to-br from-blue-500 to-cyan-600 shadow-lg shadow-blue-500/25\">\n                <Mic className=\"h-6 w-6 text-white\" />\n              </div>\n              <div>\n                <DialogTitle className=\"text-xl font-bold bg-gradient-to-l from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent\">\n                  {editingData ? \"ÿ™ÿπÿØŸäŸÑ ŸÇÿßÿπÿØÿ© ÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿµŸàÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿπÿØÿ© ÿ™ŸÑÿÆŸäÿµ ÿµŸàÿ™\"}\n                </DialogTitle>\n                <DialogDescription className=\"text-sm mt-1 text-muted-foreground\">\n                  ÿ£ÿπÿØ ŸÇÿßÿπÿØÿ© ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÖŸÇÿßÿ∑ÿπ ÿßŸÑÿµŸàÿ™Ÿäÿ© ŸàÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿµŸàÿ™Ÿäÿ©\n                </DialogDescription>\n              </div>\n            </div>\n          </DialogHeader>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <Sparkles className=\"h-4 w-4 text-blue-500\" />\n              ÿßÿ≥ŸÖ ÿßŸÑŸÇÿßÿπÿØÿ©\n            </Label>\n            <Input\n              value={form.name}\n              onChange={(e) => setForm({ ...form, name: e.target.value })}\n              placeholder=\"ŸÖÿ´ÿßŸÑ: ÿ™ŸÑÿÆŸäÿµ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿµŸàÿ™Ÿäÿ© ÿßŸÑŸÖÿÆÿ™ÿµÿ±\"\n              className=\"h-12 text-base border-2 focus:border-primary/50 transition-all rounded-xl bg-muted/30\"\n            />\n          </div>\n\n          <div className=\"space-y-3\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <BookOpen className=\"h-4 w-4 text-purple-500\" />\n              ÿ£ÿ≥ŸÑŸàÿ® ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n            </Label>\n            <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-2\">\n              {summarizationStyles.map((style) => {\n                const styleInfo = styleIcons[style.value] || styleIcons.balanced;\n                const isSelected = form.style === style.value;\n                return (\n                  <button\n                    key={style.value}\n                    type=\"button\"\n                    onClick={() => setForm({ ...form, style: style.value })}\n                    className={`p-3 rounded-xl border-2 transition-all duration-200 text-center ${\n                      isSelected\n                        ? `border-primary/50 bg-primary/10 dark:bg-primary/20 ring-2 ring-primary/20`\n                        : 'border-border hover:border-primary/30 hover:bg-muted/50'\n                    }`}\n                  >\n                    <div className=\"text-2xl mb-1\">{styleInfo.icon}</div>\n                    <div className=\"font-semibold text-xs\">{style.label}</div>\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n            <div className=\"space-y-3\">\n              <Label className=\"text-sm font-semibold flex items-center gap-2\">\n                <Hash className=\"h-4 w-4 text-blue-500\" />\n                ÿßŸÑÿ∑ŸàŸÑ ÿßŸÑÿ£ŸÇÿµŸâ: <span className=\"text-primary font-bold\">{form.maxLength} ÿ≠ÿ±ŸÅ</span>\n              </Label>\n              <div className=\"px-2\">\n                <Slider\n                  value={[form.maxLength || 300]}\n                  onValueChange={([value]) => setForm({ ...form, maxLength: value })}\n                  min={100}\n                  max={2000}\n                  step={50}\n                  className=\"w-full\"\n                />\n                <div className=\"flex justify-between text-xs text-muted-foreground mt-2\">\n                  <span>100</span>\n                  <span>2000</span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label className=\"text-sm font-semibold flex items-center gap-2\">\n                <ListChecks className=\"h-4 w-4 text-cyan-500\" />\n                ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©: <span className=\"text-primary font-bold\">{form.keyPointsCount}</span>\n              </Label>\n              <div className=\"px-2\">\n                <Slider\n                  value={[form.keyPointsCount || 3]}\n                  onValueChange={([value]) => setForm({ ...form, keyPointsCount: value })}\n                  min={1}\n                  max={10}\n                  step={1}\n                  className=\"w-full\"\n                />\n                <div className=\"flex justify-between text-xs text-muted-foreground mt-2\">\n                  <span>1</span>\n                  <span>10</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <Settings2 className=\"h-4 w-4 text-purple-500\" />\n              ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©\n            </Label>\n            <Input\n              type=\"number\"\n              value={form.priority}\n              onChange={(e) => setForm({ ...form, priority: parseInt(e.target.value) || 0 })}\n              className=\"h-12 border-2 rounded-xl bg-muted/30\"\n              min={0}\n              max={100}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\n              <AlignLeft className=\"h-4 w-4 text-cyan-500\" />\n              ÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÖÿÆÿµÿµÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)\n            </Label>\n            <Textarea\n              value={form.prompt}\n              onChange={(e) => setForm({ ...form, prompt: e.target.value })}\n              placeholder=\"ÿ£ÿ∂ŸÅ ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿÆÿßÿµÿ© ŸÑŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿπŸÜÿØ ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÖŸÇÿßÿ∑ÿπ ÿßŸÑÿµŸàÿ™Ÿäÿ©...\"\n              className=\"min-h-[100px] border-2 rounded-xl bg-muted/30 resize-none\"\n            />\n          </div>\n\n          <div className=\"p-4 rounded-xl border-2 border-blue-500/30 bg-gradient-to-l from-blue-500/5 to-cyan-500/5 dark:from-blue-500/10 dark:to-cyan-500/10\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className={`p-2 rounded-xl ${form.isActive ? 'bg-blue-500 text-white' : 'bg-muted'}`}>\n                  <Zap className=\"h-5 w-5\" />\n                </div>\n                <div>\n                  <div className=\"font-semibold\">ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÇÿßÿπÿØÿ©</div>\n                  <div className=\"text-xs text-muted-foreground\">ÿßŸÑŸÇÿßÿπÿØÿ© {form.isActive ? 'ŸÖŸÅÿπŸÑÿ©' : 'ŸÖÿπÿ∑ŸÑÿ©'}</div>\n                </div>\n              </div>\n              <Switch\n                checked={form.isActive}\n                onCheckedChange={(checked) => setForm({ ...form, isActive: checked })}\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 p-6 pt-0\">\n          <Button\n            onClick={handleSubmit}\n            disabled={isLoading || !form.name}\n            className=\"flex-1 h-12 rounded-xl bg-gradient-to-l from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 text-white font-bold shadow-lg shadow-blue-500/25\"\n          >\n            {isLoading && <Loader className=\"h-5 w-5 ml-2 animate-spin\" />}\n            {editingData ? \"ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™\" : \"ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿπÿØÿ©\"}\n          </Button>\n          <Button\n            variant=\"outline\"\n            className=\"h-12 px-8 rounded-xl border-2\"\n            onClick={() => onOpenChange(false)}\n          >\n            ÿ•ŸÑÿ∫ÿßÿ°\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9989,"size_tokens":null},"COMPLETE_FIELD_EXTRACTION_FIX_REPORT.md":{"content":"# ÿ™ŸÇÿ±Ÿäÿ± ÿ•ÿµŸÑÿßÿ≠ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ¥ÿßŸÖŸÑ\n\n## üìã ŸÖŸÑÿÆÿµ ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ ŸàÿßŸÑÿ≠ŸÑŸàŸÑ\n\nÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ Ÿàÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿ≠ÿ±ÿ¨ÿ©: **ÿßŸÑÿ≠ŸÇŸàŸÑ (ÿßŸÑÿ™ÿµŸÜŸäŸÅÿå ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±ÿå ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©ÿå ÿßŸÑŸÖÿµÿØÿ±) ŸÉÿßŸÜÿ™ ŸÅÿßÿ±ÿ∫ÿ©** ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ ŸàÿßŸÑŸÅŸäÿØŸäŸà ŸàÿßŸÑÿµŸàÿ™ ŸÑÿ£ŸÜŸá ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿØÿπÿßÿ° `_extract_fields_with_ai` ŸÇÿ®ŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÇÿßŸÑÿ®.\n\n---\n\n## ‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿµŸÑÿßÿ≠ÿßÿ™ ÿßŸÑŸÖŸÜŸÅÿ∞ÿ©\n\n### 1. **ÿ•ÿµŸÑÿßÿ≠ #1: ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ (Link Processing)**\n**ÿßŸÑŸÖŸàŸÇÿπ:** ÿ≥ÿ∑Ÿàÿ± 160-223  \n**ÿßŸÑŸÖÿ¥ŸÉŸÑÿ©:** ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ ŸÖŸÑÿÆÿµ ÿßŸÑÿ±ÿßÿ®ÿ∑  \n**ÿßŸÑÿ≠ŸÑ:**\n```python\n# ŸÇÿ®ŸÑ: Ÿäÿ∑ÿ®ŸÇ ÿßŸÑŸÇÿßŸÑÿ® ŸÖÿ®ÿßÿ¥ÿ±ÿ© ÿ®ÿØŸàŸÜ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨\ntemplate_result, extracted_data = await self._apply_publishing_template(\n    summary, task_id, template_data\n)\n\n# ÿ®ÿπÿØ: ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿ£ŸàŸÑÿßŸã ÿ´ŸÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ\nextracted_data = await self._extract_fields_with_ai(...)  # ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨\ntemplate_data.update(extracted_data)  # ÿØŸÖÿ¨\ntemplate_result, extracted_data = await self._apply_publishing_template(...)\n```\n\n### 2. **ÿ•ÿµŸÑÿßÿ≠ #2: ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà (Video Processing)**\n**ÿßŸÑŸÖŸàŸÇÿπ:** ÿ≥ÿ∑Ÿàÿ± 354-404  \n**ÿßŸÑÿ≠ŸÑ:** ŸÜŸÅÿ≥ ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© - ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÇÿ®ŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÇÿßŸÑÿ®\n\n### 3. **ÿ•ÿµŸÑÿßÿ≠ #3: ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿµŸàÿ™ (Audio Processing)**\n**ÿßŸÑŸÖŸàŸÇÿπ:** ÿ≥ÿ∑Ÿàÿ± 521-558  \n**ÿßŸÑÿ≠ŸÑ:** ŸÜŸÅÿ≥ ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© - ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÇÿ®ŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÇÿßŸÑÿ®\n\n### 4. **ÿ•ÿµŸÑÿßÿ≠ #4: ŸÖŸÑÿÆÿµ ÿßŸÑÿ£ŸÑÿ®ŸàŸÖÿßÿ™ (Albums Summary)**\n**ÿßŸÑŸÖŸàŸÇÿπ:** ÿ≥ÿ∑Ÿàÿ± 843-857ÿå 1442-1454ÿå 1806-1815  \n**ÿßŸÑÿ≠ŸÑ:** ŸÅÿ±ÿ∂ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸÅŸä ÿ≠ŸÇŸàŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n\n---\n\n## üéØ ÿßŸÑÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ© ŸÅŸä ŸÉŸÑ ÿ•ÿµŸÑÿßÿ≠\n\n```\n1. ÿ≠ÿ≥ÿßÿ® ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ (Serial Number) ŸÖÿ®ŸÉÿ±ÿßŸã\n   ‚Üì\n2. ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ (ŸÅŸäÿØŸäŸà/ÿµŸàÿ™/ÿ±ÿßÿ®ÿ∑) ‚Üí ŸÖŸÑÿÆÿµ\n   ‚Üì\n3. ÿ™ÿ∑ÿ®ŸäŸÇ ŸÖÿ±ÿ¥ÿ≠ÿßÿ™ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ (Content Filters)\n   ‚Üì\n4. ‚úÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ ÿßŸÑŸÖŸÑÿÆÿµ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ AI:\n   - ÿßŸÑÿ™ÿµŸÜŸäŸÅ (Classification)\n   - ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ± (News Type)\n   - ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© (Province)\n   - ÿßŸÑŸÖÿµÿØÿ± (Source)\n   ‚Üì\n5. ÿØŸÖÿ¨ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ© ŸÖÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ŸàŸÑŸäÿ©\n   ‚Üì\n6. ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÇÿßŸÑÿ® ŸÖÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\n   ‚Üì\n7. ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ•ŸÑŸâ ÿßŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸáÿØŸÅÿ©\n   ‚Üì\n8. ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ\n```\n\n---\n\n## üìä ÿßŸÑŸÖŸÇÿßÿ±ŸÜÿ© ŸÇÿ®ŸÑ Ÿàÿ®ÿπÿØ\n\n| ÿßŸÑŸÜŸàÿπ | ÿßŸÑŸÖÿ¥ŸÉŸÑÿ© | ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ¢ŸÜ |\n|--------|---------|-----------|\n| **ÿ±Ÿàÿßÿ®ÿ∑** | ÿ≠ŸÇŸàŸÑ ŸÅÿßÿ±ÿ∫ÿ© | ‚úÖ ÿ™Ÿèÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÖŸÜ ŸÖŸÑÿÆÿµ ÿßŸÑÿ±ÿßÿ®ÿ∑ |\n| **ŸÅŸäÿØŸäŸà** | ÿ≠ŸÇŸàŸÑ ŸÅÿßÿ±ÿ∫ÿ© | ‚úÖ ÿ™Ÿèÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÖŸÜ ŸÖŸÑÿÆÿµ ÿßŸÑŸÅŸäÿØŸäŸà |\n| **ÿµŸàÿ™** | ÿ≠ŸÇŸàŸÑ ŸÅÿßÿ±ÿ∫ÿ© | ‚úÖ ÿ™Ÿèÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÖŸÜ ŸÖŸÑÿÆÿµ ÿßŸÑÿµŸàÿ™ |\n| **ÿ£ŸÑÿ®ŸàŸÖÿßÿ™** | ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ ŸÅŸä ÿßŸÑÿ™ŸÑÿÆŸäÿµ | ‚úÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸäŸèÿ≥ÿ™ÿÆÿØŸÖ |\n\n---\n\n## üîç ÿßŸÑÿπŸÖŸÑŸäÿ© ÿßŸÑÿ™ŸÅÿµŸäŸÑŸäÿ© ŸÑŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨\n\n### ÿπŸÜÿØ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ±ÿßÿ®ÿ∑:\n```\nÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÅŸäÿØŸäŸà\n  ‚Üì\nŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ (Link Processor)\n  ‚Üì \nŸÖŸÑÿÆÿµ ÿßŸÑŸÅŸäÿØŸäŸà (ŸÖÿ´ŸÑÿßŸã: \"ÿßŸÑÿØŸÉÿ™Ÿàÿ± ÿ£ÿ≠ŸÖÿØ Ÿäÿ™ÿ≠ÿØÿ´ ÿπŸÜ ÿßŸÑÿ•ŸäŸÖÿßŸÜ...\")\n  ‚Üì\nAI ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ:\n  - ÿßŸÑÿ™ÿµŸÜŸäŸÅ: ÿØŸäŸÜŸä/ÿ±Ÿàÿ≠Ÿä\n  - ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±: ŸÖÿ≠ÿßÿ∂ÿ±ÿ©\n  - ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©: (ÿ•ŸÜ Ÿàÿ¨ÿØÿ™)\n  - ÿßŸÑŸÖÿµÿØÿ±: ÿßÿ≥ŸÖ ÿßŸÑŸÇŸÜÿßÿ©\n  ‚Üì\nŸÇÿßŸÑÿ® ÿßŸÑŸÜÿ¥ÿ± ŸäŸèÿ∑ÿ®ŸÇ ŸÖÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©\n```\n\n---\n\n## ‚úÖ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©\n\n### ŸÑŸÉŸÑ ŸÜŸàÿπ ŸÖÿ≠ÿ™ŸàŸâ (ÿ±Ÿàÿßÿ®ÿ∑/ŸÅŸäÿØŸäŸà/ÿµŸàÿ™):\n\n- ‚úÖ Ÿäÿ™ŸÖ ÿ≠ÿ≥ÿßÿ® ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØ ŸÖÿ®ŸÉÿ±ÿßŸã\n- ‚úÖ Ÿäÿ™ŸÖ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠\n- ‚úÖ Ÿäÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ŸÖÿ±ÿ¥ÿ≠ÿßÿ™ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ\n- ‚úÖ Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ AI **ŸÇÿ®ŸÑ** ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÇÿßŸÑÿ®\n- ‚úÖ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÑÿß ÿ™ÿ∏Ÿáÿ± ŸÅÿßÿ±ÿ∫ÿ©\n- ‚úÖ ÿßŸÑŸÇÿßŸÑÿ® ŸäŸèÿ∑ÿ®ŸÇ ŸÖÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÉÿßŸÖŸÑÿ©\n- ‚úÖ Ÿäÿ™ŸÖ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸÜŸàÿßÿ™\n\n---\n\n## üìù ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿπÿØŸëŸÑÿ©\n\n**telegram_bot/services/forwarding_engine.py**\n\n1. ÿ≥ÿ∑Ÿàÿ± 160-223: ÿ•ÿµŸÑÿßÿ≠ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÑŸÑÿ±Ÿàÿßÿ®ÿ∑\n2. ÿ≥ÿ∑Ÿàÿ± 354-404: ÿ•ÿµŸÑÿßÿ≠ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÑŸÑŸÅŸäÿØŸäŸà\n3. ÿ≥ÿ∑Ÿàÿ± 521-558: ÿ•ÿµŸÑÿßÿ≠ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÑŸÑÿµŸàÿ™\n4. ÿ≥ÿ∑Ÿàÿ± 843-857: ŸÅÿ±ÿ∂ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ±\n5. ÿ≥ÿ∑Ÿàÿ± 1442-1454: ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ≠ŸÇŸàŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n6. ÿ≥ÿ∑Ÿàÿ± 1806-1815: ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ™ŸÑÿÆŸäÿµ ŸÇÿ®ŸÑ ÿ®ŸÜÿßÿ° ÿßŸÑŸÇÿßŸÑÿ®\n\n---\n\n## üß™ ÿßÿÆÿ™ÿ®ÿßÿ± ÿ¥ÿßŸÖŸÑ\n\n### ÿßÿÆÿ™ÿ®ÿßÿ± #1: ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±ÿßÿ®ÿ∑\n```\n1. ÿ£ÿ±ÿ≥ŸÑ ÿ±ÿßÿ®ÿ∑ ŸÅŸäÿØŸäŸà Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ:\n   - ÿ™ÿµŸÜŸäŸÅ Ÿàÿßÿ∂ÿ≠ (ÿ≥Ÿäÿßÿ≥Ÿäÿå ÿ±Ÿäÿßÿ∂Ÿäÿå ÿØŸäŸÜŸä)\n   - ÿßÿ≥ŸÖ ŸÖÿ≠ÿßŸÅÿ∏ÿ©\n   - ŸÖÿµÿØÿ± ÿßŸÑÿÆÿ®ÿ±\n\nÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑŸÖÿ™ŸàŸÇÿπÿ©:\n‚úÖ ÿßŸÑÿ™ÿµŸÜŸäŸÅ: [ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©]\n‚úÖ ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±: [ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©]\n‚úÖ ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©: [ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©]\n‚úÖ ÿßŸÑŸÖÿµÿØÿ±: [ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©]\n```\n\n### ÿßÿÆÿ™ÿ®ÿßÿ± #2: ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±\n```\n1. ÿ£ÿ±ÿ≥ŸÑ ŸÅŸäÿØŸäŸà ŸÖÿπ ŸÉÿßÿ®ÿ¥ŸÜ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÖÿπŸÑŸàŸÖÿßÿ™\nÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: ŸÜŸÅÿ≥ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± #1\n```\n\n### ÿßÿÆÿ™ÿ®ÿßÿ± #3: ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ŸÑÿ®ŸàŸÖ\n```\n1. ÿ£ÿ±ÿ≥ŸÑ ÿ£ŸÑÿ®ŸàŸÖ (3 ÿµŸàÿ±) ŸÖÿπ ŸÉÿßÿ®ÿ¥ŸÜÿßÿ™\nÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± Ÿäÿ∏Ÿáÿ±ÿå ŸÑÿß ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä\n```\n\n---\n\n## üìå ŸÜŸÇÿßÿ∑ ŸÖŸáŸÖÿ©\n\n1. **ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿ≠ÿ±ÿ¨**: ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ **Ÿäÿ¨ÿ®** ÿ£ŸÜ Ÿäÿ™ŸÖ ŸÇÿ®ŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÇÿßŸÑÿ®\n2. **ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖŸÑÿÆÿµ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨**: Ÿäÿ¨ÿ® ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖŸÑÿÆÿµ ÿßŸÑŸÅŸäÿØŸäŸà/ÿßŸÑÿµŸàÿ™/ÿßŸÑÿ±ÿßÿ®ÿ∑ÿå ŸÑÿß ÿßŸÑŸÉÿßÿ®ÿ¥ŸÜ ÿßŸÑÿ£ÿµŸÑŸä\n3. **ÿØŸÖÿ¨ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™**: ÿßÿ≥ÿ™ÿØÿπÿßÿ° `template_data.update(extracted_data)` Ÿäÿ∂ŸÖŸÜ ÿπÿØŸÖ ŸÅŸÇÿØÿßŸÜ ÿ£Ÿä ÿ®ŸäÿßŸÜÿßÿ™\n\n---\n\n## üéØ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©\n\n### ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑŸÖÿ≠ŸÑŸàŸÑÿ©: **4**\n1. ‚úÖ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÅÿßÿ±ÿ∫ÿ© ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑\n2. ‚úÖ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÅÿßÿ±ÿ∫ÿ© ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà\n3. ‚úÖ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÅÿßÿ±ÿ∫ÿ© ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿµŸàÿ™\n4. ‚úÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ Ÿäÿ∏Ÿáÿ± ŸÅŸä ÿßŸÑÿ™ŸÑÿÆŸäÿµ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßŸÑŸÖŸÑÿÆÿµ\n\n### ÿßŸÑÿ≠ÿßŸÑÿ©: **‚úÖ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÅŸàÿ±Ÿä**\n\n---\n\n## üìÑ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©\n\n- `CAPTION_SUMMARIZATION_DEBUG_REPORT.md` - ÿ™ŸÅÿßÿµŸäŸÑ ŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n- `VIDEO_AUDIO_FIELD_EXTRACTION_FIX_REPORT.md` - ÿ™ŸÅÿßÿµŸäŸÑ ŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑŸÅŸäÿØŸäŸà ŸàÿßŸÑÿµŸàÿ™\n","path":null,"size_bytes":6721,"size_tokens":null},"CAPTION_SUMMARIZATION_DEBUG_REPORT.md":{"content":"# ÿ™ŸÇÿ±Ÿäÿ± ÿ™ŸÅÿµŸäŸÑŸä ÿπŸÜ ŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ ŸÅŸä ÿßŸÑÿ£ŸÑÿ®ŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ¨ŸÖÿπÿ© ÿπŸÑŸâ ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ\n\n## üìã ŸÖŸÑÿÆÿµ ÿ™ŸÜŸÅŸäÿ∞Ÿä\n\nÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ Ÿàÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿ≠ÿ±ÿ¨ÿ© ŸÉÿßŸÜÿ™ ÿ™ÿ≥ÿ®ÿ® ÿ∏ŸáŸàÿ± **ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä ÿßŸÑŸÉÿßŸÖŸÑ ŸÑŸÑŸÉÿßÿ®ÿ¥ŸÜ** ŸÅŸä ÿ≠ŸÇŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸÖŸÜ AI.\n\n---\n\n## üîç ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑŸÖŸÉÿ™ÿ¥ŸÅÿ©\n\n### 1. ‚úÖ **ÿßŸÑŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© - ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ Ÿäÿ∏Ÿáÿ± ŸÅŸä ÿßŸÑÿ™ŸÑÿÆŸäÿµ**\n**ÿßŸÑŸÖŸàŸÇÿπ:** `forwarding_engine.py` ÿ≥ÿ∑Ÿàÿ± 1431-1436  \n**ÿßŸÑÿ≥ÿ®ÿ®:** ÿπŸÜÿØŸÖÿß ŸäŸÉŸàŸÜ ŸÜŸàÿπ ÿßŸÑÿ≠ŸÇŸÑ `\"summary\"` ÿ£Ÿà `\"content\"`, Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ `processed_text` (ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ±)ÿå ŸÑŸÉŸÜ ÿ•ÿ∞ÿß ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ŸÖÿ±Ÿäÿ±Ÿá ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠ ÿ£Ÿà ŸÉÿßŸÜ Noneÿå Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ `text` (ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä ÿßŸÑŸÉÿßŸÖŸÑ)\n\n**ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±:** ‚ùå ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ Ÿäÿ∏Ÿáÿ± ŸÅŸä ŸÇÿßŸÑÿ® ÿßŸÑŸÜÿ¥ÿ± ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßŸÑŸÖŸÑÿÆÿµ\n\n---\n\n### 2. ‚úÖ **ŸÖÿ¥ŸÉŸÑÿ© ÿπÿØŸÖ ŸÅÿ±ÿ∂ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ±**\n**ÿßŸÑŸÖŸàŸÇÿπ:** ÿ≥ÿ∑Ÿàÿ± 843-846 (ŸÇÿ®ŸÑ ÿßŸÑÿ™ÿπÿØŸäŸÑ)  \n**ÿßŸÑŸÖÿ¥ŸÉŸÑÿ©:** ÿßŸÑŸÉŸàÿØ ŸÑŸÖ ŸäŸÅÿ±ÿ∂ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ `processed_caption` ÿπŸÜÿØ ÿ™ŸàŸÅÿ±Ÿáÿå ÿ®ŸÑ ŸÉÿßŸÜ Ÿäÿπÿ™ŸÖÿØ ÿπŸÑŸâ ÿßŸÑÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿ∂ÿπŸäŸÅÿ©  \n**ÿßŸÑÿ•ÿµŸÑÿßÿ≠:** ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ¥ÿ±ÿ∑ ŸÖŸÜ `if processed_caption and not extracted_data.get()` ÿ•ŸÑŸâ ŸÅÿ±ÿ∂ ŸÖÿ®ÿßÿ¥ÿ±\n\n---\n\n### 3. ‚úÖ **ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ summarization_enabled**\n**ÿßŸÑŸÖŸàŸÇÿπ:** ÿ≥ÿ∑ÿ± 752  \n**ÿßŸÑŸÖÿ¥ŸÉŸÑÿ©:** ÿßŸÑÿ™ÿ≠ŸÇŸÇ Ÿäÿ™ŸÖ ŸÖŸÜ ŸÖŸÅÿ™ÿßÿ≠ Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑ ŸÅŸä ÿ®ÿπÿ∂ ÿßŸÑÿ≠ÿßŸÑÿßÿ™  \n**ÿßŸÑÿ≠ŸÑ:** ÿßŸÑÿ™ÿ≠ŸÇŸÇ Ÿäÿ™ŸÖ ŸÖŸÜ ŸÖŸÅÿ™ÿßÿ≠ŸäŸÜ: `summarizationEnabled` Ÿà `summarization_enabled`\n\n---\n\n### 4. ‚úÖ **ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≤ÿØŸàÿ¨**\n**ÿßŸÑŸÖŸàŸÇÿπ:** ÿ≥ÿ∑Ÿàÿ± 1718-1754  \n**ÿßŸÑŸÖÿ¥ŸÉŸÑÿ©:** ŸÅŸä ÿ®ÿπÿ∂ ÿßŸÑÿ≠ÿßŸÑÿßÿ™ Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖÿ±ÿ™ŸäŸÜÿå ŸÖŸÖÿß Ÿäÿ≥ÿ®ÿ® ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ŸÖŸàÿßÿ±ÿØ ÿ∫Ÿäÿ± ÿ∂ÿ±Ÿàÿ±Ÿä  \n**ÿßŸÑÿ≠ŸÑ:** ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÅÿ≠ÿµ `fields_already_extracted` ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖÿ≤ÿØŸàÿ¨\n\n---\n\n## ‚úÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠ÿßÿ™ ÿßŸÑŸÖŸÜŸÅÿ∞ÿ©\n\n### ÿ•ÿµŸÑÿßÿ≠ #1: ŸÅÿ±ÿ∂ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸÅŸä ÿ≠ŸÇŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n```python\n# ŸÇÿ®ŸÑ (ÿÆÿ∑ÿ£):\nif processed_caption and not extracted_data.get(\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"):\n    extracted_data[\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"] = processed_caption\n\n# ÿ®ÿπÿØ (ÿµÿ≠Ÿäÿ≠):\nif processed_caption:\n    extracted_data[\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"] = processed_caption\n    extracted_data[\"summary\"] = processed_caption\n    log_detailed(\"info\", \"forwarding_engine\", \"_process_media_group_after_delay\",\n                f\"‚úÖ FORCED summary field to use processed caption ({len(processed_caption)} chars)\")\n```\n**ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±:** ‚úÖ Ÿäÿ∂ŸÖŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ÿØÿßÿ¶ŸÖÿßŸã\n\n---\n\n### ÿ•ÿµŸÑÿßÿ≠ #2: ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ ŸÜŸàÿπ \"summary\"\n```python\n# ŸÇÿ®ŸÑ (ÿ∂ÿπŸäŸÅ):\nif field_type == \"summary\" or field_type == \"content\":\n    summary_text = processed_text if processed_text else text\n\n# ÿ®ÿπÿØ (ŸÇŸàŸä):\nif field_type == \"summary\" or field_type == \"content\":\n    if processed_text:\n        summary_text = processed_text\n        log_detailed(\"info\", ..., f\"‚úÖ Using AI-processed text for {field_type}\")\n    else:\n        summary_text = text\n        log_detailed(\"warning\", ..., f\"‚ö†Ô∏è No processed_text available\")\n```\n**ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±:** ‚úÖ Ÿäÿ∂ŸÖŸÜ ÿ£ŸàŸÑŸàŸäÿ© ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸÖÿπ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ™ŸÅÿµŸäŸÑŸä ŸÑŸÑÿ£ÿÆÿ∑ÿßÿ°\n\n---\n\n### ÿ•ÿµŸÑÿßÿ≠ #3: ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÇÿ®ŸÑ ÿ®ŸÜÿßÿ° ÿßŸÑŸÇÿßŸÑÿ®\n```python\n# ÿ¨ÿØŸäÿØ:\nif extracted_data:\n    has_summary = extracted_data.get(\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\") or extracted_data.get(\"summary\")\n    if has_summary:\n        log_detailed(\"info\", ..., f\"‚úÖ Summary field present: {len(has_summary)} chars\")\n    else:\n        log_detailed(\"warning\", ..., f\"‚ö†Ô∏è Summary field NOT found in extracted_data!\")\n```\n**ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±:** ‚úÖ ŸäŸÉÿ™ÿ¥ŸÅ ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ ŸÅŸä ŸÖÿ±ÿ≠ŸÑÿ© ŸÖÿ®ŸÉÿ±ÿ©\n\n---\n\n### ÿ•ÿµŸÑÿßÿ≠ #4: ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ (Logging)\n```python\n# ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ¨ŸÑÿßÿ™ ÿ™ŸÅÿµŸäŸÑŸäÿ©:\n- ŸÖÿ™Ÿâ Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸàŸÖÿ™Ÿâ ÿßŸÑÿ£ÿµŸÑŸä\n- ÿ∑ŸàŸÑ ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿ©\n- ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸàŸÖÿµÿßÿØÿ±Ÿáÿß\n- ÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™ ÿπŸÜÿØ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©\n```\n**ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±:** ‚úÖ ÿ™ÿ™ÿ®ÿπ ÿØŸÇŸäŸÇ ŸÑŸÑŸÖÿ¥ŸÉŸÑÿ© ÿπŸÜÿØ ÿ≠ÿØŸàÿ´Ÿáÿß\n\n---\n\n## üìä ÿ™ÿØŸÅŸÇ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ŸÑÿ®ŸàŸÖÿßÿ™ - ÿßŸÑÿ¢ŸÜ ÿµÿ≠Ÿäÿ≠\n\n```\n1. ÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ© ŸÖŸÜ ÿßŸÑÿ£ŸÑÿ®ŸàŸÖ (ÿßŸÑÿµŸàÿ±ÿ© 1)\n   ‚Üì\n2. ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ© (cache)\n   ‚Üì\n3. ÿ®ÿπÿØ 2.5 ÿ´ÿßŸÜŸäÿ©: ÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ\n   ‚Üì\n4. ‚úÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÉÿßÿ®ÿ¥ŸÜÿßÿ™ Ÿàÿ™ÿ¨ŸÖŸäÿπŸáÿß\n   ‚Üì\n5. ‚úÖ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ¨ŸÖÿπ ÿπÿ®ÿ± AI (ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸÅÿπŸÑ)\n   ‚Üì\n6. ‚úÖ ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ÿ•ŸÑŸâ extracted_data[\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"]\n   ‚Üì\n7. ‚úÖ ÿ™ÿ∑ÿ®ŸäŸÇ ŸÇÿßŸÑÿ® ÿßŸÑŸÜÿ¥ÿ± (Ÿäÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ±)\n   ‚Üì\n8. ‚úÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ£ŸÑÿ®ŸàŸÖ ŸÖÿπ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ±\n   ‚Üì\n9. ‚úÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸÅŸä ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ\n```\n\n---\n\n## üß™ ŸÉŸäŸÅŸäÿ© ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±\n\n### ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ≠ÿßŸÑÿ© 1: ŸÖÿπ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n```\n1. ÿ£ÿ±ÿ≥ŸÑ ÿ£ŸÑÿ®ŸàŸÖ (3 ÿµŸàÿ±) ŸÖÿπ ŸÉÿßÿ®ÿ¥ŸÜ ŸÑŸÉŸÑ ÿµŸàÿ±ÿ©\n   ÿßŸÑÿµŸàÿ±ÿ© 1: \"ŸÉÿßÿ®ÿ¥ŸÜ ÿ∑ŸàŸäŸÑ ÿ¨ÿØÿßŸã ÿ±ŸÇŸÖ 1\"\n   ÿßŸÑÿµŸàÿ±ÿ© 2: \"ŸÉÿßÿ®ÿ¥ŸÜ ÿ∑ŸàŸäŸÑ ÿ¨ÿØÿßŸã ÿ±ŸÇŸÖ 2\"\n   ÿßŸÑÿµŸàÿ±ÿ© 3: \"ŸÉÿßÿ®ÿ¥ŸÜ ÿ∑ŸàŸäŸÑ ÿ¨ÿØÿßŸã ÿ±ŸÇŸÖ 3\"\n\n2. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ:\n   ‚úÖ ÿßŸÑŸÉÿßÿ®ÿ¥ŸÜ ÿßŸÑŸÖŸèÿ±ÿ≥ŸÑ = ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸÖŸÜ AI\n   ‚úÖ ÿπÿØŸÖ ÿ∏ŸáŸàÿ± ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑÿ£ÿµŸÑŸäÿ© ÿßŸÑŸÉÿßŸÖŸÑÿ©\n   ‚úÖ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿ™ÿ∏Ÿáÿ± \"‚úÖ FORCED summary field to use processed caption\"\n```\n\n### ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ≠ÿßŸÑÿ© 2: ÿ®ÿØŸàŸÜ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n```\n1. ÿπÿ∑ŸëŸÑ \"summarizationEnabled\" ŸÅŸä ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ©\n2. ÿ£ÿ±ÿ≥ŸÑ ÿ£ŸÑÿ®ŸàŸÖ ÿ®ŸÜŸÅÿ≥ ÿßŸÑÿ∑ÿ±ŸäŸÇÿ©\n3. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ:\n   ‚úÖ ÿßŸÑŸÉÿßÿ®ÿ¥ŸÜ = ÿ™ÿ¨ŸÖŸäÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÉÿßÿ®ÿ¥ŸÜÿßÿ™ (ŸÜÿµŸàÿµ ÿ£ÿµŸÑŸäÿ©)\n   ‚úÖ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿ™ÿ∏Ÿáÿ± \"‚ö†Ô∏è Summary field set to original caption\"\n```\n\n---\n\n## üìù ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ - ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ•ÿµŸÑÿßÿ≠ÿßÿ™\n\n- ‚úÖ Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿ¨ŸÖŸäÿπ ŸÉÿßÿ®ÿ¥ŸÜÿßÿ™ ÿßŸÑÿ£ŸÑÿ®ŸàŸÖ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠\n- ‚úÖ Ÿäÿ™ŸÖ ÿ™ÿ¨ŸÖŸäÿπ ÿßŸÑŸÉÿßÿ®ÿ¥ŸÜÿßÿ™ ŸÅŸä ŸÜÿµ Ÿàÿßÿ≠ÿØ\n- ‚úÖ Ÿäÿ™ŸÖ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ¨ŸÖÿπ ÿπÿ®ÿ± AI (ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸÅÿπŸÑ)\n- ‚úÖ Ÿäÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ÿ•ŸÑŸâ `extracted_data[\"ÿßŸÑÿ™ŸÑÿÆŸäÿµ\"]`\n- ‚úÖ Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸÅŸä ŸÇÿßŸÑÿ® ÿßŸÑŸÜÿ¥ÿ±\n- ‚úÖ ŸÑÿß Ÿäÿ∏Ÿáÿ± ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä ÿßŸÑŸÉÿßŸÖŸÑ ŸÅŸä ÿ≠ŸÇŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ\n- ‚úÖ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ Ÿàÿßÿ∂ÿ≠ÿ© Ÿàÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ™ÿØŸÅŸÇ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠\n- ‚úÖ ŸÑÿß ŸäŸàÿ¨ÿØ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ŸÖÿ≤ÿØŸàÿ¨ ŸÑŸÑÿ≠ŸÇŸàŸÑ\n\n---\n\n## üìå ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿπÿØŸëŸÑÿ©\n\n1. **telegram_bot/services/forwarding_engine.py**\n   - ÿ≥ÿ∑ÿ± 847-857: ŸÅÿ±ÿ∂ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ±\n   - ÿ≥ÿ∑ÿ± 1442-1454: ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ≠ŸÇŸàŸÑ \"summary\"\n   - ÿ≥ÿ∑ÿ± 1806-1815: ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÇÿ®ŸÑ ÿ®ŸÜÿßÿ° ÿßŸÑŸÇÿßŸÑÿ®\n   - ÿ≥ÿ∑ÿ± 1840-1851: ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ¨ŸÑÿßÿ™ ÿ™ŸÅÿµŸäŸÑŸäÿ©\n\n---\n\n## ‚ö†Ô∏è ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ŸÖŸáŸÖÿ©\n\n1. **ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ:** ÿßÿ∞Ÿáÿ® ÿ•ŸÑŸâ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ© Ÿàÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ŸÅÿπŸäŸÑ \"summarizationEnabled\"\n2. **ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ AI Provider:** ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ŸÉŸàŸäŸÜ ŸÖÿ≤ŸàÿØ AI ŸàÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠\n3. **ŸÖÿ±ÿßÿ¨ÿπÿ© ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™:** ÿπŸÜÿØ ÿ≠ÿØŸàÿ´ ŸÖÿ¥ŸÉŸÑÿ©ÿå ÿßÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿπŸÜ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™Ÿä ÿ™ÿ®ÿØÿ£ ÿ®ŸÄ `‚úÖ` Ÿà `‚ö†Ô∏è`\n4. **ÿ≠ŸÇŸàŸÑ ÿßŸÑŸÇÿßŸÑÿ®:** ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿ≠ŸÇŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ ŸÑŸá `field_type: \"summary\"` ŸàŸÑŸäÿ≥ `\"extracted\"`\n\n---\n\n## üéØ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©\n\n‚úÖ **ÿ™ŸÖ ÿ≠ŸÑ ÿßŸÑŸÖÿ¥ŸÉŸÑÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑ**\n- ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ ŸÑŸÜ Ÿäÿ∏Ÿáÿ± ŸÅŸä ÿ≠ŸÇŸÑ ÿßŸÑÿ™ŸÑÿÆŸäÿµ ÿ®ÿπÿØ ÿßŸÑÿ¢ŸÜ\n- ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿÆÿ™ÿµÿ± ŸÖŸÜ AI ÿ≥ŸäŸèÿ≥ÿ™ÿÆÿØŸÖ ÿØÿßÿ¶ŸÖÿßŸã ÿπŸÜÿØ ÿ™ŸàŸÅÿ±Ÿá\n- ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ Ÿàÿßÿ∂ÿ≠ÿ© Ÿàÿ™ÿ≥ÿßÿπÿØ ŸÅŸä ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÖÿ¥ŸÉŸÑÿ© ÿπŸÜÿØ ÿ≠ÿØŸàÿ´Ÿáÿß\n\n**ÿßŸÑÿ≠ÿßŸÑÿ©:** ‚úÖ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ± ŸàÿßŸÑŸÜÿ¥ÿ±\n","path":null,"size_bytes":8191,"size_tokens":null},"VIDEO_AUDIO_FIELD_EXTRACTION_FIX_REPORT.md":{"content":"# ÿ™ŸÇÿ±Ÿäÿ± ÿ•ÿµŸÑÿßÿ≠ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ ÿßŸÑŸÅŸäÿØŸäŸà ŸàÿßŸÑÿµŸàÿ™\n\n## üìã ŸÖŸÑÿÆÿµ ÿßŸÑŸÖÿ¥ŸÉŸÑÿ©\n\nÿßŸÑÿ≠ŸÇŸàŸÑ (ÿßŸÑÿ™ÿµŸÜŸäŸÅÿå ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±ÿå ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©ÿå ÿßŸÑŸÖÿµÿØÿ±) ŸÉÿßŸÜÿ™ **ŸÅÿßÿ±ÿ∫ÿ© ÿ™ŸÖÿßŸÖÿßŸã** ÿπŸÜÿØ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà ŸàÿßŸÑÿµŸàÿ™\n\n## üîç ÿßŸÑÿ≥ÿ®ÿ® ÿßŸÑÿ¨ÿ∞ÿ±Ÿä\n\nÿπŸÜÿØ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà ŸàÿßŸÑÿµŸàÿ™ÿå ÿßŸÑŸÉŸàÿØ ŸÉÿßŸÜ:\n1. ‚úÖ Ÿäÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÖŸÑÿÆÿµ ÿßŸÑŸÅŸäÿØŸäŸà/ÿßŸÑÿµŸàÿ™ ŸÖŸÜ AI\n2. ‚ùå Ÿäÿ∑ÿ®ŸÇ ÿßŸÑŸÇÿßŸÑÿ® ŸÖÿ®ÿßÿ¥ÿ±ÿ© ÿØŸàŸÜ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ\n3. ‚ùå ŸÑÿß Ÿäÿ≥ÿ™ÿØÿπŸä `_extract_fields_with_ai` ŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ (ÿßŸÑÿ™ÿµŸÜŸäŸÅÿå ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©ÿå ÿ•ŸÑÿÆ)\n\n```python\n# ŸÇÿ®ŸÑ (ÿÆÿ∑ÿ£):\ntemplate_result, extracted_data = await self._apply_publishing_template(\n    video_summary, \n    task_id, \n    initial_extracted_data.copy()  # ‚ùå ŸÅŸÇÿ∑ ÿ±ŸÇŸÖ ÿßŸÑŸÇŸäÿØÿå ÿ®ÿØŸàŸÜ ÿ≠ŸÇŸàŸÑ ÿ£ÿÆÿ±Ÿâ\n)\n\n# ÿ®ÿπÿØ (ÿµÿ≠Ÿäÿ≠):\n# 1. ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ ÿßŸÑŸÖŸÑÿÆÿµ\nextracted_data = await self._extract_fields_with_ai(\n    video_summary,  # ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖŸÑÿÆÿµ ŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ\n    task_id,\n    provider_name,\n    model_name,\n    fields_to_extract,\n    serial_number=serial_number,\n    processed_text=video_summary,\n    original_text=message.caption or \"\"\n)\n\n# 2. ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÇÿßŸÑÿ® ŸÖÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©\ntemplate_result, extracted_data = await self._apply_publishing_template(\n    video_summary, \n    task_id, \n    extracted_data  # ‚úÖ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©\n)\n```\n\n## ‚úÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠ÿßÿ™ ÿßŸÑŸÖŸÜŸÅÿ∞ÿ©\n\n### 1. ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà (ÿ≥ÿ∑Ÿàÿ± 354-404)\n```python\n‚úÖ ÿßÿ≥ÿ™ÿØÿπÿßÿ° _extract_fields_with_ai ŸÇÿ®ŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÇÿßŸÑÿ®\n‚úÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ fields_to_extract ŸÖŸÜ ÿßŸÑŸÇÿßŸÑÿ®\n‚úÖ ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ provider_name Ÿà model_name\n‚úÖ ÿ™ŸÖÿ±Ÿäÿ± audio_summary ŸÉŸÜÿµ ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨\n‚úÖ ÿØŸÖÿ¨ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÖÿπ extracted_data ŸÇÿ®ŸÑ ÿßŸÑŸÇÿßŸÑÿ®\n```\n\n### 2. ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿµŸàÿ™ (ÿ≥ÿ∑Ÿàÿ± 521-558)\n```python\n‚úÖ ŸÜŸÅÿ≥ ÿßŸÑÿ•ÿµŸÑÿßÿ≠ ŸÉÿßŸÑŸÅŸäÿØŸäŸà\n‚úÖ ÿßÿ≥ÿ™ÿØÿπÿßÿ° _extract_fields_with_ai ŸÑŸÑÿµŸàÿ™\n‚úÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ ŸÖŸÑÿÆÿµ ÿßŸÑÿµŸàÿ™\n```\n\n## üìä ÿßŸÑÿ™ÿØŸÅŸÇ ÿßŸÑÿµÿ≠Ÿäÿ≠ ÿßŸÑÿ¢ŸÜ\n\n### ŸÑŸÑŸÅŸäÿØŸäŸà:\n```\n1. ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà ÿ®ŸÄ AI ‚Üí ŸÖŸÑÿÆÿµ\n   ‚Üì\n2. ‚úÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ ÿßŸÑŸÖŸÑÿÆÿµ\n   - ÿßŸÑÿ™ÿµŸÜŸäŸÅ\n   - ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ±\n   - ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©\n   - ÿßŸÑŸÖÿµÿØÿ±\n   ‚Üì\n3. ‚úÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÇÿßŸÑÿ® ŸÖÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©\n   ‚Üì\n4. ‚úÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖÿπ ŸÇÿßŸÑÿ® ŸÖŸÉÿ™ŸÖŸÑ\n```\n\n### ŸÑŸÑÿµŸàÿ™:\n```\nŸÜŸÅÿ≥ ÿßŸÑÿ™ÿØŸÅŸÇ ŸÉÿßŸÑŸÅŸäÿØŸäŸà\n```\n\n## üß™ ŸÉŸäŸÅŸäÿ© ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±\n\n### ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà:\n```\n1. ÿ£ÿ±ÿ≥ŸÑ ŸÅŸäÿØŸäŸà ŸÖÿπ ŸÉÿßÿ®ÿ¥ŸÜ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ:\n   - ŸÉŸÑŸÖÿßÿ™ ÿ™ÿØŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿµŸÜŸäŸÅ (ÿ≥Ÿäÿßÿ≥Ÿäÿå ÿ±Ÿäÿßÿ∂Ÿäÿå ÿ•ŸÑÿÆ)\n   - ÿßÿ≥ŸÖ ŸÖÿ≠ÿßŸÅÿ∏ÿ© (ÿ®ÿ∫ÿØÿßÿØÿå ÿßŸÑŸÖŸàÿµŸÑÿå ÿßŸÑÿ®ÿµÿ±ÿ©)\n   - ŸÖÿµÿØÿ± ÿßŸÑÿÆÿ®ÿ±\n\n2. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ:\n   ‚úÖ ÿ≠ŸÇŸÑ ÿßŸÑÿ™ÿµŸÜŸäŸÅ ŸÖŸÖŸÑŸàÿ°\n   ‚úÖ ÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© ŸÖŸÖŸÑŸàÿ°\n   ‚úÖ ÿ≠ŸÇŸÑ ÿßŸÑŸÖÿµÿØÿ± ŸÖŸÖŸÑŸàÿ°\n   ‚úÖ ŸÜŸàÿπ ÿßŸÑÿÆÿ®ÿ± ŸÖŸÖŸÑŸàÿ°\n```\n\n## üìù ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿπÿØŸëŸÑÿ©\n\n- `telegram_bot/services/forwarding_engine.py`\n  - ÿ≥ÿ∑Ÿàÿ± 354-404: ÿ•ÿµŸÑÿßÿ≠ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÑŸÑŸÅŸäÿØŸäŸà\n  - ÿ≥ÿ∑Ÿàÿ± 521-558: ÿ•ÿµŸÑÿßÿ≠ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÑŸÑÿµŸàÿ™\n\n## ‚ö†Ô∏è ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ŸÖŸáŸÖÿ©\n\n1. **ÿßŸÑÿ™ÿµŸÜŸäŸÅ Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨Ÿá ŸÖŸÜ ÿßŸÑŸÖŸÑÿÆÿµ**: ÿπŸÜÿØŸÖÿß ŸäŸÇŸàŸÑ AI \"Ÿáÿ∞ÿß ÿÆÿ®ÿ± ÿ≥Ÿäÿßÿ≥Ÿä\"ÿå ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ \"ÿ≥Ÿäÿßÿ≥Ÿä\"\n2. **ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©**: ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿßÿ™ ŸÅŸä ÿßŸÑŸÖŸÑÿÆÿµ\n3. **ÿßŸÑŸÖÿµÿØÿ±**: ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ŸÖÿµÿØÿ± ÿßŸÑÿÆÿ®ÿ± ŸÖŸÜ ÿßŸÑŸÖŸÑÿÆÿµ ÿ•ŸÜ Ÿàÿ¨ÿØ\n4. **ÿßŸÑŸÉÿßÿ®ÿ¥ŸÜ ÿßŸÑÿ£ÿµŸÑŸä**: ŸäŸèÿ≥ÿ™ÿÆÿØŸÖ ŸÉŸÄ fallback ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÑÿØŸäŸÜÿß ŸÖŸÑÿÆÿµ\n\n## üéØ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©\n\n‚úÖ ÿ¨ŸÖŸäÿπ ÿ≠ŸÇŸàŸÑ ÿßŸÑŸÇÿßŸÑÿ® ÿßŸÑÿ¢ŸÜ ÿ™Ÿèÿ≥ÿ™ÿÆÿ±ÿ¨ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠ ŸÖŸÜ ŸÖŸÑÿÆÿµÿßÿ™ ÿßŸÑŸÅŸäÿØŸäŸà ŸàÿßŸÑÿµŸàÿ™\n‚úÖ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÑŸÜ ÿ™ÿ∏Ÿáÿ± ŸÅÿßÿ±ÿ∫ÿ© ÿ®ÿπÿØ ÿßŸÑÿ¢ŸÜ\n‚úÖ ÿßŸÑŸÇÿßŸÑÿ® ŸäŸèÿ∑ÿ®ŸÇ ŸÖÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ©\n\n**ÿßŸÑÿ≠ÿßŸÑÿ©:** ‚úÖ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ± ŸàÿßŸÑŸÜÿ¥ÿ±\n","path":null,"size_bytes":4206,"size_tokens":null}},"version":2}